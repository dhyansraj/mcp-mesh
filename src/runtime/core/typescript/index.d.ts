/* auto-generated by NAPI-RS */
/* eslint-disable */
/** Handle to a running agent runtime (TypeScript wrapper). */
export declare class JsAgentHandle {
  /**
   * Wait for and return the next mesh event.
   *
   * This is an async method that blocks until an event is available.
   * Returns a JsMeshEvent with eventType "shutdown" when the runtime has shut down.
   */
  nextEvent(): Promise<JsMeshEvent>
  /**
   * Get current dependency endpoints.
   *
   * Returns an object mapping capability names to endpoint URLs.
   */
  getDependencies(): Promise<Record<string, string>>
  /** Get current agent health status. */
  getStatus(): Promise<string>
  /** Get the agent ID assigned by the registry. */
  getAgentId(): Promise<string | null>
  /** Check if shutdown has been requested. */
  isShutdownRequested(): Promise<boolean>
  /** Request graceful shutdown of the agent runtime. */
  shutdown(): Promise<void>
  /**
   * Update the tools/routes registered with the registry.
   *
   * Uses smart diffing - only triggers a heartbeat if tools have changed.
   * Call this after Express route introspection to update route names
   * from placeholders (e.g., "route_0_UNKNOWN:UNKNOWN") to proper names
   * (e.g., "GET:/time").
   *
   * @param tools - Array of tool specifications with updated function names
   * @returns true if the update was sent successfully
   */
  updateTools(tools: Array<JsToolSpec>): Promise<boolean>
  /**
   * Update the HTTP port (e.g., after auto-detection from Express).
   *
   * @param port - The detected HTTP port
   * @returns true if the update was sent successfully
   */
  updatePort(port: number): Promise<boolean>
}

/**
 * Auto-detect external IP address.
 *
 * Uses UDP socket trick to find the IP that would route to external networks.
 * Falls back to "localhost" if detection fails.
 */
export declare function autoDetectIp(): string

/**
 * Get the default value for a configuration key.
 *
 * This allows SDKs to retrieve default values without doing full resolution,
 * useful for documentation, type hints, and avoiding duplicate default definitions.
 *
 * @param keyName - Config key (e.g., "registry_url", "namespace", "health_interval")
 * @returns Default value if the key is known and has a default, null otherwise.
 */
export declare function getDefault(keyName: string): string | null

/**
 * Get the environment variable name for a configuration key.
 *
 * @param keyName - Config key (e.g., "registry_url", "namespace")
 * @returns Environment variable name if the key is known, null otherwise.
 */
export declare function getEnvVar(keyName: string): string | null

/** Get Redis URL with fallback to default (redis://localhost:6379). */
export declare function getRedisUrl(): string

/**
 * Initialize the trace publisher.
 *
 * Must be called before publishing spans. Checks if tracing is enabled
 * and initializes Redis connection.
 *
 * @returns true if tracing is enabled and Redis is available, false otherwise.
 */
export declare function initTracePublisher(): Promise<boolean>

/**
 * Check if trace publishing is available.
 *
 * @returns true if tracing is enabled and Redis is connected.
 */
export declare function isTracePublisherAvailable(): Promise<boolean>

/**
 * Check if distributed tracing is enabled.
 *
 * Checks MCP_MESH_DISTRIBUTED_TRACING_ENABLED environment variable.
 */
export declare function isTracingEnabled(): boolean

/** Agent specification for TypeScript. */
export interface JsAgentSpec {
  /** Unique agent name/identifier */
  name: string
  /** Agent version (semver) */
  version: string
  /** Human-readable description */
  description: string
  /** Registry URL (e.g., "http://localhost:8100") */
  registryUrl: string
  /** HTTP port for this agent */
  httpPort: number
  /** HTTP host announced to registry */
  httpHost: string
  /** Namespace for isolation */
  namespace: string
  /**
   * Agent type: "mcp_agent" (provides capabilities) or "api" (only consumes)
   * Defaults to "mcp_agent" if not specified
   */
  agentType?: string
  /** Tools/capabilities provided by this agent */
  tools: Array<JsToolSpec>
  /** LLM agent specifications for tools using mesh.llm() */
  llmAgents?: Array<JsLlmAgentSpec>
  /** Heartbeat interval in seconds */
  heartbeatInterval: number
}

/** Dependency specification for TypeScript. */
export interface JsDependencySpec {
  /** Capability name to depend on */
  capability: string
  /** Tags for filtering (e.g., ["+fast", "-deprecated"]) */
  tags: Array<string>
  /** Version constraint (e.g., ">=2.0.0") */
  version?: string
}

/**
 * LLM agent specification for TypeScript.
 * Used to register LLM-powered tools with the mesh.
 */
export interface JsLlmAgentSpec {
  /** Unique identifier for this LLM function (matches the tool's function_name) */
  functionId: string
  /**
   * Provider selector - serialized JSON string
   * e.g., '{"capability": "llm", "tags": ["+claude"]}'
   */
  provider: string
  /**
   * Tool filter specification - serialized JSON string
   * e.g., '[{"capability": "calculator"}, {"tags": ["tools"]}]'
   */
  filter?: string
  /** Filter mode: "all", "best_match", or "*" */
  filterMode: string
  /** Maximum agentic loop iterations */
  maxIterations: number
}

/** LLM provider information returned in llm_provider_available events. */
export interface JsLlmProviderInfo {
  /** Function ID of the LLM function that requested this provider */
  functionId: string
  /** Agent ID providing this capability */
  agentId: string
  /** Endpoint URL to call */
  endpoint: string
  /** Function name to call */
  functionName: string
  /** Model name (optional) */
  model?: string
}

/**
 * LLM tool information returned in llm_tools_updated events.
 * Contains resolved tool metadata for LLM agents to use.
 */
export interface JsLlmToolInfo {
  /** Function name of the tool */
  functionName: string
  /** Capability name */
  capability: string
  /** Endpoint URL to call */
  endpoint: string
  /** Agent ID providing this tool */
  agentId: string
  /** Input schema (serialized JSON string) */
  inputSchema?: string
}

/** Mesh event for TypeScript. */
export interface JsMeshEvent {
  /** Event type (e.g., "dependency_available", "agent_registered", "llm_tools_updated") */
  eventType: string
  /** Capability name (for dependency events) */
  capability?: string
  /** Endpoint URL (for dependency_available) */
  endpoint?: string
  /** Function name to call (for dependency_available) */
  functionName?: string
  /** Agent ID (for dependency events) */
  agentId?: string
  /**
   * Function that requested this dependency (for dependency events)
   * This is the tool/function that declared the dependency.
   */
  requestingFunction?: string
  /**
   * Dependency index within the requesting function (for dependency events)
   * This allows SDKs to inject the resolved dependency at the correct position.
   */
  depIndex?: number
  /** Function ID of the LLM agent (for llm_tools_updated, llm_provider_available) */
  functionId?: string
  /** List of available tools (for llm_tools_updated event) */
  tools?: Array<JsLlmToolInfo>
  /** Provider info (for llm_provider_available event) */
  providerInfo?: JsLlmProviderInfo
  /** Error message (for error events) */
  error?: string
  /** Reason for event (for disconnect events) */
  reason?: string
}

/** Tool specification for TypeScript. */
export interface JsToolSpec {
  /** Function name in the code */
  functionName: string
  /** Capability name for discovery */
  capability: string
  /** Version of this capability */
  version: string
  /** Tags for filtering */
  tags: Array<string>
  /** Human-readable description */
  description: string
  /** Dependencies required by this tool */
  dependencies: Array<JsDependencySpec>
  /** JSON Schema for input parameters (MCP format) - serialized JSON string */
  inputSchema?: string
  /** LLM filter specification (for @mesh.llm decorated functions) - serialized JSON string */
  llmFilter?: string
  /** LLM provider specification (for mesh delegation) - serialized JSON string */
  llmProvider?: string
}

/**
 * Publish a trace span to Redis.
 *
 * Publishes span data to the `mesh:trace` Redis stream.
 * Non-blocking - silently handles failures to never break agent operations.
 *
 * @param spanData - Map of span data (all values must be strings)
 * @returns true if published successfully, false otherwise.
 */
export declare function publishSpan(spanData: Record<string, string>): Promise<boolean>

/**
 * Resolve configuration value with priority: ENV > param > default.
 *
 * @param keyName - Config key (e.g., "registry_url", "http_host", "namespace")
 * @param paramValue - Optional value from code/config
 * @returns Resolved value or empty string if unknown key
 */
export declare function resolveConfig(keyName: string, paramValue?: string | undefined | null): string

/**
 * Resolve boolean configuration value with priority: ENV > param > default.
 *
 * @param keyName - Config key (e.g., "distributed_tracing_enabled")
 * @param paramValue - Optional value from code/config
 * @returns Resolved boolean value
 */
export declare function resolveConfigBool(keyName: string, paramValue?: boolean | undefined | null): boolean

/**
 * Resolve integer configuration value with priority: ENV > param > default.
 *
 * @param keyName - Config key (e.g., "http_port", "health_interval")
 * @param paramValue - Optional value from code/config
 * @returns Resolved integer value or null if unknown key
 */
export declare function resolveConfigInt(keyName: string, paramValue?: number | undefined | null): number | null

/**
 * Start an agent runtime with the given specification.
 *
 * This spawns a background Tokio runtime that handles:
 * - Registration with the mesh registry
 * - Periodic heartbeats
 * - Topology change detection
 * - Event streaming
 */
export declare function startAgent(spec: JsAgentSpec): JsAgentHandle
