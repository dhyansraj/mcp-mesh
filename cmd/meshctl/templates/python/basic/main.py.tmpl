#!/usr/bin/env python3
"""
{{ .Name }} - MCP Mesh Agent

{{ if .Description }}{{ .Description }}{{ else }}A MCP Mesh agent generated using meshctl scaffold.{{ end }}
"""

from typing import Any

import mesh
from fastmcp import FastMCP

# FastMCP server instance
app = FastMCP("{{ toPascalCase .Name }} Service")


# ===== TOOLS =====

@app.tool()
@mesh.tool(
    capability="hello",
    description="Say hello to someone",
)
async def hello(name: str = "World") -> str:
    """
    Say hello to someone.

    Args:
        name: The name to greet.

    Returns:
        A greeting message.
    """
    return f"Hello, {name}! I'm {{ .Name }}."


@app.tool()
@mesh.tool(
    capability="echo",
    description="Echo a message back",
)
async def echo(message: str) -> str:
    """
    Echo a message back.

    Args:
        message: The message to echo.

    Returns:
        The same message.
    """
    return message


# ===== AGENT CONFIGURATION =====

@mesh.agent(
    name="{{ .Name }}",
    version="1.0.0",
    description="{{ if .Description }}{{ .Description }}{{ else }}MCP Mesh agent for {{ .Name }}{{ end }}",
    http_port={{ .Port }},
    enable_http=True,
    auto_run=True,
)
class {{ toPascalCase .Name }}Agent:
    """
    Agent class that configures how mesh should run the FastMCP server.

    The mesh processor will:
    1. Discover the 'app' FastMCP instance
    2. Apply dependency injection to decorated functions
    3. Start the FastMCP HTTP server on the configured port
    4. Register all capabilities with the mesh registry
    """

    pass


# No main method needed!
# Mesh processor automatically handles:
# - FastMCP server discovery and startup
# - Dependency injection between functions
# - HTTP server configuration
# - Service registration with mesh registry
