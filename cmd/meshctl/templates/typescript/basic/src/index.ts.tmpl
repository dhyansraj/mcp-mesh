#!/usr/bin/env npx tsx
/**
 * {{ .Name }} - MCP Mesh Agent
 *
 * {{ if .Description }}{{ .Description }}{{ else }}A MCP Mesh agent generated using meshctl scaffold.{{ end }}
 */

import { FastMCP, mesh, McpMeshTool } from "@mcpmesh/sdk";
import { z } from "zod";

// FastMCP server instance
const server = new FastMCP({
  name: "{{ toPascalCase .Name }} Service",
  version: "1.0.0",
});

// Wrap with MCP Mesh
const agent = mesh(server, {
  name: "{{ .Name }}",
  httpPort: {{ .Port }},
});

// ===== TOOLS =====

agent.addTool({
  name: "{{ .ToolName | default "hello" }}",
  capability: "{{ .ToolName | default "hello" }}",
  description: "{{ .ToolDescription | default "A sample tool" }}",
  tags: {{ if .Tags }}{{ toJSON .Tags }}{{ else }}["tools"]{{ end }},
  parameters: z.object({
    // TODO: Define your input parameters using Zod schemas
    //
    // Example parameter types:
    // name: z.string().describe("User name"),
    // count: z.number().int().default(1).describe("Repeat count"),
    // threshold: z.number().default(0.5).describe("Score threshold"),
    // verbose: z.boolean().optional().describe("Enable verbose output"),
    // mode: z.enum(["fast", "accurate"]).default("fast").describe("Processing mode"),
  }),
  execute: async (args) => {
    // TODO: Implement tool logic
    return "Not implemented";
  },
});

// ===== DEPENDENCY INJECTION EXAMPLE (uncomment and adapt) =====
//
// Declare dependencies to call tools on other agents in the mesh.
// The mesh runtime injects McpMeshTool instances positionally into execute.
//
// agent.addTool({
//   name: "orchestrate",
//   capability: "orchestrate",
//   description: "Calls another agent's tool",
//   tags: ["tools"],
//   dependencies: ["calculator"],           // declare dependency on "calculator" capability
//   parameters: z.object({
//     expression: z.string().describe("Math expression"),
//   }),
//   execute: async (args, calculator: McpMeshTool | null) => {
//     if (!calculator) {
//       return "calculator dependency not available";
//     }
//     const result = await calculator({ expression: args.expression });
//     return `Calculator says: ${result}`;
//   },
// });

console.log("{{ .Name }} agent defined. Waiting for auto-start...");
