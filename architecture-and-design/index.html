<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Enterprise-grade distributed service mesh for MCP agents. Kubernetes-native platform with zero-boilerplate dependency injection."><meta name=author content="MCP Mesh Contributors"><link href=https://dhyansraj.github.io/mcp-mesh/architecture-and-design/ rel=canonical><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>MCP Mesh Architecture and Design - MCP Mesh</title><link rel=stylesheet href=../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../assets/stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><!-- Google Search Console Verification --><meta name=google-site-verification content=EtV7XZPdw0d9azFHor7Zq2BeuVZVnwSwD0zzGNMOUoM><!-- Sitemap for Search Engines --><link rel=sitemap type=application/xml title=Sitemap href=https://dhyansraj.github.io/mcp-mesh/sitemap.xml></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#mcp-mesh-architecture-and-design class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="MCP Mesh" class="md-header__button md-logo" aria-label="MCP Mesh" data-md-component=logo> <img src=../assets/images/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> MCP Mesh </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> MCP Mesh Architecture and Design </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/dhyansraj/mcp-mesh title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> dhyansraj/mcp-mesh </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../00-why-mcp-mesh/ class=md-tabs__link> Why MCP Mesh? </a> </li> <li class=md-tabs__item> <a href=../python/ class=md-tabs__link> Python SDK </a> </li> <li class=md-tabs__item> <a href=../typescript/ class=md-tabs__link> TypeScript SDK </a> </li> <li class=md-tabs__item> <a href=../concepts/architecture/ class=md-tabs__link> Concepts </a> </li> <li class=md-tabs__item> <a href=../02-local-development/ class=md-tabs__link> Local Development </a> </li> <li class=md-tabs__item> <a href=../deployment/ class=md-tabs__link> Deployment </a> </li> <li class=md-tabs__item> <a href=../07-observability/ class=md-tabs__link> Observability </a> </li> <li class=md-tabs__item> <a href=../cli/ class=md-tabs__link> CLI Reference </a> </li> <li class=md-tabs__item> <a href=../faq/ class=md-tabs__link> FAQ </a> </li> <li class=md-tabs__item> <a href=../contributing/ class=md-tabs__link> Contributing </a> </li> <li class=md-tabs__item> <a href=../comparison/ class=md-tabs__link> Feature Comparison </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="MCP Mesh" class="md-nav__button md-logo" aria-label="MCP Mesh" data-md-component=logo> <img src=../assets/images/logo.svg alt=logo> </a> MCP Mesh </label> <div class=md-nav__source> <a href=https://github.com/dhyansraj/mcp-mesh title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> dhyansraj/mcp-mesh </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../00-why-mcp-mesh/ class=md-nav__link> <span class=md-ellipsis> Why MCP Mesh? </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../python/ class="md-nav__link "> <span class=md-ellipsis> Python SDK </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Python SDK </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_2> <div class="md-nav__link md-nav__container"> <a href=../python/getting-started/ class="md-nav__link "> <span class=md-ellipsis> Getting Started </span> </a> <label class="md-nav__link " for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../python/getting-started/prerequisites/ class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> Core Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Core Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../python/decorators/ class=md-nav__link> <span class=md-ellipsis> Decorators </span> </a> </li> <li class=md-nav__item> <a href=../python/dependency-injection/ class=md-nav__link> <span class=md-ellipsis> Dependency Injection </span> </a> </li> <li class=md-nav__item> <a href=../python/capabilities-tags/ class=md-nav__link> <span class=md-ellipsis> Capabilities & Tags </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../python/llm/ class=md-nav__link> <span class=md-ellipsis> LLM Integration </span> </a> </li> <li class=md-nav__item> <a href=../python/fastapi-integration/ class=md-nav__link> <span class=md-ellipsis> FastAPI Integration </span> </a> </li> <li class=md-nav__item> <a href=../python/examples/ class=md-nav__link> <span class=md-ellipsis> Examples & Testing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <div class="md-nav__link md-nav__container"> <a href=../typescript/ class="md-nav__link "> <span class=md-ellipsis> TypeScript SDK </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> TypeScript SDK </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_2> <div class="md-nav__link md-nav__container"> <a href=../typescript/getting-started/ class="md-nav__link "> <span class=md-ellipsis> Getting Started </span> </a> <label class="md-nav__link " for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../typescript/getting-started/prerequisites/ class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> Core Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Core Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../typescript/mesh-functions/ class=md-nav__link> <span class=md-ellipsis> Mesh Functions </span> </a> </li> <li class=md-nav__item> <a href=../typescript/dependency-injection/ class=md-nav__link> <span class=md-ellipsis> Dependency Injection </span> </a> </li> <li class=md-nav__item> <a href=../typescript/capabilities-tags/ class=md-nav__link> <span class=md-ellipsis> Capabilities & Tags </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../typescript/llm/ class=md-nav__link> <span class=md-ellipsis> LLM Integration </span> </a> </li> <li class=md-nav__item> <a href=../typescript/express-integration/ class=md-nav__link> <span class=md-ellipsis> Express Integration </span> </a> </li> <li class=md-nav__item> <a href=../typescript/examples/ class=md-nav__link> <span class=md-ellipsis> Examples & Testing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../concepts/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture & Design </span> </a> </li> <li class=md-nav__item> <a href=../concepts/registry/ class=md-nav__link> <span class=md-ellipsis> Registry </span> </a> </li> <li class=md-nav__item> <a href=../concepts/health-discovery/ class=md-nav__link> <span class=md-ellipsis> Health & Discovery </span> </a> </li> <li class=md-nav__item> <a href=../concepts/tag-matching/ class=md-nav__link> <span class=md-ellipsis> Tag Matching </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Local Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Local Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../02-local-development/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../02-local-development/01-environment-setup/ class=md-nav__link> <span class=md-ellipsis> Environment Setup </span> </a> </li> <li class=md-nav__item> <a href=../02-local-development/02-local-registry/ class=md-nav__link> <span class=md-ellipsis> Local Registry </span> </a> </li> <li class=md-nav__item> <a href=../02-local-development/03-debugging/ class=md-nav__link> <span class=md-ellipsis> Debugging </span> </a> </li> <li class=md-nav__item> <a href=../02-local-development/04-hot-reload/ class=md-nav__link> <span class=md-ellipsis> Hot Reload </span> </a> </li> <li class=md-nav__item> <a href=../02-local-development/05-testing/ class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=../02-local-development/troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Deployment </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Deployment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../03-docker-deployment/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../03-docker-deployment/01-building-images/ class=md-nav__link> <span class=md-ellipsis> Building Images </span> </a> </li> <li class=md-nav__item> <a href=../03-docker-deployment/02-compose-setup/ class=md-nav__link> <span class=md-ellipsis> Compose Setup </span> </a> </li> <li class=md-nav__item> <a href=../03-docker-deployment/03-multi-agent/ class=md-nav__link> <span class=md-ellipsis> Multi-Agent </span> </a> </li> <li class=md-nav__item> <a href=../03-docker-deployment/04-networking/ class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> </li> <li class=md-nav__item> <a href=../03-docker-deployment/05-storage/ class=md-nav__link> <span class=md-ellipsis> Storage </span> </a> </li> <li class=md-nav__item> <a href=../03-docker-deployment/troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../04-kubernetes-basics/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../06-helm-deployment/02-umbrella-chart/ class=md-nav__link> <span class=md-ellipsis> Multi-Agent Deployment </span> </a> </li> <li class=md-nav__item> <a href=../06-helm-deployment/03-customizing-values/ class=md-nav__link> <span class=md-ellipsis> Customizing Values </span> </a> </li> <li class=md-nav__item> <a href=../06-helm-deployment/04-multi-environment/ class=md-nav__link> <span class=md-ellipsis> Multi-Environment </span> </a> </li> <li class=md-nav__item> <a href=../04-kubernetes-basics/05-troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7_3_6> <label class=md-nav__link for=__nav_7_3_6 id=__nav_7_3_6_label tabindex=0> <span class=md-ellipsis> Advanced </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_7_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3_6> <span class="md-nav__icon md-icon"></span> Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../06-helm-deployment/01-understanding-charts/ class=md-nav__link> <span class=md-ellipsis> Helm Charts Deep Dive </span> </a> </li> <li class=md-nav__item> <a href=../06-helm-deployment/05-best-practices/ class=md-nav__link> <span class=md-ellipsis> Best Practices </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../07-observability/ class=md-nav__link> <span class=md-ellipsis> Observability </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_9> <div class="md-nav__link md-nav__container"> <a href=../cli/ class="md-nav__link "> <span class=md-ellipsis> CLI Reference </span> </a> <label class="md-nav__link " for=__nav_9 id=__nav_9_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> CLI Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../cli/start/ class=md-nav__link> <span class=md-ellipsis> meshctl start </span> </a> </li> <li class=md-nav__item> <a href=../cli/call/ class=md-nav__link> <span class=md-ellipsis> meshctl call </span> </a> </li> <li class=md-nav__item> <a href=../cli/list/ class=md-nav__link> <span class=md-ellipsis> meshctl list </span> </a> </li> <li class=md-nav__item> <a href=../cli/scaffold/ class=md-nav__link> <span class=md-ellipsis> meshctl scaffold </span> </a> </li> <li class=md-nav__item> <a href=../cli/man/ class=md-nav__link> <span class=md-ellipsis> meshctl man </span> </a> </li> <li class=md-nav__item> <a href=../environment-variables/ class=md-nav__link> <span class=md-ellipsis> Environment Variables </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../comparison/ class=md-nav__link> <span class=md-ellipsis> Feature Comparison </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=mcp-mesh-architecture-and-design>MCP Mesh Architecture and Design<a class=headerlink href=#mcp-mesh-architecture-and-design title="Permanent link">&para;</a></h1> <blockquote> <p>Understanding the core architecture, design principles, and usage patterns of MCP Mesh</p> </blockquote> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>MCP Mesh is a distributed service orchestration framework built on top of the Model Context Protocol (MCP) that enables seamless dependency injection, service discovery, and inter-service communication. The architecture combines familiar FastMCP development patterns with powerful mesh orchestration capabilities.</p> <h2 id=glossary>Glossary<a class=headerlink href=#glossary title="Permanent link">&para;</a></h2> <p>Key terms used throughout MCP Mesh documentation:</p> <table> <thead> <tr> <th>Term</th> <th>Definition</th> </tr> </thead> <tbody> <tr> <td><strong>Agent</strong></td> <td>A Python or TypeScript application that registers with the mesh and provides one or more tools. Each agent runs as an independent service.</td> </tr> <tr> <td><strong>Tool</strong></td> <td>A function decorated with <code>@app.tool()</code> and <code>@mesh.tool()</code> (Python) or registered with <code>agent.addTool()</code> (TypeScript) that can be discovered and called by other agents. Tools are the building blocks of MCP Mesh.</td> </tr> <tr> <td><strong>Capability</strong></td> <td>A unique identifier (string) that describes what a tool provides. Other tools declare dependencies on capabilities, not specific agents. Example: <code>"redis_store_memory"</code>, <code>"analyze_emotion"</code>.</td> </tr> <tr> <td><strong>Dependency</strong></td> <td>A capability that a tool requires. MCP Mesh automatically discovers and injects dependencies at runtime.</td> </tr> <tr> <td><strong>Registry</strong></td> <td>The central service that tracks all agents, their capabilities, and health status. Agents register on startup and send periodic heartbeats. <strong>Important:</strong> The registry is a <em>facilitator</em>, not a proxy—it helps agents find each other, but actual tool calls go directly between agents.</td> </tr> <tr> <td><strong>Heartbeat</strong></td> <td>Periodic signal sent by agents to the registry to indicate they're alive. Default interval is 15 seconds.</td> </tr> <tr> <td><strong>Proxy</strong></td> <td>An injected object (<code>McpMeshAgent</code>) that transparently handles communication with remote tools. You call it like a function; MCP Mesh handles the rest.</td> </tr> <tr> <td><strong>Tag</strong></td> <td>Metadata attached to tools for filtering during dependency resolution. Supports <code>+</code> (prefer) and <code>-</code> (avoid) operators.</td> </tr> <tr> <td><strong>MCP (Model Context Protocol)</strong></td> <td>The underlying protocol used for tool communication. MCP Mesh tools are standard MCP tools and can be invoked via HTTP using MCP's <code>tools/list</code> and <code>tools/call</code> endpoints.</td> </tr> </tbody> </table> <h3 id=about-fastmcp>About FastMCP<a class=headerlink href=#about-fastmcp title="Permanent link">&para;</a></h3> <p>MCP Mesh uses <a href=https://github.com/jlowin/fastmcp>FastMCP</a> under the hood to handle MCP protocol details. You don't need to learn FastMCP separately—just use the <code>@app.tool()</code> decorator to define tools and MCP Mesh handles everything else.</p> <p><strong>What FastMCP provides (handled automatically):</strong></p> <ul> <li>MCP protocol serialization/deserialization</li> <li>HTTP server for tool endpoints</li> <li>Tool schema generation from Python type hints</li> </ul> <p><strong>What MCP Mesh adds:</strong></p> <ul> <li>Service discovery and registration</li> <li>Automatic dependency injection</li> <li>Health monitoring and heartbeats</li> <li>LLM integration (<code>@mesh.llm</code>)</li> <li>Multi-agent orchestration</li> </ul> <p><strong>MCP Compatibility:</strong></p> <p>MCP Mesh tools are standard MCP tools. They can be invoked using the meshctl CLI or any MCP client:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># List registered agents</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>meshctl<span class=w> </span>list
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=c1># Call a tool (discovers agent via registry)</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>meshctl<span class=w> </span>call<span class=w> </span>my_tool<span class=w> </span><span class=s1>&#39;{&quot;param&quot;:&quot;value&quot;}&#39;</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=c1># Call with explicit agent</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>meshctl<span class=w> </span>call<span class=w> </span>my-agent:my_tool<span class=w> </span><span class=s1>&#39;{&quot;param&quot;:&quot;value&quot;}&#39;</span>
</span></code></pre></div> <details> <summary>Using curl directly (JSON-RPC)</summary> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># List available tools</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>curl<span class=w> </span>-s<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:8080/mcp<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Accept: application/json, text/event-stream&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1,&quot;method&quot;:&quot;tools/list&quot;,&quot;params&quot;:{}}&#39;</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=c1># Call a tool</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>curl<span class=w> </span>-s<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:8080/mcp<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Accept: application/json, text/event-stream&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1,&quot;method&quot;:&quot;tools/call&quot;,&quot;params&quot;:{&quot;name&quot;:&quot;my_tool&quot;,&quot;arguments&quot;:{&quot;param&quot;:&quot;value&quot;}}}&#39;</span>
</span></code></pre></div> </details> <hr> <h2 id=core-architecture>Core Architecture<a class=headerlink href=#core-architecture title="Permanent link">&para;</a></h2> <h3 id=high-level-components>High-Level Components<a class=headerlink href=#high-level-components title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>┌─────────────────────────────────────────────────────────────────┐
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>│                        MCP Mesh Ecosystem                       │
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>├─────────────────────────────────────────────────────────────────┤
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>│              ┌───────────────────────────────────┐              │
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>│              │           Redis                   │              │
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>│              │      (Session Storage)            │              │
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>│              │   session:* keys for stickiness   │              │
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>│              └─────────────┬─────────────────────┘              │
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>│                            │                                    │
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>│         ┌──────────────────┼──────────────────┐                 │
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>│         │                  │                  │                 │
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>│         ▼                  ▼                  ▼                 │
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>│  │   Agent A   │  │   Agent B   │  │   Agent C   │              │
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>│  │             │◄─┼─────────────┼─►│             │              │
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>│  │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │              │
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>│  │ │FastMCP  │◄┼──┼►│FastMCP  │◄┼──┼►│FastMCP  │ │              │
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>│  │ │Server   │ │  │ │Server   │ │  │ │Server   │ │              │
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>│  │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │              │
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>│  │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │              │
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>│  │ │Mesh     │ │  │ │Mesh     │ │  │ │Mesh     │ │              │
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>│  │ │Runtime  │ │  │ │Runtime  │ │  │ │Runtime  │ │              │
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>│  │ │(Inject) │ │  │ │(Inject) │ │  │ │(Inject) │ │              │
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>│  │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │              │
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>│         │                │                │                     │
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>│         │ Heartbeat      │ Heartbeat      │ Heartbeat           │
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>│         │ + Discovery    │ + Discovery    │ + Discovery         │
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>│         │                │                │                     │
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>│         └────────────────┼────────────────┘                     │
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>│                          ▼                                      │
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a>│                  ┌─────────────┐                                │
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a>│                  │   Registry  │                                │
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a>│                  │ (Background)│                                │
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a>│                  │ ┌─────────┐ │                                │
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a>│                  │ │Service  │ │                                │
</span><span id=__span-2-37><a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a>│                  │ │Discovery│ │                                │
</span><span id=__span-2-38><a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a>│                  │ │         │ │                                │
</span><span id=__span-2-39><a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a>│                  │ │SQLite/  │ │                                │
</span><span id=__span-2-40><a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a>│                  │ │Postgres │ │                                │
</span><span id=__span-2-41><a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a>│                  │ └─────────┘ │                                │
</span><span id=__span-2-42><a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a>│                  │ ┌─────────┐ │                                │
</span><span id=__span-2-43><a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a>│                  │ │Health   │ │                                │
</span><span id=__span-2-44><a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a>│                  │ │Monitor  │ │                                │
</span><span id=__span-2-45><a id=__codelineno-2-45 name=__codelineno-2-45 href=#__codelineno-2-45></a>│                  │ └─────────┘ │                                │
</span><span id=__span-2-46><a id=__codelineno-2-46 name=__codelineno-2-46 href=#__codelineno-2-46></a>│                  └─────────────┘                                │
</span><span id=__span-2-47><a id=__codelineno-2-47 name=__codelineno-2-47 href=#__codelineno-2-47></a>│                                                                 │
</span><span id=__span-2-48><a id=__codelineno-2-48 name=__codelineno-2-48 href=#__codelineno-2-48></a>│  Direct MCP JSON-RPC calls between FastMCP servers              │
</span><span id=__span-2-49><a id=__codelineno-2-49 name=__codelineno-2-49 href=#__codelineno-2-49></a>│  ◄──────────────────────────────────────────────────────────►   │
</span><span id=__span-2-50><a id=__codelineno-2-50 name=__codelineno-2-50 href=#__codelineno-2-50></a>│  Registry for discovery, Redis for session stickiness           │
</span><span id=__span-2-51><a id=__codelineno-2-51 name=__codelineno-2-51 href=#__codelineno-2-51></a>└─────────────────────────────────────────────────────────────────┘
</span></code></pre></div> <h3 id=component-responsibilities>Component Responsibilities<a class=headerlink href=#component-responsibilities title="Permanent link">&para;</a></h3> <h4 id=1-agents-python-typescript-runtime>1. <strong>Agents (Python &amp; TypeScript Runtime)</strong><a class=headerlink href=#1-agents-python-typescript-runtime title="Permanent link">&para;</a></h4> <ul> <li><strong>FastMCP Integration</strong>: Native MCP protocol support for direct agent-to-agent communication</li> <li><strong>Mesh Runtime</strong>: Background dependency injection and proxy creation</li> <li><strong>Auto-Discovery</strong>: Automatic capability registration with registry</li> <li><strong>Health Monitoring</strong>: Periodic heartbeats to registry (background process)</li> </ul> <h4 id=2-registry-go-service>2. <strong>Registry (Go Service)</strong><a class=headerlink href=#2-registry-go-service title="Permanent link">&para;</a></h4> <ul> <li><strong>Service Discovery</strong>: Centralized capability and endpoint registry (background coordination)</li> <li><strong>Health Tracking</strong>: Agent health monitoring and failure detection</li> <li><strong>Dependency Resolution</strong>: Smart capability matching with tags at startup</li> <li><strong>Load Balancing</strong>: Multiple providers for same capability selection</li> </ul> <h4 id=3-meshctl-cli-go-binary>3. <strong>meshctl CLI (Go Binary)</strong><a class=headerlink href=#3-meshctl-cli-go-binary title="Permanent link">&para;</a></h4> <ul> <li><strong>Lifecycle Management</strong>: Start, stop, monitor agents</li> <li><strong>Development Tools</strong>: File watching, auto-restart, debugging</li> <li><strong>Registry Operations</strong>: Query services, check health, troubleshoot</li> </ul> <h4 id=4-redis-session-storage>4. <strong>Redis (Session Storage)</strong><a class=headerlink href=#4-redis-session-storage title="Permanent link">&para;</a></h4> <ul> <li><strong>Session Affinity</strong>: Maps session IDs to pod IPs for stateful operations</li> <li><strong>Distributed State</strong>: Enables session stickiness across multiple pod replicas</li> <li><strong>Graceful Fallback</strong>: Agents fall back to in-memory storage if Redis unavailable</li> <li><strong>TTL Management</strong>: Automatic session cleanup and expiration</li> </ul> <h3 id=key-insight-background-orchestration>Key Insight: Background Orchestration<a class=headerlink href=#key-insight-background-orchestration title="Permanent link">&para;</a></h3> <p><strong>MCP Mesh operates as background infrastructure:</strong></p> <ul> <li><strong>Discovery Phase</strong>: Registry helps agents find each other during startup</li> <li><strong>Runtime Phase</strong>: Direct FastMCP-to-FastMCP communication (no proxy)</li> <li><strong>Monitoring Phase</strong>: Continuous health checks and capability updates in background</li> </ul> <h2 id=mcp-mesh-agents-and-tools>MCP Mesh Agents and Tools<a class=headerlink href=#mcp-mesh-agents-and-tools title="Permanent link">&para;</a></h2> <p>MCP Mesh agents are simple Python or TypeScript applications that define one or more MCP tools. While tools communicate via the MCP protocol, all networking and communication complexity is abstracted away by MCP Mesh.</p> <h3 id=what-is-an-mcp-mesh-agent>What is an MCP Mesh Agent?<a class=headerlink href=#what-is-an-mcp-mesh-agent title="Permanent link">&para;</a></h3> <p>An agent is a Python or TypeScript application that:</p> <ol> <li>Creates a FastMCP server</li> <li>Wraps it with mesh capabilities</li> <li>Defines tools with capabilities and dependencies</li> </ol> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=what-is-an-mcp-mesh-agent-python name=__tabbed_1 type=radio><input id=what-is-an-mcp-mesh-agent-typescript name=__tabbed_1 type=radio><div class=tabbed-labels><label for=what-is-an-mcp-mesh-agent-python>Python</label><label for=what-is-an-mcp-mesh-agent-typescript>TypeScript</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=kn>import</span><span class=w> </span><span class=nn>mesh</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=kn>from</span><span class=w> </span><span class=nn>fastmcp</span><span class=w> </span><span class=kn>import</span> <span class=n>FastMCP</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=n>app</span> <span class=o>=</span> <span class=n>FastMCP</span><span class=p>(</span><span class=s2>&quot;My Agent&quot;</span><span class=p>)</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>           <span class=c1># FastMCP decorator - defines MCP tool</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>           <span class=c1># Mesh decorator - adds orchestration</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;greeting&quot;</span><span class=p>,</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>    <span class=n>dependencies</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;time_service&quot;</span><span class=p>]</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=p>)</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>greet</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>time_service</span><span class=p>:</span> <span class=n>mesh</span><span class=o>.</span><span class=n>McpMeshAgent</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Greet someone with the current time.&quot;&quot;&quot;</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>    <span class=n>current_time</span> <span class=o>=</span> <span class=k>await</span> <span class=n>time_service</span><span class=p>()</span> <span class=k>if</span> <span class=n>time_service</span> <span class=k>else</span> <span class=s2>&quot;unknown&quot;</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>    <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;Hello </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>! The time is </span><span class=si>{</span><span class=n>current_time</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>agent</span><span class=p>(</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;greeting-agent&quot;</span><span class=p>,</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>    <span class=n>http_port</span><span class=o>=</span><span class=mi>8080</span><span class=p>,</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a>    <span class=n>enable_http</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>    <span class=n>auto_run</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=p>)</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=k>class</span><span class=w> </span><span class=nc>GreetingAgent</span><span class=p>:</span>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a>    <span class=k>pass</span>
</span></code></pre></div> </div> <div class=tabbed-block> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>FastMCP</span><span class=p>,</span><span class=w> </span><span class=nx>mesh</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;@mcpmesh/sdk&quot;</span><span class=p>;</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>z</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;zod&quot;</span><span class=p>;</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>FastMCP</span><span class=p>({</span><span class=w> </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;My Agent&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>version</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;1.0.0&quot;</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=kd>const</span><span class=w> </span><span class=nx>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>mesh</span><span class=p>(</span><span class=nx>server</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;greeting-agent&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>port</span><span class=o>:</span><span class=w> </span><span class=kt>8080</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=nx>agent</span><span class=p>.</span><span class=nx>addTool</span><span class=p>({</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>  </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;greet&quot;</span><span class=p>,</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>  </span><span class=nx>capability</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;greeting&quot;</span><span class=p>,</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>  </span><span class=nx>description</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Greet someone with the current time&quot;</span><span class=p>,</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w>  </span><span class=nx>dependencies</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;time_service&quot;</span><span class=p>],</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w>  </span><span class=nx>parameters</span><span class=o>:</span><span class=w> </span><span class=kt>z.object</span><span class=p>({</span><span class=w> </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=kt>z.string</span><span class=p>()</span><span class=w> </span><span class=p>}),</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=w>  </span><span class=nx>execute</span><span class=o>:</span><span class=w> </span><span class=kt>async</span><span class=w> </span><span class=p>({</span><span class=w> </span><span class=nx>name</span><span class=w> </span><span class=p>},</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>time_service</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>currentTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>time_service</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>time_service</span><span class=p>()</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;unknown&quot;</span><span class=p>;</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=sb>`Hello </span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>! The time is </span><span class=si>${</span><span class=nx>currentTime</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=p>});</span>
</span></code></pre></div> </div> </div> </div> <p>That's all the code you need. MCP Mesh handles:</p> <ul> <li><strong>Service discovery</strong> - Finding other agents in the network</li> <li><strong>Dependency injection</strong> - Automatically wiring dependencies</li> <li><strong>Health monitoring</strong> - Heartbeats and failure detection</li> <li><strong>HTTP exposure</strong> - Tools callable via REST API</li> </ul> <h3 id=types-of-tools>Types of Tools<a class=headerlink href=#types-of-tools title="Permanent link">&para;</a></h3> <p>MCP Mesh supports four types of tools, each with its own decorator:</p> <table> <thead> <tr> <th>Decorator</th> <th>Purpose</th> <th>Use Case</th> </tr> </thead> <tbody> <tr> <td><code>@mesh.tool</code></td> <td>Standard MCP tool with dependency injection</td> <td>Data processing, storage, utilities</td> </tr> <tr> <td><code>@mesh.llm</code></td> <td>LLM-powered tool with agentic capabilities</td> <td>AI analysis, content generation, reasoning</td> </tr> <tr> <td><code>@mesh.llm_provider</code></td> <td>Zero-code LLM vendor integration</td> <td>Claude, GPT-4, Gemini providers</td> </tr> <tr> <td><code>@mesh.route</code></td> <td>FastAPI route with tool injection</td> <td>REST APIs, webhooks, external interfaces</td> </tr> </tbody> </table> <hr> <h3 id=1-standard-tools-meshtool>1. Standard Tools (<code>@mesh.tool</code>)<a class=headerlink href=#1-standard-tools-meshtool title="Permanent link">&para;</a></h3> <p>Standard tools are the building blocks of MCP Mesh. They expose capabilities that other agents can discover and call.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;redis_store_memory&quot;</span><span class=p>,</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>description</span><span class=o>=</span><span class=s2>&quot;Store a memory in Redis&quot;</span><span class=p>,</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=n>version</span><span class=o>=</span><span class=s2>&quot;1.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;redis&quot;</span><span class=p>,</span> <span class=s2>&quot;storage&quot;</span><span class=p>,</span> <span class=s2>&quot;write&quot;</span><span class=p>],</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=p>)</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>store_memory</span><span class=p>(</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>    <span class=n>user_email</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>    <span class=n>content</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    <span class=n>importance</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Store a new memory in Redis.&quot;&quot;&quot;</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>    <span class=n>key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;memory:</span><span class=si>{</span><span class=n>user_email</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>    <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>        <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>content</span><span class=p>,</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>        <span class=s2>&quot;importance&quot;</span><span class=p>:</span> <span class=n>importance</span><span class=p>,</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>    <span class=p>}))</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>    <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;success&quot;</span><span class=p>,</span> <span class=s2>&quot;key&quot;</span><span class=p>:</span> <span class=n>key</span><span class=p>}</span>
</span></code></pre></div> <p><strong>Key concepts:</strong></p> <ul> <li><strong>Capability</strong>: A unique identifier that other tools use to declare dependencies</li> <li><strong>Tags</strong>: Metadata for filtering during dependency resolution</li> <li><strong>Version</strong>: Semantic versioning for compatibility matching</li> <li><strong>Dependencies</strong>: List of capabilities this tool requires</li> </ul> <h4 id=dependency-injection>Dependency Injection<a class=headerlink href=#dependency-injection title="Permanent link">&para;</a></h4> <p>When a tool declares dependencies, MCP Mesh automatically resolves and injects them:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;update_emotion&quot;</span><span class=p>,</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>    <span class=n>dependencies</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;analyze_emotion&quot;</span><span class=p>],</span>  <span class=c1># Depends on another capability</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=p>)</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>update_emotion</span><span class=p>(</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>    <span class=n>user_email</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>    <span class=n>avatar_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>    <span class=n>analyze</span><span class=p>:</span> <span class=n>mesh</span><span class=o>.</span><span class=n>McpMeshAgent</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>  <span class=c1># Injected automatically</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Update emotion state using LLM analysis.&quot;&quot;&quot;</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>    <span class=c1># Call the injected dependency like a function</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>analyze</span><span class=p>(</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>        <span class=n>user_email</span><span class=o>=</span><span class=n>user_email</span><span class=p>,</span>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>        <span class=n>avatar_id</span><span class=o>=</span><span class=n>avatar_id</span><span class=p>,</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>    <span class=p>)</span>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>    <span class=c1># Use the result</span>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>    <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;emotion&quot;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>emotion</span><span class=p>,</span> <span class=s2>&quot;intensity&quot;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>intensity</span><span class=p>}</span>
</span></code></pre></div> <p><strong>How it works:</strong></p> <ol> <li>Agent starts and registers its capabilities with the registry</li> <li>MCP Mesh discovers agents that provide required dependencies</li> <li>Proxy objects (<code>mesh.McpMeshAgent</code>) are injected at runtime</li> <li>Calling the proxy transparently invokes the remote tool via MCP</li> <li>You don't manage URLs, connections, retries, or failures</li> </ol> <h4 id=advanced-tag-matching>Advanced Tag Matching<a class=headerlink href=#advanced-tag-matching title="Permanent link">&para;</a></h4> <p>Tags support prefix operators for fine-grained control:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;analyze&quot;</span><span class=p>,</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>    <span class=n>dependencies</span><span class=o>=</span><span class=p>[</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>        <span class=s2>&quot;storage&quot;</span><span class=p>,</span>              <span class=c1># Must have &quot;storage&quot; tag</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>        <span class=p>{</span><span class=s2>&quot;capability&quot;</span><span class=p>:</span> <span class=s2>&quot;llm&quot;</span><span class=p>,</span> <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;+claude&quot;</span><span class=p>,</span> <span class=s2>&quot;-gpt&quot;</span><span class=p>]},</span>  <span class=c1># Prefer Claude, avoid GPT</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>    <span class=p>]</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=p>)</span>
</span></code></pre></div> <table> <thead> <tr> <th>Operator</th> <th>Meaning</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td>(none)</td> <td>Must have tag</td> <td><code>"storage"</code></td> </tr> <tr> <td><code>+</code></td> <td>Prefer if available</td> <td><code>"+claude"</code></td> </tr> <tr> <td><code>-</code></td> <td>Avoid if possible</td> <td><code>"-expensive"</code></td> </tr> </tbody> </table> <hr> <h3 id=2-llm-tools-meshllm>2. LLM Tools (<code>@mesh.llm</code>)<a class=headerlink href=#2-llm-tools-meshllm title="Permanent link">&para;</a></h3> <p>LLM tools add intelligence to any MCP tool. They can:</p> <ul> <li>Execute agentic loops with tool calling</li> <li>Use dynamic system prompts (Jinja2 templates)</li> <li>Filter available tools for the LLM</li> <li>Return structured JSON or plain text</li> </ul> <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=kn>from</span><span class=w> </span><span class=nn>pydantic</span><span class=w> </span><span class=kn>import</span> <span class=n>BaseModel</span><span class=p>,</span> <span class=n>Field</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=k>class</span><span class=w> </span><span class=nc>EmotionAnalysis</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Structured response from emotion analysis.&quot;&quot;&quot;</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>    <span class=n>emotion</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&quot;Primary emotion&quot;</span><span class=p>)</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>    <span class=n>intensity</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>ge</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>le</span><span class=o>=</span><span class=mf>1.0</span><span class=p>)</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>    <span class=n>reasoning</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&quot;Brief explanation&quot;</span><span class=p>)</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>llm</span><span class=p>(</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>    <span class=n>provider</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;capability&quot;</span><span class=p>:</span> <span class=s2>&quot;llm&quot;</span><span class=p>,</span> <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;llm&quot;</span><span class=p>,</span> <span class=s2>&quot;+gpt&quot;</span><span class=p>]},</span>  <span class=c1># Prefer GPT for speed</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>    <span class=n>max_iterations</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>                                          <span class=c1># Single LLM call</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>    <span class=n>system_prompt</span><span class=o>=</span><span class=s2>&quot;file://prompts/emotion_analysis.jinja2&quot;</span><span class=p>,</span>   <span class=c1># Dynamic prompt</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>    <span class=n>context_param</span><span class=o>=</span><span class=s2>&quot;emotion_ctx&quot;</span><span class=p>,</span>                               <span class=c1># Context injection</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>    <span class=n>response_format</span><span class=o>=</span><span class=s2>&quot;json&quot;</span><span class=p>,</span>                                    <span class=c1># Structured output</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=p>)</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;analyze_emotion&quot;</span><span class=p>,</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;emotion&quot;</span><span class=p>,</span> <span class=s2>&quot;analysis&quot;</span><span class=p>,</span> <span class=s2>&quot;llm&quot;</span><span class=p>],</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=p>)</span>
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>analyze_emotion</span><span class=p>(</span>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a>    <span class=n>emotion_ctx</span><span class=p>:</span> <span class=n>EmotionContext</span><span class=p>,</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>    <span class=n>llm</span><span class=p>:</span> <span class=n>mesh</span><span class=o>.</span><span class=n>MeshLlmAgent</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>EmotionAnalysis</span><span class=p>:</span>
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Analyze avatar&#39;s emotional state from conversation.&quot;&quot;&quot;</span>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a>    <span class=k>return</span> <span class=k>await</span> <span class=n>llm</span><span class=p>(</span><span class=s2>&quot;Analyze the avatar&#39;s emotional state&quot;</span><span class=p>)</span>
</span></code></pre></div> <h4 id=llm-decorator-options>LLM Decorator Options<a class=headerlink href=#llm-decorator-options title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Option</th> <th>Description</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td><code>provider</code></td> <td>Which LLM to use (capability + tags)</td> <td><code>{"capability": "llm", "tags": ["+claude"]}</code></td> </tr> <tr> <td><code>max_iterations</code></td> <td>Max tool-calling loops</td> <td><code>10</code> for agentic, <code>1</code> for single call</td> </tr> <tr> <td><code>system_prompt</code></td> <td>Static string or Jinja2 file</td> <td><code>"file://prompts/system.jinja2"</code></td> </tr> <tr> <td><code>context_param</code></td> <td>Parameter name for template context</td> <td><code>"emotion_ctx"</code></td> </tr> <tr> <td><code>response_format</code></td> <td>Output format</td> <td><code>"json"</code>, <code>"text"</code></td> </tr> <tr> <td><code>filter</code></td> <td>Filter available tools for LLM</td> <td><code>{"tags": ["memory-agent"]}</code></td> </tr> <tr> <td><code>filter_mode</code></td> <td>How to apply filter</td> <td><code>"all"</code>, <code>"any"</code></td> </tr> </tbody> </table> <h4 id=agentic-tool-calling>Agentic Tool Calling<a class=headerlink href=#agentic-tool-calling title="Permanent link">&para;</a></h4> <p>LLM tools can call other tools in a loop:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>llm</span><span class=p>(</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=nb>filter</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;memory-agent&quot;</span><span class=p>,</span> <span class=s2>&quot;recall&quot;</span><span class=p>]},</span>  <span class=c1># Only memory tools available</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>    <span class=n>filter_mode</span><span class=o>=</span><span class=s2>&quot;all&quot;</span><span class=p>,</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>    <span class=n>provider</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;capability&quot;</span><span class=p>:</span> <span class=s2>&quot;llm&quot;</span><span class=p>,</span> <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;+claude&quot;</span><span class=p>]},</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>    <span class=n>max_iterations</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>  <span class=c1># Allow up to 10 tool calls</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>    <span class=n>system_prompt</span><span class=o>=</span><span class=s2>&quot;file://prompts/avatar.jinja2&quot;</span><span class=p>,</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>    <span class=n>context_param</span><span class=o>=</span><span class=s2>&quot;avatar_ctx&quot;</span><span class=p>,</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>    <span class=n>response_format</span><span class=o>=</span><span class=s2>&quot;text&quot;</span><span class=p>,</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=p>)</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;generic_avatar_respond&quot;</span><span class=p>,</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;avatar&quot;</span><span class=p>,</span> <span class=s2>&quot;companion&quot;</span><span class=p>],</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=p>)</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>generic_respond</span><span class=p>(</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>    <span class=n>avatar_ctx</span><span class=p>:</span> <span class=n>AvatarContext</span><span class=p>,</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a>    <span class=n>llm</span><span class=p>:</span> <span class=n>mesh</span><span class=o>.</span><span class=n>MeshLlmAgent</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Generate avatar response with memory recall capability.&quot;&quot;&quot;</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a>    <span class=c1># LLM can call memory_recall tool during its reasoning</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a>    <span class=k>return</span> <span class=k>await</span> <span class=n>llm</span><span class=p>(</span><span class=n>avatar_ctx</span><span class=o>.</span><span class=n>conversation_history</span><span class=p>)</span>
</span></code></pre></div> <p>The LLM sees filtered tools and can call them autonomously. MCP Mesh handles the tool execution loop.</p> <hr> <h3 id=3-llm-providers-meshllm_provider>3. LLM Providers (<code>@mesh.llm_provider</code>)<a class=headerlink href=#3-llm-providers-meshllm_provider title="Permanent link">&para;</a></h3> <p>LLM providers make any AI vendor available to the mesh with zero code:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>llm_provider</span><span class=p>(</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>    <span class=n>model</span><span class=o>=</span><span class=s2>&quot;anthropic/claude-sonnet-4-5&quot;</span><span class=p>,</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;llm&quot;</span><span class=p>,</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;llm&quot;</span><span class=p>,</span> <span class=s2>&quot;claude&quot;</span><span class=p>,</span> <span class=s2>&quot;anthropic&quot;</span><span class=p>,</span> <span class=s2>&quot;sonnet&quot;</span><span class=p>,</span> <span class=s2>&quot;provider&quot;</span><span class=p>],</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>    <span class=n>version</span><span class=o>=</span><span class=s2>&quot;1.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=p>)</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=k>def</span><span class=w> </span><span class=nf>claude_provider</span><span class=p>():</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Claude provider - automatically creates process_chat endpoint.&quot;&quot;&quot;</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>    <span class=k>pass</span>  <span class=c1># Implementation is in the decorator</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>agent</span><span class=p>(</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;claude-provider&quot;</span><span class=p>,</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>    <span class=n>http_port</span><span class=o>=</span><span class=mi>9110</span><span class=p>,</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>    <span class=n>enable_http</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>    <span class=n>auto_run</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>    <span class=n>health_check</span><span class=o>=</span><span class=n>claude_health_check</span><span class=p>,</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=p>)</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=k>class</span><span class=w> </span><span class=nc>ClaudeProviderAgent</span><span class=p>:</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>    <span class=k>pass</span>
</span></code></pre></div> <p><strong>What it provides:</strong></p> <ul> <li>Automatic <code>process_chat(request: MeshLlmRequest)</code> tool</li> <li>LiteLLM integration for unified API</li> <li>Error handling and retries</li> <li>Mesh registration with capability and tags</li> </ul> <h4 id=multiple-providers>Multiple Providers<a class=headerlink href=#multiple-providers title="Permanent link">&para;</a></h4> <p>Deploy multiple providers and let tools choose at runtime:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># claude_provider.py</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>llm_provider</span><span class=p>(</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>    <span class=n>model</span><span class=o>=</span><span class=s2>&quot;anthropic/claude-sonnet-4-5&quot;</span><span class=p>,</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;llm&quot;</span><span class=p>,</span> <span class=s2>&quot;claude&quot;</span><span class=p>,</span> <span class=s2>&quot;anthropic&quot;</span><span class=p>,</span> <span class=s2>&quot;expensive&quot;</span><span class=p>,</span> <span class=s2>&quot;smart&quot;</span><span class=p>],</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=p>)</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=k>def</span><span class=w> </span><span class=nf>claude_provider</span><span class=p>():</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>    <span class=k>pass</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=c1># openai_provider.py</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>llm_provider</span><span class=p>(</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>    <span class=n>model</span><span class=o>=</span><span class=s2>&quot;openai/gpt-4o&quot;</span><span class=p>,</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;llm&quot;</span><span class=p>,</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;gpt&quot;</span><span class=p>,</span> <span class=s2>&quot;fast&quot;</span><span class=p>,</span> <span class=s2>&quot;cheap&quot;</span><span class=p>],</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=p>)</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=k>def</span><span class=w> </span><span class=nf>openai_provider</span><span class=p>():</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>    <span class=k>pass</span>
</span></code></pre></div> <p>Tools select providers using tag matching:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>llm</span><span class=p>(</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>    <span class=c1># Use Claude for complex reasoning</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=n>provider</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;capability&quot;</span><span class=p>:</span> <span class=s2>&quot;llm&quot;</span><span class=p>,</span> <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;+claude&quot;</span><span class=p>,</span> <span class=s2>&quot;+smart&quot;</span><span class=p>]},</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=p>)</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>complex_analysis</span><span class=p>(</span><span class=o>...</span><span class=p>):</span> <span class=o>...</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>llm</span><span class=p>(</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>    <span class=c1># Use GPT for fast, simple tasks</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>    <span class=n>provider</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;capability&quot;</span><span class=p>:</span> <span class=s2>&quot;llm&quot;</span><span class=p>,</span> <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;+gpt&quot;</span><span class=p>,</span> <span class=s2>&quot;+fast&quot;</span><span class=p>]},</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=p>)</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>quick_extraction</span><span class=p>(</span><span class=o>...</span><span class=p>):</span> <span class=o>...</span>
</span></code></pre></div> <hr> <h3 id=4-fastapi-routes-meshroute>4. FastAPI Routes (<code>@mesh.route</code>)<a class=headerlink href=#4-fastapi-routes-meshroute title="Permanent link">&para;</a></h3> <p>The <code>@mesh.route</code> decorator lets FastAPI endpoints call MCP tools as regular Python functions:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=kn>from</span><span class=w> </span><span class=nn>fastapi</span><span class=w> </span><span class=kn>import</span> <span class=n>APIRouter</span><span class=p>,</span> <span class=n>Request</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=kn>from</span><span class=w> </span><span class=nn>mesh.types</span><span class=w> </span><span class=kn>import</span> <span class=n>McpMeshAgent</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=n>router</span> <span class=o>=</span> <span class=n>APIRouter</span><span class=p>(</span><span class=n>prefix</span><span class=o>=</span><span class=s2>&quot;/chat&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;chat&quot;</span><span class=p>])</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=nd>@router</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;/completions&quot;</span><span class=p>)</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=n>dependencies</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;avatar_chat&quot;</span><span class=p>])</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>chat_completions</span><span class=p>(</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>    <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>    <span class=n>chat_request</span><span class=p>:</span> <span class=n>ChatCompletionRequest</span><span class=p>,</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>    <span class=n>avatar_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;maya-creative&quot;</span><span class=p>,</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>    <span class=n>avatar_agent</span><span class=p>:</span> <span class=n>McpMeshAgent</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>  <span class=c1># Injected by @mesh.route</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=p>):</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;OpenAI-compatible chat endpoint.&quot;&quot;&quot;</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a>    <span class=c1># Extract user from JWT</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a>    <span class=n>user_info</span> <span class=o>=</span> <span class=n>require_user_from_request</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a>    <span class=c1># Call MCP tool like a regular function</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>avatar_agent</span><span class=p>(</span>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a>        <span class=n>user_email</span><span class=o>=</span><span class=n>user_info</span><span class=p>[</span><span class=s2>&quot;email&quot;</span><span class=p>],</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a>        <span class=n>message</span><span class=o>=</span><span class=n>chat_request</span><span class=o>.</span><span class=n>messages</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>content</span><span class=p>,</span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a>        <span class=n>avatar_id</span><span class=o>=</span><span class=n>avatar_id</span><span class=p>,</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a>    <span class=p>)</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a>    <span class=k>return</span> <span class=n>ChatCompletionResponse</span><span class=p>(</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a>        <span class=n>choices</span><span class=o>=</span><span class=p>[{</span><span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=s2>&quot;message&quot;</span><span class=p>]}}]</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a>    <span class=p>)</span>
</span></code></pre></div> <p><strong>Benefits:</strong></p> <ul> <li><strong>No network code</strong>: MCP Mesh handles connections</li> <li><strong>Type safety</strong>: Pydantic models work transparently</li> <li><strong>Dependency injection</strong>: Tools injected like FastAPI dependencies</li> <li><strong>Decoupled architecture</strong>: Routes don't know where tools run</li> </ul> <hr> <h3 id=putting-it-all-together>Putting It All Together<a class=headerlink href=#putting-it-all-together title="Permanent link">&para;</a></h3> <p>Here's how these components work together in a real system (Maya):</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>┌──────────────────────────────────────────────────────────────────┐
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>│                     FastAPI Backend                               │
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>│  @mesh.route(dependencies=[&quot;avatar_chat&quot;])                       │
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>│  POST /chat/completions → avatar_agent()                         │
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>└──────────────────────────────────┬───────────────────────────────┘
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>                                   │
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>                                   ▼
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>┌──────────────────────────────────────────────────────────────────┐
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>│                    Orchestrator Agent                             │
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>│  @mesh.tool(capability=&quot;avatar_chat&quot;,                            │
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>│             dependencies=[&quot;generic_avatar_respond&quot;,              │
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>│                          &quot;memory_recall&quot;, &quot;update_emotion&quot;])     │
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>└──────────┬───────────────────────┬───────────────────────────────┘
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>           │                       │
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>           ▼                       ▼
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>┌─────────────────────┐  ┌─────────────────────────────────────────┐
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>│   Avatar Agent      │  │          Memory LLM Agent               │
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a>│  @mesh.llm(         │  │  @mesh.llm(provider={&quot;+gpt&quot;})           │
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a>│    provider={&quot;+claude&quot;}│  │  @mesh.tool(capability=&quot;memory_recall&quot;)│
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a>│  )                  │  │                                         │
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a>└─────────┬───────────┘  └─────────────────┬───────────────────────┘
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a>          │                                │
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a>          ▼                                ▼
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a>┌─────────────────────┐           ┌─────────────────────┐
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a>│   Claude Provider   │           │   OpenAI Provider   │
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a>│  @mesh.llm_provider │           │  @mesh.llm_provider │
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a>│  model=&quot;claude...&quot;  │           │  model=&quot;gpt-4o&quot;     │
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a>└─────────────────────┘           └─────────────────────┘
</span></code></pre></div> <p><strong>Data flow:</strong></p> <ol> <li>HTTP request hits FastAPI route</li> <li><code>@mesh.route</code> injects <code>avatar_agent</code> (Orchestrator)</li> <li>Orchestrator calls Avatar Agent with injected dependencies</li> <li>Avatar Agent uses Claude via <code>@mesh.llm</code></li> <li>Memory LLM uses GPT for fast extraction</li> <li>Response flows back through the chain</li> </ol> <p>All of this happens with:</p> <ul> <li><strong>Zero network code</strong> in your tools</li> <li><strong>Automatic service discovery</strong></li> <li><strong>Runtime dependency injection</strong></li> <li><strong>Transparent LLM provider selection</strong></li> </ul> <hr> <h2 id=design-principles>Design Principles<a class=headerlink href=#design-principles title="Permanent link">&para;</a></h2> <h3 id=1-true-resilient-architecture>1. <strong>True Resilient Architecture</strong><a class=headerlink href=#1-true-resilient-architecture title="Permanent link">&para;</a></h3> <p>MCP Mesh implements a fundamentally resilient architecture where agents operate independently and enhance each other when available:</p> <p><strong>Core Resilience Principles:</strong></p> <ul> <li><strong>Standalone Operation</strong>: Agents function as vanilla FastMCP servers without any dependencies</li> <li><strong>Registry as Facilitator</strong>: Registry enables discovery and wiring, but agents don't depend on it</li> <li><strong>Dynamic Enhancement</strong>: Agents get enhanced capabilities when other agents are available</li> <li><strong>Graceful Degradation</strong>: Loss of registry or other agents doesn't break existing functionality</li> <li><strong>Self-Healing</strong>: Agents automatically reconnect and refresh when components return</li> </ul> <p><strong>Architecture Flow:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>Agent Startup → Works Standalone (FastMCP mode)
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>       ↓
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>Registry Available → Agents Get Wired → Enhanced Capabilities
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>       ↓
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>Registry Down → Agents Continue Working → Direct MCP Communication Preserved
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>       ↓
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>Registry Returns → Agents Refresh → Topology Updates Resume
</span></code></pre></div> <h3 id=2-dual-decorator-pattern>2. <strong>Dual Decorator Pattern</strong><a class=headerlink href=#2-dual-decorator-pattern title="Permanent link">&para;</a></h3> <p>MCP Mesh uses a dual decorator approach that preserves FastMCP familiarity while adding mesh orchestration:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>      <span class=c1># ← FastMCP: MCP protocol handling</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>      <span class=c1># ← Mesh: Dependency injection + orchestration</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;weather_data&quot;</span><span class=p>,</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=n>dependencies</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;time_service&quot;</span><span class=p>]</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=p>)</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=k>def</span><span class=w> </span><span class=nf>get_weather</span><span class=p>(</span><span class=n>time_service</span><span class=p>:</span> <span class=n>Any</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>    <span class=c1># Business logic here</span>
</span></code></pre></div> <p><strong>Benefits:</strong></p> <ul> <li><strong>Familiar Development</strong>: Developers keep using FastMCP patterns</li> <li><strong>Enhanced Capabilities</strong>: Mesh adds dependency injection seamlessly</li> <li><strong>Zero Boilerplate</strong>: No manual server management or configuration</li> <li><strong>Gradual Adoption</strong>: Can add mesh features incrementally</li> </ul> <h3 id=3-unified-proxy-system>3. <strong>Unified Proxy System</strong><a class=headerlink href=#3-unified-proxy-system title="Permanent link">&para;</a></h3> <p>MCP Mesh uses a unified proxy (<code>EnhancedUnifiedMCPProxy</code>) that auto-configures from decorator kwargs:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;enhanced_service&quot;</span><span class=p>,</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>    <span class=n>timeout</span><span class=o>=</span><span class=mi>60</span><span class=p>,</span>                    <span class=c1># Auto-configures proxy timeout</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>    <span class=n>retry_count</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>                 <span class=c1># Auto-configures retry policy</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>    <span class=n>session_required</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>         <span class=c1># Enables session management</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>    <span class=n>auth_required</span><span class=o>=</span><span class=kc>True</span>             <span class=c1># Auto-enables authentication</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=p>)</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=k>def</span><span class=w> </span><span class=nf>enhanced_tool</span><span class=p>():</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>    <span class=k>pass</span>
</span></code></pre></div> <p><strong>Proxy Classes:</strong></p> <ul> <li><strong>UnifiedMCPProxy</strong>: Base class using FastMCP client with all MCP protocol features</li> <li><strong>EnhancedUnifiedMCPProxy</strong>: Enhanced version with retry logic (used for all dependencies)</li> <li><strong>SelfDependencyProxy</strong>: Optimized proxy for local/same-agent calls (no network overhead)</li> </ul> <p><strong>Features (all in one proxy):</strong></p> <ul> <li>Configurable timeout and retry with exponential backoff</li> <li>Session management for stateful operations</li> <li>Custom headers and authentication</li> <li>Distributed tracing integration</li> <li>HTTP fallback when FastMCP client unavailable</li> </ul> <p><em>Implementation: See <code>src/runtime/python/_mcp_mesh/engine/unified_mcp_proxy.py</code></em></p> <h3 id=4-session-management-and-stickiness>4. <strong>Session Management and Stickiness</strong><a class=headerlink href=#4-session-management-and-stickiness title="Permanent link">&para;</a></h3> <p>For stateful operations, MCP Mesh provides automatic session affinity:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;stateful_counter&quot;</span><span class=p>,</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>    <span class=n>session_required</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>         <span class=c1># Enables session stickiness</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>    <span class=n>stateful</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>                 <span class=c1># Marks as stateful operation</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>    <span class=n>auto_session_management</span><span class=o>=</span><span class=kc>True</span>   <span class=c1># Automatic session lifecycle</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=p>)</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=k>def</span><span class=w> </span><span class=nf>increment_counter</span><span class=p>(</span><span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>increment</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>    <span class=c1># Automatically routed to same pod for this session</span>
</span></code></pre></div> <p><strong>Session Features:</strong></p> <ul> <li><strong>Redis-Backed Storage</strong>: Distributed session affinity across pods</li> <li><strong>Automatic Routing</strong>: Requests with same session_id go to same pod</li> <li><strong>Graceful Fallback</strong>: In-memory storage when Redis unavailable</li> <li><strong>TTL Management</strong>: Automatic session cleanup</li> </ul> <p><em>Implementation: See <code>src/runtime/python/_mcp_mesh/engine/http_wrapper.py</code></em></p> <h3 id=5-fast-heartbeat-architecture>5. <strong>Fast Heartbeat Architecture</strong><a class=headerlink href=#5-fast-heartbeat-architecture title="Permanent link">&para;</a></h3> <p>Optimized health monitoring with dual-heartbeat system:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=n>HEAD</span> <span class=o>/</span><span class=n>heartbeat</span>    <span class=c1># Lightweight timestamp update (5s intervals)</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=n>POST</span> <span class=o>/</span><span class=n>heartbeat</span>    <span class=c1># Full registration when triggered by HEAD response</span>
</span></code></pre></div> <p><strong>Benefits:</strong></p> <ul> <li><strong>Fast Failure Detection</strong>: Sub-20s failure detection</li> <li><strong>Network Efficiency</strong>: Minimal bandwidth usage</li> <li><strong>On-Demand Registration</strong>: Full updates only when needed</li> </ul> <p><em>Implementation: See <code>cmd/registry/</code> for heartbeat handling</em></p> <h2 id=implementation-architecture>Implementation Architecture<a class=headerlink href=#implementation-architecture title="Permanent link">&para;</a></h2> <h3 id=two-pipeline-design>Two-Pipeline Design<a class=headerlink href=#two-pipeline-design title="Permanent link">&para;</a></h3> <p>MCP Mesh uses a sophisticated two-pipeline architecture that separates initialization from runtime operations:</p> <h4 id=startup-pipeline-one-time-execution>Startup Pipeline (One-time Execution)<a class=headerlink href=#startup-pipeline-one-time-execution title="Permanent link">&para;</a></h4> <div class="language-text highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>DecoratorCollectionStep → ConfigurationStep → HeartbeatPreparationStep →
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>FastMCPServerDiscoveryStep → HeartbeatLoopStep → FastAPIServerSetupStep
</span></code></pre></div> <p><strong>Purpose</strong>: Initialize agent, collect decorators, prepare for mesh integration <strong>Trigger</strong>: Agent startup, decorator debounce completion <strong>Outcome</strong>: Agent ready with capabilities registered and dependency injection configured</p> <p><em>Implementation: See <code>src/runtime/python/_mcp_mesh/pipeline/startup/</code></em></p> <h4 id=heartbeat-pipeline-continuous-loop>Heartbeat Pipeline (Continuous Loop)<a class=headerlink href=#heartbeat-pipeline-continuous-loop title="Permanent link">&para;</a></h4> <div class="language-text highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>RegistryConnectionStep → HeartbeatSendStep → DependencyResolutionStep
</span></code></pre></div> <p><strong>Purpose</strong>: Maintain mesh connectivity, update dependency topology <strong>Trigger</strong>: Periodic execution (30s intervals) <strong>Outcome</strong>: Updated dependency proxies, health status maintained</p> <p><em>Implementation: See <code>src/runtime/python/_mcp_mesh/pipeline/heartbeat/</code></em></p> <h3 id=decorator-processing-and-debounce-coordination>Decorator Processing and Debounce Coordination<a class=headerlink href=#decorator-processing-and-debounce-coordination title="Permanent link">&para;</a></h3> <p><strong>Challenge</strong>: Decorators are processed as Python imports the module, but we need to wait for all decorators before starting mesh processing.</p> <p><strong>Solution</strong>: Debounce coordinator with configurable delay</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>  <span class=c1># Triggers debounce timer</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=k>def</span><span class=w> </span><span class=nf>tool1</span><span class=p>():</span> <span class=k>pass</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>  <span class=c1># Resets debounce timer</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=k>def</span><span class=w> </span><span class=nf>tool2</span><span class=p>():</span> <span class=k>pass</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=c1># After MCP_MESH_DEBOUNCE_DELAY (default 1.0s) with no new decorators:</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=c1># → Startup pipeline begins</span>
</span></code></pre></div> <p><strong>Design Benefits</strong>:</p> <ul> <li>Handles dynamic decorator registration during import</li> <li>Prevents race conditions in multi-decorator modules</li> <li>Configurable timing via <code>MCP_MESH_DEBOUNCE_DELAY</code></li> </ul> <p><em>Implementation: See <code>src/runtime/python/_mcp_mesh/engine/debounce_coordinator.py</code></em></p> <h3 id=dependency-resolution-and-proxy-architecture>Dependency Resolution and Proxy Architecture<a class=headerlink href=#dependency-resolution-and-proxy-architecture title="Permanent link">&para;</a></h3> <h4 id=function-caching-strategy>Function Caching Strategy<a class=headerlink href=#function-caching-strategy title="Permanent link">&para;</a></h4> <p><strong>Key Insight</strong>: Mesh decorators must process BEFORE FastMCP decorators to cache original functions. Since Python processes decorators bottom-up, <code>@mesh.tool()</code> goes below <code>@app.tool()</code>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>   <span class=c1># ← FastMCP processes wrapped function (outer, applied second)</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>  <span class=c1># ← Processes first, caches original function (inner, applied first)</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=k>def</span><span class=w> </span><span class=nf>hello</span><span class=p>():</span> <span class=k>pass</span>
</span></code></pre></div> <p><strong>Implementation</strong>:</p> <ol> <li>Mesh decorator caches <code>func._mesh_original_func = func</code></li> <li>Creates dependency injection wrapper</li> <li>FastMCP receives wrapper (not original)</li> <li>Runtime calls cached original with injected dependencies</li> </ol> <h4 id=proxy-selection-logic>Proxy Selection Logic<a class=headerlink href=#proxy-selection-logic title="Permanent link">&para;</a></h4> <p><strong>Registry-Driven</strong>: Heartbeat response determines proxy type based on dependency location.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=k>if</span> <span class=n>current_agent_id</span> <span class=o>==</span> <span class=n>target_agent_id</span><span class=p>:</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>    <span class=c1># Same agent - direct local call (no network overhead)</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>    <span class=n>proxy</span> <span class=o>=</span> <span class=n>SelfDependencyProxy</span><span class=p>(</span><span class=n>original_func</span><span class=p>,</span> <span class=n>function_name</span><span class=p>)</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=k>else</span><span class=p>:</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>    <span class=c1># Different agent - unified MCP proxy with auto-configuration</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>    <span class=n>proxy</span> <span class=o>=</span> <span class=n>EnhancedUnifiedMCPProxy</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>function_name</span><span class=p>,</span> <span class=n>kwargs_config</span><span class=p>)</span>
</span></code></pre></div> <p>The unified proxy automatically configures itself from <code>kwargs_config</code> passed from the <code>@mesh.tool()</code> decorator (timeout, retry, session, auth, etc.).</p> <p><em>Implementation: See <code>src/runtime/python/_mcp_mesh/pipeline/mcp_heartbeat/rust_heartbeat.py</code></em></p> <h3 id=hash-based-change-detection>Hash-Based Change Detection<a class=headerlink href=#hash-based-change-detection title="Permanent link">&para;</a></h3> <p><strong>Performance Optimization</strong>: Only update dependency injection when topology actually changes.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=k>def</span><span class=w> </span><span class=nf>_hash_dependency_state</span><span class=p>(</span><span class=n>dependency_state</span><span class=p>):</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>    <span class=n>state_str</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>dependency_state</span><span class=p>,</span> <span class=n>sort_keys</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>state_str</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=c1># In heartbeat pipeline:</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=n>current_hash</span> <span class=o>=</span> <span class=n>_hash_dependency_state</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>dependencies</span><span class=p>)</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=k>if</span> <span class=n>current_hash</span> <span class=o>==</span> <span class=n>_last_dependency_hash</span><span class=p>:</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a>    <span class=k>return</span>  <span class=c1># Skip expensive dependency injection update</span>
</span></code></pre></div> <p><strong>Benefits</strong>:</p> <ul> <li>Eliminates unnecessary proxy recreation</li> <li>Reduces CPU overhead in stable topologies</li> <li>Enables high-frequency heartbeats without performance penalty</li> </ul> <h3 id=registry-as-facilitator-pattern>Registry as Facilitator Pattern<a class=headerlink href=#registry-as-facilitator-pattern title="Permanent link">&para;</a></h3> <p><strong>Design Philosophy</strong>: Registry coordinates but never controls agent execution.</p> <p><strong>Registry Responsibilities</strong>:</p> <ul> <li>Accept agent registrations via heartbeat</li> <li>Store capability metadata (SQLite for local dev, PostgreSQL for production)</li> <li>Resolve dependencies and return topology</li> <li>Monitor health and mark unhealthy agents</li> <li>Generate audit events</li> </ul> <p><strong>What Registry NEVER Does</strong>:</p> <ul> <li>Make calls to agents (only agents call registry)</li> <li>Control agent lifecycle</li> <li>Proxy or intercept agent-to-agent communication</li> <li>Store business logic or state</li> </ul> <p><strong>Agent Autonomy</strong>: Agents poll registry for updates but operate independently. Registry failure doesn't break existing agent-to-agent connections.</p> <p><em>Implementation: See <code>cmd/registry/</code> for Go registry service</em></p> <h2 id=usage-patterns>Usage Patterns<a class=headerlink href=#usage-patterns title="Permanent link">&para;</a></h2> <h3 id=basic-agent-development>Basic Agent Development<a class=headerlink href=#basic-agent-development title="Permanent link">&para;</a></h3> <p><strong>1. Simple Tool Creation:</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=kn>from</span><span class=w> </span><span class=nn>fastmcp</span><span class=w> </span><span class=kn>import</span> <span class=n>FastMCP</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=kn>import</span><span class=w> </span><span class=nn>mesh</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=n>app</span> <span class=o>=</span> <span class=n>FastMCP</span><span class=p>(</span><span class=s2>&quot;My Service&quot;</span><span class=p>)</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span><span class=n>capability</span><span class=o>=</span><span class=s2>&quot;greeting&quot;</span><span class=p>)</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=k>def</span><span class=w> </span><span class=nf>say_hello</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>    <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;Hello, </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>!&quot;</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>agent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;greeting-service&quot;</span><span class=p>)</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=k>class</span><span class=w> </span><span class=nc>GreetingAgent</span><span class=p>:</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a>    <span class=k>pass</span>
</span></code></pre></div> <p><strong>2. With Dependencies:</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;time_greeting&quot;</span><span class=p>,</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>    <span class=n>dependencies</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;time_service&quot;</span><span class=p>]</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=p>)</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=k>def</span><span class=w> </span><span class=nf>time_greeting</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>time_service</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>    <span class=n>current_time</span> <span class=o>=</span> <span class=n>time_service</span><span class=p>()</span> <span class=k>if</span> <span class=n>time_service</span> <span class=k>else</span> <span class=s2>&quot;unknown time&quot;</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>    <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;Hello, </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>! Current time: </span><span class=si>{</span><span class=n>current_time</span><span class=si>}</span><span class=s2>&quot;</span>
</span></code></pre></div> <h3 id=enhanced-configuration>Enhanced Configuration<a class=headerlink href=#enhanced-configuration title="Permanent link">&para;</a></h3> <p><strong>3. Production-Ready Tool:</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;secure_data_processor&quot;</span><span class=p>,</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>    <span class=n>timeout</span><span class=o>=</span><span class=mi>120</span><span class=p>,</span>                           <span class=c1># 2 min timeout</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>    <span class=n>retry_count</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>                         <span class=c1># Retry on failure</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>    <span class=n>auth_required</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>                    <span class=c1># Require authentication</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>    <span class=n>custom_headers</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;X-Service&quot;</span><span class=p>:</span> <span class=s2>&quot;data&quot;</span><span class=p>},</span>  <span class=c1># Custom headers</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>    <span class=n>streaming</span><span class=o>=</span><span class=kc>True</span>                         <span class=c1># Enable streaming</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=p>)</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>process_large_dataset</span><span class=p>(</span><span class=n>data_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a>    <span class=c1># Auto-configured with enhanced proxy features</span>
</span></code></pre></div> <p><strong>4. Stateful Operations:</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>tool</span><span class=p>()</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>    <span class=n>capability</span><span class=o>=</span><span class=s2>&quot;user_session&quot;</span><span class=p>,</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a>    <span class=n>session_required</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>        <span class=c1># Enable session stickiness</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>    <span class=n>stateful</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>               <span class=c1># Mark as stateful</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a>    <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=p>)</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=k>def</span><span class=w> </span><span class=nf>update_user_state</span><span class=p>(</span><span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>updates</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a>    <span class=c1># Automatically routed to same pod for session consistency</span>
</span></code></pre></div> <h3 id=deployment-patterns>Deployment Patterns<a class=headerlink href=#deployment-patterns title="Permanent link">&para;</a></h3> <p><strong>Local Development:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1># Terminal 1: Start registry</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>meshctl<span class=w> </span>registry<span class=w> </span>start
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=c1># Terminal 2: Start your agent</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>python<span class=w> </span>my_agent.py
</span></code></pre></div> <p><strong>Docker Compose:</strong></p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3.8&quot;</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=w>  </span><span class=nt>registry</span><span class=p>:</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mcpmesh/registry:latest</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;8000:8000&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=w>  </span><span class=nt>my-service</span><span class=p>:</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=w>      </span><span class=nt>MCP_MESH_REGISTRY_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://registry:8000</span>
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>registry</span><span class="p p-Indicator">]</span>
</span></code></pre></div> <p><strong>Kubernetes:</strong></p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=nt>metadata</span><span class=p>:</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-service</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=nt>spec</span><span class=p>:</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent</span>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-service:latest</span>
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=w>          </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-32-13><a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MCP_MESH_REGISTRY_URL</span>
</span><span id=__span-32-14><a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://mcp-registry:8000&quot;</span>
</span><span id=__span-32-15><a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_URL</span>
</span><span id=__span-32-16><a id=__codelineno-32-16 name=__codelineno-32-16 href=#__codelineno-32-16></a><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;redis://redis:6379&quot;</span><span class=w> </span><span class=c1># For session storage</span>
</span></code></pre></div> <h2 id=performance-characteristics>Performance Characteristics<a class=headerlink href=#performance-characteristics title="Permanent link">&para;</a></h2> <h3 id=scalability-metrics>Scalability Metrics<a class=headerlink href=#scalability-metrics title="Permanent link">&para;</a></h3> <ul> <li><strong>Registry</strong>: 1000+ agents, 10,000+ capabilities, 100+ heartbeats/sec</li> <li><strong>Agent</strong>: 1000+ tool calls/sec, &lt;2s startup time</li> <li><strong>Discovery</strong>: &lt;10ms lookup time, &lt;1s update propagation</li> </ul> <h3 id=network-overhead>Network Overhead<a class=headerlink href=#network-overhead title="Permanent link">&para;</a></h3> <ul> <li><strong>HEAD Heartbeat</strong>: ~200B per agent every 5 seconds</li> <li><strong>POST Heartbeat</strong>: ~2KB per agent when topology changes</li> <li><strong>Tool Calls</strong>: Standard MCP JSON-RPC (varies by payload)</li> </ul> <h2 id=security-model>Security Model<a class=headerlink href=#security-model title="Permanent link">&para;</a></h2> <h3 id=current-architecture>Current Architecture<a class=headerlink href=#current-architecture title="Permanent link">&para;</a></h3> <ul> <li><strong>Trusted Network Model</strong>: Assumes secure network environment</li> <li><strong>Service-to-Service</strong>: Direct HTTP communication between agents</li> <li><strong>No Built-in Auth</strong>: Authentication via proxy configuration</li> </ul> <h3 id=production-recommendations>Production Recommendations<a class=headerlink href=#production-recommendations title="Permanent link">&para;</a></h3> <ol> <li><strong>Network Segmentation</strong>: Use private networks or VPNs</li> <li><strong>Service Mesh</strong>: Deploy with Istio/Linkerd for mTLS</li> <li><strong>API Gateway</strong>: Use gateway for external access control</li> <li><strong>Enhanced Proxies</strong>: Use <code>auth_required=True</code> with bearer tokens</li> </ol> <h2 id=extension-points>Extension Points<a class=headerlink href=#extension-points title="Permanent link">&para;</a></h2> <h3 id=custom-dependency-resolvers>Custom Dependency Resolvers<a class=headerlink href=#custom-dependency-resolvers title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=k>class</span><span class=w> </span><span class=nc>CustomDependencyResolver</span><span class=p>(</span><span class=n>DependencyResolver</span><span class=p>):</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>resolve_capability</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>capability_spec</span><span class=p>):</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>        <span class=c1># Custom logic for finding capabilities</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>        <span class=n>candidates</span> <span class=o>=</span> <span class=k>await</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>find_candidates</span><span class=p>(</span><span class=n>capability_spec</span><span class=p>)</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>apply_custom_selection</span><span class=p>(</span><span class=n>candidates</span><span class=p>)</span>
</span></code></pre></div> <h3 id=custom-health-checks>Custom Health Checks<a class=headerlink href=#custom-health-checks title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=nd>@mesh</span><span class=o>.</span><span class=n>tool</span><span class=p>(</span><span class=n>health_check</span><span class=o>=</span><span class=n>custom_health_check</span><span class=p>)</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=k>def</span><span class=w> </span><span class=nf>database_tool</span><span class=p>():</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>    <span class=k>pass</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>custom_health_check</span><span class=p>():</span>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>    <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;healthy&quot;</span><span class=p>,</span> <span class=s2>&quot;connections&quot;</span><span class=p>:</span> <span class=n>db</span><span class=o>.</span><span class=n>pool</span><span class=o>.</span><span class=n>size</span><span class=p>}</span>
</span></code></pre></div> <p><em>See <code>src/runtime/python/_mcp_mesh/</code> for extension interfaces</em></p> <hr> <p>This architecture enables MCP Mesh to provide a seamless, scalable, and developer-friendly service orchestration platform that preserves the simplicity of FastMCP while adding powerful distributed system capabilities.</p> <p><strong>For Implementation Details</strong>: See source code in <code>src/runtime/python/</code> (Python), <code>src/runtime/typescript/</code> (TypeScript), and <code>cmd/registry/</code> (Go) <strong>For Examples</strong>: See <code>examples/</code> directory for complete working examples <strong>For Configuration</strong>: See <a href=../environment-variables/ >Environment Variables</a> for all configuration options</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="January 16, 2026 02:43:08 UTC"><span class=timeago datetime=2026-01-16T02:43:08+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="January 16, 2026 02:43:08 UTC">2026-01-16</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="July 1, 2025 04:41:39 UTC"><span class=timeago datetime=2025-07-01T04:41:39+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="July 1, 2025 04:41:39 UTC">2025-07-01</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024-2025 MCP Mesh Contributors </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/dhyansraj/mcp-mesh target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.youtube.com/@MCPMesh target=_blank rel=noopener title=www.youtube.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z"/></svg> </a> <a href=https://discord.gg/KDFDREphWn target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg> </a> <a href=https://pypi.org/project/mcp-mesh/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> <script src=../assets/javascripts/extra.js></script> </body> </html>