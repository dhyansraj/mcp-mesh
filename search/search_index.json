{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-_,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Enterprise-Grade Distributed Service Mesh for AI Agents","text":"<p>MCP Mesh transforms the Model Context Protocol (MCP) from a development protocol into an enterprise-grade distributed system. Build production-ready AI agent networks with zero boilerplate.</p> <p>Complete Platform for AI Agents</p> <p>MCP Mesh is a complete platform for building and deploying AI agents to production scale. See how MCP Mesh compares \u2192</p>"},{"location":"#quick-start","title":"Quick Start","text":"PythonTypeScript <pre><code>pip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n</code></pre> <pre><code>from fastmcp import FastMCP\nimport mesh\n\napp = FastMCP(\"My Service\")\n\n@app.tool()\n@mesh.tool(capability=\"greeting\", dependencies=[\"date_service\"])\nasync def greet(date_service: mesh.McpMeshTool = None):\n    return f\"Hello! {await date_service()}\"\n\n@mesh.agent(name=\"my-service\", auto_run=True)\nclass MyAgent:\n    pass\n</code></pre> <pre><code>npm install @mcpmesh/sdk\n</code></pre> <pre><code>import { FastMCP, mesh } from \"@mcpmesh/sdk\";\nimport { z } from \"zod\";\n\nconst server = new FastMCP({ name: \"my-service\", version: \"1.0.0\" });\nconst agent = mesh(server, { name: \"my-service\", port: 9000 });\n\nagent.addTool({\n  name: \"greet\",\n  capability: \"greeting\",\n  description: \"Greet the user with current date\",\n  dependencies: [\"date_service\"],\n  parameters: z.object({ name: z.string() }),\n  execute: async ({ name }, { date_service }) =&gt; {\n    const date = await date_service();\n    return `Hello, ${name}! Today is ${date}`;\n  },\n});\n</code></pre> <p>That's it! No manual server setup, no connection management, no networking code.</p>"},{"location":"#key-features","title":"Key Features","text":""},{"location":"#zero-boilerplate","title":"Zero Boilerplate","text":"<p>Two decorators replace hundreds of lines of networking code. Just write business logic.</p>"},{"location":"#smart-discovery","title":"Smart Discovery","text":"<p>Tag-based service resolution with version constraints. Agents automatically find dependencies.</p>"},{"location":"#kubernetes-native","title":"Kubernetes Native","text":"<p>Production-ready Helm charts with horizontal scaling, health checks, and observability.</p>"},{"location":"#dynamic-updates","title":"Dynamic Updates","text":"<p>Hot dependency injection without restarts. Add, remove, or upgrade services seamlessly.</p>"},{"location":"#built-in-observability","title":"Built-in Observability","text":"<p>Grafana dashboards, distributed tracing with Tempo, and Redis-backed session management.</p>"},{"location":"#enterprise-ready","title":"Enterprise Ready","text":"<p>Graceful failure handling, auto-reconnection, RBAC support, and real-time monitoring.</p>"},{"location":"#why-mcp-mesh","title":"Why MCP Mesh?","text":"For DevelopersFor Solution ArchitectsFor DevOps TeamsFor Support &amp; OperationsFor Engineering Leadership <p>Stop fighting infrastructure. Start building intelligence.</p> <ul> <li>Zero boilerplate networking code</li> <li>Pure Python simplicity with FastMCP integration</li> <li>End-to-end FastAPI integration with <code>@mesh.route()</code></li> <li>Same code runs locally, in Docker, and Kubernetes</li> </ul> <p>Design intelligent systems, not complex integrations.</p> <ul> <li>Agent-centric architecture with clear capabilities</li> <li>Dynamic intelligence - agents get smarter automatically</li> <li>Domain-driven design with focused, composable agents</li> <li>Mix and match agents to create new capabilities</li> </ul> <p>Production-ready AI infrastructure out of the box.</p> <ul> <li>Kubernetes-native with battle-tested Helm charts</li> <li>Enterprise observability with Grafana, Tempo, and Redis</li> <li>Zero-touch operations with auto-discovery</li> <li>Scale from 2 agents to 200+ with same complexity</li> </ul> <p>Complete visibility and zero-downtime operations.</p> <ul> <li>Real-Time Network Monitoring: See every agent, dependency, and health status in live dashboards</li> <li>Intelligent Scaling: Agents scale independently based on demand - no cascading performance issues</li> <li>Graceful Failure Handling: Agents degrade gracefully when dependencies are unavailable, automatically reconnect when services return</li> <li>One-Click Diagnostics: <code>meshctl status</code> provides instant network health assessment with actionable insights</li> </ul> <p>Transform AI experiments into production revenue.</p> <ul> <li>Accelerated Time-to-Market: Move from PoC to production deployment in weeks, not months</li> <li>Cross-Team Collaboration: Enable different departments to build agents that automatically enhance each other's capabilities</li> <li>Risk Mitigation: Battle-tested enterprise patterns ensure reliable AI deployments that scale with your business</li> <li>Future-Proof Architecture: Add new AI capabilities without disrupting existing systems</li> </ul> <p>Turn your AI strategy from \"promising experiments\" to \"competitive advantage in production.\"</p>"},{"location":"#mcp-vs-mcp-mesh","title":"MCP vs MCP Mesh","text":"Challenge Traditional MCP MCP Mesh Connect 5 servers 200+ lines of networking code 2 decorators Handle failures Manual error handling everywhere Automatic graceful degradation Scale to production Custom Kubernetes setup <code>helm install mcp-mesh</code> Monitor system Build custom dashboards Built-in observability stack Add new capabilities Restart and reconfigure clients Auto-discovery, zero downtime"},{"location":"#mcp-mesh-vs-other-frameworks","title":"MCP Mesh vs Other Frameworks","text":"Framework K8s Native Independent Scaling Service Discovery Best For MCP Mesh  Helm  Per-agent pods  Built-in Production deployment LangGraph  Manual  Same process  DIY Complex workflows CrewAI  Manual  Limited  None Rapid prototyping AutoGen  Manual  Manual  DIY Enterprise/Azure OpenAI Agents  Manual  Manual  None OpenAI-centric <p> Full comparison with code examples</p>"},{"location":"#installation","title":"Installation","text":"meshctl (CLI)RegistryPython RuntimeTypeScript RuntimeDocker ImagesHelm Charts <pre><code>npm install -g @mcpmesh/cli\n</code></pre> <p>Command-line tool for managing agents, registry, and mesh operations.</p> <pre><code>npm install -g @mcpmesh/cli\n</code></pre> <p>Service discovery and coordination server. Included with the npm package above.</p> <pre><code>pip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n</code></pre> <p>Runtime for building agents with <code>@mesh.agent</code> and <code>@mesh.tool</code> decorators.</p> <pre><code>npm install @mcpmesh/sdk\n</code></pre> <p>Runtime for building agents with <code>mesh()</code>, <code>agent()</code>, and <code>addTool()</code> functions.</p> <pre><code>docker pull mcpmesh/registry:0.8\ndocker pull mcpmesh/python-runtime:0.8\n</code></pre> <p>Official container images for production deployments.</p> <pre><code>helm install mcp-mesh oci://ghcr.io/dhyansraj/mcp-mesh/charts/mcp-mesh\n</code></pre> <p>Kubernetes deployment with the umbrella chart.</p>"},{"location":"#community-support","title":"Community &amp; Support","text":"<ul> <li> Discord - Real-time help and discussions</li> <li> GitHub Discussions - Share ideas and ask questions</li> <li> Issues - Report bugs or request features</li> <li> Examples - Working code examples</li> </ul>"},{"location":"#project-status","title":"Project Status","text":"<ul> <li>Latest Release: v0.8.0-beta.6 (January 2026)</li> <li>License: MIT</li> <li>Languages: Python 3.11+ and TypeScript/Node.js 18+ (runtime), Go 1.23+ (registry)</li> <li>Status: Production-ready, actively developed</li> </ul>"},{"location":"#acknowledgments","title":"Acknowledgments","text":"<ul> <li>Anthropic for creating the MCP protocol</li> <li>FastMCP for excellent MCP server foundations</li> <li>Kubernetes community for the infrastructure platform</li> <li>All contributors who help make MCP Mesh better</li> </ul> <p>Ready to get started?</p> <p>Python SDK TypeScript SDK View on GitHub</p> <p>Star the repo if MCP Mesh helps you build better AI systems! </p>"},{"location":"01-getting-started/","title":"Getting Started with MCP Mesh","text":"<p>From zero to distributed MCP services in 10 minutes</p>"},{"location":"01-getting-started/#overview","title":"Overview","text":"<p>MCP Mesh makes building distributed MCP services as easy as writing Python functions. Add decorators to your classes and functions, and they automatically discover and use other services across your network.</p>"},{"location":"01-getting-started/#what-is-mcp-mesh","title":"What is MCP Mesh?","text":"<p>MCP Mesh is a distributed service mesh framework that enhances FastMCP with automatic discovery and dependency injection:</p> <ul> <li>\ud83d\udd0c Dual decorators: Combine familiar <code>@app.tool</code> (FastMCP) with <code>@mesh.tool</code> (orchestration)</li> <li>\ud83d\udd0d All MCP decorators: Support for <code>@app.tool</code>, <code>@app.prompt</code>, <code>@app.resource</code> from FastMCP</li> <li>\ud83d\udc89 Smart dependency injection: Use remote functions with type safety (<code>mesh.McpMeshTool</code>)</li> <li>\ud83c\udff7\ufe0f Tag-based resolution: Smart capability matching using tags and metadata</li> <li>\ud83d\ude80 Zero boilerplate: Mesh discovers your FastMCP <code>app</code> and handles everything</li> <li>\ud83d\udce6 Production ready: Go registry + Python agents + Kubernetes support</li> </ul>"},{"location":"01-getting-started/#the-simplest-example","title":"The Simplest Example","text":"<pre><code>import mesh\nfrom fastmcp import FastMCP\n\n# Single FastMCP server instance\napp = FastMCP(\"Hello World Service\")\n\n# 1. Add a simple tool with dual decorators\n@app.tool()  # \u2190 FastMCP decorator (familiar MCP development)\n@mesh.tool(capability=\"greeting\")  # \u2190 Mesh decorator (adds orchestration)\ndef greet(name: str = \"World\") -&gt; str:\n    return f\"Hello, {name}!\"\n\n# 2. Add a tool with dependency injection\n@app.tool()  # \u2190 FastMCP handles MCP protocol\n@mesh.tool(\n    capability=\"advanced_greeting\",\n    dependencies=[\"date_service\"]  # \u2190 Mesh handles service discovery\n)\nasync def greet_with_date(name: str = \"World\", date_service: mesh.McpMeshTool = None) -&gt; str:\n    if date_service:\n        current_date = await date_service()  # Calls remote system agent\n        return f\"Hello, {name}! Today is {current_date}\"\n    return f\"Hello, {name}! (Date service not available)\"\n\n# 3. Configure the agent\n@mesh.agent(\n    name=\"hello-world\",\n    http_port=9090,\n    auto_run=True  # Mesh handles server startup automatically\n)\nclass HelloWorldAgent:\n    pass\n\n# No main method needed! Mesh discovers 'app' and handles everything.\n</code></pre> <p>That's it! The dual decorator pattern gives you:</p> <ul> <li>FastMCP decorators (<code>@app.tool</code>) for familiar MCP development</li> <li>Mesh decorators (<code>@mesh.tool</code>) for dependency injection and orchestration</li> <li>Automatic discovery - Mesh finds your FastMCP <code>app</code> and handles server startup</li> <li>Zero boilerplate - No main methods or manual server management needed</li> </ul>"},{"location":"01-getting-started/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure you have the required tools installed.</p>"},{"location":"01-getting-started/#required","title":"Required","text":""},{"location":"01-getting-started/#python-311","title":"Python 3.11+","text":"<pre><code># Check version\npython --version  # Should show 3.11 or higher\n\n# Install if needed\n# macOS\nbrew install python@3.11\n\n# Ubuntu/Debian\nsudo apt install python3.11\n\n# Windows - download from https://python.org\n</code></pre>"},{"location":"01-getting-started/#virtual-environment","title":"Virtual Environment","text":"<p>MCP Mesh expects a <code>.venv</code> directory in your project root:</p> <pre><code># Create virtual environment\npython -m venv .venv\n\n# Activate it\nsource .venv/bin/activate  # Linux/macOS\n.venv\\Scripts\\activate      # Windows\n\n# Install MCP Mesh SDK\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n</code></pre> <p>Why .venv?</p> <p><code>meshctl start</code> automatically detects and uses <code>.venv</code> if present. This keeps your project dependencies isolated and consistent.</p>"},{"location":"01-getting-started/#docker-docker-compose","title":"Docker &amp; Docker Compose","text":"<p>Required for the Docker quick start and production deployments:</p> <pre><code># Check installation\ndocker --version\ndocker compose version\n\n# Install if needed\n# macOS\nbrew install --cask docker  # Installs Docker Desktop\n\n# Ubuntu\nsudo apt install docker.io docker-compose-v2\n\n# Windows - download Docker Desktop from https://docker.com\n</code></pre>"},{"location":"01-getting-started/#meshctl-cli","title":"meshctl CLI","text":"<p>The <code>meshctl</code> command-line tool manages agents, registry, and scaffolding:</p> <pre><code># Install via npm (recommended)\nnpm install -g @mcpmesh/cli\n</code></pre> Alternative: Homebrew (macOS) <pre><code>brew tap dhyansraj/mcp-mesh\nbrew install mcp-mesh\n</code></pre> Alternative: Install Script (Linux/macOS) <pre><code>curl -sSL https://raw.githubusercontent.com/dhyansraj/mcp-mesh/main/install.sh | bash\n</code></pre> Alternative: Build from Source <pre><code>git clone https://github.com/dhyansraj/mcp-mesh.git\ncd mcp-mesh\nmake install-dev\n# Binary available at ./bin/meshctl\n</code></pre> <p>Verify installation:</p> <pre><code>meshctl version\n</code></pre>"},{"location":"01-getting-started/#optional-for-kubernetes","title":"Optional (for Kubernetes)","text":""},{"location":"01-getting-started/#helm","title":"Helm","text":"<p>Required for deploying to Kubernetes:</p> <pre><code># macOS\nbrew install helm\n\n# Linux\ncurl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash\n\n# Verify\nhelm version\n</code></pre>"},{"location":"01-getting-started/#minikube-local-kubernetes","title":"Minikube (Local Kubernetes)","text":"<p>For local Kubernetes development:</p> <pre><code># macOS\nbrew install minikube\n\n# Linux\ncurl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64\nsudo install minikube-linux-amd64 /usr/local/bin/minikube\n\n# Windows\nchoco install minikube\n\n# Start cluster\nminikube start --cpus=4 --memory=8192\n</code></pre>"},{"location":"01-getting-started/#quick-check","title":"Quick Check","text":"<p>Run this to verify your setup:</p> <pre><code>echo \"=== MCP Mesh Prerequisites Check ===\"\necho -n \"Python: \"; python --version 2&gt;/dev/null || echo \"\u274c Not found\"\necho -n \"pip: \"; pip --version 2&gt;/dev/null | head -c 20 || echo \"\u274c Not found\"\necho -n \"Docker: \"; docker --version 2&gt;/dev/null | head -c 25 || echo \"\u274c Not found\"\necho -n \"meshctl: \"; meshctl version 2&gt;/dev/null || echo \"\u274c Not found (optional for Docker quick start)\"\necho -n \"Helm: \"; helm version --short 2&gt;/dev/null || echo \"\u26a0\ufe0f Not found (optional)\"\necho -n \"Minikube: \"; minikube version --short 2&gt;/dev/null || echo \"\u26a0\ufe0f Not found (optional)\"\n</code></pre>"},{"location":"01-getting-started/#quick-start-docker-2-minutes","title":"Quick Start (Docker - 2 Minutes)","text":"<p>Easiest way to get started:</p> <pre><code># 1. Clone the repository (for agent code)\ngit clone https://github.com/dhyansraj/mcp-mesh.git\ncd mcp-mesh/examples/docker-examples\n\n# 2. Start everything (uses published Docker images)\ndocker-compose up\n\n# 3. Test it (in another terminal)\nmeshctl call hello_mesh_simple --agent-url http://localhost:8081\n</code></pre> <p>Expected response:</p> <pre><code>{\n  \"content\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"\ud83d\udc4b Hello from MCP Mesh! Today is December 11, 2025 at 03:30 PM\"\n    }\n  ],\n  \"isError\": false\n}\n</code></pre> <p>That's it! You now have a working distributed MCP service mesh! \ud83c\udf89</p>"},{"location":"01-getting-started/#quick-start-with-meshctl-2-minutes","title":"Quick Start with meshctl (2 Minutes)","text":"<p>The simplest way to run agents locally:</p> <pre><code># 1. Install MCP Mesh\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n\n# 2. Clone examples\ngit clone https://github.com/dhyansraj/mcp-mesh.git\ncd mcp-mesh/examples/simple\n\n# 3. Start agents (registry starts automatically!)\nmeshctl start system_agent.py     # Terminal 1\nmeshctl start hello_world.py      # Terminal 2\n\n# 4. Test it\nmeshctl call hello_mesh_simple\n</code></pre> <p>Auto-Registry</p> <p><code>meshctl start</code> automatically starts the registry if one isn't running. No need to manage it separately!</p>"},{"location":"01-getting-started/#alternative-installation-methods","title":"Alternative Installation Methods","text":"Homebrew (macOS) <pre><code># Install CLI tools via Homebrew\nbrew tap dhyansraj/mcp-mesh\nbrew install mcp-mesh\n\n# Then follow the Quick Start above\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n</code></pre> Install Script (Linux/macOS) <pre><code># Install meshctl binary\ncurl -sSL https://raw.githubusercontent.com/dhyansraj/mcp-mesh/main/install.sh | bash\n\n# Then follow the Quick Start above\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n</code></pre> Build from Source  **For contributors:**  <pre><code># Build everything\nmake install-dev\n\n# Start agents\n./bin/meshctl start examples/simple/system_agent.py   # Terminal 1\n./bin/meshctl start examples/simple/hello_world.py    # Terminal 2\n\n# Check status\n./bin/meshctl status\n</code></pre>"},{"location":"01-getting-started/#learning-paths","title":"Learning Paths","text":"<p>Choose your journey based on your goals:</p>"},{"location":"01-getting-started/#i-want-to-see-it-working-5-minutes","title":"\ud83d\ude80 I want to see it working (5 minutes)","text":"<ol> <li>Docker Quick Start - Complete environment</li> <li>Test the examples - See dependency injection in action</li> <li>Explore with meshctl - Understand the architecture</li> </ol>"},{"location":"01-getting-started/#i-want-to-develop-agents-15-minutes","title":"\ud83d\udd27 I want to develop agents (15 minutes)","text":"<ol> <li>Local Development Setup - Set up your environment</li> <li>Run examples locally - Direct binary execution</li> <li>Modify an agent - Make your first change</li> <li>Create new tools - Add your own functionality</li> </ol>"},{"location":"01-getting-started/#i-want-production-deployment-30-minutes","title":"\ud83c\udfed I want production deployment (30 minutes)","text":"<ol> <li>Kubernetes Guide - Production-ready setup</li> <li>Deploy to cluster - Scale and monitor</li> <li>Test resilience - Failure scenarios</li> <li>Monitor with meshctl - Operational insights</li> </ol>"},{"location":"01-getting-started/#i-want-to-understand-everything-60-minutes","title":"\ud83d\udcda I want to understand everything (60 minutes)","text":"<ol> <li>Start with Docker to see the big picture</li> <li>Try local development to understand internals</li> <li>Deploy to Kubernetes for production patterns</li> <li>Read the architecture docs for deep understanding</li> </ol>"},{"location":"01-getting-started/#how-mcp-mesh-works","title":"How MCP Mesh Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Registry      \u2502    \u2502  Hello World     \u2502    \u2502  System Agent  \u2502\n\u2502   (Go + DB)     \u2502    \u2502  Agent (Python)  \u2502    \u2502  (Python)       \u2502\n\u2502   Port: 8000    \u2502\u25c4\u2500\u2500\u25ba\u2502  Port: 8081      \u2502\u25c4\u2500\u2500\u25ba\u2502  Port: 8082     \u2502\n\u2502   [Discovery]   \u2502    \u2502  [Capabilities]  \u2502    \u2502  [Services]     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u25b2                         \u25b2                       \u25b2\n        \u2502               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  meshctl Client  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                        \u2502  (CLI/Dashboard) \u2502\n                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nYour Code                    MCP Mesh Runtime               Automatic\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 @mesh.agent     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2022 HTTP Wrapper     \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u2022 Registry   \u2502\n\u2502 @mesh.tool      \u2502         \u2502 \u2022 Dependency Graph \u2502       \u2502 \u2022 Discovery  \u2502\n\u2502 def my_func():  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u2022 JSON-RPC/MCP     \u2502       \u2502 \u2022 Health     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   You write this             Handles complexity            Runs for you\n</code></pre>"},{"location":"01-getting-started/#key-concepts-in-30-seconds","title":"Key Concepts in 30 Seconds","text":"<ol> <li>Agents: Python classes decorated with <code>@mesh.agent</code> that group related tools</li> <li>Tools: Functions decorated with <code>@mesh.tool</code> that provide specific capabilities</li> <li>Registry: Go service that tracks all agents and handles service discovery</li> <li>Capabilities: What each tool provides (e.g., \"date_service\", \"weather\", \"database\")</li> <li>Dependencies: What capabilities a tool needs from other agents</li> <li>Injection: Remote functions automatically injected as function parameters</li> <li>meshctl: CLI tool for managing, monitoring, and debugging the mesh</li> </ol>"},{"location":"01-getting-started/#why-developers-love-mcp-mesh","title":"Why Developers Love MCP Mesh","text":"<ul> <li>Zero boilerplate: Just add decorators to existing functions</li> <li>Graceful degradation: Agents work standalone, enhance when connected</li> <li>MCP protocol: Full compatibility with existing MCP tools and clients</li> <li>Local to production: Same code runs locally, in Docker, and Kubernetes</li> <li>Real-time updates: Hot dependency injection without restarts</li> <li>Operational visibility: Built-in monitoring and debugging tools</li> </ul>"},{"location":"01-getting-started/#ready-to-start","title":"Ready to Start?","text":"<p>Choose your path:</p> <ul> <li>\ud83d\ude80 Quick Demo: Try the Docker deployment</li> <li>\ud83d\udd27 Local Development: Follow the local development guide</li> <li>\ud83c\udfed Production Setup: Deploy with Helm to Kubernetes</li> <li>\ud83d\udcda Deep Dive: Read the architecture and design</li> </ul> <p>\ud83d\udca1 Tip: Start with Docker for the complete experience, then try local development for faster iteration.</p> <p>\ud83d\udcda Note: All examples use the same core agents, so you can easily switch between deployment methods.</p>"},{"location":"01-getting-started/#troubleshooting","title":"\ud83d\udd27 Troubleshooting","text":"<p>Common issues when getting started:</p> <p>Docker Issues:</p> <ul> <li>Port conflicts: Change ports in <code>.env.local</code> file</li> <li>Build failures: Try <code>docker-compose build --no-cache</code></li> <li>Registry connection: Check <code>docker-compose logs registry</code></li> </ul> <p>Local Development Issues:</p> <ul> <li>Build errors: Ensure Go 1.21+ and Python 3.11+ are installed</li> <li>Registry not starting: Check if port 8000 is available</li> <li>Agent connection failures: Verify registry is running first</li> <li>Import errors: Run <code>make install-dev</code> to install dependencies</li> </ul> <p>Testing Issues:</p> <ul> <li>Tool calls fail: Use <code>/mcp</code> endpoint, not <code>/tools/call</code></li> <li>No dependency injection: Wait 30-60 seconds for full mesh setup</li> <li>JSON errors: Ensure proper JSON-RPC format in curl commands</li> </ul> <p>For detailed solutions, see the troubleshooting sections in each example README.</p>"},{"location":"01-getting-started/#known-limitations","title":"\u26a0\ufe0f Known Limitations","text":"<ul> <li>Windows Support: Native Windows support is experimental; WSL2 or Docker recommended</li> <li>Python 3.10 and below: Not supported; requires Python 3.11+</li> <li>Network Policies: Strict firewall/network policies may block agent communication</li> </ul>"},{"location":"01-getting-started/#whats-next","title":"\ud83c\udfaf What's Next?","text":"<p>After getting started:</p>"},{"location":"01-getting-started/#explore-the-examples","title":"Explore the Examples","text":"<ul> <li>Modify existing agents to understand the patterns</li> <li>Add new tools to see dependency injection in action</li> <li>Test resilience by stopping and starting agents</li> </ul>"},{"location":"01-getting-started/#build-your-own-agent","title":"Build Your Own Agent","text":"<pre><code># Generate a new agent with meshctl scaffold\nmeshctl scaffold --name my-agent --capability my_tool\n\n# Or generate with Docker Compose\nmeshctl scaffold --name my-agent --compose\n</code></pre> <ul> <li>Customize the generated agent code</li> <li>Add your own capabilities and dependencies</li> <li>Test integration with existing agents</li> </ul>"},{"location":"01-getting-started/#scale-to-production","title":"Scale to Production","text":"<ul> <li>Deploy to Kubernetes for production workloads</li> <li>Set up monitoring and alerting</li> <li>Configure security and access controls</li> </ul>"},{"location":"01-getting-started/#advanced-features","title":"Advanced Features","text":"<ul> <li>Tag-based dependency resolution</li> <li>Multi-replica agent deployments</li> <li>Cross-namespace service discovery</li> <li>Custom capability development</li> </ul>"},{"location":"01-getting-started/#additional-resources","title":"\ud83d\udcda Additional Resources","text":"<ul> <li>Local Development - Set up your development environment</li> <li>Docker Deployment - Deploy agents with Docker Compose</li> <li>Kubernetes Deployment - Production deployment with Helm</li> <li>meshctl CLI Reference - Command reference for meshctl</li> </ul>"},{"location":"02-local-development/","title":"Local Development","text":"<p>Develop your own MCP Mesh agents locally</p>"},{"location":"02-local-development/#choose-your-language","title":"Choose Your Language","text":""},{"location":"02-local-development/#python","title":"Python","text":"<p>Full-featured Python SDK with decorators.</p> <ul> <li><code>@mesh.agent</code>, <code>@mesh.tool</code> decorators</li> <li>Jinja2 template support</li> <li>pytest integration</li> </ul> <p> Python Guide</p>"},{"location":"02-local-development/#typescript","title":"TypeScript","text":"<p>Modern TypeScript SDK with full type safety.</p> <ul> <li><code>mesh()</code>, <code>agent.addTool()</code> functions</li> <li>Zod schema validation</li> <li>Vitest integration</li> </ul> <p> TypeScript Guide</p>"},{"location":"02-local-development/#overview","title":"Overview","text":"<p>This guide walks you through setting up a local development environment for building your own MCP Mesh agents. You'll learn how to scaffold, develop, and test agents on your machine using Python or TypeScript.</p>"},{"location":"02-local-development/#development-workflow","title":"Development Workflow","text":"<pre><code>graph LR\n    A[Install Tools] --&gt; B[Scaffold Agent]\n    B --&gt; C[Write Code]\n    C --&gt; D[Start Agents]\n    D --&gt; E[Test with curl]\n    E --&gt; C</code></pre>"},{"location":"02-local-development/#quick-start","title":"Quick Start","text":""},{"location":"02-local-development/#1-install-required-components","title":"1. Install Required Components","text":"meshctl (CLI)RegistryPython RuntimeTypeScript Runtime <pre><code>npm install -g @mcpmesh/cli\n</code></pre> <p>Command-line tool for managing agents, registry, and mesh operations.</p> <pre><code>npm install -g @mcpmesh/cli\n</code></pre> <p>Service discovery and coordination server. Included with the npm package above.</p> <pre><code>pip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n</code></pre> <p>Runtime for building agents with <code>@mesh.agent</code> and <code>@mesh.tool</code> decorators.</p> <pre><code>npm install @mcpmesh/sdk zod\nnpm install -D typescript tsx @types/node\n</code></pre> <p>Runtime for building agents with <code>mesh()</code> and <code>agent.addTool()</code> functions.</p>"},{"location":"02-local-development/#2-set-up-your-project","title":"2. Set Up Your Project","text":"<pre><code># Create project directory\nmkdir my-agent-project\ncd my-agent-project\n\n# Create and activate virtual environment\npython -m venv .venv\nsource .venv/bin/activate  # On Windows: .venv\\Scripts\\activate\n\n# Install MCP Mesh SDK (if not done above)\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n</code></pre>"},{"location":"02-local-development/#3-scaffold-your-agent","title":"3. Scaffold Your Agent","text":"<pre><code># Generate a new agent\nmeshctl scaffold --name my-agent --capability my_service\n\n# Or with Docker Compose for deployment\nmeshctl scaffold --name my-agent --compose\n</code></pre> <p>This creates:</p> <pre><code>my-agent/\n\u251c\u2500\u2500 main.py           # Your agent code\n\u251c\u2500\u2500 requirements.txt  # Dependencies\n\u2514\u2500\u2500 README.md         # Documentation\n</code></pre>"},{"location":"02-local-development/#4-develop-your-agent","title":"4. Develop Your Agent","text":"<p>Edit <code>main.py</code> to add your functionality:</p> <pre><code>import mesh\nfrom fastmcp import FastMCP\n\napp = FastMCP(\"My Agent\")\n\n@app.tool()\n@mesh.tool(capability=\"my_service\")\ndef my_function(data: str) -&gt; str:\n    \"\"\"Your custom functionality.\"\"\"\n    return f\"Processed: {data}\"\n\n@mesh.agent(name=\"my-agent\", http_port=8080, auto_run=True)\nclass MyAgent:\n    pass\n</code></pre>"},{"location":"02-local-development/#5-start-your-agent","title":"5. Start Your Agent","text":"<pre><code># Start your agent (registry auto-starts if not running)\nmeshctl start main.py\n</code></pre>"},{"location":"02-local-development/#6-test-your-agent","title":"6. Test Your Agent","text":"<pre><code># List registered agents\nmeshctl list\n\n# Call your tool\nmeshctl call my_function '{\"data\":\"hello\"}'\n</code></pre> Alternative: Using curl directly <pre><code># List available tools\ncurl -s -X POST http://localhost:8080/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tools/list\",\"params\":{}}'\n\n# Call your tool\ncurl -s -X POST http://localhost:8080/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tools/call\",\"params\":{\"name\":\"my_function\",\"arguments\":{\"data\":\"hello\"}}}'\n</code></pre>  !!! note \"SSE Response Format\" MCP Mesh uses Server-Sent Events (SSE) format. `meshctl call` handles this automatically."},{"location":"02-local-development/#multi-agent-development","title":"Multi-Agent Development","text":"<p>Develop multiple agents that work together:</p> <pre><code># Terminal 1: Start first agent\nmeshctl start agents/auth_agent.py\n\n# Terminal 2: Start second agent (depends on first)\nmeshctl start agents/api_agent.py\n\n# Test dependency injection\nmeshctl call secure_operation\n</code></pre>"},{"location":"02-local-development/#project-structure","title":"Project Structure","text":"<p>Each scaffolded agent gets its own directory:</p> <pre><code>my-project/\n\u251c\u2500\u2500 my-agent/\n\u2502   \u251c\u2500\u2500 main.py           # Agent code\n\u2502   \u251c\u2500\u2500 requirements.txt  # Dependencies\n\u2502   \u251c\u2500\u2500 Dockerfile        # Container build\n\u2502   \u251c\u2500\u2500 helm-values.yaml  # Kubernetes config\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 __main__.py\n\u2502   \u2514\u2500\u2500 README.md\n\u251c\u2500\u2500 another-agent/\n\u2502   \u251c\u2500\u2500 main.py\n\u2502   \u251c\u2500\u2500 requirements.txt\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 docker-compose.yml    # Generated with --compose\n</code></pre>"},{"location":"02-local-development/#environment-variables","title":"Environment Variables","text":"<p>For local development, agent configuration (name, port, capabilities) is typically defined in the agent code itself. Environment variables are more useful for:</p> <ul> <li>Shared configuration across multiple agents (API keys, external service URLs)</li> <li>Kubernetes/Helm deployments where you override ports and registry URLs</li> </ul> <pre><code># .env - shared config for multiple agents\nOPENAI_API_KEY=sk-...\nDATABASE_URL=postgres://localhost:5432/mydb\n</code></pre> <p>Use <code>--env-file</code> to load shared variables when starting agents:</p> <pre><code># Load .env for all agents\nmeshctl start --env-file .env agent1.py agent2.py\n\n# Or pass individual variables\nmeshctl start --env MY_API_KEY=secret main.py\n</code></pre> <p>Port Configuration</p> <p>Avoid setting <code>MCP_MESH_HTTP_PORT</code> in shared env files\u2014it causes port conflicts when running multiple agents. Define ports in your agent code for local dev, or let them auto-assign with <code>port: 0</code>.</p>"},{"location":"02-local-development/#useful-commands","title":"Useful Commands","text":"<pre><code># Start multiple agents at once (mixed languages supported)\nmeshctl start agent1.py agent2.ts agent3.py\n\n# Start with hot reload (auto-restart on file changes)\nmeshctl start -w main.py\n\n# Start in background (detached mode)\nmeshctl start -d main.py\n\n# List all agents\nmeshctl list\n\n# Check mesh status (capabilities, dependencies, endpoints)\nmeshctl status\n\n# Stop all agents\nmeshctl stop --all\n</code></pre>"},{"location":"02-local-development/#debugging","title":"Debugging","text":""},{"location":"02-local-development/#enable-debug-mode","title":"Enable Debug Mode","text":"<pre><code># Debug mode (verbose output + debug logging)\nmeshctl start --debug main.py\n\n# Or set specific log level\nmeshctl start --log-level DEBUG main.py\n\n# Available levels: TRACE, DEBUG, INFO, WARN, ERROR\n# TRACE enables SQL logging for registry debugging\n</code></pre>"},{"location":"02-local-development/#check-registry-connection","title":"Check Registry Connection","text":"<pre><code># Quick check - shows agent count and dependency resolution\nmeshctl list\n\n# Detailed view - shows capabilities, dependencies, endpoints\nmeshctl status\n</code></pre>"},{"location":"02-local-development/#vs-code-configuration","title":"VS Code Configuration","text":"<p>Create <code>.vscode/launch.json</code>:</p> <pre><code>{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"Debug Agent\",\n      \"type\": \"python\",\n      \"request\": \"launch\",\n      \"module\": \"mesh\",\n      \"args\": [\"start\", \"main.py\"],\n      \"env\": {\n        \"MCP_MESH_LOG_LEVEL\": \"DEBUG\"\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"02-local-development/#testing-your-agents","title":"Testing Your Agents","text":"<pre><code># tests/test_agents.py\nimport pytest\nimport requests\n\ndef test_my_function():\n    response = requests.post(\n        \"http://localhost:8080/mcp\",\n        json={\n            \"jsonrpc\": \"2.0\",\n            \"id\": 1,\n            \"method\": \"tools/call\",\n            \"params\": {\n                \"name\": \"my_function\",\n                \"arguments\": {\"data\": \"test\"}\n            }\n        }\n    )\n    assert response.status_code == 200\n    result = response.json()\n    assert \"Processed: test\" in str(result)\n</code></pre> <p>Run tests:</p> <pre><code>pytest tests/\n</code></pre>"},{"location":"02-local-development/#troubleshooting","title":"Troubleshooting","text":""},{"location":"02-local-development/#registry-not-starting","title":"Registry Not Starting","text":"<pre><code># Check if port 8000 is in use\nlsof -i :8000\n\n# Kill existing process if needed\nkill -9 $(lsof -t -i:8000)\n\n# Start registry manually\nmeshctl start-registry\n</code></pre>"},{"location":"02-local-development/#agent-not-registering","title":"Agent Not Registering","text":"<ol> <li>Check registry is running: <code>curl http://localhost:8000/health</code></li> <li>Check agent logs for errors</li> <li>Verify <code>MCP_MESH_REGISTRY_URL</code> is correct</li> </ol>"},{"location":"02-local-development/#dependency-not-injected","title":"Dependency Not Injected","text":"<pre><code># Quick check - see if all dependencies are resolved (e.g., \"4/4\")\nmeshctl list\n\n# Detailed view - shows capabilities, resolved dependencies, and endpoints\nmeshctl status\n</code></pre>"},{"location":"02-local-development/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Deployment - Package and deploy your agents</li> <li>Kubernetes Deployment - Scale to production</li> <li>Mesh Decorators Reference - All decorator options</li> </ul>"},{"location":"03-docker-deployment/","title":"Docker Deployment","text":"<p>Run MCP Mesh agents in containers with pre-built images and generated compose files</p>"},{"location":"03-docker-deployment/#overview","title":"Overview","text":"<p>MCP Mesh provides pre-built Docker images and a scaffold tool to generate Docker Compose files automatically. No need to write Dockerfiles from scratch.</p>"},{"location":"03-docker-deployment/#quick-start-30-seconds","title":"Quick Start (30 seconds)","text":"<pre><code># Generate a new agent with Dockerfile and compose file\nmeshctl scaffold --name my-agent --compose\n\n# Start everything (docker-compose.yml is in current directory)\ndocker-compose up\n</code></pre> <p>That's it! Your agent is running with the registry and observability stack.</p>"},{"location":"03-docker-deployment/#pre-built-images","title":"Pre-built Images","text":"<p>MCP Mesh publishes official images to Docker Hub:</p> Image Purpose <code>mcpmesh/registry:0.8</code> Go-based registry service <code>mcpmesh/python-runtime:0.8</code> Python agent runtime (includes mcp-mesh SDK) <code>mcpmesh/typescript-runtime:0.8</code> TypeScript agent runtime (includes @mcpmesh/sdk)"},{"location":"03-docker-deployment/#using-scaffold-to-generate-compose-files","title":"Using Scaffold to Generate Compose Files","text":"<p>The <code>meshctl scaffold</code> command generates everything you need:</p> <pre><code># Generate compose for existing agents directory\nmeshctl scaffold --compose -d ./agents\n\n# Include observability stack (Grafana, Tempo, Redis)\nmeshctl scaffold --compose --observability -d ./agents\n\n# Preview without creating files\nmeshctl scaffold --compose --dry-run -d ./agents\n</code></pre>"},{"location":"03-docker-deployment/#generated-docker-composeyml","title":"Generated docker-compose.yml","text":"PythonTypeScript <pre><code>version: \"3.8\"\n\nservices:\n  registry:\n    image: mcpmesh/registry:0.8\n    ports:\n      - \"8000:8000\"\n    healthcheck:\n      test: [\"CMD\", \"wget\", \"-q\", \"--spider\", \"http://localhost:8000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  my-agent:\n    image: mcpmesh/python-runtime:0.8\n    ports:\n      - \"8080:8080\"\n    volumes:\n      - ./my-agent:/app/agent:ro\n    command: [\"python\", \"/app/agent/main.py\"]\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n      - MCP_MESH_HTTP_PORT=8080\n    depends_on:\n      registry:\n        condition: service_healthy\n\nnetworks:\n  default:\n    name: mcp-mesh\n</code></pre> <pre><code>version: \"3.8\"\n\nservices:\n  registry:\n    image: mcpmesh/registry:0.8\n    ports:\n      - \"8000:8000\"\n    healthcheck:\n      test: [\"CMD\", \"wget\", \"-q\", \"--spider\", \"http://localhost:8000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  my-agent:\n    image: mcpmesh/typescript-runtime:0.8\n    ports:\n      - \"8080:8080\"\n    volumes:\n      - ./my-agent:/app/agent:ro\n    command: [\"npx\", \"tsx\", \"/app/agent/src/index.ts\"]\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n      - MCP_MESH_HTTP_PORT=8080\n    depends_on:\n      registry:\n        condition: service_healthy\n\nnetworks:\n  default:\n    name: mcp-mesh\n</code></pre>"},{"location":"03-docker-deployment/#manual-setup-without-scaffold","title":"Manual Setup (Without Scaffold)","text":"<p>If you prefer manual control, here's a minimal compose file:</p> PythonTypeScript <pre><code>version: \"3.8\"\n\nservices:\n  registry:\n    image: mcpmesh/registry:0.8\n    ports:\n      - \"8000:8000\"\n\n  my-agent:\n    image: mcpmesh/python-runtime:0.8\n    volumes:\n      - ./agent.py:/app/agent.py:ro\n    command: [\"python\", \"/app/agent.py\"]\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n\nnetworks:\n  default:\n    name: mcp-mesh\n</code></pre> <pre><code>version: \"3.8\"\n\nservices:\n  registry:\n    image: mcpmesh/registry:0.8\n    ports:\n      - \"8000:8000\"\n\n  my-agent:\n    image: mcpmesh/typescript-runtime:0.8\n    volumes:\n      - ./my-agent:/app/agent:ro\n    command: [\"npx\", \"tsx\", \"/app/agent/src/index.ts\"]\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n\nnetworks:\n  default:\n    name: mcp-mesh\n</code></pre>"},{"location":"03-docker-deployment/#building-custom-agent-images","title":"Building Custom Agent Images","text":"<p>The <code>meshctl scaffold</code> command automatically generates a <code>Dockerfile</code> for each agent. Use that for production builds.</p> <p>If you didn't use scaffold, here's a sample Dockerfile:</p> PythonTypeScript <pre><code>FROM mcpmesh/python-runtime:0.8\n\nCOPY ./my-agent /app/agent\n\n# Install additional dependencies if needed\nRUN pip install -r /app/agent/requirements.txt\n\nCMD [\"python\", \"/app/agent/main.py\"]\n</code></pre> <pre><code>FROM mcpmesh/typescript-runtime:0.8\n\nWORKDIR /app/agent\nCOPY ./my-agent/package*.json ./\nRUN npm install\n\nCOPY ./my-agent .\n\nCMD [\"npx\", \"tsx\", \"src/index.ts\"]\n</code></pre> <p>Build and run:</p> <pre><code>docker build -t my-company/my-agent:1.0 .\ndocker run -e MCP_MESH_REGISTRY_URL=http://registry:8000 my-company/my-agent:1.0\n</code></pre>"},{"location":"03-docker-deployment/#multi-agent-setup","title":"Multi-Agent Setup","text":"<p>Run multiple agents with a single compose file:</p> <pre><code>version: \"3.8\"\n\nservices:\n  registry:\n    image: mcpmesh/registry:0.8\n    ports:\n      - \"8000:8000\"\n\n  auth-agent:\n    image: mcpmesh/python-runtime:0.8\n    volumes:\n      - ./agents/auth:/app/agent:ro\n    command: [\"python\", \"/app/agent/main.py\"]\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n      - MCP_MESH_HTTP_PORT=8080\n\n  data-agent:\n    image: mcpmesh/python-runtime:0.8\n    volumes:\n      - ./agents/data:/app/agent:ro\n    command: [\"python\", \"/app/agent/main.py\"]\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n      - MCP_MESH_HTTP_PORT=8080\n\n  api-agent:\n    image: mcpmesh/python-runtime:0.8\n    volumes:\n      - ./agents/api:/app/agent:ro\n    command: [\"python\", \"/app/agent/main.py\"]\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n      - MCP_MESH_HTTP_PORT=8080\n\nnetworks:\n  default:\n    name: mcp-mesh\n</code></pre>"},{"location":"03-docker-deployment/#adding-observability","title":"Adding Observability","text":"<p>Use <code>--observability</code> flag to include Grafana, Tempo, and Redis:</p> <pre><code>meshctl scaffold --compose --observability -d ./agents\n</code></pre> <p>Or add manually:</p> <pre><code>services:\n  # ... your agents ...\n\n  redis:\n    image: redis:7-alpine\n    ports:\n      - \"6379:6379\"\n\n  tempo:\n    image: grafana/tempo:latest\n    ports:\n      - \"3200:3200\"\n      - \"4317:4317\"\n\n  grafana:\n    image: grafana/grafana:latest\n    ports:\n      - \"3000:3000\"\n    environment:\n      - GF_AUTH_ANONYMOUS_ENABLED=true\n</code></pre>"},{"location":"03-docker-deployment/#environment-variables","title":"Environment Variables","text":"<p>Key environment variables for containerized agents:</p> Variable Description Default <code>MCP_MESH_REGISTRY_URL</code> Registry endpoint <code>http://localhost:8000</code> <code>MCP_MESH_HTTP_PORT</code> Agent HTTP port <code>8080</code> <code>MCP_MESH_LOG_LEVEL</code> Logging level <code>INFO</code> <code>REDIS_URL</code> Redis for sessions (optional) <code>TEMPO_ENDPOINT</code> Tracing endpoint (optional)"},{"location":"03-docker-deployment/#best-practices","title":"Best Practices","text":"<ol> <li>Use pre-built images - Don't build from source unless necessary</li> <li>Generate with scaffold - Let <code>meshctl scaffold</code> handle the boilerplate</li> <li>Volume mount for development - Fast iteration without rebuilding</li> <li>Build custom images for production - Bake code into image</li> <li>Use health checks - Ensure proper startup order</li> </ol>"},{"location":"03-docker-deployment/#troubleshooting","title":"Troubleshooting","text":""},{"location":"03-docker-deployment/#agent-cant-connect-to-registry","title":"Agent can't connect to registry","text":"<pre><code># Check registry is healthy\ndocker-compose ps\ndocker-compose logs registry\n\n# Verify network\ndocker network ls\ndocker network inspect mcp-mesh\n</code></pre>"},{"location":"03-docker-deployment/#agent-exits-immediately","title":"Agent exits immediately","text":"<pre><code># Check logs\ndocker-compose logs my-agent\n\n# Run interactively\ndocker-compose run --rm my-agent /bin/bash\n</code></pre>"},{"location":"03-docker-deployment/#next-steps","title":"Next Steps","text":"<ul> <li>Networking Details - Deep dive into container networking</li> <li>Kubernetes Deployment - Production deployment with Helm</li> </ul>"},{"location":"04-kubernetes-basics/","title":"Kubernetes Deployment","text":"<p>Deploy MCP Mesh to Kubernetes using Helm charts</p>"},{"location":"04-kubernetes-basics/#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes cluster (minikube, EKS, GKE, AKS, etc.)</li> <li>Helm 3.8+ (for OCI registry support)</li> <li>kubectl configured</li> <li>meshctl installed</li> </ul>"},{"location":"04-kubernetes-basics/#quick-start","title":"Quick Start","text":""},{"location":"04-kubernetes-basics/#1-deploy-core-infrastructure","title":"1. Deploy Core Infrastructure","text":"<p>The <code>mcp-mesh-core</code> chart deploys registry + PostgreSQL + Redis + Grafana + Tempo:</p> <pre><code># Create namespace\nkubectl create namespace mcp-mesh\n\n# Deploy core (OCI registry - no \"helm repo add\" needed)\nhelm install mcp-core oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-core \\\n  --version 0.8.0-beta.6 \\\n  --namespace mcp-mesh\n\n# Wait for registry\nkubectl wait --for=condition=available deployment/mcp-core-mcp-mesh-registry \\\n  -n mcp-mesh --timeout=120s\n</code></pre>"},{"location":"04-kubernetes-basics/#2-build-your-agent-image","title":"2. Build Your Agent Image","text":"<p>Scaffold creates a Dockerfile and helm-values.yaml:</p> <pre><code># Create agent with deployment files\nmeshctl scaffold --name my-agent --agent-type tool\n\ncd my-agent\n# Edit main.py to implement your tool logic\n</code></pre> <p>Build the image:</p> Local (minikube)Cloud (push to registry) <pre><code># Use minikube's Docker daemon\neval $(minikube docker-env)\n\n# Build image\ndocker build -t my-agent:v1 .\n</code></pre> <pre><code># Build for amd64 (if on Mac ARM) and push\ndocker buildx build --platform linux/amd64 \\\n  -t your-registry/my-agent:v1 --push .\n</code></pre>"},{"location":"04-kubernetes-basics/#3-deploy-agent-with-helm","title":"3. Deploy Agent with Helm","text":"<pre><code>helm install my-agent oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-agent \\\n  --version 0.8.0-beta.6 \\\n  --namespace mcp-mesh \\\n  -f helm-values.yaml \\\n  --set image.repository=my-agent \\\n  --set image.tag=v1\n</code></pre> <p>For cloud deployments, use your full registry path:</p> <pre><code>helm install my-agent oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-agent \\\n  --version 0.8.0-beta.6 \\\n  --namespace mcp-mesh \\\n  -f helm-values.yaml \\\n  --set image.repository=your-registry/my-agent \\\n  --set image.tag=v1\n</code></pre>"},{"location":"04-kubernetes-basics/#4-verify","title":"4. Verify","text":"<pre><code># Check pods\nkubectl get pods -n mcp-mesh\n\n# Port forward and test with meshctl\nkubectl port-forward -n mcp-mesh svc/mcp-core-mcp-mesh-registry 8000:8000 &amp;\nmeshctl list\n</code></pre>"},{"location":"04-kubernetes-basics/#helm-charts","title":"Helm Charts","text":"<p>MCP Mesh charts are hosted on GitHub Container Registry as OCI artifacts:</p> Chart Description <code>oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-core</code> Registry + PostgreSQL + Redis + Grafana + Tempo <code>oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-agent</code> Deploy individual agents <code>oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-registry</code> Registry only (lightweight)"},{"location":"04-kubernetes-basics/#customizing-deployments","title":"Customizing Deployments","text":""},{"location":"04-kubernetes-basics/#using-helm-valuesyaml","title":"Using helm-values.yaml","text":"<p><code>meshctl scaffold</code> generates a <code>helm-values.yaml</code> ready for deployment:</p> <pre><code># my-agent/helm-values.yaml (auto-generated)\nimage:\n  repository: your-registry/my-agent\n  tag: latest\n\nagent:\n  name: my-agent\n  # port: 8080 is default, no need to specify\n\nmesh:\n  enabled: true\n  registryUrl: http://mcp-core-mcp-mesh-registry:8000\n\nresources:\n  limits:\n    cpu: 500m\n    memory: 512Mi\n  requests:\n    cpu: 100m\n    memory: 128Mi\n</code></pre>"},{"location":"04-kubernetes-basics/#disable-observability-components","title":"Disable Observability Components","text":"<pre><code># Core without Grafana/Tempo (lighter footprint)\nhelm install mcp-core oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-core \\\n  --version 0.8.0-beta.6 \\\n  --namespace mcp-mesh \\\n  --set grafana.enabled=false \\\n  --set tempo.enabled=false\n</code></pre>"},{"location":"04-kubernetes-basics/#registry-only-minimal","title":"Registry Only (Minimal)","text":"<pre><code># Just the registry, no database or observability\nhelm install mcp-registry oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-registry \\\n  --version 0.8.0-beta.6 \\\n  --namespace mcp-mesh\n</code></pre>"},{"location":"04-kubernetes-basics/#common-operations","title":"Common Operations","text":"<pre><code># List Helm releases\nhelm list -n mcp-mesh\n\n# Upgrade an agent\nhelm upgrade my-agent oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-agent \\\n  --version 0.8.0-beta.6 \\\n  --namespace mcp-mesh \\\n  --set image.tag=v2\n\n# Scale replicas\nhelm upgrade my-agent oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-agent \\\n  --version 0.8.0-beta.6 \\\n  --namespace mcp-mesh \\\n  --reuse-values \\\n  --set replicaCount=3\n\n# Uninstall\nhelm uninstall my-agent -n mcp-mesh\n\n# View agent logs\nkubectl logs -f deployment/my-agent-mcp-mesh-agent -n mcp-mesh\n</code></pre>"},{"location":"04-kubernetes-basics/#port-strategy","title":"Port Strategy","text":"<p>Port configuration differs between environments:</p> Environment Port Strategy Why Local / docker-compose Unique ports (9001, 9002...) Containers share host network Kubernetes All agents use 8080 Each pod has its own IP <p>The Helm chart sets <code>MCP_MESH_HTTP_PORT=8080</code> automatically. Your code doesn't need to change.</p>"},{"location":"04-kubernetes-basics/#troubleshooting","title":"Troubleshooting","text":""},{"location":"04-kubernetes-basics/#pods-not-starting","title":"Pods not starting","text":"<pre><code># Check pod status and events\nkubectl get pods -n mcp-mesh\nkubectl describe pod &lt;pod-name&gt; -n mcp-mesh\n\n# Check logs\nkubectl logs &lt;pod-name&gt; -n mcp-mesh\n</code></pre>"},{"location":"04-kubernetes-basics/#registry-connection-issues","title":"Registry connection issues","text":"<pre><code># Test registry health\nkubectl port-forward -n mcp-mesh svc/mcp-core-mcp-mesh-registry 8000:8000 &amp;\ncurl http://localhost:8000/health\n\n# Check DNS from agent pod\nkubectl exec -it &lt;agent-pod&gt; -n mcp-mesh -- nslookup mcp-core-mcp-mesh-registry\n</code></pre>"},{"location":"04-kubernetes-basics/#image-pull-errors-minikube","title":"Image pull errors (minikube)","text":"<pre><code># Ensure you're using minikube's Docker\neval $(minikube docker-env)\ndocker images | grep my-agent\n\n# Set imagePullPolicy if needed\nhelm upgrade my-agent ... --set image.pullPolicy=Never\n</code></pre>"},{"location":"04-kubernetes-basics/#next-steps","title":"Next Steps","text":"<ul> <li><code>meshctl man deployment</code> - Full deployment reference</li> <li><code>meshctl scaffold --help</code> - Agent scaffolding options</li> </ul>"},{"location":"07-observability/","title":"Observability","text":"<p>Built-in tracing, dashboards, and monitoring - ready to use</p>"},{"location":"07-observability/#overview","title":"Overview","text":"<p>MCP Mesh includes a complete observability stack:</p> <ul> <li>Redis - Trace event collection from agents</li> <li>Tempo - Distributed trace storage and querying</li> <li>Grafana - Pre-configured dashboards</li> </ul> <p>The data flows: Agents \u2192 Redis \u2192 Registry \u2192 Tempo \u2192 Grafana</p>"},{"location":"07-observability/#quick-start","title":"Quick Start","text":""},{"location":"07-observability/#with-helm-recommended","title":"With Helm (Recommended)","text":"<pre><code># Deploy core with observability enabled (default)\nhelm install mcp-core oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-core \\\n  --version 0.8.0-beta.6 \\\n  --namespace mcp-mesh \\\n  --set redis.enabled=true \\\n  --set tempo.enabled=true \\\n  --set grafana.enabled=true\n\n# Access Grafana\nkubectl port-forward svc/mcp-core-mcp-mesh-grafana 3000:3000 -n mcp-mesh\nopen http://localhost:3000  # admin/admin\n</code></pre>"},{"location":"07-observability/#with-docker-compose","title":"With Docker Compose","text":"<pre><code># Generate compose with observability\nmeshctl scaffold --compose --observability -d ./agents\n\n# Start\ndocker-compose up -d\n\n# Access Grafana\nopen http://localhost:3000\n</code></pre>"},{"location":"07-observability/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          Data Flow                                       \u2502\n\u2502                                                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    publish     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    consume    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 Agent A \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Redis  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 Registry \u2502     \u2502\n\u2502  \u2502 Agent B \u2502    events      \u2502 Stream  \u2502    events     \u2502          \u2502     \u2502\n\u2502  \u2502 Agent C \u2502                \u2502         \u2502               \u2502          \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                            \u2502            \u2502\n\u2502                                                   export   \u2502            \u2502\n\u2502                                                   traces   \u2502            \u2502\n\u2502                                                            \u25bc            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502 Grafana \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  Tempo   \u2502       \u2502\n\u2502  \u2502         \u2502              query traces              \u2502          \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"07-observability/#configuration","title":"Configuration","text":""},{"location":"07-observability/#environment-variables","title":"Environment Variables","text":"<p>Registry (trace consumer):</p> Variable Default Description <code>MCP_MESH_DISTRIBUTED_TRACING_ENABLED</code> <code>false</code> Enable tracing <code>REDIS_URL</code> <code>redis://localhost:6379</code> Redis for trace events <code>TELEMETRY_ENDPOINT</code> - Tempo OTLP endpoint <code>TRACE_EXPORTER_TYPE</code> <code>otlp</code> Export format: <code>otlp</code>, <code>console</code>, <code>json</code> <code>STREAM_NAME</code> <code>mesh:trace</code> Redis stream name <code>CONSUMER_GROUP</code> <code>mcp-mesh-registry-processors</code> Consumer group <p>Agents (trace publishers):</p> Variable Default Description <code>MCP_MESH_DISTRIBUTED_TRACING_ENABLED</code> <code>false</code> Enable trace publishing <code>REDIS_URL</code> <code>redis://localhost:6379</code> Redis for publishing events"},{"location":"07-observability/#enable-tracing","title":"Enable Tracing","text":"<pre><code># In mcp-mesh-core values\nmcp-mesh-registry:\n  registry:\n    observability:\n      distributedTracing:\n        enabled: true\n        redisUrl: \"redis://mcp-core-mcp-mesh-redis:6379\"\n        telemetryEndpoint: \"mcp-core-mcp-mesh-tempo:4317\"\n</code></pre>"},{"location":"07-observability/#troubleshooting","title":"Troubleshooting","text":""},{"location":"07-observability/#step-1-check-if-agents-are-publishing-to-redis","title":"Step 1: Check if Agents are Publishing to Redis","text":"<pre><code># Check Redis stream exists and has events\nredis-cli XLEN mesh:trace\n\n# View recent events\nredis-cli XREVRANGE mesh:trace + - COUNT 5\n\n# Expected output: Events with trace_id, span_id, agent_name\n</code></pre> <p>If empty:</p> <ul> <li>Check <code>MCP_MESH_DISTRIBUTED_TRACING_ENABLED=true</code> in agent env</li> <li>Check agent can reach Redis: <code>curl http://agent:8080/health</code></li> <li>Check agent logs for \"Tracing enabled\" message</li> </ul>"},{"location":"07-observability/#step-2-check-registry-connection-to-redis","title":"Step 2: Check Registry Connection to Redis","text":"<pre><code># Check registry can connect to Redis\nkubectl exec -it &lt;registry-pod&gt; -n mcp-mesh -- redis-cli -h mcp-core-mcp-mesh-redis ping\n\n# Check consumer group exists\nredis-cli XINFO GROUPS mesh:trace\n\n# Expected output: Consumer group \"mcp-mesh-registry-processors\" with consumers\n</code></pre> <p>If no consumer group:</p> <ul> <li>Check <code>MCP_MESH_DISTRIBUTED_TRACING_ENABLED=true</code> in registry env</li> <li>Check <code>REDIS_URL</code> points to correct Redis service</li> <li>Check registry logs for \"Starting trace consumer\" message</li> </ul>"},{"location":"07-observability/#step-3-check-registry-is-exporting-to-tempo","title":"Step 3: Check Registry is Exporting to Tempo","text":"<pre><code># Check trace status endpoint\nkubectl port-forward svc/mcp-core-mcp-mesh-registry 8000:8000 -n mcp-mesh\ncurl http://localhost:8000/trace/status | jq .\n\n# Expected output:\n# {\n#   \"enabled\": true,\n#   \"consumer\": { \"status\": \"running\" },\n#   \"correlator\": { \"active_traces\": N },\n#   \"exporter\": { \"type\": \"otlp\", \"exported_traces\": N }\n# }\n</code></pre> <p>If exporter not working:</p> <ul> <li>Check <code>TELEMETRY_ENDPOINT</code> points to Tempo (e.g., <code>tempo:4317</code>)</li> <li>Check Tempo is running: <code>kubectl get pods -l app.kubernetes.io/name=mcp-mesh-tempo</code></li> <li>Check registry logs for export errors</li> </ul>"},{"location":"07-observability/#step-4-check-grafana-can-query-tempo","title":"Step 4: Check Grafana Can Query Tempo","text":"<pre><code># Port-forward Tempo\nkubectl port-forward svc/mcp-core-mcp-mesh-tempo 3200:3200 -n mcp-mesh\n\n# Query traces directly from Tempo\ncurl \"http://localhost:3200/api/search?limit=5\" | jq .\n\n# Expected output: List of traces\n</code></pre> <p>If no traces in Tempo:</p> <ul> <li>Check Tempo is receiving data on port 4317 (OTLP gRPC)</li> <li>Check Tempo logs: <code>kubectl logs -l app.kubernetes.io/name=mcp-mesh-tempo -n mcp-mesh</code></li> </ul> <p>In Grafana:</p> <ol> <li>Go to Explore \u2192 Select \"Tempo\" datasource</li> <li>Search for traces</li> <li>If \"No data\", check datasource URL points to <code>http://mcp-core-mcp-mesh-tempo:3200</code></li> </ol>"},{"location":"07-observability/#common-issues","title":"Common Issues","text":""},{"location":"07-observability/#no-traces-appearing-anywhere","title":"No traces appearing anywhere","text":"<pre><code># Full diagnostic check\necho \"=== Redis Stream ===\"\nredis-cli XLEN mesh:trace\n\necho \"=== Consumer Groups ===\"\nredis-cli XINFO GROUPS mesh:trace\n\necho \"=== Registry Trace Status ===\"\ncurl -s http://localhost:8000/trace/status | jq .\n\necho \"=== Tempo Traces ===\"\ncurl -s \"http://localhost:3200/api/search?limit=1\" | jq .\n</code></pre>"},{"location":"07-observability/#traces-in-redis-but-not-in-tempo","title":"Traces in Redis but not in Tempo","text":"<p>Registry is not consuming or exporting properly:</p> <pre><code># Check registry logs\nkubectl logs -l app.kubernetes.io/name=mcp-mesh-registry -n mcp-mesh | grep -i trace\n\n# Check consumer lag (pending events)\nredis-cli XINFO GROUPS mesh:trace\n# Look for \"lag\" field - high lag means consumer is slow/stuck\n</code></pre>"},{"location":"07-observability/#traces-in-tempo-but-not-in-grafana","title":"Traces in Tempo but not in Grafana","text":"<p>Grafana datasource misconfigured:</p> <ol> <li>Go to Grafana \u2192 Configuration \u2192 Data Sources \u2192 Tempo</li> <li>Verify URL: <code>http://mcp-core-mcp-mesh-tempo:3200</code></li> <li>Click \"Save &amp; Test\"</li> </ol>"},{"location":"07-observability/#accessing-services","title":"Accessing Services","text":"<pre><code># Grafana (dashboards)\nkubectl port-forward svc/mcp-core-mcp-mesh-grafana 3000:3000 -n mcp-mesh\n# URL: http://localhost:3000 (admin/admin)\n\n# Tempo (trace API)\nkubectl port-forward svc/mcp-core-mcp-mesh-tempo 3200:3200 -n mcp-mesh\n# URL: http://localhost:3200/api/search\n\n# Registry (trace status)\nkubectl port-forward svc/mcp-core-mcp-mesh-registry 8000:8000 -n mcp-mesh\n# URL: http://localhost:8000/trace/status\n</code></pre>"},{"location":"07-observability/#disable-observability","title":"Disable Observability","text":"<p>For minimal deployments:</p> <pre><code># mcp-mesh-core values\nredis:\n  enabled: false\n\ntempo:\n  enabled: false\n\ngrafana:\n  enabled: false\n\nmcp-mesh-registry:\n  registry:\n    observability:\n      distributedTracing:\n        enabled: false\n</code></pre>"},{"location":"architecture-and-design/","title":"MCP Mesh Architecture and Design","text":"<p>Understanding the core architecture, design principles, and usage patterns of MCP Mesh</p>"},{"location":"architecture-and-design/#overview","title":"Overview","text":"<p>MCP Mesh is a distributed service orchestration framework built on top of the Model Context Protocol (MCP) that enables seamless dependency injection, service discovery, and inter-service communication. The architecture combines familiar FastMCP development patterns with powerful mesh orchestration capabilities.</p>"},{"location":"architecture-and-design/#glossary","title":"Glossary","text":"<p>Key terms used throughout MCP Mesh documentation:</p> Term Definition Agent A Python or TypeScript application that registers with the mesh and provides one or more tools. Each agent runs as an independent service. Tool A function decorated with <code>@app.tool()</code> and <code>@mesh.tool()</code> (Python) or registered with <code>agent.addTool()</code> (TypeScript) that can be discovered and called by other agents. Tools are the building blocks of MCP Mesh. Capability A unique identifier (string) that describes what a tool provides. Other tools declare dependencies on capabilities, not specific agents. Example: <code>\"redis_store_memory\"</code>, <code>\"analyze_emotion\"</code>. Dependency A capability that a tool requires. MCP Mesh automatically discovers and injects dependencies at runtime. Registry The central service that tracks all agents, their capabilities, and health status. Agents register on startup and send periodic heartbeats. Important: The registry is a facilitator, not a proxy\u2014it helps agents find each other, but actual tool calls go directly between agents. Heartbeat Periodic signal sent by agents to the registry to indicate they're alive. Default interval is 15 seconds. Proxy An injected object (<code>McpMeshTool</code>) that transparently handles communication with remote tools. You call it like a function; MCP Mesh handles the rest. Tag Metadata attached to tools for filtering during dependency resolution. Supports <code>+</code> (prefer) and <code>-</code> (avoid) operators. MCP (Model Context Protocol) The underlying protocol used for tool communication. MCP Mesh tools are standard MCP tools and can be invoked via HTTP using MCP's <code>tools/list</code> and <code>tools/call</code> endpoints."},{"location":"architecture-and-design/#about-fastmcp","title":"About FastMCP","text":"<p>MCP Mesh uses FastMCP under the hood to handle MCP protocol details. You don't need to learn FastMCP separately\u2014just use the <code>@app.tool()</code> decorator to define tools and MCP Mesh handles everything else.</p> <p>What FastMCP provides (handled automatically):</p> <ul> <li>MCP protocol serialization/deserialization</li> <li>HTTP server for tool endpoints</li> <li>Tool schema generation from Python type hints</li> </ul> <p>What MCP Mesh adds:</p> <ul> <li>Service discovery and registration</li> <li>Automatic dependency injection</li> <li>Health monitoring and heartbeats</li> <li>LLM integration (<code>@mesh.llm</code>)</li> <li>Multi-agent orchestration</li> </ul> <p>MCP Compatibility:</p> <p>MCP Mesh tools are standard MCP tools. They can be invoked using the meshctl CLI or any MCP client:</p> <pre><code># List registered agents\nmeshctl list\n\n# Call a tool (discovers agent via registry)\nmeshctl call my_tool '{\"param\":\"value\"}'\n\n# Call with explicit agent\nmeshctl call my-agent:my_tool '{\"param\":\"value\"}'\n</code></pre> Using curl directly (JSON-RPC) <pre><code># List available tools\ncurl -s -X POST http://localhost:8080/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tools/list\",\"params\":{}}'\n\n# Call a tool\ncurl -s -X POST http://localhost:8080/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tools/call\",\"params\":{\"name\":\"my_tool\",\"arguments\":{\"param\":\"value\"}}}'\n</code></pre>"},{"location":"architecture-and-design/#core-architecture","title":"Core Architecture","text":""},{"location":"architecture-and-design/#high-level-components","title":"High-Level Components","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        MCP Mesh Ecosystem                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502              \u2502           Redis                   \u2502              \u2502\n\u2502              \u2502      (Session Storage)            \u2502              \u2502\n\u2502              \u2502   session:* keys for stickiness   \u2502              \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502\n\u2502                            \u2502                                    \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502         \u2502                  \u2502                  \u2502                 \u2502\n\u2502         \u25bc                  \u25bc                  \u25bc                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502  \u2502   Agent A   \u2502  \u2502   Agent B   \u2502  \u2502   Agent C   \u2502              \u2502\n\u2502  \u2502             \u2502\u25c4\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25ba\u2502             \u2502              \u2502\n\u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502              \u2502\n\u2502  \u2502 \u2502FastMCP  \u2502\u25c4\u253c\u2500\u2500\u253c\u25ba\u2502FastMCP  \u2502\u25c4\u253c\u2500\u2500\u253c\u25ba\u2502FastMCP  \u2502 \u2502              \u2502\n\u2502  \u2502 \u2502Server   \u2502 \u2502  \u2502 \u2502Server   \u2502 \u2502  \u2502 \u2502Server   \u2502 \u2502              \u2502\n\u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502              \u2502\n\u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502              \u2502\n\u2502  \u2502 \u2502Mesh     \u2502 \u2502  \u2502 \u2502Mesh     \u2502 \u2502  \u2502 \u2502Mesh     \u2502 \u2502              \u2502\n\u2502  \u2502 \u2502Runtime  \u2502 \u2502  \u2502 \u2502Runtime  \u2502 \u2502  \u2502 \u2502Runtime  \u2502 \u2502              \u2502\n\u2502  \u2502 \u2502(Inject) \u2502 \u2502  \u2502 \u2502(Inject) \u2502 \u2502  \u2502 \u2502(Inject) \u2502 \u2502              \u2502\n\u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502              \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502\n\u2502         \u2502                \u2502                \u2502                     \u2502\n\u2502         \u2502 Heartbeat      \u2502 Heartbeat      \u2502 Heartbeat           \u2502\n\u2502         \u2502 + Discovery    \u2502 + Discovery    \u2502 + Discovery         \u2502\n\u2502         \u2502                \u2502                \u2502                     \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                     \u2502\n\u2502                          \u25bc                                      \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                \u2502\n\u2502                  \u2502   Registry  \u2502                                \u2502\n\u2502                  \u2502 (Background)\u2502                                \u2502\n\u2502                  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502                                \u2502\n\u2502                  \u2502 \u2502Service  \u2502 \u2502                                \u2502\n\u2502                  \u2502 \u2502Discovery\u2502 \u2502                                \u2502\n\u2502                  \u2502 \u2502         \u2502 \u2502                                \u2502\n\u2502                  \u2502 \u2502SQLite/  \u2502 \u2502                                \u2502\n\u2502                  \u2502 \u2502Postgres \u2502 \u2502                                \u2502\n\u2502                  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502                                \u2502\n\u2502                  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502                                \u2502\n\u2502                  \u2502 \u2502Health   \u2502 \u2502                                \u2502\n\u2502                  \u2502 \u2502Monitor  \u2502 \u2502                                \u2502\n\u2502                  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502                                \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                \u2502\n\u2502                                                                 \u2502\n\u2502  Direct MCP JSON-RPC calls between FastMCP servers              \u2502\n\u2502  \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba   \u2502\n\u2502  Registry for discovery, Redis for session stickiness           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture-and-design/#component-responsibilities","title":"Component Responsibilities","text":""},{"location":"architecture-and-design/#1-agents-python-typescript-runtime","title":"1. Agents (Python &amp; TypeScript Runtime)","text":"<ul> <li>FastMCP Integration: Native MCP protocol support for direct agent-to-agent communication</li> <li>Mesh Runtime: Background dependency injection and proxy creation</li> <li>Auto-Discovery: Automatic capability registration with registry</li> <li>Health Monitoring: Periodic heartbeats to registry (background process)</li> </ul>"},{"location":"architecture-and-design/#2-registry-go-service","title":"2. Registry (Go Service)","text":"<ul> <li>Service Discovery: Centralized capability and endpoint registry (background coordination)</li> <li>Health Tracking: Agent health monitoring and failure detection</li> <li>Dependency Resolution: Smart capability matching with tags at startup</li> <li>Load Balancing: Multiple providers for same capability selection</li> </ul>"},{"location":"architecture-and-design/#3-meshctl-cli-go-binary","title":"3. meshctl CLI (Go Binary)","text":"<ul> <li>Lifecycle Management: Start, stop, monitor agents</li> <li>Development Tools: File watching, auto-restart, debugging</li> <li>Registry Operations: Query services, check health, troubleshoot</li> </ul>"},{"location":"architecture-and-design/#4-redis-session-storage","title":"4. Redis (Session Storage)","text":"<ul> <li>Session Affinity: Maps session IDs to pod IPs for stateful operations</li> <li>Distributed State: Enables session stickiness across multiple pod replicas</li> <li>Graceful Fallback: Agents fall back to in-memory storage if Redis unavailable</li> <li>TTL Management: Automatic session cleanup and expiration</li> </ul>"},{"location":"architecture-and-design/#key-insight-background-orchestration","title":"Key Insight: Background Orchestration","text":"<p>MCP Mesh operates as background infrastructure:</p> <ul> <li>Discovery Phase: Registry helps agents find each other during startup</li> <li>Runtime Phase: Direct FastMCP-to-FastMCP communication (no proxy)</li> <li>Monitoring Phase: Continuous health checks and capability updates in background</li> </ul>"},{"location":"architecture-and-design/#mcp-mesh-agents-and-tools","title":"MCP Mesh Agents and Tools","text":"<p>MCP Mesh agents are simple Python or TypeScript applications that define one or more MCP tools. While tools communicate via the MCP protocol, all networking and communication complexity is abstracted away by MCP Mesh.</p>"},{"location":"architecture-and-design/#what-is-an-mcp-mesh-agent","title":"What is an MCP Mesh Agent?","text":"<p>An agent is a Python or TypeScript application that:</p> <ol> <li>Creates a FastMCP server</li> <li>Wraps it with mesh capabilities</li> <li>Defines tools with capabilities and dependencies</li> </ol> PythonTypeScript <pre><code>import mesh\nfrom fastmcp import FastMCP\n\napp = FastMCP(\"My Agent\")\n\n@app.tool()           # FastMCP decorator - defines MCP tool\n@mesh.tool(           # Mesh decorator - adds orchestration\n    capability=\"greeting\",\n    dependencies=[\"time_service\"]\n)\nasync def greet(name: str, time_service: mesh.McpMeshTool = None):\n    \"\"\"Greet someone with the current time.\"\"\"\n    current_time = await time_service() if time_service else \"unknown\"\n    return f\"Hello {name}! The time is {current_time}\"\n\n@mesh.agent(\n    name=\"greeting-agent\",\n    http_port=8080,\n    enable_http=True,\n    auto_run=True,\n)\nclass GreetingAgent:\n    pass\n</code></pre> <pre><code>import { FastMCP, mesh } from \"@mcpmesh/sdk\";\nimport { z } from \"zod\";\n\nconst server = new FastMCP({ name: \"My Agent\", version: \"1.0.0\" });\nconst agent = mesh(server, { name: \"greeting-agent\", port: 8080 });\n\nagent.addTool({\n  name: \"greet\",\n  capability: \"greeting\",\n  description: \"Greet someone with the current time\",\n  dependencies: [\"time_service\"],\n  parameters: z.object({ name: z.string() }),\n  execute: async ({ name }, { time_service }) =&gt; {\n    const currentTime = time_service ? await time_service() : \"unknown\";\n    return `Hello ${name}! The time is ${currentTime}`;\n  },\n});\n</code></pre> <p>That's all the code you need. MCP Mesh handles:</p> <ul> <li>Service discovery - Finding other agents in the network</li> <li>Dependency injection - Automatically wiring dependencies</li> <li>Health monitoring - Heartbeats and failure detection</li> <li>HTTP exposure - Tools callable via REST API</li> </ul>"},{"location":"architecture-and-design/#types-of-tools","title":"Types of Tools","text":"<p>MCP Mesh supports four types of tools, each with its own decorator:</p> Decorator Purpose Use Case <code>@mesh.tool</code> Standard MCP tool with dependency injection Data processing, storage, utilities <code>@mesh.llm</code> LLM-powered tool with agentic capabilities AI analysis, content generation, reasoning <code>@mesh.llm_provider</code> Zero-code LLM vendor integration Claude, GPT-4, Gemini providers <code>@mesh.route</code> FastAPI route with tool injection REST APIs, webhooks, external interfaces"},{"location":"architecture-and-design/#1-standard-tools-meshtool","title":"1. Standard Tools (<code>@mesh.tool</code>)","text":"<p>Standard tools are the building blocks of MCP Mesh. They expose capabilities that other agents can discover and call.</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"redis_store_memory\",\n    description=\"Store a memory in Redis\",\n    version=\"1.0.0\",\n    tags=[\"redis\", \"storage\", \"write\"],\n)\nasync def store_memory(\n    user_email: str,\n    content: str,\n    importance: int,\n) -&gt; dict:\n    \"\"\"Store a new memory in Redis.\"\"\"\n    key = f\"memory:{user_email}:{timestamp}\"\n    await redis_client.set(key, json.dumps({\n        \"content\": content,\n        \"importance\": importance,\n    }))\n    return {\"status\": \"success\", \"key\": key}\n</code></pre> <p>Key concepts:</p> <ul> <li>Capability: A unique identifier that other tools use to declare dependencies</li> <li>Tags: Metadata for filtering during dependency resolution</li> <li>Version: Semantic versioning for compatibility matching</li> <li>Dependencies: List of capabilities this tool requires</li> </ul>"},{"location":"architecture-and-design/#dependency-injection","title":"Dependency Injection","text":"<p>When a tool declares dependencies, MCP Mesh automatically resolves and injects them:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"update_emotion\",\n    dependencies=[\"analyze_emotion\"],  # Depends on another capability\n)\nasync def update_emotion(\n    user_email: str,\n    avatar_id: str,\n    analyze: mesh.McpMeshTool = None,  # Injected automatically\n) -&gt; dict:\n    \"\"\"Update emotion state using LLM analysis.\"\"\"\n\n    # Call the injected dependency like a function\n    result = await analyze(\n        user_email=user_email,\n        avatar_id=avatar_id,\n    )\n\n    # Use the result\n    return {\"emotion\": result.emotion, \"intensity\": result.intensity}\n</code></pre> <p>How it works:</p> <ol> <li>Agent starts and registers its capabilities with the registry</li> <li>MCP Mesh discovers agents that provide required dependencies</li> <li>Proxy objects (<code>mesh.McpMeshTool</code>) are injected at runtime</li> <li>Calling the proxy transparently invokes the remote tool via MCP</li> <li>You don't manage URLs, connections, retries, or failures</li> </ol>"},{"location":"architecture-and-design/#advanced-tag-matching","title":"Advanced Tag Matching","text":"<p>Tags support prefix operators for fine-grained control:</p> <pre><code>@mesh.tool(\n    capability=\"analyze\",\n    dependencies=[\n        \"storage\",              # Must have \"storage\" tag\n        {\"capability\": \"llm\", \"tags\": [\"+claude\", \"-gpt\"]},  # Prefer Claude, avoid GPT\n    ]\n)\n</code></pre> Operator Meaning Example (none) Must have tag <code>\"storage\"</code> <code>+</code> Prefer if available <code>\"+claude\"</code> <code>-</code> Avoid if possible <code>\"-expensive\"</code>"},{"location":"architecture-and-design/#2-llm-tools-meshllm","title":"2. LLM Tools (<code>@mesh.llm</code>)","text":"<p>LLM tools add intelligence to any MCP tool. They can:</p> <ul> <li>Execute agentic loops with tool calling</li> <li>Use dynamic system prompts (Jinja2 templates)</li> <li>Filter available tools for the LLM</li> <li>Return structured JSON or plain text</li> </ul> <pre><code>from pydantic import BaseModel, Field\n\nclass EmotionAnalysis(BaseModel):\n    \"\"\"Structured response from emotion analysis.\"\"\"\n    emotion: str = Field(..., description=\"Primary emotion\")\n    intensity: float = Field(..., ge=0.0, le=1.0)\n    reasoning: str = Field(..., description=\"Brief explanation\")\n\n@app.tool()\n@mesh.llm(\n    provider={\"capability\": \"llm\", \"tags\": [\"llm\", \"+gpt\"]},  # Prefer GPT for speed\n    max_iterations=1,                                          # Single LLM call\n    system_prompt=\"file://prompts/emotion_analysis.jinja2\",   # Dynamic prompt\n    context_param=\"emotion_ctx\",                               # Context injection\n    response_format=\"json\",                                    # Structured output\n)\n@mesh.tool(\n    capability=\"analyze_emotion\",\n    tags=[\"emotion\", \"analysis\", \"llm\"],\n)\nasync def analyze_emotion(\n    emotion_ctx: EmotionContext,\n    llm: mesh.MeshLlmAgent = None,\n) -&gt; EmotionAnalysis:\n    \"\"\"Analyze avatar's emotional state from conversation.\"\"\"\n    return await llm(\"Analyze the avatar's emotional state\")\n</code></pre>"},{"location":"architecture-and-design/#llm-decorator-options","title":"LLM Decorator Options","text":"Option Description Example <code>provider</code> Which LLM to use (capability + tags) <code>{\"capability\": \"llm\", \"tags\": [\"+claude\"]}</code> <code>max_iterations</code> Max tool-calling loops <code>10</code> for agentic, <code>1</code> for single call <code>system_prompt</code> Static string or Jinja2 file <code>\"file://prompts/system.jinja2\"</code> <code>context_param</code> Parameter name for template context <code>\"emotion_ctx\"</code> <code>response_format</code> Output format <code>\"json\"</code>, <code>\"text\"</code> <code>filter</code> Filter available tools for LLM <code>{\"tags\": [\"memory-agent\"]}</code> <code>filter_mode</code> How to apply filter <code>\"all\"</code>, <code>\"any\"</code>"},{"location":"architecture-and-design/#agentic-tool-calling","title":"Agentic Tool Calling","text":"<p>LLM tools can call other tools in a loop:</p> <pre><code>@app.tool()\n@mesh.llm(\n    filter={\"tags\": [\"memory-agent\", \"recall\"]},  # Only memory tools available\n    filter_mode=\"all\",\n    provider={\"capability\": \"llm\", \"tags\": [\"+claude\"]},\n    max_iterations=10,  # Allow up to 10 tool calls\n    system_prompt=\"file://prompts/avatar.jinja2\",\n    context_param=\"avatar_ctx\",\n    response_format=\"text\",\n)\n@mesh.tool(\n    capability=\"generic_avatar_respond\",\n    tags=[\"avatar\", \"companion\"],\n)\nasync def generic_respond(\n    avatar_ctx: AvatarContext,\n    llm: mesh.MeshLlmAgent = None,\n) -&gt; str:\n    \"\"\"Generate avatar response with memory recall capability.\"\"\"\n    # LLM can call memory_recall tool during its reasoning\n    return await llm(avatar_ctx.conversation_history)\n</code></pre> <p>The LLM sees filtered tools and can call them autonomously. MCP Mesh handles the tool execution loop.</p>"},{"location":"architecture-and-design/#3-llm-providers-meshllm_provider","title":"3. LLM Providers (<code>@mesh.llm_provider</code>)","text":"<p>LLM providers make any AI vendor available to the mesh with zero code:</p> <pre><code>@mesh.llm_provider(\n    model=\"anthropic/claude-sonnet-4-5\",\n    capability=\"llm\",\n    tags=[\"llm\", \"claude\", \"anthropic\", \"sonnet\", \"provider\"],\n    version=\"1.0.0\",\n)\ndef claude_provider():\n    \"\"\"Claude provider - automatically creates process_chat endpoint.\"\"\"\n    pass  # Implementation is in the decorator\n\n@mesh.agent(\n    name=\"claude-provider\",\n    http_port=9110,\n    enable_http=True,\n    auto_run=True,\n    health_check=claude_health_check,\n)\nclass ClaudeProviderAgent:\n    pass\n</code></pre> <p>What it provides:</p> <ul> <li>Automatic <code>process_chat(request: MeshLlmRequest)</code> tool</li> <li>LiteLLM integration for unified API</li> <li>Error handling and retries</li> <li>Mesh registration with capability and tags</li> </ul>"},{"location":"architecture-and-design/#multiple-providers","title":"Multiple Providers","text":"<p>Deploy multiple providers and let tools choose at runtime:</p> <pre><code># claude_provider.py\n@mesh.llm_provider(\n    model=\"anthropic/claude-sonnet-4-5\",\n    tags=[\"llm\", \"claude\", \"anthropic\", \"expensive\", \"smart\"],\n)\ndef claude_provider():\n    pass\n\n# openai_provider.py\n@mesh.llm_provider(\n    model=\"openai/gpt-4o\",\n    tags=[\"llm\", \"openai\", \"gpt\", \"fast\", \"cheap\"],\n)\ndef openai_provider():\n    pass\n</code></pre> <p>Tools select providers using tag matching:</p> <pre><code>@mesh.llm(\n    # Use Claude for complex reasoning\n    provider={\"capability\": \"llm\", \"tags\": [\"+claude\", \"+smart\"]},\n)\nasync def complex_analysis(...): ...\n\n@mesh.llm(\n    # Use GPT for fast, simple tasks\n    provider={\"capability\": \"llm\", \"tags\": [\"+gpt\", \"+fast\"]},\n)\nasync def quick_extraction(...): ...\n</code></pre>"},{"location":"architecture-and-design/#4-fastapi-routes-meshroute","title":"4. FastAPI Routes (<code>@mesh.route</code>)","text":"<p>The <code>@mesh.route</code> decorator lets FastAPI endpoints call MCP tools as regular Python functions:</p> <pre><code>from fastapi import APIRouter, Request\nfrom mesh.types import McpMeshTool\n\nrouter = APIRouter(prefix=\"/chat\", tags=[\"chat\"])\n\n@router.post(\"/completions\")\n@mesh.route(dependencies=[\"avatar_chat\"])\nasync def chat_completions(\n    request: Request,\n    chat_request: ChatCompletionRequest,\n    avatar_id: str = \"maya-creative\",\n    avatar_agent: McpMeshTool = None,  # Injected by @mesh.route\n):\n    \"\"\"OpenAI-compatible chat endpoint.\"\"\"\n\n    # Extract user from JWT\n    user_info = require_user_from_request(request)\n\n    # Call MCP tool like a regular function\n    result = await avatar_agent(\n        user_email=user_info[\"email\"],\n        message=chat_request.messages[-1].content,\n        avatar_id=avatar_id,\n    )\n\n    return ChatCompletionResponse(\n        choices=[{\"message\": {\"content\": result[\"message\"]}}]\n    )\n</code></pre> <p>Benefits:</p> <ul> <li>No network code: MCP Mesh handles connections</li> <li>Type safety: Pydantic models work transparently</li> <li>Dependency injection: Tools injected like FastAPI dependencies</li> <li>Decoupled architecture: Routes don't know where tools run</li> </ul>"},{"location":"architecture-and-design/#putting-it-all-together","title":"Putting It All Together","text":"<p>Here's how these components work together in a real system (Maya):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     FastAPI Backend                               \u2502\n\u2502  @mesh.route(dependencies=[\"avatar_chat\"])                       \u2502\n\u2502  POST /chat/completions \u2192 avatar_agent()                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                   \u2502\n                                   \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Orchestrator Agent                             \u2502\n\u2502  @mesh.tool(capability=\"avatar_chat\",                            \u2502\n\u2502             dependencies=[\"generic_avatar_respond\",              \u2502\n\u2502                          \"memory_recall\", \"update_emotion\"])     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502                       \u2502\n           \u25bc                       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Avatar Agent      \u2502  \u2502          Memory LLM Agent               \u2502\n\u2502  @mesh.llm(         \u2502  \u2502  @mesh.llm(provider={\"+gpt\"})           \u2502\n\u2502    provider={\"+claude\"}\u2502  \u2502  @mesh.tool(capability=\"memory_recall\")\u2502\n\u2502  )                  \u2502  \u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                                \u2502\n          \u25bc                                \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Claude Provider   \u2502           \u2502   OpenAI Provider   \u2502\n\u2502  @mesh.llm_provider \u2502           \u2502  @mesh.llm_provider \u2502\n\u2502  model=\"claude...\"  \u2502           \u2502  model=\"gpt-4o\"     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Data flow:</p> <ol> <li>HTTP request hits FastAPI route</li> <li><code>@mesh.route</code> injects <code>avatar_agent</code> (Orchestrator)</li> <li>Orchestrator calls Avatar Agent with injected dependencies</li> <li>Avatar Agent uses Claude via <code>@mesh.llm</code></li> <li>Memory LLM uses GPT for fast extraction</li> <li>Response flows back through the chain</li> </ol> <p>All of this happens with:</p> <ul> <li>Zero network code in your tools</li> <li>Automatic service discovery</li> <li>Runtime dependency injection</li> <li>Transparent LLM provider selection</li> </ul>"},{"location":"architecture-and-design/#design-principles","title":"Design Principles","text":""},{"location":"architecture-and-design/#1-true-resilient-architecture","title":"1. True Resilient Architecture","text":"<p>MCP Mesh implements a fundamentally resilient architecture where agents operate independently and enhance each other when available:</p> <p>Core Resilience Principles:</p> <ul> <li>Standalone Operation: Agents function as vanilla FastMCP servers without any dependencies</li> <li>Registry as Facilitator: Registry enables discovery and wiring, but agents don't depend on it</li> <li>Dynamic Enhancement: Agents get enhanced capabilities when other agents are available</li> <li>Graceful Degradation: Loss of registry or other agents doesn't break existing functionality</li> <li>Self-Healing: Agents automatically reconnect and refresh when components return</li> </ul> <p>Architecture Flow:</p> <pre><code>Agent Startup \u2192 Works Standalone (FastMCP mode)\n       \u2193\nRegistry Available \u2192 Agents Get Wired \u2192 Enhanced Capabilities\n       \u2193\nRegistry Down \u2192 Agents Continue Working \u2192 Direct MCP Communication Preserved\n       \u2193\nRegistry Returns \u2192 Agents Refresh \u2192 Topology Updates Resume\n</code></pre>"},{"location":"architecture-and-design/#2-dual-decorator-pattern","title":"2. Dual Decorator Pattern","text":"<p>MCP Mesh uses a dual decorator approach that preserves FastMCP familiarity while adding mesh orchestration:</p> <pre><code>@app.tool()      # \u2190 FastMCP: MCP protocol handling\n@mesh.tool(      # \u2190 Mesh: Dependency injection + orchestration\n    capability=\"weather_data\",\n    dependencies=[\"time_service\"]\n)\ndef get_weather(time_service: Any = None) -&gt; dict:\n    # Business logic here\n</code></pre> <p>Benefits:</p> <ul> <li>Familiar Development: Developers keep using FastMCP patterns</li> <li>Enhanced Capabilities: Mesh adds dependency injection seamlessly</li> <li>Zero Boilerplate: No manual server management or configuration</li> <li>Gradual Adoption: Can add mesh features incrementally</li> </ul>"},{"location":"architecture-and-design/#3-unified-proxy-system","title":"3. Unified Proxy System","text":"<p>MCP Mesh uses a unified proxy (<code>EnhancedUnifiedMCPProxy</code>) that auto-configures from decorator kwargs:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"enhanced_service\",\n    timeout=60,                    # Auto-configures proxy timeout\n    retry_count=3,                 # Auto-configures retry policy\n    session_required=True,         # Enables session management\n    auth_required=True             # Auto-enables authentication\n)\ndef enhanced_tool():\n    pass\n</code></pre> <p>Proxy Classes:</p> <ul> <li>UnifiedMCPProxy: Base class using FastMCP client with all MCP protocol features</li> <li>EnhancedUnifiedMCPProxy: Enhanced version with retry logic (used for all dependencies)</li> <li>SelfDependencyProxy: Optimized proxy for local/same-agent calls (no network overhead)</li> </ul> <p>Features (all in one proxy):</p> <ul> <li>Configurable timeout and retry with exponential backoff</li> <li>Session management for stateful operations</li> <li>Custom headers and authentication</li> <li>Distributed tracing integration</li> <li>HTTP fallback when FastMCP client unavailable</li> </ul> <p>Implementation: See <code>src/runtime/python/_mcp_mesh/engine/unified_mcp_proxy.py</code></p>"},{"location":"architecture-and-design/#4-session-management-and-stickiness","title":"4. Session Management and Stickiness","text":"<p>For stateful operations, MCP Mesh provides automatic session affinity:</p> <pre><code>@mesh.tool(\n    capability=\"stateful_counter\",\n    session_required=True,         # Enables session stickiness\n    stateful=True,                 # Marks as stateful operation\n    auto_session_management=True   # Automatic session lifecycle\n)\ndef increment_counter(session_id: str, increment: int = 1):\n    # Automatically routed to same pod for this session\n</code></pre> <p>Session Features:</p> <ul> <li>Redis-Backed Storage: Distributed session affinity across pods</li> <li>Automatic Routing: Requests with same session_id go to same pod</li> <li>Graceful Fallback: In-memory storage when Redis unavailable</li> <li>TTL Management: Automatic session cleanup</li> </ul> <p>Implementation: See <code>src/runtime/python/_mcp_mesh/engine/http_wrapper.py</code></p>"},{"location":"architecture-and-design/#5-fast-heartbeat-architecture","title":"5. Fast Heartbeat Architecture","text":"<p>Optimized health monitoring with dual-heartbeat system:</p> <pre><code>HEAD /heartbeat    # Lightweight timestamp update (5s intervals)\nPOST /heartbeat    # Full registration when triggered by HEAD response\n</code></pre> <p>Benefits:</p> <ul> <li>Fast Failure Detection: Sub-20s failure detection</li> <li>Network Efficiency: Minimal bandwidth usage</li> <li>On-Demand Registration: Full updates only when needed</li> </ul> <p>Implementation: See <code>cmd/registry/</code> for heartbeat handling</p>"},{"location":"architecture-and-design/#implementation-architecture","title":"Implementation Architecture","text":""},{"location":"architecture-and-design/#two-pipeline-design","title":"Two-Pipeline Design","text":"<p>MCP Mesh uses a sophisticated two-pipeline architecture that separates initialization from runtime operations:</p>"},{"location":"architecture-and-design/#startup-pipeline-one-time-execution","title":"Startup Pipeline (One-time Execution)","text":"<pre><code>DecoratorCollectionStep \u2192 ConfigurationStep \u2192 HeartbeatPreparationStep \u2192\nFastMCPServerDiscoveryStep \u2192 HeartbeatLoopStep \u2192 FastAPIServerSetupStep\n</code></pre> <p>Purpose: Initialize agent, collect decorators, prepare for mesh integration Trigger: Agent startup, decorator debounce completion Outcome: Agent ready with capabilities registered and dependency injection configured</p> <p>Implementation: See <code>src/runtime/python/_mcp_mesh/pipeline/startup/</code></p>"},{"location":"architecture-and-design/#heartbeat-pipeline-continuous-loop","title":"Heartbeat Pipeline (Continuous Loop)","text":"<pre><code>RegistryConnectionStep \u2192 HeartbeatSendStep \u2192 DependencyResolutionStep\n</code></pre> <p>Purpose: Maintain mesh connectivity, update dependency topology Trigger: Periodic execution (30s intervals) Outcome: Updated dependency proxies, health status maintained</p> <p>Implementation: See <code>src/runtime/python/_mcp_mesh/pipeline/heartbeat/</code></p>"},{"location":"architecture-and-design/#decorator-processing-and-debounce-coordination","title":"Decorator Processing and Debounce Coordination","text":"<p>Challenge: Decorators are processed as Python imports the module, but we need to wait for all decorators before starting mesh processing.</p> <p>Solution: Debounce coordinator with configurable delay</p> <pre><code>@mesh.tool()  # Triggers debounce timer\ndef tool1(): pass\n\n@mesh.tool()  # Resets debounce timer\ndef tool2(): pass\n\n# After MCP_MESH_DEBOUNCE_DELAY (default 1.0s) with no new decorators:\n# \u2192 Startup pipeline begins\n</code></pre> <p>Design Benefits:</p> <ul> <li>Handles dynamic decorator registration during import</li> <li>Prevents race conditions in multi-decorator modules</li> <li>Configurable timing via <code>MCP_MESH_DEBOUNCE_DELAY</code></li> </ul> <p>Implementation: See <code>src/runtime/python/_mcp_mesh/engine/debounce_coordinator.py</code></p>"},{"location":"architecture-and-design/#dependency-resolution-and-proxy-architecture","title":"Dependency Resolution and Proxy Architecture","text":""},{"location":"architecture-and-design/#function-caching-strategy","title":"Function Caching Strategy","text":"<p>Key Insight: Mesh decorators must process BEFORE FastMCP decorators to cache original functions. Since Python processes decorators bottom-up, <code>@mesh.tool()</code> goes below <code>@app.tool()</code>:</p> <pre><code>@app.tool()   # \u2190 FastMCP processes wrapped function (outer, applied second)\n@mesh.tool()  # \u2190 Processes first, caches original function (inner, applied first)\ndef hello(): pass\n</code></pre> <p>Implementation:</p> <ol> <li>Mesh decorator caches <code>func._mesh_original_func = func</code></li> <li>Creates dependency injection wrapper</li> <li>FastMCP receives wrapper (not original)</li> <li>Runtime calls cached original with injected dependencies</li> </ol>"},{"location":"architecture-and-design/#proxy-selection-logic","title":"Proxy Selection Logic","text":"<p>Registry-Driven: Heartbeat response determines proxy type based on dependency location.</p> <pre><code>if current_agent_id == target_agent_id:\n    # Same agent - direct local call (no network overhead)\n    proxy = SelfDependencyProxy(original_func, function_name)\nelse:\n    # Different agent - unified MCP proxy with auto-configuration\n    proxy = EnhancedUnifiedMCPProxy(endpoint, function_name, kwargs_config)\n</code></pre> <p>The unified proxy automatically configures itself from <code>kwargs_config</code> passed from the <code>@mesh.tool()</code> decorator (timeout, retry, session, auth, etc.).</p> <p>Implementation: See <code>src/runtime/python/_mcp_mesh/pipeline/mcp_heartbeat/rust_heartbeat.py</code></p>"},{"location":"architecture-and-design/#hash-based-change-detection","title":"Hash-Based Change Detection","text":"<p>Performance Optimization: Only update dependency injection when topology actually changes.</p> <pre><code>def _hash_dependency_state(dependency_state):\n    state_str = json.dumps(dependency_state, sort_keys=True)\n    return hashlib.sha256(state_str.encode()).hexdigest()\n\n# In heartbeat pipeline:\ncurrent_hash = _hash_dependency_state(response.dependencies)\nif current_hash == _last_dependency_hash:\n    return  # Skip expensive dependency injection update\n</code></pre> <p>Benefits:</p> <ul> <li>Eliminates unnecessary proxy recreation</li> <li>Reduces CPU overhead in stable topologies</li> <li>Enables high-frequency heartbeats without performance penalty</li> </ul>"},{"location":"architecture-and-design/#registry-as-facilitator-pattern","title":"Registry as Facilitator Pattern","text":"<p>Design Philosophy: Registry coordinates but never controls agent execution.</p> <p>Registry Responsibilities:</p> <ul> <li>Accept agent registrations via heartbeat</li> <li>Store capability metadata (SQLite for local dev, PostgreSQL for production)</li> <li>Resolve dependencies and return topology</li> <li>Monitor health and mark unhealthy agents</li> <li>Generate audit events</li> </ul> <p>What Registry NEVER Does:</p> <ul> <li>Make calls to agents (only agents call registry)</li> <li>Control agent lifecycle</li> <li>Proxy or intercept agent-to-agent communication</li> <li>Store business logic or state</li> </ul> <p>Agent Autonomy: Agents poll registry for updates but operate independently. Registry failure doesn't break existing agent-to-agent connections.</p> <p>Implementation: See <code>cmd/registry/</code> for Go registry service</p>"},{"location":"architecture-and-design/#usage-patterns","title":"Usage Patterns","text":""},{"location":"architecture-and-design/#basic-agent-development","title":"Basic Agent Development","text":"<p>1. Simple Tool Creation:</p> <pre><code>from fastmcp import FastMCP\nimport mesh\n\napp = FastMCP(\"My Service\")\n\n@app.tool()\n@mesh.tool(capability=\"greeting\")\ndef say_hello(name: str) -&gt; str:\n    return f\"Hello, {name}!\"\n\n@mesh.agent(name=\"greeting-service\")\nclass GreetingAgent:\n    pass\n</code></pre> <p>2. With Dependencies:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"time_greeting\",\n    dependencies=[\"time_service\"]\n)\ndef time_greeting(name: str, time_service=None) -&gt; str:\n    current_time = time_service() if time_service else \"unknown time\"\n    return f\"Hello, {name}! Current time: {current_time}\"\n</code></pre>"},{"location":"architecture-and-design/#enhanced-configuration","title":"Enhanced Configuration","text":"<p>3. Production-Ready Tool:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"secure_data_processor\",\n    timeout=120,                           # 2 min timeout\n    retry_count=3,                         # Retry on failure\n    auth_required=True,                    # Require authentication\n    custom_headers={\"X-Service\": \"data\"},  # Custom headers\n    streaming=True                         # Enable streaming\n)\nasync def process_large_dataset(data_url: str):\n    # Auto-configured with enhanced proxy features\n</code></pre> <p>4. Stateful Operations:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"user_session\",\n    session_required=True,        # Enable session stickiness\n    stateful=True,               # Mark as stateful\n    timeout=30\n)\ndef update_user_state(session_id: str, updates: dict):\n    # Automatically routed to same pod for session consistency\n</code></pre>"},{"location":"architecture-and-design/#deployment-patterns","title":"Deployment Patterns","text":"<p>Local Development:</p> <pre><code># Terminal 1: Start registry\nmeshctl registry start\n\n# Terminal 2: Start your agent\npython my_agent.py\n</code></pre> <p>Docker Compose:</p> <pre><code>version: \"3.8\"\nservices:\n  registry:\n    image: mcpmesh/registry:latest\n    ports: [\"8000:8000\"]\n\n  my-service:\n    build: .\n    environment:\n      MCP_MESH_REGISTRY_URL: http://registry:8000\n    depends_on: [registry]\n</code></pre> <p>Kubernetes:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: my-service\nspec:\n  replicas: 3\n  template:\n    spec:\n      containers:\n        - name: agent\n          image: my-service:latest\n          env:\n            - name: MCP_MESH_REGISTRY_URL\n              value: \"http://mcp-registry:8000\"\n            - name: REDIS_URL\n              value: \"redis://redis:6379\" # For session storage\n</code></pre>"},{"location":"architecture-and-design/#performance-characteristics","title":"Performance Characteristics","text":""},{"location":"architecture-and-design/#scalability-metrics","title":"Scalability Metrics","text":"<ul> <li>Registry: 1000+ agents, 10,000+ capabilities, 100+ heartbeats/sec</li> <li>Agent: 1000+ tool calls/sec, &lt;2s startup time</li> <li>Discovery: &lt;10ms lookup time, &lt;1s update propagation</li> </ul>"},{"location":"architecture-and-design/#network-overhead","title":"Network Overhead","text":"<ul> <li>HEAD Heartbeat: ~200B per agent every 5 seconds</li> <li>POST Heartbeat: ~2KB per agent when topology changes</li> <li>Tool Calls: Standard MCP JSON-RPC (varies by payload)</li> </ul>"},{"location":"architecture-and-design/#security-model","title":"Security Model","text":""},{"location":"architecture-and-design/#current-architecture","title":"Current Architecture","text":"<ul> <li>Trusted Network Model: Assumes secure network environment</li> <li>Service-to-Service: Direct HTTP communication between agents</li> <li>No Built-in Auth: Authentication via proxy configuration</li> </ul>"},{"location":"architecture-and-design/#production-recommendations","title":"Production Recommendations","text":"<ol> <li>Network Segmentation: Use private networks or VPNs</li> <li>Service Mesh: Deploy with Istio/Linkerd for mTLS</li> <li>API Gateway: Use gateway for external access control</li> <li>Enhanced Proxies: Use <code>auth_required=True</code> with bearer tokens</li> </ol>"},{"location":"architecture-and-design/#extension-points","title":"Extension Points","text":""},{"location":"architecture-and-design/#custom-dependency-resolvers","title":"Custom Dependency Resolvers","text":"<pre><code>class CustomDependencyResolver(DependencyResolver):\n    async def resolve_capability(self, capability_spec):\n        # Custom logic for finding capabilities\n        candidates = await super().find_candidates(capability_spec)\n        return self.apply_custom_selection(candidates)\n</code></pre>"},{"location":"architecture-and-design/#custom-health-checks","title":"Custom Health Checks","text":"<pre><code>@mesh.tool(health_check=custom_health_check)\ndef database_tool():\n    pass\n\nasync def custom_health_check():\n    return {\"status\": \"healthy\", \"connections\": db.pool.size}\n</code></pre> <p>See <code>src/runtime/python/_mcp_mesh/</code> for extension interfaces</p> <p>This architecture enables MCP Mesh to provide a seamless, scalable, and developer-friendly service orchestration platform that preserves the simplicity of FastMCP while adding powerful distributed system capabilities.</p> <p>For Implementation Details: See source code in <code>src/runtime/python/</code> (Python), <code>src/runtime/typescript/</code> (TypeScript), and <code>cmd/registry/</code> (Go) For Examples: See <code>examples/</code> directory for complete working examples For Configuration: See Environment Variables for all configuration options</p>"},{"location":"comparison/","title":"Feature Comparison","text":"<p>MCP Mesh vs LangChain, AutoGen, and CrewAI</p> <p>How does MCP Mesh compare to other popular AI agent frameworks? This detailed comparison covers development, deployment, observability, and enterprise features.</p>"},{"location":"comparison/#develop","title":"Develop","text":"Feature LangChain AutoGen CrewAI MCP Mesh Scaffold agents <code>meshctl scaffold</code> Local dev server <code>meshctl start</code> List agents <code>meshctl list</code> Status check <code>meshctl status</code> Built-in docs <code>meshctl man</code> Hot reload Local tracing <code>meshctl trace</code>"},{"location":"comparison/#build","title":"Build","text":"Feature LangChain AutoGen CrewAI MCP Mesh Zero-config Dependency Injection Dynamic Distributed DI Capability-based discovery Tag-based filtering Cross-language support  Python + TypeScript Same code local/Docker/K8s Monolith mode (single process) Distributed mode  DIY  DIY  DIY  Auto Structured output  Manual  Manual  Manual  Native (Pydantic/Zod)"},{"location":"comparison/#test","title":"Test","text":"Feature LangChain AutoGen CrewAI MCP Mesh Zero-config mocking  Topology-based Mock by presence No code change for tests No config change for tests Integration test support  DIY  DIY  DIY  Native"},{"location":"comparison/#multi-llm","title":"Multi-LLM","text":"Feature LangChain AutoGen CrewAI MCP Mesh Multi-LLM support Dynamic LLM discovery LLM auto-failover Dynamic tool calls  Manual  Manual  Manual  Native LLM provider hot-swap Zero-code LLM providers  Scaffold"},{"location":"comparison/#agents","title":"Agents","text":"Feature LangChain AutoGen CrewAI MCP Mesh Agent-to-agent calls  Manual Dynamic agent discovery Agent hot join Agent hot leave Agent health checks N-way agent communication <code>filter_mode=\"all\"</code>"},{"location":"comparison/#deploy","title":"Deploy","text":"Feature LangChain AutoGen CrewAI MCP Mesh Docker images  DIY  DIY  DIY  Built-in Helm charts Kubernetes-native Auto-scaling  K8s native Service discovery  DIY  DIY  DIY  Native Zero-downtime deploy Environment parity  Local = Prod"},{"location":"comparison/#observe","title":"Observe","text":"Feature LangChain AutoGen CrewAI MCP Mesh Distributed tracing Cross-language tracing Local tracing  CLI Production tracing  Grafana/Tempo OpenTelemetry support  DIY  DIY  DIY  Native Trace propagation  Auto Span visualization  Grafana"},{"location":"comparison/#resilience","title":"Resilience","text":"Feature LangChain AutoGen CrewAI MCP Mesh Auto-failover Graceful degradation Circuit breaker Retry logic  DIY  DIY  DIY  Native Dead agent removal  Auto"},{"location":"comparison/#architecture","title":"Architecture","text":"Feature LangChain AutoGen CrewAI MCP Mesh Monolith \u2192 Distributed  Rewrite  Rewrite  Rewrite  Same code Central orchestrator required  Yes  Yes  Yes  Not needed Topology-based wiring Standard protocol  Custom  Custom  Custom  MCP"},{"location":"comparison/#developer-experience","title":"Developer Experience","text":"Feature LangChain AutoGen CrewAI MCP Mesh Lines of code for agent ~50+ ~50+ ~50+ ~10 Framework lock-in  High  High  High  Low (decorators) Learning curve Steep Steep Medium Low Pure Python/TS  Framework classes  Framework classes  Framework classes  Just decorators"},{"location":"comparison/#enterprise","title":"Enterprise","text":"Feature LangChain AutoGen CrewAI MCP Mesh Production-ready Enterprise observability Team development  Blocking  Blocking  Blocking  Non-blocking Multi-team support  Capability boundaries"},{"location":"comparison/#summary","title":"Summary","text":"<p>MCP Mesh is designed for production AI systems where you need:</p> <ul> <li>Zero infrastructure code - Just decorators, no boilerplate</li> <li>Dynamic discovery - Agents find each other automatically</li> <li>Enterprise operations - Tracing, failover, and scaling built-in</li> <li>Standard protocol - MCP, not proprietary formats</li> <li>Low lock-in - Your code stays clean Python/TypeScript</li> </ul> <p>Get Started View Architecture</p>"},{"location":"contributing/","title":"Contributing to MCP Mesh","text":"<p>Guidelines for contributing to the MCP Mesh project</p>"},{"location":"contributing/#getting-started","title":"Getting Started","text":"<ol> <li>Fork the repository on GitHub</li> <li>Clone your fork locally:    <pre><code>git clone https://github.com/YOUR_USERNAME/mcp-mesh.git\ncd mcp-mesh\n</code></pre></li> <li>Set up development environment:    <pre><code>make install-dev\nsource .venv/bin/activate\n</code></pre></li> </ol>"},{"location":"contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"contributing/#1-create-a-branch","title":"1. Create a Branch","text":"<pre><code>git checkout -b feature/your-feature-name\n# or\ngit checkout -b fix/your-bug-fix\n</code></pre>"},{"location":"contributing/#2-make-changes","title":"2. Make Changes","text":"<ul> <li>Follow existing code style and patterns</li> <li>Add tests for new functionality</li> <li>Update documentation as needed</li> </ul>"},{"location":"contributing/#3-test-your-changes","title":"3. Test Your Changes","text":"<pre><code># Run tests\nmake test\n\n# Run linting\nmake lint\n\n# Build to verify\nmake build\n</code></pre>"},{"location":"contributing/#4-commit-and-push","title":"4. Commit and Push","text":"<pre><code>git add .\ngit commit -m \"feat: add new feature description\"\ngit push origin feature/your-feature-name\n</code></pre> <p>Commit message format:</p> <ul> <li><code>feat:</code> - New feature</li> <li><code>fix:</code> - Bug fix</li> <li><code>docs:</code> - Documentation only</li> <li><code>refactor:</code> - Code refactoring</li> <li><code>test:</code> - Adding tests</li> <li><code>chore:</code> - Maintenance tasks</li> </ul>"},{"location":"contributing/#5-create-pull-request","title":"5. Create Pull Request","text":"<ol> <li>Go to MCP Mesh GitHub</li> <li>Click \"New Pull Request\"</li> <li>Select your branch</li> <li>Fill in the PR template</li> <li>Request review</li> </ol>"},{"location":"contributing/#project-structure","title":"Project Structure","text":"<pre><code>mcp-mesh/\n\u251c\u2500\u2500 cmd/                    # Go CLI tools (meshctl, registry)\n\u251c\u2500\u2500 src/runtime/python/     # Python SDK\n\u251c\u2500\u2500 examples/               # Example agents\n\u251c\u2500\u2500 docs/                   # Documentation (MkDocs)\n\u251c\u2500\u2500 helm/                   # Helm charts\n\u2514\u2500\u2500 Makefile               # Build automation\n</code></pre>"},{"location":"contributing/#code-guidelines","title":"Code Guidelines","text":""},{"location":"contributing/#python-sdk","title":"Python (SDK)","text":"<ul> <li>Python 3.11+ compatible</li> <li>Type hints required</li> <li>Docstrings for public functions</li> <li>Follow existing patterns in <code>src/runtime/python/_mcp_mesh/</code></li> </ul>"},{"location":"contributing/#go-cliregistry","title":"Go (CLI/Registry)","text":"<ul> <li>Go 1.23+</li> <li>Run <code>go fmt</code> before committing</li> <li>Follow Go conventions</li> </ul>"},{"location":"contributing/#documentation","title":"Documentation","text":"<ul> <li>Use MkDocs Material syntax</li> <li>Test locally: <code>mkdocs serve</code></li> <li>Keep examples runnable</li> </ul>"},{"location":"contributing/#getting-help","title":"Getting Help","text":"<ul> <li>Questions: GitHub Discussions</li> <li>Bugs: GitHub Issues</li> <li>Chat: Discord Community</li> </ul>"},{"location":"contributing/#license","title":"License","text":"<p>By contributing, you agree that your contributions will be licensed under the MIT License.</p> <p>Thank you for contributing to MCP Mesh!</p>"},{"location":"deployment/","title":"Deployment","text":"<p>Choose the right deployment method for your environment</p>"},{"location":"deployment/#overview","title":"Overview","text":"<p>MCP Mesh supports multiple deployment options to fit your infrastructure needs. Whether you're developing locally or deploying to production Kubernetes clusters, MCP Mesh has you covered.</p>"},{"location":"deployment/#deployment-options","title":"Deployment Options","text":""},{"location":"deployment/#docker","title":"Docker","text":"<p>Best for: Local development, testing, simple deployments</p> <ul> <li>Quick setup with Docker Compose</li> <li>Pre-built images available</li> <li>Auto-generated compose files with <code>meshctl scaffold</code></li> <li>Great for development and CI/CD</li> </ul> <pre><code># Quick start\nmeshctl scaffold --name my-agent --compose\ndocker-compose up\n</code></pre> <p> Docker Guide</p>"},{"location":"deployment/#kubernetes","title":"Kubernetes","text":"<p>Best for: Production deployments (Recommended)</p> <ul> <li>Production-ready Helm charts</li> <li>Horizontal pod autoscaling</li> <li>Built-in observability (Grafana, Tempo)</li> <li>Multi-environment support</li> </ul> <pre><code># Quick start (OCI registry - no helm repo add needed)\nhelm install mcp-registry oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-registry \\\n  --version 0.8.0-beta.6 -n mcp-mesh --create-namespace\n</code></pre> <p> Kubernetes Guide</p>"},{"location":"deployment/#quick-comparison","title":"Quick Comparison","text":"Feature Docker Kubernetes Setup Complexity  Easy  Medium Production Ready  Limited  Yes Scaling Manual Automatic (HPA) Observability Built-in (opt-in) Built-in (opt-in) Best Use Case Development Production"},{"location":"deployment/#which-should-i-choose","title":"Which Should I Choose?","text":""},{"location":"deployment/#use-docker-if-you-want-to","title":"Use Docker if you want to:","text":"<ul> <li>Get started quickly with minimal setup</li> <li>Develop and test locally</li> <li>Run a simple proof-of-concept</li> <li>Use Docker Compose for orchestration</li> </ul>"},{"location":"deployment/#use-kubernetes-if-you-want-to","title":"Use Kubernetes if you want to:","text":"<ul> <li>Deploy to production</li> <li>Scale agents independently</li> <li>Use enterprise features (monitoring, tracing)</li> <li>Follow GitOps practices</li> </ul> <p>Recommendation</p> <p>For production deployments, we strongly recommend Kubernetes with Helm charts. They include battle-tested configurations, built-in observability, and follow Kubernetes best practices.</p>"},{"location":"deployment/#deployment-path","title":"Deployment Path","text":"<pre><code>graph LR\n    A[Start] --&gt; B{Environment?}\n    B --&gt;|Local Dev| C[Docker]\n    B --&gt;|Production| D[Kubernetes]\n    C --&gt;|Scale Up| D</code></pre>"},{"location":"deployment/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Deployment - Start here for local development</li> <li>Kubernetes Deployment - Production-ready deployment with Helm</li> </ul>"},{"location":"enhanced-tag-matching-migration/","title":"Enhanced Tag Matching Migration Guide","text":"<p>Upgrading from exact tag matching to smart <code>+</code>/<code>-</code> operators</p> <p>This guide helps you migrate existing MCP Mesh applications to take advantage of enhanced tag matching with preference and exclusion operators introduced in v0.4+.</p>"},{"location":"enhanced-tag-matching-migration/#what-changed","title":"What Changed","text":""},{"location":"enhanced-tag-matching-migration/#before-v04-exact-matching-only","title":"Before v0.4 - Exact Matching Only","text":"<pre><code>@mesh.tool(\n    dependencies=[{\n        \"capability\": \"llm_service\",\n        \"tags\": [\"claude\", \"opus\"]  # ALL tags must match exactly\n    }]\n)\n</code></pre> <p>Problem: Rigid matching - either exact match or total failure. No fallback options.</p>"},{"location":"enhanced-tag-matching-migration/#after-v04-smart-matching","title":"After v0.4 - Smart Matching","text":"<pre><code>@mesh.tool(\n    dependencies=[{\n        \"capability\": \"llm_service\",\n        \"tags\": [\n            \"claude\",       # Required (same as before)\n            \"+opus\",        # Preferred (bonus if present)\n            \"-experimental\" # Excluded (must NOT be present)\n        ]\n    }]\n)\n</code></pre> <p>Benefits: Smart provider selection, graceful degradation, cost control, safety exclusions.</p>"},{"location":"enhanced-tag-matching-migration/#backward-compatibility","title":"Backward Compatibility","text":"<p>\u2705 100% Backward Compatible: All existing tag configurations continue to work unchanged.</p> <ul> <li>Tags without prefixes remain \"required\" tags</li> <li>Existing dependency resolution behavior preserved</li> <li>No breaking changes to APIs or data structures</li> <li>Zero migration required for basic use cases</li> </ul>"},{"location":"enhanced-tag-matching-migration/#migration-strategies","title":"Migration Strategies","text":""},{"location":"enhanced-tag-matching-migration/#strategy-1-gradual-enhancement-recommended","title":"Strategy 1: Gradual Enhancement (Recommended)","text":"<p>Start with your existing exact tags and gradually add preferences/exclusions:</p> <pre><code># Phase 1: Existing configuration (works unchanged)\n\"tags\": [\"claude\", \"production\"]\n\n# Phase 2: Add preferences for better provider selection\n\"tags\": [\"claude\", \"production\", \"+opus\"]\n\n# Phase 3: Add safety exclusions\n\"tags\": [\"claude\", \"production\", \"+opus\", \"-experimental\", \"-beta\"]\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#strategy-2-full-smart-matching","title":"Strategy 2: Full Smart Matching","text":"<p>Transform exact requirements into intelligent preferences:</p>"},{"location":"enhanced-tag-matching-migration/#before-rigid","title":"Before (Rigid)","text":"<pre><code>@mesh.tool(\n    capability=\"chat_service\",\n    dependencies=[{\n        \"capability\": \"llm_service\",\n        \"tags\": [\"claude\", \"opus\"]  # Fails if no opus available\n    }]\n)\ndef premium_chat(llm_service: mesh.McpMeshTool = None):\n    return llm_service() if llm_service else \"Service unavailable\"\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#after-smart","title":"After (Smart)","text":"<pre><code>@mesh.tool(\n    capability=\"chat_service\",\n    dependencies=[{\n        \"capability\": \"llm_service\",\n        \"tags\": [\n            \"claude\",           # Still require Claude\n            \"+opus\",            # Prefer opus quality\n            \"+sonnet\",          # Fallback to sonnet\n            \"-experimental\"     # Never use experimental\n        ]\n    }]\n)\ndef adaptive_chat(llm_service: mesh.McpMeshTool = None):\n    \"\"\"\n    Smart chat that adapts to available services:\n    - Prefers opus when available\n    - Falls back to sonnet if opus unavailable\n    - Never uses experimental/unstable services\n    \"\"\"\n    return llm_service() if llm_service else \"No suitable service available\"\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#common-migration-patterns","title":"Common Migration Patterns","text":""},{"location":"enhanced-tag-matching-migration/#pattern-1-cost-optimization","title":"Pattern 1: Cost Optimization","text":"<p>Transform expensive exact requirements into cost-conscious preferences:</p> <pre><code># Before: Always uses expensive premium service\n@mesh.tool(\n    dependencies=[{\"capability\": \"llm_service\", \"tags\": [\"claude\", \"opus\", \"premium\"]}]\n)\n\n# After: Prefers quality but allows cost-effective alternatives\n@mesh.tool(\n    dependencies=[{\n        \"capability\": \"llm_service\",\n        \"tags\": [\n            \"claude\",       # Required model family\n            \"+opus\",        # Prefer best quality\n            \"+sonnet\",      # Accept good quality\n            \"-premium\"      # Exclude expensive tiers when cost matters\n        ]\n    }]\n)\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#pattern-2-environment-safety","title":"Pattern 2: Environment Safety","text":"<p>Add safety exclusions to prevent production issues:</p> <pre><code># Before: Could accidentally get experimental services\n@mesh.tool(\n    dependencies=[{\"capability\": \"database_service\", \"tags\": [\"postgres\"]}]\n)\n\n# After: Explicit safety guardrails\n@mesh.tool(\n    dependencies=[{\n        \"capability\": \"database_service\",\n        \"tags\": [\n            \"postgres\",         # Required database type\n            \"+primary\",         # Prefer primary instance\n            \"+ssd\",            # Prefer SSD performance\n            \"-experimental\",    # Safety: no experimental features\n            \"-beta\",           # Safety: no beta versions\n            \"-replica\"         # Safety: no read-only replicas for writes\n        ]\n    }]\n)\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#pattern-3-multi-region-preferences","title":"Pattern 3: Multi-Region Preferences","text":"<p>Transform region-specific exact matching into intelligent preferences:</p> <pre><code># Before: Hard-coded to specific region\n@mesh.tool(\n    dependencies=[{\n        \"capability\": \"storage_service\",\n        \"tags\": [\"aws\", \"us-east-1\", \"primary\"]\n    }]\n)\n\n# After: Regional preferences with fallbacks\n@mesh.tool(\n    dependencies=[{\n        \"capability\": \"storage_service\",\n        \"tags\": [\n            \"aws\",              # Required cloud provider\n            \"+us-east-1\",       # Prefer primary region\n            \"+us-west-2\",       # Acceptable fallback region\n            \"+primary\",         # Prefer primary storage\n            \"-experimental\"     # No experimental storage\n        ]\n    }]\n)\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#advanced-migration-examples","title":"Advanced Migration Examples","text":""},{"location":"enhanced-tag-matching-migration/#multi-service-architecture-migration","title":"Multi-Service Architecture Migration","text":""},{"location":"enhanced-tag-matching-migration/#before-brittle-exact-matching","title":"Before: Brittle Exact Matching","text":"<pre><code>@mesh.tool(\n    capability=\"data_pipeline\",\n    dependencies=[\n        {\"capability\": \"database\", \"tags\": [\"postgres\", \"v15\", \"primary\"]},\n        {\"capability\": \"cache\", \"tags\": [\"redis\", \"cluster\", \"v7\"]},\n        {\"capability\": \"queue\", \"tags\": [\"rabbitmq\", \"ha\", \"v3.10\"]}\n    ]\n)\ndef rigid_pipeline():\n    \"\"\"Brittle pipeline that fails if any exact version unavailable.\"\"\"\n    pass\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#after-resilient-smart-matching","title":"After: Resilient Smart Matching","text":"<pre><code>@mesh.tool(\n    capability=\"data_pipeline\",\n    dependencies=[\n        {\n            \"capability\": \"database\",\n            \"tags\": [\n                \"postgres\",         # Required database\n                \"+primary\",         # Prefer primary instance\n                \"+v15\",            # Prefer latest version\n                \"+ssd\",            # Prefer SSD performance\n                \"-experimental\",    # No experimental versions\n                \"-replica\"         # No read-only for this pipeline\n            ]\n        },\n        {\n            \"capability\": \"cache\",\n            \"tags\": [\n                \"redis\",           # Required cache type\n                \"+cluster\",        # Prefer clustered setup\n                \"+v7\",            # Prefer latest Redis 7.x\n                \"+memory-optimized\", # Prefer memory optimization\n                \"-single-node\"     # Avoid single points of failure\n            ]\n        },\n        {\n            \"capability\": \"queue\",\n            \"tags\": [\n                \"rabbitmq\",        # Required message queue\n                \"+ha\",            # Prefer high availability\n                \"+v3.10\",         # Prefer stable version\n                \"-beta\"           # No beta versions in production\n            ]\n        }\n    ]\n)\ndef resilient_pipeline():\n    \"\"\"\n    Resilient pipeline that:\n    - Prefers optimal configurations\n    - Gracefully degrades when needed\n    - Maintains safety guardrails\n    \"\"\"\n    pass\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#testing-your-migration","title":"Testing Your Migration","text":""},{"location":"enhanced-tag-matching-migration/#1-validate-enhanced-matching-works","title":"1. Validate Enhanced Matching Works","text":"<pre><code># Start multiple providers with different tags\npython provider_haiku.py   # Tags: [\"claude\", \"haiku\", \"fast\"]\npython provider_sonnet.py  # Tags: [\"claude\", \"sonnet\", \"balanced\"]\npython provider_opus.py    # Tags: [\"claude\", \"opus\", \"premium\"]\n\n# Test consumer with preferences\npython consumer.py         # Tags: [\"claude\", \"+opus\", \"-experimental\"]\n# Should select opus provider (preferred)\n\n# Stop opus provider\npkill -f provider_opus.py\n\n# Test fallback behavior\npython consumer.py         # Should fallback to sonnet provider\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#2-verify-exclusion-works","title":"2. Verify Exclusion Works","text":"<pre><code># Start experimental provider\npython experimental.py     # Tags: [\"claude\", \"experimental\"]\n\n# Test exclusion\npython consumer.py         # Tags: [\"claude\", \"-experimental\"]\n# Should find NO providers (experimental excluded)\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#3-monitor-provider-selection","title":"3. Monitor Provider Selection","text":"<pre><code># Check which providers are selected\ncurl -s http://localhost:8000/agents | \\\n  jq '.agents[] | select(.dependencies_resolved &gt; 0) |\n      {name: .name, resolved_dependencies: .resolved_dependencies}'\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#performance-considerations","title":"Performance Considerations","text":""},{"location":"enhanced-tag-matching-migration/#scoring-overhead","title":"Scoring Overhead","text":"<p>Enhanced matching adds minimal overhead:</p> <ul> <li>Simple string prefix checking: O(n) with number of tags</li> <li>Priority scoring: O(n) calculation per provider</li> <li>Provider ranking: O(n log n) sorting of candidates</li> </ul>"},{"location":"enhanced-tag-matching-migration/#network-efficiency","title":"Network Efficiency","text":"<p>Smart matching can improve network efficiency:</p> <ul> <li>Better provider selection reduces retry attempts</li> <li>Regional preferences minimize latency</li> <li>Cost exclusions prevent expensive provider usage</li> </ul>"},{"location":"enhanced-tag-matching-migration/#troubleshooting-migration","title":"Troubleshooting Migration","text":""},{"location":"enhanced-tag-matching-migration/#issue-no-providers-match","title":"Issue: No Providers Match","text":"<pre><code># Check what providers are available\ncurl -s http://localhost:8000/agents | jq '.agents[].capabilities'\n\n# Verify your tag requirements aren't too restrictive\n# Try removing some exclusions or changing requirements to preferences\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#issue-unexpected-provider-selected","title":"Issue: Unexpected Provider Selected","text":"<pre><code># Debug provider scoring\n# Add logging to see scoring decisions:\nexport MCP_MESH_LOG_LEVEL=DEBUG\npython your_consumer.py\n\n# Look for log messages like:\n# \"Provider score: agent_id=claude-opus score=15\"\n# \"Selected provider: claude-opus (highest score)\"\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#issue-legacy-behavior-changed","title":"Issue: Legacy Behavior Changed","text":"<p>If you need exactly the old behavior:</p> <pre><code># Ensure all tags are required (no + or -)\n\"tags\": [\"claude\", \"opus\"]  # Exact matching preserved\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#best-practices-after-migration","title":"Best Practices After Migration","text":""},{"location":"enhanced-tag-matching-migration/#1-use-descriptive-tag-hierarchies","title":"1. Use Descriptive Tag Hierarchies","text":"<pre><code># Good: Clear hierarchy and purpose\n\"tags\": [\n    \"llm\",                    # Service type\n    \"claude\",                 # Provider\n    \"+opus\",                  # Preferred model\n    \"+us-east-1\",            # Preferred region\n    \"-experimental\",          # Safety exclusion\n    \"-expensive\"             # Cost control\n]\n\n# Avoid: Cryptic or overly generic tags\n\"tags\": [\"svc\", \"v1\", \"+opt\", \"-bad\"]\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#2-balance-preferences-vs-requirements","title":"2. Balance Preferences vs Requirements","text":"<pre><code># Good: Some requirements, some preferences\n\"tags\": [\n    \"postgres\",              # Required: specific database\n    \"+primary\",              # Preferred: better performance\n    \"-experimental\"          # Safety: exclude risky versions\n]\n\n# Avoid: All preferences (too loose) or all requirements (too rigid)\n\"tags\": [\"+postgres\", \"+primary\", \"+ssd\"]  # Too loose\n\"tags\": [\"postgres\", \"v15.2\", \"us-east-1a\", \"i3.xlarge\"]  # Too rigid\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#3-document-your-tag-strategy","title":"3. Document Your Tag Strategy","text":"<pre><code>@mesh.tool(\n    capability=\"financial_processor\",\n    dependencies=[{\n        \"capability\": \"database_service\",\n        \"tags\": [\n            # Required for compliance\n            \"postgres\",          # SOX compliance requirement\n            \"encrypted\",         # PCI DSS requirement\n\n            # Performance preferences\n            \"+primary\",          # Prefer primary for consistency\n            \"+ssd\",             # Prefer SSD for speed\n\n            # Safety exclusions\n            \"-experimental\",     # Never use experimental in finance\n            \"-replica\"          # Never use read-only for transactions\n        ]\n    }],\n    description=\"Financial processor with strict compliance and performance requirements\"\n)\n</code></pre>"},{"location":"enhanced-tag-matching-migration/#summary","title":"Summary","text":"<p>Enhanced tag matching provides powerful capabilities while maintaining full backward compatibility:</p> <p>\u2705 Zero breaking changes - existing code works unchanged \u2705 Gradual migration - enhance at your own pace \u2705 Smart fallbacks - graceful degradation when preferred services unavailable \u2705 Cost control - exclude expensive services with <code>-premium</code> \u2705 Safety guardrails - exclude experimental/beta with <code>-experimental</code>, <code>-beta</code> \u2705 Regional preferences - prefer local services with <code>+us-east-1</code></p> <p>Start small with simple preferences, then gradually add more sophisticated matching logic as you see the benefits in your specific use cases.</p>"},{"location":"environment-variables/","title":"Environment Variables Reference","text":"<p>Configure MCP Mesh agents and services with environment variables</p>"},{"location":"environment-variables/#overview","title":"Overview","text":"<p>MCP Mesh can be configured using environment variables, allowing you to customize behavior without changing code. Environment variables override <code>@mesh.agent</code> decorator parameters and provide flexibility for different deployment environments.</p>"},{"location":"environment-variables/#essential-environment-variables","title":"Essential Environment Variables","text":""},{"location":"environment-variables/#logging-and-debug","title":"Logging and Debug","text":"<pre><code># Set log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)\nexport MCP_MESH_LOG_LEVEL=DEBUG\n\n# Enable debug mode (forces DEBUG level)\nexport MCP_MESH_DEBUG_MODE=true\n</code></pre>"},{"location":"environment-variables/#registry-configuration","title":"Registry Configuration","text":"<pre><code># Complete registry URL\nexport MCP_MESH_REGISTRY_URL=http://localhost:8000\n\n# Or set host and port separately\nexport MCP_MESH_REGISTRY_HOST=localhost\nexport MCP_MESH_REGISTRY_PORT=8000\n</code></pre>"},{"location":"environment-variables/#agent-configuration","title":"Agent Configuration","text":"<pre><code># Override agent name\nexport MCP_MESH_AGENT_NAME=my-custom-agent\n\n# Set agent namespace\nexport MCP_MESH_NAMESPACE=development\n\n# Enable/disable auto-run\nexport MCP_MESH_AUTO_RUN=true\n\n# Auto-run heartbeat interval (seconds)\nexport MCP_MESH_AUTO_RUN_INTERVAL=30\n</code></pre>"},{"location":"environment-variables/#http-server-settings","title":"HTTP Server Settings","text":"<pre><code># Server binding address (what interface to bind to)\nexport HOST=0.0.0.0\n\n# Agent HTTP port\nexport MCP_MESH_HTTP_PORT=8080\n\n# Enable/disable HTTP transport\nexport MCP_MESH_HTTP_ENABLED=true\n\n# External hostname announced to registry\nexport MCP_MESH_HTTP_HOST=my-agent\n</code></pre>"},{"location":"environment-variables/#health-and-monitoring","title":"Health and Monitoring","text":"<pre><code># Health check interval (seconds)\nexport MCP_MESH_HEALTH_INTERVAL=30\n\n# Enable global mesh functionality\nexport MCP_MESH_ENABLED=true\n</code></pre>"},{"location":"environment-variables/#registry-server-configuration","title":"Registry Server Configuration","text":"<p>These variables configure the Go registry server (<code>mcp-mesh-registry</code>)</p>"},{"location":"environment-variables/#core-server-settings","title":"Core Server Settings","text":"<pre><code># Server binding host\nexport HOST=localhost\n\n# Server port\nexport PORT=8000\n\n# Database connection URL\nexport DATABASE_URL=mcp_mesh_registry.db\n\n# Registry service name\nexport REGISTRY_NAME=mcp-mesh-registry\n</code></pre>"},{"location":"environment-variables/#fast-heartbeat-health-monitoring","title":"Fast Heartbeat &amp; Health Monitoring","text":"<pre><code># Agent heartbeat timeout - when to mark agents as unhealthy (seconds)\n# Optimized for 5-second HEAD heartbeats: 4 missed beats = 20s\nexport DEFAULT_TIMEOUT_THRESHOLD=20\n\n# Health monitor scan interval - how often to check for unhealthy agents (seconds)\nexport HEALTH_CHECK_INTERVAL=10\n\n# Agent eviction threshold - when to remove stale agents (seconds)\nexport DEFAULT_EVICTION_THRESHOLD=60\n</code></pre>"},{"location":"environment-variables/#cache-and-performance","title":"Cache and Performance","text":"<pre><code># Response cache TTL (seconds)\nexport CACHE_TTL=30\n\n# Enable response caching\nexport ENABLE_RESPONSE_CACHE=true\n</code></pre>"},{"location":"environment-variables/#logging-and-debug_1","title":"Logging and Debug","text":"<pre><code># Registry log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)\nexport MCP_MESH_LOG_LEVEL=INFO\n\n# Enable debug mode (true/false)\nexport MCP_MESH_DEBUG_MODE=false\n</code></pre>"},{"location":"environment-variables/#cors-configuration","title":"CORS Configuration","text":"<pre><code># Enable CORS support\nexport ENABLE_CORS=true\n\n# Allowed origins (comma-separated)\nexport ALLOWED_ORIGINS=\"*\"\n\n# Allowed HTTP methods\nexport ALLOWED_METHODS=\"GET,POST,PUT,DELETE,OPTIONS\"\n\n# Allowed headers\nexport ALLOWED_HEADERS=\"*\"\n</code></pre>"},{"location":"environment-variables/#feature-flags","title":"Feature Flags","text":"<pre><code># Enable metrics collection\nexport ENABLE_METRICS=true\n\n# Enable Prometheus metrics\nexport ENABLE_PROMETHEUS=true\n\n# Enable event system\nexport ENABLE_EVENTS=true\n</code></pre>"},{"location":"environment-variables/#configuration-patterns","title":"Configuration Patterns","text":""},{"location":"environment-variables/#registry-server-configurations","title":"Registry Server Configurations","text":""},{"location":"environment-variables/#development-registry","title":"Development Registry","text":"<pre><code># .env.registry.development\nMCP_MESH_LOG_LEVEL=DEBUG\nMCP_MESH_DEBUG_MODE=true\nHOST=localhost\nPORT=8000\nDEFAULT_TIMEOUT_THRESHOLD=10  # Fast detection for development\nHEALTH_CHECK_INTERVAL=5       # Quick scans for development\nENABLE_RESPONSE_CACHE=false   # Disable cache for testing\n</code></pre>"},{"location":"environment-variables/#production-registry","title":"Production Registry","text":"<pre><code># .env.registry.production\nMCP_MESH_LOG_LEVEL=INFO\nMCP_MESH_DEBUG_MODE=false\nHOST=0.0.0.0\nPORT=8000\nDEFAULT_TIMEOUT_THRESHOLD=20  # Balanced for production\nHEALTH_CHECK_INTERVAL=10      # Regular monitoring\nENABLE_RESPONSE_CACHE=true\nCACHE_TTL=30\nDATABASE_URL=postgresql://user:pass@db:5432/mcp_mesh\n</code></pre>"},{"location":"environment-variables/#high-performance-registry","title":"High-Performance Registry","text":"<pre><code># .env.registry.high-perf\nMCP_MESH_LOG_LEVEL=WARNING\nDEFAULT_TIMEOUT_THRESHOLD=5   # Ultra-fast detection\nHEALTH_CHECK_INTERVAL=2       # Very frequent monitoring\nCACHE_TTL=60                  # Longer cache for performance\nENABLE_RESPONSE_CACHE=true\n</code></pre>"},{"location":"environment-variables/#agent-development-environment","title":"Agent Development Environment","text":"<pre><code># .env.development\nMCP_MESH_LOG_LEVEL=DEBUG\nMCP_MESH_DEBUG_MODE=true\nMCP_MESH_REGISTRY_URL=http://localhost:8000\nMCP_MESH_NAMESPACE=development\nMCP_MESH_AUTO_RUN_INTERVAL=10\nMCP_MESH_HEALTH_INTERVAL=15\n</code></pre>"},{"location":"environment-variables/#production-environment","title":"Production Environment","text":"<pre><code># .env.production\nMCP_MESH_LOG_LEVEL=INFO\nMCP_MESH_DEBUG_MODE=false\nMCP_MESH_REGISTRY_URL=http://registry.company.com:8000\nMCP_MESH_NAMESPACE=production\nMCP_MESH_AUTO_RUN_INTERVAL=30\nMCP_MESH_HEALTH_INTERVAL=30\nHOST=0.0.0.0\nMCP_MESH_HTTP_HOST=api-service.company.com\n</code></pre>"},{"location":"environment-variables/#testing-environment","title":"Testing Environment","text":"<pre><code># .env.testing\nMCP_MESH_LOG_LEVEL=WARNING\nMCP_MESH_DEBUG_MODE=false\nMCP_MESH_AUTO_RUN=false\nMCP_MESH_REGISTRY_URL=http://test-registry:8000\nMCP_MESH_NAMESPACE=testing\n</code></pre>"},{"location":"environment-variables/#using-environment-variables","title":"Using Environment Variables","text":""},{"location":"environment-variables/#with-registry-server","title":"With Registry Server","text":"<pre><code># Start registry with environment file\nmcp-mesh-registry --host 0.0.0.0 --port 8000\n\n# Or with environment variables\nDEFAULT_TIMEOUT_THRESHOLD=10 HEALTH_CHECK_INTERVAL=5 mcp-mesh-registry\n\n# Load environment file manually\nsource .env.registry.development\nmcp-mesh-registry\n\n# Check registry configuration\nmcp-mesh-registry --help\n</code></pre>"},{"location":"environment-variables/#with-meshctl","title":"With meshctl","text":"<pre><code># Load environment file\nmeshctl start my_agent.py --env-file .env.development\n\n# Pass individual variables\nmeshctl start my_agent.py --env MCP_MESH_LOG_LEVEL=DEBUG --env MCP_MESH_DEBUG_MODE=true\n\n# Use system environment\nexport MCP_MESH_LOG_LEVEL=DEBUG\nmeshctl start my_agent.py\n</code></pre>"},{"location":"environment-variables/#with-python","title":"With Python","text":"<pre><code># Load environment file manually\nsource .env.development\npython my_agent.py\n\n# Or use python-dotenv in your agent\npip install python-dotenv\n</code></pre> <pre><code>import os\nfrom dotenv import load_dotenv\n\n# Load environment file\nload_dotenv('.env.development')\n\n# Your agent code here\n</code></pre>"},{"location":"environment-variables/#override-agent-configuration","title":"Override Agent Configuration","text":"<p>Environment variables override <code>@mesh.agent</code> decorator parameters:</p> <pre><code>@mesh.agent(\n    name=\"default-service\",\n    http_port=8080,\n    auto_run=True,\n    namespace=\"default\"\n)\nclass MyAgent:\n    pass\n</code></pre> <pre><code># Override decorator settings\nexport MCP_MESH_AGENT_NAME=overridden-service\nexport MCP_MESH_HTTP_PORT=9090\nexport MCP_MESH_AUTO_RUN=false\nexport MCP_MESH_NAMESPACE=custom\n\n# Runs with overridden values\npython my_agent.py\n</code></pre>"},{"location":"environment-variables/#advanced-configuration","title":"Advanced Configuration","text":""},{"location":"environment-variables/#kubernetes-environment","title":"Kubernetes Environment","text":"<pre><code># Service discovery variables (auto-detected in K8s)\nexport SERVICE_NAME=my-service\nexport NAMESPACE=production\nexport POD_NAME=my-service-abc123\nexport POD_IP=10.244.1.5\nexport NODE_NAME=worker-node-1\n</code></pre>"},{"location":"environment-variables/#docker-compose-environment","title":"Docker Compose Environment","text":"<pre><code># docker-compose.yml\nservices:\n  my-agent:\n    environment:\n      - HOST=0.0.0.0 # Bind to all interfaces\n      - MCP_MESH_HTTP_HOST=my-agent # Service name for inter-container communication\n      - MCP_MESH_HTTP_PORT=8080\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n      - MCP_MESH_LOG_LEVEL=INFO\n      - MCP_MESH_NAMESPACE=docker\n</code></pre>"},{"location":"environment-variables/#performance-tuning","title":"Performance Tuning","text":"<pre><code># Python runtime optimization\nexport PYTHONUNBUFFERED=1\nexport PYTHONPATH=/app/lib:/app/agents\n\n# Uvicorn server settings (for FastMCP)\nexport UVICORN_WORKERS=1\nexport UVICORN_LOOP=auto\nexport UVICORN_LIFESPAN=on\n</code></pre>"},{"location":"environment-variables/#fast-heartbeat-optimization","title":"Fast Heartbeat Optimization","text":"<p>Ultra-fast topology change detection:</p> <pre><code># Ultra-aggressive (sub-5 second detection)\nexport DEFAULT_TIMEOUT_THRESHOLD=5   # Mark unhealthy after 5s\nexport HEALTH_CHECK_INTERVAL=2       # Scan every 2 seconds\n\n# Balanced (default - sub-20 second detection)\nexport DEFAULT_TIMEOUT_THRESHOLD=20  # Mark unhealthy after 20s (4 missed 5s heartbeats)\nexport HEALTH_CHECK_INTERVAL=10      # Scan every 10 seconds\n\n# Conservative (legacy behavior)\nexport DEFAULT_TIMEOUT_THRESHOLD=60  # Mark unhealthy after 60s\nexport HEALTH_CHECK_INTERVAL=30      # Scan every 30 seconds\n\n# Production recommended\nexport DEFAULT_TIMEOUT_THRESHOLD=20\nexport HEALTH_CHECK_INTERVAL=10\n</code></pre> <p>How it works:</p> <ul> <li>Agents send lightweight HEAD requests every ~5 seconds</li> <li>Registry responds with topology change status (200/202/410)</li> <li>Background monitor detects unhealthy agents and creates events</li> <li>Other agents get notified via 202 responses on their HEAD checks</li> </ul>"},{"location":"environment-variables/#dynamic-updates","title":"Dynamic Updates","text":"<pre><code># Enable dynamic capability updates\nexport MCP_MESH_DYNAMIC_UPDATES=true\n\n# Update strategy (immediate, graceful)\nexport MCP_MESH_UPDATE_STRATEGY=graceful\n\n# Grace period for updates (seconds)\nexport MCP_MESH_UPDATE_GRACE_PERIOD=30\n</code></pre>"},{"location":"environment-variables/#real-world-examples","title":"Real-World Examples","text":""},{"location":"environment-variables/#multi-service-development","title":"Multi-Service Development","text":"<pre><code># Terminal 1: Start registry with fast heartbeats\nexport MCP_MESH_LOG_LEVEL=DEBUG\nexport DEFAULT_TIMEOUT_THRESHOLD=10\nexport HEALTH_CHECK_INTERVAL=5\nmcp-mesh-registry --host localhost --port 8000\n\n# Terminal 2: Start auth service\nexport MCP_MESH_AGENT_NAME=auth-service\nexport MCP_MESH_HTTP_PORT=8081\nexport MCP_MESH_NAMESPACE=dev\nexport MCP_MESH_LOG_LEVEL=DEBUG\npython services/auth.py\n\n# Terminal 3: Start API service\nexport MCP_MESH_AGENT_NAME=api-service\nexport MCP_MESH_HTTP_PORT=8082\nexport MCP_MESH_NAMESPACE=dev\nexport MCP_MESH_LOG_LEVEL=DEBUG\npython services/api.py\n</code></pre>"},{"location":"environment-variables/#registry-high-availability","title":"Registry High Availability","text":"<pre><code># Primary registry (port 8000)\nexport HOST=0.0.0.0\nexport PORT=8000\nexport DATABASE_URL=postgresql://user:pass@primary-db:5432/mcp_mesh\nexport DEFAULT_TIMEOUT_THRESHOLD=20\nexport HEALTH_CHECK_INTERVAL=10\nmcp-mesh-registry &amp;\n\n# Backup registry (port 8001) - read-only mode for failover\nexport HOST=0.0.0.0\nexport PORT=8001\nexport DATABASE_URL=postgresql://user:pass@replica-db:5432/mcp_mesh\nexport DEFAULT_TIMEOUT_THRESHOLD=30\nexport HEALTH_CHECK_INTERVAL=15\nmcp-mesh-registry &amp;\n</code></pre>"},{"location":"environment-variables/#remote-registry-connection","title":"Remote Registry Connection","text":"<pre><code># Connect to shared development registry\nexport MCP_MESH_REGISTRY_URL=http://dev-registry.team.local:8000\nexport MCP_MESH_NAMESPACE=shared-dev\nexport MCP_MESH_AGENT_NAME=my-feature-branch\n\npython my_agent.py\n</code></pre>"},{"location":"environment-variables/#cicd-pipeline","title":"CI/CD Pipeline","text":"<pre><code># Test environment variables\nexport MCP_MESH_AUTO_RUN=false          # Don't auto-start in tests\nexport MCP_MESH_LOG_LEVEL=ERROR         # Minimal logging\nexport MCP_MESH_REGISTRY_URL=http://test-registry:8000\nexport MCP_MESH_NAMESPACE=ci-${BUILD_ID}\n\n# Run tests\npython -m pytest tests/\n</code></pre>"},{"location":"environment-variables/#load-testing-setup","title":"Load Testing Setup","text":"<pre><code># Start multiple instances with unique names\nfor i in {1..5}; do\n  export MCP_MESH_AGENT_NAME=load-test-agent-$i\n  export MCP_MESH_HTTP_PORT=$((8080 + i))\n  python my_agent.py &amp;\ndone\n\n# Monitor all instances\nmeshctl list --filter load-test\n</code></pre>"},{"location":"environment-variables/#environment-variable-hierarchy","title":"Environment Variable Hierarchy","text":"<p>Environment variables are applied in this order (last wins):</p> <ol> <li>System environment variables</li> <li>Environment files (<code>.env</code>)</li> <li>meshctl <code>--env</code> flags</li> <li><code>@mesh.agent</code> decorator parameters</li> </ol> <pre><code># Example: Final port will be 9999\nexport MCP_MESH_HTTP_PORT=8080              # System (1)\n# .env file has: MCP_MESH_HTTP_PORT=8081    # File (2)\nmeshctl start my_agent.py --env MCP_MESH_HTTP_PORT=9999  # Flag (3)\n</code></pre>"},{"location":"environment-variables/#debugging-environment-issues","title":"Debugging Environment Issues","text":""},{"location":"environment-variables/#check-current-environment","title":"Check Current Environment","text":"<pre><code># Show all MCP Mesh environment variables\nenv | grep MCP_MESH\n\n# Test specific variable\necho $MCP_MESH_LOG_LEVEL\n\n# Verify environment file loading\nmeshctl start my_agent.py --env-file .env.development --debug\n</code></pre>"},{"location":"environment-variables/#common-issues","title":"Common Issues","text":""},{"location":"environment-variables/#1-port-already-in-use","title":"1. Port Already in Use","text":"<pre><code># Check what's using a port\nlsof -i :8080\n\n# Use different port\nexport MCP_MESH_HTTP_PORT=8081\n</code></pre>"},{"location":"environment-variables/#2-registry-connection-failed","title":"2. Registry Connection Failed","text":"<pre><code># Test registry connectivity\ncurl -s http://localhost:8000/health\n\n# Use different registry\nexport MCP_MESH_REGISTRY_URL=http://backup-registry:8000\n</code></pre>"},{"location":"environment-variables/#3-agent-name-conflicts","title":"3. Agent Name Conflicts","text":"<pre><code># Use unique agent name\nexport MCP_MESH_AGENT_NAME=my-unique-agent-$(date +%s)\n\n# Check existing agents\nmeshctl list\n</code></pre>"},{"location":"environment-variables/#4-environment-file-not-loaded","title":"4. Environment File Not Loaded","text":"<pre><code># Verify file exists and is readable\ncat .env.development\n\n# Use absolute path\nmeshctl start my_agent.py --env-file /full/path/to/.env.development\n</code></pre>"},{"location":"environment-variables/#environment-templates","title":"Environment Templates","text":""},{"location":"environment-variables/#development-template","title":"Development Template","text":"<pre><code># .env.development\nMCP_MESH_LOG_LEVEL=DEBUG\nMCP_MESH_DEBUG_MODE=true\nMCP_MESH_REGISTRY_URL=http://localhost:8000\nMCP_MESH_NAMESPACE=development\nMCP_MESH_AUTO_RUN_INTERVAL=10\nMCP_MESH_HEALTH_INTERVAL=15\nHOST=0.0.0.0\n</code></pre>"},{"location":"environment-variables/#production-template","title":"Production Template","text":"<pre><code># .env.production\nMCP_MESH_LOG_LEVEL=INFO\nMCP_MESH_DEBUG_MODE=false\nMCP_MESH_REGISTRY_URL=https://registry.company.com\nMCP_MESH_NAMESPACE=production\nMCP_MESH_AUTO_RUN_INTERVAL=30\nMCP_MESH_HEALTH_INTERVAL=30\nMCP_MESH_UPDATE_STRATEGY=graceful\nMCP_MESH_UPDATE_GRACE_PERIOD=60\nHOST=0.0.0.0\n</code></pre>"},{"location":"environment-variables/#docker-template","title":"Docker Template","text":"<pre><code># .env.docker\nHOST=0.0.0.0\nMCP_MESH_HTTP_HOST=my-service\nMCP_MESH_REGISTRY_URL=http://registry:8000\nMCP_MESH_NAMESPACE=docker\nMCP_MESH_LOG_LEVEL=INFO\nPYTHONUNBUFFERED=1\n</code></pre>"},{"location":"environment-variables/#security-considerations","title":"Security Considerations","text":""},{"location":"environment-variables/#sensitive-information","title":"Sensitive Information","text":"<pre><code># \u274c Don't put secrets in environment files committed to git\nMCP_MESH_API_KEY=secret123\n\n# \u2705 Use secure secret management\nexport MCP_MESH_API_KEY=$(kubectl get secret mesh-api-key -o jsonpath='{.data.key}' | base64 -d)\n\n# \u2705 Or use external secret providers\nexport MCP_MESH_REGISTRY_URL=$(vault kv get -field=url secret/mesh/registry)\n</code></pre>"},{"location":"environment-variables/#network-security","title":"Network Security","text":"<pre><code># Use secure URLs in production\nexport MCP_MESH_REGISTRY_URL=https://registry.company.com  # \u2705 HTTPS\n\n# Bind to specific interfaces when needed\nexport HOST=127.0.0.1  # \u2705 Localhost only\nexport HOST=0.0.0.0    # \u26a0\ufe0f All interfaces (use carefully)\n</code></pre>"},{"location":"environment-variables/#next-steps","title":"Next Steps","text":"<p>Now that you understand environment configuration:</p> <ol> <li>Local Development - Professional development workflows</li> <li>Production Deployment - Container orchestration</li> <li>Mesh Decorators - @mesh.tool, @mesh.llm decorators</li> </ol>"},{"location":"environment-variables/#summary","title":"Summary","text":""},{"location":"environment-variables/#agent-configuration-python","title":"Agent Configuration (Python)","text":"<p>Focus on <code>MCP_MESH_*</code> variables for agent behavior, heartbeat intervals, and service discovery.</p>"},{"location":"environment-variables/#registry-configuration-go","title":"Registry Configuration (Go)","text":"<p>Focus on <code>DEFAULT_TIMEOUT_THRESHOLD</code> and <code>HEALTH_CHECK_INTERVAL</code> for fast topology detection.</p> <p>\ud83d\udca1 Pro Tip: Use environment files for different deployment stages - keeps configuration organized and secure.</p> <p>\ud83d\udd27 Development Tip: Set <code>MCP_MESH_DEBUG_MODE=true</code> during development for detailed logging and faster feedback.</p> <p>\ud83d\ude80 Production Tip: Use <code>DEFAULT_TIMEOUT_THRESHOLD=20</code> and <code>HEALTH_CHECK_INTERVAL=10</code> for optimal fast heartbeat performance.</p> <p>\u26a1 Performance Tip: For ultra-fast systems, try <code>DEFAULT_TIMEOUT_THRESHOLD=5</code> and <code>HEALTH_CHECK_INTERVAL=2</code> for sub-5 second topology detection.</p> <p>\ud83d\udee1\ufe0f Registry Tip: Use <code>DATABASE_URL</code> with PostgreSQL in production for better performance and reliability.</p>"},{"location":"faq/","title":"FAQ","text":"<p>Frequently asked questions about MCP Mesh</p>"},{"location":"faq/#dependency-injection","title":"Dependency Injection","text":""},{"location":"faq/#how-do-i-use-mesh-dependencies-in-background-tasks-redis-consumers-cron-jobs","title":"How do I use mesh dependencies in background tasks (Redis consumers, cron jobs)?","text":"<p>Use <code>@mesh.tool</code> without <code>@app.tool</code>. The decorator provides full dependency injection even when the function is not exposed as an MCP tool.</p> <pre><code># Declare dependency - NOT an MCP tool (no @app.tool)\n@mesh.tool(dependencies=[\"notification_service\"])\nasync def send_notification(msg: str, notifier: mesh.McpMeshTool = None):\n    \"\"\"Internal function with DI - not exposed via MCP.\"\"\"\n    await notifier({\"message\": msg})\n\n# Use from anywhere - dependencies auto-injected!\nasync def redis_consumer(message):\n    await send_notification(message)  # notifier is injected automatically\n\nasync def cron_job():\n    await send_notification(\"Daily report\")  # works here too!\n</code></pre> <p>How it works:</p> <ol> <li><code>@mesh.tool</code> registers the function's dependencies with the mesh registry</li> <li>During agent startup/heartbeat, dependencies are resolved and proxies are created</li> <li>The decorator creates a wrapper that intercepts all calls</li> <li>When you call the function, the wrapper injects the resolved proxies automatically</li> </ol> <p>Key points:</p> <ul> <li>The <code>capability</code> parameter is optional for internal functions</li> <li>Dependencies are resolved during agent heartbeat</li> <li>Proxies are injected automatically on every call</li> <li>Works from any context: MCP calls, background tasks, direct calls</li> </ul>"},{"location":"faq/#project-organization","title":"Project Organization","text":""},{"location":"faq/#how-do-i-organize-meshtool-functions-across-multiple-files","title":"How do I organize @mesh.tool functions across multiple files?","text":"<p>MCP Mesh follows FastAPI's pattern - explicit imports are required. Tools are only registered when Python executes their decorators.</p> <p>Directory structure:</p> <pre><code>my-agent/\n\u251c\u2500\u2500 main.py           # Entry point with @mesh.agent\n\u251c\u2500\u2500 tools/\n\u2502   \u251c\u2500\u2500 __init__.py   # Re-exports tools\n\u2502   \u251c\u2500\u2500 greeter.py    # @mesh.tool functions\n\u2502   \u2514\u2500\u2500 calculator.py # @mesh.tool functions\n</code></pre> <p>Option 1: Import in main.py</p> <pre><code># main.py\nfrom tools import greeter, calculator  # Executes decorators\n\n@mesh.agent(name=\"my-agent\")\nclass MyAgent: pass\n</code></pre> <p>Option 2: Re-export from __init__.py</p> <pre><code># tools/__init__.py\nfrom .greeter import *\nfrom .calculator import *\n\n# main.py\nfrom tools import *  # Or specific functions\n\n@mesh.agent(name=\"my-agent\")\nclass MyAgent: pass\n</code></pre> <p>Option 3: Auto-import helper</p> <pre><code># tools/__init__.py\nimport importlib\nimport pkgutil\n\n# Auto-import all modules in this package\nfor loader, name, is_pkg in pkgutil.walk_packages(__path__):\n    importlib.import_module(f\"{__name__}.{name}\")\n\n# main.py\nimport tools  # All submodules auto-imported\n\n@mesh.agent(name=\"my-agent\")\nclass MyAgent: pass\n</code></pre> <p>Why explicit imports?</p> <p>This matches FastAPI's router pattern - no magic auto-discovery. Explicit imports keep code clear and predictable.</p>"},{"location":"faq/#logging","title":"Logging","text":""},{"location":"faq/#why-are-my-heartbeat-logs-so-verbose","title":"Why are my heartbeat logs so verbose?","text":"<p>MCP Mesh uses a tiered logging system:</p> Level What you see INFO Every 10<sup>th</sup> heartbeat, topology changes, errors DEBUG One summary line per heartbeat TRACE Full pipeline execution details <p>To reduce verbosity, use <code>--log-level INFO</code> (default) or set <code>MCP_MESH_LOG_LEVEL=INFO</code>.</p> <pre><code># Quiet mode - only important events\nmeshctl start main.py\n\n# Debug mode - one line per heartbeat\nmeshctl start main.py --debug\n\n# Trace mode - full details (for troubleshooting)\nmeshctl start main.py --log-level TRACE\n</code></pre>"},{"location":"faq/#deployment","title":"Deployment","text":""},{"location":"faq/#how-do-i-name-log-files-for-agents-using-mainpy","title":"How do I name log files for agents using main.py?","text":"<p>MCP Mesh automatically determines log file names:</p> <ol> <li>First: Looks for <code>@mesh.agent(name=\"...\")</code> decorator</li> <li>Then: Uses filename (without <code>.py</code>)</li> <li>Finally: If filename is <code>main</code>, uses parent directory name</li> </ol> Script Path Log File <code>my-api/main.py</code> <code>my-api.log</code> <code>calculator/main.py</code> <code>calculator.log</code> <code>greeter.py</code> <code>greeter.log</code> <p>This ensures that scaffolded agents (which use <code>main.py</code>) don't all write to <code>main.log</code>.</p>"},{"location":"faq/#see-also","title":"See Also","text":"<ul> <li>Getting Started - Quick introduction to MCP Mesh</li> <li>Mesh Decorators - Full decorator reference</li> <li>Troubleshooting - Common issues and solutions</li> </ul>"},{"location":"mesh-decorators/","title":"MCP Mesh Decorators Reference","text":"<p>Complete guide to @mesh.tool and @mesh.agent decorators - order matters!</p>"},{"location":"mesh-decorators/#critical-decorator-order","title":"Critical: Decorator Order","text":"<p>\u26a0\ufe0f IMPORTANT: Mesh decorators must come AFTER MCP decorators:</p> <pre><code># \u2705 CORRECT ORDER\n@app.tool()        # \u2190 FastMCP decorator FIRST\n@mesh.tool(        # \u2190 Mesh decorator SECOND\n    capability=\"greeting\"\n)\ndef hello_world():\n    return \"Hello!\"\n\n# \u274c WRONG ORDER - This will not work!\n@mesh.tool(capability=\"greeting\")  # \u2190 Wrong: mesh first\n@app.tool()                        # \u2190 Wrong: FastMCP second\ndef broken_function():\n    return \"This won't work\"\n</code></pre> <p>Why order matters: Mesh decorators need to wrap and enhance MCP decorators to provide dependency injection and orchestration.</p>"},{"location":"mesh-decorators/#meshtool-function-level-capabilities","title":"@mesh.tool - Function-Level Capabilities","text":"<p>The <code>@mesh.tool</code> decorator registers individual functions as mesh capabilities with dependency injection.</p>"},{"location":"mesh-decorators/#parameters","title":"Parameters","text":"Parameter Type Default Description <code>capability</code> <code>str \\| None</code> <code>None</code> Capability name others can depend on <code>tags</code> <code>list[str] \\| None</code> <code>[]</code> Tags for smart service discovery <code>version</code> <code>str</code> <code>\"1.0.0\"</code> Semantic version for this capability <code>dependencies</code> <code>list[str \\| dict] \\| None</code> <code>None</code> Required capabilities (simple or complex) <code>description</code> <code>str \\| None</code> Function docstring Human-readable description <code>**kwargs</code> <code>Any</code> - Additional metadata"},{"location":"mesh-decorators/#simple-example","title":"Simple Example","text":"<pre><code>import mesh\nfrom fastmcp import FastMCP\n\napp = FastMCP(\"My Service\")\n\n@app.tool()  # FastMCP decorator first\n@mesh.tool(  # Mesh decorator second\n    capability=\"greeting\",\n    tags=[\"social\", \"basic\"],\n    version=\"1.0.0\",\n    description=\"Simple greeting function\"\n)\ndef say_hello(name: str = \"World\") -&gt; str:\n    \"\"\"Say hello to someone.\"\"\"\n    return f\"Hello, {name}!\"\n</code></pre>"},{"location":"mesh-decorators/#dependencies-simple-vs-complex","title":"Dependencies: Simple vs Complex","text":""},{"location":"mesh-decorators/#simple-string-dependencies","title":"Simple String Dependencies","text":"<pre><code>@app.tool()\n@mesh.tool(\n    capability=\"weather_report\",\n    dependencies=[\"date_service\", \"location_service\"]  # Simple string array\n)\ndef get_weather(\n    date_service: mesh.McpMeshTool = None,\n    location_service: mesh.McpMeshTool = None\n) -&gt; str:\n    date = date_service() if date_service else \"unknown\"\n    location = location_service() if location_service else \"unknown\"\n    return f\"Weather for {location} on {date}: Sunny\"\n</code></pre>"},{"location":"mesh-decorators/#complex-object-dependencies","title":"Complex Object Dependencies","text":"<pre><code>@app.tool()\n@mesh.tool(\n    capability=\"advanced_weather\",\n    dependencies=[\n        \"date_service\",  # Simple dependency\n        {\n            \"capability\": \"location_service\",\n            \"tags\": [\"geo\", \"precise\"],           # Smart tag matching\n            \"version\": \"&gt;=2.0.0\",               # Version constraint\n            \"namespace\": \"production\"            # Specific namespace\n        },\n        {\n            \"capability\": \"info\",\n            \"tags\": [\"system\", \"weather\"]        # Gets weather-specific info\n        }\n    ],\n    tags=[\"weather\", \"advanced\"],\n    version=\"2.1.0\"\n)\ndef get_advanced_weather(\n    date_service: mesh.McpMeshTool = None,\n    location_service: mesh.McpMeshTool = None,\n    info: mesh.McpMeshTool = None\n) -&gt; dict:\n    \"\"\"Advanced weather with multiple tagged dependencies.\"\"\"\n    return {\n        \"date\": date_service() if date_service else \"unknown\",\n        \"location\": location_service() if location_service else \"unknown\",\n        \"system_info\": info() if info else {}\n    }\n</code></pre>"},{"location":"mesh-decorators/#dependency-object-structure","title":"Dependency Object Structure","text":"<p>For complex dependencies, use this structure:</p> <pre><code>{\n    \"capability\": \"required_capability_name\",  # Required: capability to find\n    \"tags\": [\"tag1\", \"tag2\"],                 # Optional: tags for smart matching\n    \"version\": \"&gt;=1.5.0,&lt;2.0.0\",             # Optional: semantic version constraint\n    \"namespace\": \"production\"                  # Optional: specific namespace\n}\n</code></pre>"},{"location":"mesh-decorators/#version-constraints","title":"Version Constraints","text":"<p>Full semantic versioning support:</p> <pre><code>@mesh.tool(\n    capability=\"data_processor\",\n    version=\"2.1.3\",  # This tool's version\n    dependencies=[\n        {\n            \"capability\": \"database\",\n            \"version\": \"&gt;=3.0.0\"      # Minimum version\n        },\n        {\n            \"capability\": \"cache\",\n            \"version\": \"~2.1.0\"       # Compatible with 2.1.x\n        },\n        {\n            \"capability\": \"api\",\n            \"version\": \"&gt;=1.0.0,&lt;2.0.0\"  # Range constraint\n        }\n    ]\n)\ndef process_data():\n    # Implementation\n    pass\n</code></pre>"},{"location":"mesh-decorators/#enhanced-tag-matching-with-operators","title":"Enhanced Tag Matching with \u00b1 Operators","text":"<p>Smart tag matching with preference and exclusion operators:</p> <p>MCP Mesh supports enhanced tag matching with <code>+</code> (preferred) and <code>-</code> (excluded) operators for intelligent service selection:</p>"},{"location":"mesh-decorators/#tag-operators","title":"Tag Operators","text":"<ul> <li>No prefix: Required tag (must be present) - <code>\"claude\"</code></li> <li><code>+</code> prefix: Preferred tag (bonus if present, no penalty if missing) - <code>\"+opus\"</code></li> <li><code>-</code> prefix: Excluded tag (must NOT be present, hard failure if found) - <code>\"-experimental\"</code></li> </ul>"},{"location":"mesh-decorators/#smart-llm-provider-selection","title":"Smart LLM Provider Selection","text":"<pre><code># Register multiple LLM providers with different capabilities\n@app.tool()\n@mesh.tool(capability=\"llm_service\", tags=[\"claude\", \"haiku\", \"fast\"])\ndef claude_haiku(): return \"Fast Claude Haiku response\"\n\n@app.tool()\n@mesh.tool(capability=\"llm_service\", tags=[\"claude\", \"sonnet\", \"balanced\"])\ndef claude_sonnet(): return \"Balanced Claude Sonnet response\"\n\n@app.tool()\n@mesh.tool(capability=\"llm_service\", tags=[\"claude\", \"opus\", \"premium\"])\ndef claude_opus(): return \"Premium Claude Opus response\"\n\n@app.tool()\n@mesh.tool(capability=\"llm_service\", tags=[\"claude\", \"experimental\", \"beta\"])\ndef claude_experimental(): return \"Experimental Claude features\"\n\n# Smart consumer with preferences and exclusions\n@app.tool()\n@mesh.tool(\n    capability=\"smart_chat\",\n    dependencies=[{\n        \"capability\": \"llm_service\",\n        \"tags\": [\n            \"claude\",           # Required: must have claude\n            \"+opus\",            # Preferred: prefer opus if available\n            \"-experimental\"     # Excluded: never use experimental services\n        ]\n    }]\n)\nasync def intelligent_chat(llm_service: mesh.McpMeshTool = None) -&gt; str:\n    \"\"\"\n    Smart chat that:\n    - Requires Claude models\n    - Prefers Opus quality when available\n    - Never uses experimental/unstable services\n    - Gracefully falls back to Sonnet if Opus unavailable\n    \"\"\"\n    if not llm_service:\n        return \"No suitable LLM service available\"\n\n    return f\"Response from: {await llm_service()}\"\n</code></pre>"},{"location":"mesh-decorators/#enhanced-matching-behavior","title":"Enhanced Matching Behavior","text":"<pre><code># Available providers:\n# - claude-haiku: [\"claude\", \"haiku\", \"fast\"]\n# - claude-sonnet: [\"claude\", \"sonnet\", \"balanced\"]\n# - claude-opus: [\"claude\", \"opus\", \"premium\"]\n# - claude-experimental: [\"claude\", \"experimental\", \"beta\"]\n\n# Consumer preferences and results:\n\"tags\": [\"claude\", \"+opus\"]                    # \u2192 Selects opus (preferred)\n\"tags\": [\"claude\", \"+balanced\"]                # \u2192 Selects sonnet (balanced)\n\"tags\": [\"claude\", \"+fast\", \"+haiku\"]          # \u2192 Selects haiku (both preferred)\n\"tags\": [\"claude\", \"-experimental\"]            # \u2192 Excludes experimental, selects any other\n\"tags\": [\"claude\", \"+opus\", \"-experimental\"]   # \u2192 Prefers opus, excludes experimental\n</code></pre>"},{"location":"mesh-decorators/#cost-control-and-safety","title":"Cost Control and Safety","text":"<pre><code>@app.tool()\n@mesh.tool(\n    capability=\"budget_analysis\",\n    dependencies=[{\n        \"capability\": \"llm_service\",\n        \"tags\": [\n            \"claude\",\n            \"+balanced\",     # Prefer cost-effective options\n            \"-premium\",      # Exclude expensive premium services\n            \"-experimental\"  # Exclude potentially unstable services\n        ]\n    }]\n)\nasync def cost_conscious_analysis(llm_service: mesh.McpMeshTool = None):\n    \"\"\"Cost-conscious analysis that avoids premium pricing.\"\"\"\n    return await llm_service() if llm_service else \"Budget service unavailable\"\n\n@app.tool()\n@mesh.tool(\n    capability=\"production_service\",\n    dependencies=[{\n        \"capability\": \"database_service\",\n        \"tags\": [\n            \"postgres\",\n            \"+primary\",      # Prefer primary database\n            \"+ssd\",          # Prefer SSD storage\n            \"-beta\",         # Never use beta versions\n            \"-experimental\"  # Never use experimental features\n        ]\n    }]\n)\nasync def production_workflow(database_service: mesh.McpMeshTool = None):\n    \"\"\"Production workflow with strict service requirements.\"\"\"\n    return await database_service(query=\"SELECT * FROM users\") if database_service else None\n</code></pre>"},{"location":"mesh-decorators/#priority-scoring-system","title":"Priority Scoring System","text":"<p>Enhanced tag matching uses priority scoring for automatic provider ranking:</p> <ul> <li>Required tags: 5 points each (must be present)</li> <li>Preferred tags: 10 bonus points each (bonus if present)</li> <li>Excluded tags: Immediate failure (provider eliminated)</li> <li>Highest scoring provider selected automatically</li> </ul> <pre><code># Example scoring:\n# Provider A: [\"claude\", \"opus\", \"premium\"]\n# Consumer needs: [\"claude\", \"+opus\", \"-experimental\"]\n# Score: claude(5) + opus(10) = 15 points \u2192 HIGH PRIORITY\n\n# Provider B: [\"claude\", \"sonnet\", \"balanced\"]\n# Consumer needs: [\"claude\", \"+opus\", \"-experimental\"]\n# Score: claude(5) = 5 points \u2192 LOWER PRIORITY\n\n# Provider C: [\"claude\", \"experimental\"]\n# Consumer needs: [\"claude\", \"+opus\", \"-experimental\"]\n# Score: ELIMINATED (experimental is excluded)\n\n# Result: Provider A selected (highest score)\n</code></pre>"},{"location":"mesh-decorators/#multi-tag-matching-legacy","title":"Multi-Tag Matching (Legacy)","text":"<p>Traditional exact tag matching is still supported:</p> <pre><code># Service provider offers multiple info types\n@app.tool()\n@mesh.tool(\n    capability=\"info\",\n    tags=[\"system\", \"general\", \"health\"]\n)\ndef get_system_health():\n    return {\"status\": \"healthy\", \"uptime\": \"5 days\"}\n\n@app.tool()\n@mesh.tool(\n    capability=\"info\",\n    tags=[\"system\", \"disk\", \"storage\"]\n)\ndef get_disk_info():\n    return {\"usage\": \"75%\", \"free\": \"250GB\"}\n\n# Consumer uses exact tags for specific info\n@app.tool()\n@mesh.tool(\n    capability=\"reporter\",\n    dependencies=[\n        {\n            \"capability\": \"info\",\n            \"tags\": [\"system\", \"general\"]  # Exact match: gets health info\n        },\n        {\n            \"capability\": \"info\",\n            \"tags\": [\"system\", \"disk\"]     # Exact match: gets disk info\n        }\n    ]\n)\ndef create_report(\n    health_info: mesh.McpMeshTool = None,\n    disk_info: mesh.McpMeshTool = None\n):\n    return {\n        \"health\": health_info() if health_info else {},\n        \"storage\": disk_info() if disk_info else {}\n    }\n</code></pre>"},{"location":"mesh-decorators/#advanced-meshtool-configuration","title":"Advanced @mesh.tool Configuration","text":"<p>Enhanced proxy auto-configuration through decorator kwargs:</p> <p>The <code>@mesh.tool</code> decorator now supports advanced configuration kwargs that automatically configure enhanced MCP proxies with timeouts, retries, authentication, streaming, and session management.</p>"},{"location":"mesh-decorators/#enhanced-proxy-kwargs","title":"Enhanced Proxy Kwargs","text":"Parameter Type Default Description <code>timeout</code> <code>int</code> <code>30</code> Request timeout in seconds <code>retry_count</code> <code>int</code> <code>1</code> Number of retry attempts <code>custom_headers</code> <code>dict</code> <code>{}</code> Custom HTTP headers to inject <code>streaming</code> <code>bool</code> <code>False</code> Enable streaming capabilities <code>auth_required</code> <code>bool</code> <code>False</code> Require authentication <code>session_required</code> <code>bool</code> <code>False</code> Enable session affinity <code>stateful</code> <code>bool</code> <code>False</code> Mark as stateful capability <code>auto_session_management</code> <code>bool</code> <code>False</code> Enable automatic session handling"},{"location":"mesh-decorators/#timeout-configuration","title":"Timeout Configuration","text":"<p>Configure different timeouts for different types of operations:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"quick_lookup\",\n    timeout=5,  # Fast operations: 5 seconds\n    retry_count=2\n)\ndef quick_data_lookup(query: str) -&gt; dict:\n    \"\"\"Fast lookup with 5s timeout, 2 retries.\"\"\"\n    return {\"result\": f\"Quick result for {query}\"}\n\n@app.tool()\n@mesh.tool(\n    capability=\"heavy_computation\",\n    timeout=300,  # Heavy operations: 5 minutes\n    retry_count=1\n)\ndef complex_calculation(data: list) -&gt; dict:\n    \"\"\"Heavy computation with 5-minute timeout.\"\"\"\n    return {\"processed\": len(data), \"result\": \"computed\"}\n</code></pre>"},{"location":"mesh-decorators/#custom-headers-for-service-identification","title":"Custom Headers for Service Identification","text":"<p>Add custom headers for debugging, routing, or service identification:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"database_service\",\n    timeout=60,\n    custom_headers={\n        \"X-Service-Type\": \"database\",\n        \"X-Priority\": \"high\",\n        \"X-Cache-Control\": \"no-cache\"\n    }\n)\ndef query_database(sql: str) -&gt; dict:\n    \"\"\"Database query with custom headers for routing and debugging.\"\"\"\n    return {\"rows\": 42, \"query\": sql}\n\n@app.tool()\n@mesh.tool(\n    capability=\"external_api\",\n    timeout=30,\n    retry_count=3,\n    custom_headers={\n        \"X-External-Service\": \"weather-api\",\n        \"X-Rate-Limit\": \"100/hour\"\n    }\n)\ndef fetch_weather_data(location: str) -&gt; dict:\n    \"\"\"External API call with rate limiting headers.\"\"\"\n    return {\"location\": location, \"temperature\": \"22\u00b0C\"}\n</code></pre>"},{"location":"mesh-decorators/#streaming-capabilities","title":"Streaming Capabilities","text":"<p>Enable streaming for real-time data processing:</p> <pre><code>from typing import AsyncGenerator\n\n@app.tool()\n@mesh.tool(\n    capability=\"data_stream\",\n    streaming=True,          # Enables streaming proxy\n    timeout=600,             # Longer timeout for streams\n    custom_headers={\n        \"X-Stream-Type\": \"data\",\n        \"X-Content-Type\": \"application/json\"\n    }\n)\nasync def stream_processing_results(\n    batch_size: int = 100\n) -&gt; AsyncGenerator[dict, None]:\n    \"\"\"Stream processing results with enhanced proxy configuration.\"\"\"\n    for i in range(0, 1000, batch_size):\n        yield {\n            \"batch\": i // batch_size,\n            \"processed_items\": batch_size,\n            \"timestamp\": \"2025-01-01T00:00:00Z\"\n        }\n        await asyncio.sleep(0.1)  # Simulate processing time\n</code></pre>"},{"location":"mesh-decorators/#authentication-requirements","title":"Authentication Requirements","text":"<p>Mark capabilities that require authentication:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"secure_data\",\n    auth_required=True,      # Requires authentication\n    timeout=60,\n    custom_headers={\n        \"X-Security-Level\": \"high\",\n        \"X-Auth-Required\": \"bearer\"\n    }\n)\ndef get_sensitive_data(data_type: str) -&gt; dict:\n    \"\"\"Access sensitive data - requires authentication.\"\"\"\n    return {\n        \"data_type\": data_type,\n        \"classified\": True,\n        \"access_level\": \"authorized\"\n    }\n</code></pre>"},{"location":"mesh-decorators/#session-management-stickiness","title":"Session Management &amp; Stickiness","text":"<p>Enable session affinity for stateful operations:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"user_session\",\n    session_required=True,           # Enable session affinity\n    stateful=True,                   # Mark as stateful\n    auto_session_management=True,    # Automatic session handling\n    timeout=30,\n    custom_headers={\n        \"X-Session-Enabled\": \"true\",\n        \"X-Stateful\": \"true\"\n    }\n)\ndef manage_user_session(\n    session_id: str,\n    action: str,\n    user_data: dict = None\n) -&gt; dict:\n    \"\"\"Session-aware operation with automatic session stickiness.\"\"\"\n    # Session data automatically routed to same pod\n    if not hasattr(manage_user_session, '_sessions'):\n        manage_user_session._sessions = {}\n\n    if action == \"create\":\n        manage_user_session._sessions[session_id] = user_data or {}\n    elif action == \"get\":\n        return manage_user_session._sessions.get(session_id, {})\n    elif action == \"update\":\n        if session_id in manage_user_session._sessions:\n            manage_user_session._sessions[session_id].update(user_data or {})\n\n    return {\n        \"session_id\": session_id,\n        \"action\": action,\n        \"data\": manage_user_session._sessions.get(session_id, {})\n    }\n</code></pre>"},{"location":"mesh-decorators/#complete-enhanced-example","title":"Complete Enhanced Example","text":"<p>Here's a comprehensive example showing all advanced features:</p> <pre><code>import asyncio\nfrom datetime import datetime\nfrom typing import AsyncGenerator\nimport mesh\nfrom fastmcp import FastMCP\n\napp = FastMCP(\"Enhanced Service\")\n\n@app.tool()\n@mesh.tool(\n    capability=\"enhanced_processor\",\n    dependencies=[\"auth_service\", \"session_manager\"],\n    tags=[\"processing\", \"enhanced\", \"production\"],\n    version=\"2.0.0\",\n    # Enhanced proxy configuration\n    timeout=120,                     # 2-minute timeout\n    retry_count=3,                   # 3 retry attempts\n    streaming=True,                  # Enable streaming\n    auth_required=True,              # Require authentication\n    session_required=True,           # Enable session affinity\n    stateful=True,                   # Mark as stateful\n    auto_session_management=True,    # Automatic session handling\n    custom_headers={\n        \"X-Service-Type\": \"enhanced-processor\",\n        \"X-Processing-Level\": \"advanced\",\n        \"X-Stream-Enabled\": \"true\",\n        \"X-Auth-Required\": \"bearer\",\n        \"X-Session-Managed\": \"auto\"\n    }\n)\nasync def enhanced_data_processor(\n    session_id: str,\n    data_batch: list,\n    processing_type: str = \"standard\",\n    # Injected dependencies\n    auth_service: mesh.McpMeshTool = None,\n    session_manager: mesh.McpMeshTool = None\n) -&gt; AsyncGenerator[dict, None]:\n    \"\"\"\n    Enhanced data processor with full advanced configuration.\n\n    Features:\n    - 120s timeout with 3 retries\n    - Authentication verification\n    - Session affinity for stateful processing\n    - Streaming results with custom headers\n    - Dependency injection for auth and session services\n    \"\"\"\n\n    # Verify authentication\n    if auth_service:\n        auth_result = auth_service({\"session_id\": session_id})\n        if not auth_result.get(\"authenticated\"):\n            yield {\"error\": \"Authentication failed\"}\n            return\n\n    # Initialize session data\n    if session_manager:\n        session_manager({\n            \"action\": \"initialize\",\n            \"session_id\": session_id,\n            \"processing_type\": processing_type\n        })\n\n    # Stream processing results\n    total_items = len(data_batch)\n    for i, item in enumerate(data_batch):\n        # Simulate processing time\n        await asyncio.sleep(0.1)\n\n        yield {\n            \"session_id\": session_id,\n            \"item_index\": i,\n            \"item_data\": item,\n            \"processing_type\": processing_type,\n            \"progress\": (i + 1) / total_items,\n            \"timestamp\": datetime.now().isoformat(),\n            \"enhanced\": True,\n            \"authenticated\": True,\n            \"session_managed\": True\n        }\n\n    # Final result\n    yield {\n        \"session_id\": session_id,\n        \"status\": \"completed\",\n        \"total_processed\": total_items,\n        \"processing_type\": processing_type,\n        \"timestamp\": datetime.now().isoformat()\n    }\n</code></pre>"},{"location":"mesh-decorators/#unified-proxy-system","title":"Unified Proxy System","text":"<p>Unified Proxy: MCP Mesh uses <code>EnhancedUnifiedMCPProxy</code> for all cross-agent calls, automatically configured from kwargs:</p> <ul> <li>Same agent \u2192 <code>SelfDependencyProxy</code> (direct call, no network overhead)</li> <li>Cross-agent \u2192 <code>EnhancedUnifiedMCPProxy</code> (auto-configured from kwargs)</li> </ul> <pre><code>@app.tool()\n@mesh.tool(capability=\"basic\", timeout=60, retry_count=3)\ndef basic_operation(): pass\n# \u2192 EnhancedUnifiedMCPProxy with 60s timeout and 3 retries\n\n@app.tool()\n@mesh.tool(capability=\"simple\")\ndef simple_operation(): pass\n# \u2192 EnhancedUnifiedMCPProxy with default configuration\n</code></pre>"},{"location":"mesh-decorators/#meshagent-agent-level-configuration","title":"@mesh.agent - Agent-Level Configuration","text":"<p>The <code>@mesh.agent</code> decorator configures the entire agent with server settings and lifecycle management.</p>"},{"location":"mesh-decorators/#parameters_1","title":"Parameters","text":"Parameter Type Default Description <code>name</code> <code>str</code> Required Agent name (mandatory!) <code>version</code> <code>str</code> <code>\"1.0.0\"</code> Agent version <code>description</code> <code>str \\| None</code> <code>None</code> Agent description <code>http_host</code> <code>str \\| None</code> <code>None</code> HTTP server host (auto-resolved) <code>http_port</code> <code>int</code> <code>0</code> HTTP server port (0 = auto-assign) <code>enable_http</code> <code>bool</code> <code>True</code> Enable HTTP endpoints <code>namespace</code> <code>str</code> <code>\"default\"</code> Agent namespace <code>health_interval</code> <code>int</code> <code>30</code> Health check interval (seconds) <code>auto_run</code> <code>bool</code> <code>True</code> Auto-start and keep alive <code>auto_run_interval</code> <code>int</code> <code>10</code> Keep-alive heartbeat (seconds) <code>**kwargs</code> <code>Any</code> - Additional agent metadata"},{"location":"mesh-decorators/#complete-agent-example","title":"Complete Agent Example","text":"<pre><code>import mesh\nfrom fastmcp import FastMCP\n\napp = FastMCP(\"Weather Service\")\n\n# Tools with mesh decorators\n@app.tool()\n@mesh.tool(\n    capability=\"current_weather\",\n    tags=[\"weather\", \"current\"],\n    version=\"1.2.0\",\n    dependencies=[\"location_service\"]\n)\nasync def get_current_weather(location_service: mesh.McpMeshTool = None):\n    location = await location_service() if location_service else \"Unknown\"\n    return f\"Current weather in {location}: 22\u00b0C, Sunny\"\n\n@app.prompt()\n@mesh.tool(\n    capability=\"weather_prompt\",\n    tags=[\"weather\", \"ai\"],\n    dependencies=[\"current_weather\"]\n)\nasync def weather_analysis_prompt(current_weather: mesh.McpMeshTool = None):\n    weather = await current_weather() if current_weather else \"No data\"\n    return f\"Analyze this weather: {weather}\"\n\n@app.resource(\"weather://config/{city}\")\n@mesh.tool(\n    capability=\"weather_config\",\n    tags=[\"weather\", \"config\"]\n)\nasync def weather_config(city: str):\n    return f\"Weather config for {city}: API enabled\"\n\n# Agent configuration\n@mesh.agent(\n    name=\"weather-service\",              # Required!\n    version=\"2.0.0\",\n    description=\"Advanced weather service with mesh integration\",\n    http_host=\"0.0.0.0\",                # Listen on all interfaces\n    http_port=9091,                     # Specific port\n    enable_http=True,\n    namespace=\"production\",\n    health_interval=60,                 # Health check every minute\n    auto_run=True,                      # Zero boilerplate!\n    auto_run_interval=15                # Heartbeat every 15 seconds\n)\nclass WeatherServiceAgent:\n    \"\"\"\n    Weather service agent demonstrating all mesh features.\n\n    Mesh automatically:\n    - Discovers the 'app' FastMCP instance\n    - Registers all @mesh.tool capabilities\n    - Starts HTTP server on configured port\n    - Manages health checks and keep-alive\n    - Handles dependency injection\n    \"\"\"\n    pass\n\n# No main method needed! Mesh handles everything.\n</code></pre>"},{"location":"mesh-decorators/#environment-variable-overrides","title":"Environment Variable Overrides","text":"<p>All agent parameters can be overridden with environment variables:</p> <pre><code># Override agent configuration\nexport MCP_MESH_HTTP_HOST=\"127.0.0.1\"\nexport MCP_MESH_HTTP_PORT=\"8080\"\nexport MCP_MESH_HTTP_ENABLED=\"true\"\nexport MCP_MESH_NAMESPACE=\"development\"\nexport MCP_MESH_HEALTH_INTERVAL=\"30\"\nexport MCP_MESH_AUTO_RUN=\"true\"\nexport MCP_MESH_AUTO_RUN_INTERVAL=\"10\"\nexport MCP_MESH_AGENT_NAME=\"custom-agent-name\"\n\n# Start agent (uses environment overrides)\npython my_agent.py\n</code></pre>"},{"location":"mesh-decorators/#advanced-patterns","title":"Advanced Patterns","text":""},{"location":"mesh-decorators/#self-dependencies","title":"Self-Dependencies","text":"<p>Agents can depend on their own capabilities:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"timestamp\",\n    tags=[\"time\", \"internal\"]\n)\ndef get_timestamp():\n    return datetime.now().isoformat()\n\n@app.tool()\n@mesh.tool(\n    capability=\"logged_greeting\",\n    dependencies=[\"timestamp\"],  # Self-dependency!\n    tags=[\"greeting\", \"logged\"]\n)\ndef hello_with_log(\n    name: str,\n    timestamp: mesh.McpMeshTool = None\n) -&gt; str:\n    time = timestamp() if timestamp else \"unknown\"\n    greeting = f\"Hello {name}!\"\n    print(f\"[{time}] Generated greeting: {greeting}\")\n    return greeting\n</code></pre>"},{"location":"mesh-decorators/#namespace-isolation","title":"Namespace Isolation","text":"<p>Use namespaces to isolate environments:</p> <pre><code>@mesh.agent(\n    name=\"api-service\",\n    namespace=\"development\",  # Development namespace\n    http_port=8080\n)\nclass DevApiService:\n    pass\n\n@mesh.agent(\n    name=\"api-service\",\n    namespace=\"production\",   # Production namespace\n    http_port=9080\n)\nclass ProdApiService:\n    pass\n</code></pre>"},{"location":"mesh-decorators/#complex-dependency-chains","title":"Complex Dependency Chains","text":"<pre><code># Base service\n@app.tool()\n@mesh.tool(capability=\"database\", tags=[\"storage\", \"primary\"])\ndef connect_database():\n    return \"database_connection\"\n\n# Middle layer\n@app.tool()\n@mesh.tool(\n    capability=\"data_access\",\n    dependencies=[\"database\"],\n    tags=[\"data\", \"layer\"]\n)\nasync def access_data(database: mesh.McpMeshTool = None):\n    db = await database() if database else None\n    return f\"data_from_{db}\"\n\n# Top layer\n@app.tool()\n@mesh.tool(\n    capability=\"business_logic\",\n    dependencies=[\n        \"data_access\",\n        {\n            \"capability\": \"cache\",\n            \"tags\": [\"performance\", \"redis\"]\n        }\n    ],\n    tags=[\"business\", \"api\"]\n)\nasync def process_business_logic(\n    data_access: mesh.McpMeshTool = None,\n    cache: mesh.McpMeshTool = None\n):\n    data = await data_access() if data_access else \"no_data\"\n    cached = await cache() if cache else \"no_cache\"\n    return f\"processed_{data}_with_{cached}\"\n</code></pre>"},{"location":"mesh-decorators/#dependency-injection-types","title":"Dependency Injection Types","text":"<p>MCP Mesh provides <code>mesh.McpMeshTool</code> as the proxy type for all dependency injection. This type handles both simple tool calls and advanced MCP protocol operations.</p>"},{"location":"mesh-decorators/#mcpmeshtool-the-universal-proxy","title":"McpMeshTool - The Universal Proxy","text":"<p>Use <code>mesh.McpMeshTool</code> for all injected dependencies:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"processor\",\n    dependencies=[\"service1\", \"service2\"]\n)\nasync def process_data(\n    service1: mesh.McpMeshTool = None,\n    service2: mesh.McpMeshTool = None,\n) -&gt; dict:\n    \"\"\"Process data using injected dependencies.\"\"\"\n\n    # Direct function call - proxy knows which remote function to invoke\n    result1 = await service1() if service1 else {}\n\n    # With arguments\n    result2 = await service1(format=\"JSON\") if service1 else {}\n\n    # Keyword arguments\n    result3 = await service2(param=\"value\", other=\"data\") if service2 else {}\n\n    return {\"result1\": result1, \"result2\": result2, \"result3\": result3}\n</code></pre> <p>Key Features of McpMeshTool:</p> <ul> <li>\u2705 Function-to-function binding (no need to specify function names)</li> <li>\u2705 Simple async call syntax: <code>await service(args)</code></li> <li>\u2705 Transparent MCP protocol communication</li> <li>\u2705 Automatic retry and error handling</li> <li>\u2705 Type-safe with IDE support</li> </ul>"},{"location":"mesh-decorators/#example-multi-dependency-pipeline","title":"Example: Multi-Dependency Pipeline","text":"<pre><code>@app.tool()\n@mesh.tool(\n    capability=\"data_pipeline\",\n    dependencies=[\"validator\", \"transformer\", \"storage\"],\n)\nasync def process_pipeline(\n    data: dict,\n    validator: mesh.McpMeshTool = None,\n    transformer: mesh.McpMeshTool = None,\n    storage: mesh.McpMeshTool = None,\n) -&gt; dict:\n    \"\"\"Multi-step data processing pipeline.\"\"\"\n\n    # Step 1: Validate\n    validation = await validator(data=data) if validator else {\"valid\": True}\n    if not validation.get(\"valid\"):\n        return {\"error\": \"Validation failed\"}\n\n    # Step 2: Transform\n    transformed = await transformer(\n        data=data,\n        format=\"normalized\",\n    ) if transformer else data\n\n    # Step 3: Store\n    result = await storage(\n        data=transformed,\n        collection=\"processed\",\n    ) if storage else {\"stored\": False}\n\n    return {\n        \"status\": \"completed\",\n        \"stored\": result.get(\"stored\", False),\n    }\n</code></pre>"},{"location":"mesh-decorators/#meshllm-llm-agent-injection","title":"@mesh.llm - LLM Agent Injection","text":"<p>New in v0.7: Inject LLM agents as dependencies with automatic tool discovery and type-safe prompt templates</p> <p>The <code>@mesh.llm</code> decorator enables LLM integration as first-class mesh capabilities, treating LLMs as injectable dependencies like any other agent.</p>"},{"location":"mesh-decorators/#parameters_2","title":"Parameters","text":"Parameter Type Default Description <code>system_prompt</code> <code>str</code> <code>None</code> Literal prompt or <code>file://path/to/template.jinja2</code> <code>filter</code> <code>dict</code> <code>None</code> Tool discovery filter (capability, tags, version) <code>provider</code> <code>str</code> <code>\"claude\"</code> LLM provider (claude, openai, etc.) <code>model</code> <code>str</code> Required Model identifier <code>context_param</code> <code>str</code> <code>None</code> Parameter name containing template context <code>max_iterations</code> <code>int</code> <code>5</code> Max agentic loop iterations"},{"location":"mesh-decorators/#decorator-order-with-llm","title":"Decorator Order with LLM","text":"<p>\u26a0\ufe0f IMPORTANT: LLM decorator order follows the same pattern - mesh decorators come after MCP decorators:</p> <pre><code># \u2705 CORRECT ORDER\n@app.tool()           # \u2190 FastMCP decorator FIRST\n@mesh.llm(            # \u2190 LLM decorator SECOND\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(           # \u2190 Mesh tool decorator THIRD\n    capability=\"chat\"\n)\nasync def chat_function(message: str, llm: mesh.MeshLlmAgent = None):\n    return await llm(message)\n\n# \u274c WRONG ORDER\n@mesh.llm(provider=\"claude\", model=\"anthropic/claude-sonnet-4-5\")  # Wrong\n@app.tool()                                                        # Wrong\n@mesh.tool(capability=\"chat\")                                      # Wrong\nasync def broken_function(message: str, llm=None):\n    pass\n</code></pre>"},{"location":"mesh-decorators/#simple-llm-injection","title":"Simple LLM Injection","text":"<pre><code>import mesh\nfrom fastmcp import FastMCP\n\napp = FastMCP(\"Chat Service\")\n\n@app.tool()\n@mesh.llm(\n    system_prompt=\"You are a helpful assistant.\",\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"chat\")\nasync def chat(message: str, llm: mesh.MeshLlmAgent = None) -&gt; str:\n    \"\"\"LLM agent auto-injected with configured system prompt.\"\"\"\n    if llm is None:\n        return \"LLM service unavailable\"\n    return await llm(message)\n</code></pre>"},{"location":"mesh-decorators/#llm-with-tool-discovery-filter","title":"LLM with Tool Discovery Filter","text":"<pre><code>@app.tool()\n@mesh.llm(\n    system_prompt=\"You are a system administrator with monitoring tools.\",\n    filter={\"tags\": [\"system\", \"monitoring\"]},  # Auto-discover tools\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"system_admin\")\nasync def admin_assistant(task: str, llm: mesh.MeshLlmAgent = None):\n    \"\"\"LLM automatically gets access to all system monitoring tools.\"\"\"\n    return await llm(task)\n</code></pre>"},{"location":"mesh-decorators/#type-safe-prompt-templates","title":"Type-Safe Prompt Templates","text":"<p>Use <code>file://</code> prefix to load Jinja2 templates with type-safe context models:</p> <pre><code>from mesh import MeshContextModel\nfrom pydantic import BaseModel, Field\n\nclass AnalysisContext(MeshContextModel):\n    \"\"\"Type-safe context for analysis prompts.\"\"\"\n    domain: str = Field(\n        ...,\n        description=\"Analysis domain: infrastructure, security, or performance\"\n    )\n    user_level: str = Field(\n        default=\"beginner\",\n        description=\"User expertise: beginner, intermediate, expert\"\n    )\n    focus_areas: list[str] = Field(\n        default_factory=list,\n        description=\"Specific areas to analyze\"\n    )\n\n@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/analyst.jinja2\",  # Load from file\n    context_param=\"ctx\",  # Which parameter contains context\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"analysis\")\nasync def analyze_system(\n    query: str,\n    ctx: AnalysisContext,  # Type-safe, validated context\n    llm: mesh.MeshLlmAgent = None\n) -&gt; dict:\n    \"\"\"Template auto-rendered with ctx before LLM call.\"\"\"\n    if llm is None:\n        return {\"error\": \"LLM unavailable\"}\n    return await llm(query)\n</code></pre> <p>Template file (<code>prompts/analyst.jinja2</code>):</p> <pre><code>You are a {{ domain }} analysis expert.\nUser expertise level: {{ user_level }}\n\n{% if focus_areas %}\nFocus your analysis on: {{ focus_areas | join(\", \") }}\n{% endif %}\n\nProvide detailed analysis appropriate for {{ user_level }}-level users.\nUse your monitoring tools when needed.\n</code></pre>"},{"location":"mesh-decorators/#dual-injection-llm-mcp-agent","title":"Dual Injection: LLM + MCP Agent","text":"<p>Breakthrough feature: Inject both LLM agents AND MCP agents into the same function:</p> <pre><code>from pydantic import BaseModel\n\nclass EnrichedResult(BaseModel):\n    \"\"\"LLM result enriched with MCP agent data.\"\"\"\n    analysis: str\n    recommendations: list[str]\n    timestamp: str\n    system_info: str\n\n@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/dual_injection.jinja2\",\n    filter={\"tags\": [\"system\"]},  # LLM gets system tools via filter\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(\n    capability=\"enriched_analysis\",\n    dependencies=[{\n        \"capability\": \"date_service\",\n        \"tags\": [\"system\", \"time\"]\n    }]  # Direct MCP agent dependency\n)\nasync def analyze_with_enrichment(\n    query: str,\n    llm: mesh.MeshLlmAgent = None,        # \u2190 Injected LLM agent\n    date_service: mesh.McpMeshTool = None  # \u2190 Injected MCP agent\n) -&gt; EnrichedResult:\n    \"\"\"\n    Demonstrates dual injection pattern.\n\n    - LLM: Intelligent analysis with filtered tool access\n    - MCP agent: Direct capability calls for enrichment\n    - Both orchestrated in one function, zero boilerplate\n    \"\"\"\n    if llm is None:\n        return EnrichedResult(\n            analysis=\"LLM unavailable\",\n            recommendations=[],\n            timestamp=\"N/A\",\n            system_info=\"N/A\"\n        )\n\n    # Step 1: Get LLM analysis (LLM has access to system tools)\n    llm_result = await llm(query)\n\n    # Step 2: Call MCP agent directly for enrichment data\n    timestamp = await date_service() if date_service else \"N/A\"\n\n    # Step 3: Combine both results\n    return EnrichedResult(\n        analysis=llm_result.analysis,\n        recommendations=llm_result.recommendations,\n        timestamp=timestamp,\n        system_info=\"Analysis enriched with real-time data\"\n    )\n</code></pre>"},{"location":"mesh-decorators/#meshcontextmodel-for-validation","title":"MeshContextModel for Validation","text":"<p><code>MeshContextModel</code> provides Pydantic-based validation with IDE support:</p> <pre><code>from mesh import MeshContextModel\n\nclass ChatContext(MeshContextModel):\n    \"\"\"Type-safe context with validation.\"\"\"\n    user_name: str = Field(..., description=\"User's display name\")\n    domain: str = Field(..., description=\"Conversation domain\")\n    expertise_level: str = Field(default=\"beginner\")\n\n@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/chat.jinja2\",\n    context_param=\"ctx\",\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"personalized_chat\")\nasync def chat(\n    message: str,\n    ctx: ChatContext,  # Validated at runtime\n    llm: mesh.MeshLlmAgent = None\n):\n    # ctx guaranteed to have user_name, domain, expertise_level\n    return await llm(message)\n\n# Usage with validation\nchat(\n    \"Hello!\",\n    ctx=ChatContext(\n        user_name=\"Alice\",\n        domain=\"technical\",\n        expertise_level=\"expert\"\n    )\n)\n</code></pre>"},{"location":"mesh-decorators/#enhanced-schemas-for-llm-chains","title":"Enhanced Schemas for LLM Chains","text":"<p>When orchestrator LLMs call specialist LLMs, Field descriptions are automatically extracted into tool schemas:</p> <pre><code># Specialist LLM with enhanced schema\nclass SpecialistContext(MeshContextModel):\n    domain: str = Field(\n        ...,\n        description=\"Analysis domain: infrastructure, security, or performance\"\n    )\n    user_level: str = Field(\n        default=\"beginner\",\n        description=\"User expertise: beginner, intermediate, expert\"\n    )\n\n@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/specialist.jinja2\",\n    context_param=\"ctx\",\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"specialist_analysis\", tags=[\"llm\", \"specialist\"])\nasync def specialist_analyze(\n    request: str,\n    ctx: SpecialistContext,\n    llm: mesh.MeshLlmAgent = None\n):\n    return await llm(request)\n\n# Orchestrator LLM discovers specialist with enhanced schema\n@app.tool()\n@mesh.llm(\n    system_prompt=\"You coordinate analysis tasks across specialists.\",\n    filter={\"capability\": \"specialist_analysis\"},  # Discovers specialist\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"orchestrator\")\nasync def orchestrate_analysis(task: str, llm: mesh.MeshLlmAgent = None):\n    \"\"\"\n    Orchestrator LLM receives enhanced schema with Field descriptions.\n\n    Knows that domain is \"infrastructure|security|performance\"\n    Knows that user_level is \"beginner|intermediate|expert\"\n\n    This dramatically improves success rate when constructing contexts!\n    \"\"\"\n    return await llm(task)\n</code></pre> <p>The orchestrator receives:</p> <pre><code>{\n  \"name\": \"specialist_analyze\",\n  \"inputSchema\": {\n    \"properties\": {\n      \"ctx\": {\n        \"properties\": {\n          \"domain\": {\n            \"type\": \"string\",\n            \"description\": \"Analysis domain: infrastructure, security, or performance\"\n          },\n          \"user_level\": {\n            \"type\": \"string\",\n            \"default\": \"beginner\",\n            \"description\": \"User expertise: beginner, intermediate, expert\"\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"mesh-decorators/#llm-filter-patterns","title":"LLM Filter Patterns","text":"<p>Common filter patterns for tool discovery:</p> <pre><code># 1. Filter by tags (most common)\n@mesh.llm(filter={\"tags\": [\"system\", \"monitoring\"]})\n\n# 2. Filter by capability\n@mesh.llm(filter={\"capability\": \"weather_service\"})\n\n# 3. Combine capability + tags\n@mesh.llm(filter={\n    \"capability\": \"database\",\n    \"tags\": [\"production\", \"primary\"]\n})\n\n# 4. Filter with version constraints\n@mesh.llm(filter={\n    \"capability\": \"api_service\",\n    \"version\": \"&gt;=2.0.0\",\n    \"tags\": [\"rest\", \"v2\"]\n})\n\n# 5. No filter - LLM has no tools\n@mesh.llm()  # Pure chat, no tool access\n</code></pre>"},{"location":"mesh-decorators/#template-context-detection","title":"Template Context Detection","text":"<p>MCP Mesh auto-detects context parameters in three ways:</p> <pre><code># 1. Explicit (recommended)\n@mesh.llm(\n    system_prompt=\"file://prompts/chat.jinja2\",\n    context_param=\"my_context\"  # Explicitly named\n)\ndef chat(msg: str, my_context: dict, llm=None): ...\n\n# 2. Convention (auto-detected)\n@mesh.llm(system_prompt=\"file://prompts/chat.jinja2\")\ndef chat(msg: str, ctx: dict, llm=None): ...  # \"ctx\" detected\n\n@mesh.llm(system_prompt=\"file://prompts/chat.jinja2\")\ndef chat(msg: str, prompt_context: dict, llm=None): ...  # \"prompt_context\" detected\n\n# 3. Type hint (auto-detected)\n@mesh.llm(system_prompt=\"file://prompts/chat.jinja2\")\ndef chat(msg: str, analysis_ctx: AnalysisContext, llm=None): ...\n# \u2191 MeshContextModel subclass detected\n</code></pre>"},{"location":"mesh-decorators/#template-features","title":"Template Features","text":"<p>Full Jinja2 support:</p> <pre><code>{# Variables #}\nHello {{ user_name }}!\n\n{# Conditionals #}\n{% if expertise_level == \"expert\" %}\n  Technical mode enabled.\n{% else %}\n  Beginner-friendly mode.\n{% endif %}\n\n{# Loops #}\nFocus areas:\n{% for area in focus_areas %}\n  - {{ area }}\n{% endfor %}\n\n{# Filters #}\n{{ capabilities | join(\", \") }}\n{{ task_type | upper }}\n\n{# Defaults #}\n{{ optional_field | default(\"N/A\") }}\n</code></pre>"},{"location":"mesh-decorators/#llm-best-practices","title":"LLM Best Practices","text":""},{"location":"mesh-decorators/#do","title":"\u2705 DO:","text":"<pre><code># Use type-safe contexts\nclass AnalysisContext(MeshContextModel):\n    domain: str = Field(..., description=\"Clear description for LLMs\")\n\n# Add Field descriptions for LLM chains\nField(..., description=\"infrastructure|security|performance\")\n\n# Check for None\nif llm is None:\n    return default_response\n\n# Use filters for dynamic tool discovery\n@mesh.llm(filter={\"tags\": [\"system\"]})\n\n# Version templates separately\nsystem_prompt=\"file://prompts/analyst_v2.jinja2\"\n</code></pre>"},{"location":"mesh-decorators/#dont","title":"\u274c DON'T:","text":"<pre><code># Don't hardcode prompts in code\nsystem_prompt=\"You are an assistant. Do this. Do that. Do everything...\"\n\n# Don't skip Field descriptions\ndomain: str  # No description for LLMs\n\n# Don't forget None checks\nreturn llm(message)  # Crashes if llm is None\n\n# Don't manually list tools in prompts\nsystem_prompt=\"You have get_cpu, get_memory, get_disk...\"  # Use filters!\n\n# Don't use dict contexts without validation\nctx: dict  # Use MeshContextModel instead\n</code></pre>"},{"location":"mesh-decorators/#environment-variables","title":"Environment Variables","text":"<p>LLM configuration via environment variables:</p> <pre><code># Provider API keys\nexport ANTHROPIC_API_KEY=\"your-claude-key\"\nexport OPENAI_API_KEY=\"your-openai-key\"\n\n# Override provider/model at runtime\nexport MCP_MESH_LLM_PROVIDER=\"openai\"\nexport MCP_MESH_LLM_MODEL=\"gpt-4\"\n\n# Template settings\nexport MCP_MESH_TEMPLATE_DIR=\"/custom/prompts\"\nexport MCP_MESH_TEMPLATE_CACHE_ENABLED=\"true\"\n</code></pre>"},{"location":"mesh-decorators/#complete-llm-example","title":"Complete LLM Example","text":"<pre><code>import mesh\nfrom fastmcp import FastMCP\nfrom mesh import MeshContextModel\nfrom pydantic import BaseModel, Field\n\napp = FastMCP(\"LLM Service\")\n\n# 1. Define contexts\nclass DocumentContext(MeshContextModel):\n    doc_type: str = Field(..., description=\"Document type: technical, business, legal\")\n    audience: str = Field(..., description=\"Target audience: engineer, executive, lawyer\")\n\n# 2. Specialist LLM\n@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/doc_analyzer.jinja2\",\n    context_param=\"ctx\",\n    filter={\"tags\": [\"document\"]},\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"doc_analysis\", tags=[\"llm\", \"specialist\"])\nasync def analyze_doc(doc: str, ctx: DocumentContext, llm: mesh.MeshLlmAgent = None):\n    if llm is None:\n        return {\"error\": \"LLM unavailable\"}\n    return await llm(doc)\n\n# 3. Orchestrator LLM\n@app.tool()\n@mesh.llm(\n    system_prompt=\"You orchestrate document workflows.\",\n    filter={\"capability\": \"doc_analysis\"},\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"doc_orchestrator\")\nasync def orchestrate(task: str, llm: mesh.MeshLlmAgent = None):\n    if llm is None:\n        return {\"error\": \"LLM unavailable\"}\n    return await llm(task)\n\n# 4. Dual injection (LLM + MCP)\n@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/enriched.jinja2\",\n    filter={\"tags\": [\"system\"]},\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(\n    capability=\"enriched_analysis\",\n    dependencies=[{\"capability\": \"date_service\"}]\n)\nasync def enriched_analyze(\n    query: str,\n    llm: mesh.MeshLlmAgent = None,\n    date_service: mesh.McpMeshTool = None\n):\n    if llm is None:\n        return {\"error\": \"LLM unavailable\"}\n\n    llm_result = await llm(query)\n    timestamp = await date_service() if date_service else \"N/A\"\n\n    return {\n        **llm_result,\n        \"timestamp\": timestamp,\n        \"enriched\": True\n    }\n\n# 5. Agent configuration\n@mesh.agent(\n    name=\"llm-service\",\n    version=\"1.0.0\",\n    http_port=8080,\n    enable_http=True,\n    auto_run=True\n)\nclass LlmServiceAgent:\n    pass\n</code></pre> <p>For complete LLM integration guide, see LLM Integration Tutorial.</p>"},{"location":"mesh-decorators/#testing-your-decorators","title":"Testing Your Decorators","text":""},{"location":"mesh-decorators/#check-service-registration","title":"Check Service Registration","text":"<pre><code># Verify capabilities are registered\ncurl -s http://localhost:8000/agents | \\\n  jq '.agents[] | {name: .name, capabilities: (.capabilities | keys)}'\n</code></pre>"},{"location":"mesh-decorators/#test-individual-capabilities","title":"Test Individual Capabilities","text":"<pre><code># Test a specific tool\ncurl -s -X POST http://localhost:9091/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": 1,\n    \"method\": \"tools/call\",\n    \"params\": {\n      \"name\": \"get_current_weather\",\n      \"arguments\": {}\n    }\n  }' | jq '.result'\n</code></pre>"},{"location":"mesh-decorators/#verify-dependency-injection","title":"Verify Dependency Injection","text":"<pre><code># Check if dependencies are resolved\ncurl -s http://localhost:8000/agents | \\\n  jq '.agents[] | select(.name==\"weather-service\") | .capabilities'\n</code></pre>"},{"location":"mesh-decorators/#common-patterns-and-best-practices","title":"Common Patterns and Best Practices","text":""},{"location":"mesh-decorators/#1-always-check-dependencies","title":"1. Always Check Dependencies","text":"<pre><code>@app.tool()\n@mesh.tool(\n    capability=\"safe_processor\",\n    dependencies=[\"external_service\"]\n)\nasync def process_safely(external_service: mesh.McpMeshTool = None):\n    if external_service is None:\n        return {\"status\": \"degraded\", \"reason\": \"external_service_unavailable\"}\n\n    try:\n        result = await external_service()\n        return {\"status\": \"success\", \"data\": result}\n    except Exception as e:\n        return {\"status\": \"error\", \"error\": str(e)}\n</code></pre>"},{"location":"mesh-decorators/#2-use-descriptive-tags","title":"2. Use Descriptive Tags","text":"<pre><code>@mesh.tool(\n    capability=\"user_service\",\n    tags=[\"users\", \"authentication\", \"api\", \"v2\"],  # Descriptive tags\n    version=\"2.1.0\"\n)\n</code></pre>"},{"location":"mesh-decorators/#3-version-your-capabilities","title":"3. Version Your Capabilities","text":"<pre><code>@mesh.tool(\n    capability=\"data_processor\",\n    version=\"3.2.1\",  # Semantic versioning\n    dependencies=[\n        {\n            \"capability\": \"database\",\n            \"version\": \"&gt;=4.0.0\"  # Ensure compatibility\n        }\n    ]\n)\n</code></pre>"},{"location":"mesh-decorators/#4-organize-by-namespace","title":"4. Organize by Namespace","text":"<pre><code># Different environments\n@mesh.agent(name=\"service\", namespace=\"development\")\n@mesh.agent(name=\"service\", namespace=\"staging\")\n@mesh.agent(name=\"service\", namespace=\"production\")\n</code></pre>"},{"location":"mesh-decorators/#troubleshooting","title":"Troubleshooting","text":""},{"location":"mesh-decorators/#decorator-order-issues","title":"Decorator Order Issues","text":"<pre><code># Error: Mesh decorator applied before MCP decorator\nTypeError: mesh.tool() can only be applied to functions already decorated with MCP decorators\n</code></pre> <p>Solution: Always put <code>@mesh.tool</code> after <code>@app.tool</code>.</p>"},{"location":"mesh-decorators/#dependency-not-found","title":"Dependency Not Found","text":"<pre><code># Check what capabilities are available\ncurl -s http://localhost:8000/agents | jq '.agents[].capabilities | keys'\n\n# Check specific capability tags\ncurl -s http://localhost:8000/agents | jq '.agents[] | select(.capabilities.your_capability)'\n</code></pre>"},{"location":"mesh-decorators/#version-constraint-errors","title":"Version Constraint Errors","text":"<p>Make sure version strings are valid semantic versions:</p> <ul> <li>\u2705 <code>\"1.0.0\"</code>, <code>\"&gt;=2.1.0\"</code>, <code>\"~1.5.0\"</code></li> <li>\u274c <code>\"v1.0\"</code>, <code>\"latest\"</code>, <code>\"1\"</code></li> </ul>"},{"location":"mesh-decorators/#agent-name-required","title":"Agent Name Required","text":"<pre><code># \u274c This will fail\n@mesh.agent()  # Missing required 'name' parameter\n\n# \u2705 This works\n@mesh.agent(name=\"my-service\")\n</code></pre>"},{"location":"mesh-decorators/#next-steps","title":"Next Steps","text":"<p>Now that you understand mesh decorators, you can:</p> <ol> <li>Local Development - Professional development setup</li> <li>Production Deployment - Containerized deployments</li> <li>meshctl CLI - Command-line tools</li> </ol> <p>\ud83d\udca1 Key Insight: The decorator order requirement ensures mesh can properly wrap and enhance MCP functionality with dependency injection.</p> <p>\ud83c\udff7\ufe0f Pro Tip: Use specific tag combinations to enable precise service selection in complex environments.</p> <p>\ud83c\udfaf Best Practice: Always version your capabilities and use semantic version constraints for dependencies.</p>"},{"location":"meshctl-cli/","title":"meshctl CLI Reference","text":"<p>Essential commands for managing MCP Mesh agents with the meshctl CLI tool</p>"},{"location":"meshctl-cli/#overview","title":"Overview","text":"<p><code>meshctl</code> is the command-line interface for MCP Mesh that helps you start, monitor, and manage your agents. It automatically handles the registry, provides beautiful monitoring displays, and simplifies development workflows.</p>"},{"location":"meshctl-cli/#quick-start","title":"Quick Start","text":"<pre><code># Generate a new agent from template\nmeshctl scaffold --name my-agent --agent-type llm-agent\n\n# Start registry + agent in one command\nmeshctl start examples/hello_world.py\n\n# List running agents with beautiful table\nmeshctl list\n\n# Check detailed status\nmeshctl status --verbose\n</code></pre>"},{"location":"meshctl-cli/#essential-commands","title":"Essential Commands","text":""},{"location":"meshctl-cli/#1-scaffolding-new-agents","title":"1. Scaffolding New Agents","text":"<p>Generate new agents from templates with interactive or CLI-based configuration.</p> <pre><code># Interactive mode (recommended for beginners)\nmeshctl scaffold\n\n# Generate a basic tool agent\nmeshctl scaffold --name my-tool --agent-type tool\n\n# Generate an LLM-powered agent\nmeshctl scaffold --name my-llm-agent --agent-type llm-agent --llm-selector claude\n\n# Generate an LLM provider\nmeshctl scaffold --name claude-provider --agent-type llm-provider --model anthropic/claude-sonnet-4-5\n</code></pre> <p>\ud83d\udcd6 See Scaffold Command Reference for complete options and examples.</p>"},{"location":"meshctl-cli/#2-starting-services","title":"2. Starting Services","text":""},{"location":"meshctl-cli/#start-registry-only","title":"Start Registry Only","text":"<pre><code># Start just the registry (useful for development)\nmeshctl start --registry-only\n\n# Start registry on custom port\nmeshctl start --registry-only --registry-port 9000\n</code></pre>"},{"location":"meshctl-cli/#start-single-agent","title":"Start Single Agent","text":"<pre><code># Start agent (registry starts automatically if needed)\nmeshctl start my_agent.py\n\n# Start with custom configuration\nmeshctl start my_agent.py --debug --verbose\n</code></pre>"},{"location":"meshctl-cli/#start-multiple-agents","title":"Start Multiple Agents","text":"<pre><code># Start multiple agents at once\nmeshctl start agent1.py agent2.py agent3.py\n\n# Start with environment variables\nmeshctl start my_agent.py --env KEY=value --env DEBUG=true\n</code></pre>"},{"location":"meshctl-cli/#3-monitoring-and-status","title":"3. Monitoring and Status","text":""},{"location":"meshctl-cli/#list-all-agents","title":"List All Agents","text":"<pre><code># Beautiful table view (recommended)\nmeshctl list\n\n# Wide view with endpoints and tool counts\nmeshctl list --wide\n\n# Filter by name pattern\nmeshctl list --filter weather\n\n# Show only healthy agents\nmeshctl list\n</code></pre> <p>Example output:</p> <pre><code>AGENT NAME       STATUS    UPTIME     CAPABILITIES           DEPENDENCIES    ENDPOINT\nweather-service  healthy   2m 30s     weather_data,forecast  date_service   http://localhost:9091\nhello-world      healthy   1m 45s     greeting               date_service   http://localhost:9090\nsystem-agent     healthy   3m 12s     date_service,info      -              http://localhost:8080\n</code></pre>"},{"location":"meshctl-cli/#detailed-status","title":"Detailed Status","text":"<pre><code># Show overall mesh status\nmeshctl status\n\n# Verbose status with detailed information\nmeshctl status --verbose\n\n# JSON output for automation\nmeshctl status --json\n</code></pre>"},{"location":"meshctl-cli/#4-configuration-management","title":"4. Configuration Management","text":""},{"location":"meshctl-cli/#view-configuration","title":"View Configuration","text":"<pre><code># Show current configuration\nmeshctl config show\n\n# Show config file location\nmeshctl config path\n</code></pre>"},{"location":"meshctl-cli/#update-configuration","title":"Update Configuration","text":"<pre><code># Set registry port\nmeshctl config set registry_port 9090\n\n# Set log level\nmeshctl config set log_level DEBUG\n\n# Reset to defaults\nmeshctl config reset\n</code></pre>"},{"location":"meshctl-cli/#useful-development-flags","title":"Useful Development Flags","text":""},{"location":"meshctl-cli/#auto-restart-and-file-watching","title":"Auto-Restart and File Watching","text":"<pre><code># Auto-restart on file changes (default: enabled)\nmeshctl start my_agent.py --auto-restart\n\n# Custom file watch pattern\nmeshctl start my_agent.py --watch-pattern \"*.py,*.json\"\n\n# Disable file watching\nmeshctl start my_agent.py --watch-files=false\n</code></pre>"},{"location":"meshctl-cli/#debugging-and-logging","title":"Debugging and Logging","text":"<pre><code># Enable debug mode\nmeshctl start my_agent.py --debug\n\n# Set custom log level\nmeshctl start my_agent.py --log-level DEBUG\n\n# Verbose output\nmeshctl start my_agent.py --verbose\n\n# Quiet mode (errors only)\nmeshctl start my_agent.py --quiet\n</code></pre>"},{"location":"meshctl-cli/#custom-configuration","title":"Custom Configuration","text":"<pre><code># Custom database path\nmeshctl start --registry-only --db-path ./my_registry.db\n\n# Custom working directory\nmeshctl start my_agent.py --working-dir /path/to/project\n\n# Load environment file\nmeshctl start my_agent.py --env-file .env.development\n</code></pre>"},{"location":"meshctl-cli/#remote-registry-operations","title":"Remote Registry Operations","text":""},{"location":"meshctl-cli/#connect-to-remote-registry","title":"Connect to Remote Registry","text":"<pre><code># Connect to remote registry\nmeshctl list --registry-url http://production-registry:8000\n\n# Connect with custom host/port\nmeshctl list --registry-host prod.example.com --registry-port 9000\n\n# List agents from remote registry\nmeshctl list --registry-url https://secure-registry.example.com\n</code></pre>"},{"location":"meshctl-cli/#agent-registration","title":"Agent Registration","text":"<pre><code># Connect agent to external registry\nmeshctl start my_agent.py --registry-url http://remote-registry:8000 --connect-only\n</code></pre>"},{"location":"meshctl-cli/#process-management","title":"Process Management","text":""},{"location":"meshctl-cli/#detached-mode","title":"Detached Mode","text":"<pre><code># Run in background (detached)\nmeshctl start my_agent.py --detach\n\n# Custom PID file\nmeshctl start my_agent.py --detach --pid-file ./my_agent.pid\n\n# Check status of detached services\nmeshctl status\n</code></pre>"},{"location":"meshctl-cli/#graceful-shutdown","title":"Graceful Shutdown","text":"<pre><code># Custom shutdown timeout\nmeshctl start my_agent.py --shutdown-timeout 60\n\n# Custom startup timeout\nmeshctl start my_agent.py --startup-timeout 45\n</code></pre>"},{"location":"meshctl-cli/#advanced-usage-examples","title":"Advanced Usage Examples","text":""},{"location":"meshctl-cli/#development-workflow","title":"Development Workflow","text":"<pre><code># Terminal 1: Start registry for development\nmeshctl start --registry-only --debug\n\n# Terminal 2: Start your agent with hot reload\nmeshctl start my_agent.py --debug --verbose --auto-restart\n\n# Terminal 3: Monitor all services\nwatch 'meshctl list --wide'\n</code></pre>"},{"location":"meshctl-cli/#production-like-testing","title":"Production-like Testing","text":"<pre><code># Start multiple services\nmeshctl start \\\n  services/auth.py \\\n  services/database.py \\\n  services/api.py \\\n  --detach \\\n  --log-level INFO\n\n# Monitor the services\nmeshctl list\nmeshctl status --verbose\n</code></pre>"},{"location":"meshctl-cli/#multi-environment-setup","title":"Multi-Environment Setup","text":"<pre><code># Development environment\nmeshctl start my_agent.py \\\n  --env-file .env.development \\\n  --registry-port 8000 \\\n  --debug\n\n# Staging environment\nmeshctl start my_agent.py \\\n  --env-file .env.staging \\\n  --registry-port 8001 \\\n  --log-level WARN\n\n# Connect to production registry\nmeshctl list --registry-url https://prod-registry.company.com\n</code></pre>"},{"location":"meshctl-cli/#configuration-file","title":"Configuration File","text":"<p>meshctl stores configuration in <code>~/.mcp_mesh/cli_config.json</code>:</p> <pre><code>{\n  \"registry_host\": \"localhost\",\n  \"registry_port\": 8000,\n  \"log_level\": \"INFO\",\n  \"auto_restart\": true,\n  \"watch_files\": true,\n  \"debug\": false,\n  \"startup_timeout\": 30,\n  \"shutdown_timeout\": 30\n}\n</code></pre>"},{"location":"meshctl-cli/#common-configuration","title":"Common Configuration","text":"<pre><code># Set development defaults\nmeshctl config set debug true\nmeshctl config set log_level DEBUG\nmeshctl config set registry_port 8080\n\n# Set production defaults\nmeshctl config set debug false\nmeshctl config set log_level WARN\nmeshctl config set auto_restart false\n</code></pre>"},{"location":"meshctl-cli/#monitoring-and-troubleshooting","title":"Monitoring and Troubleshooting","text":""},{"location":"meshctl-cli/#health-checks","title":"Health Checks","text":"<pre><code># Check overall system health\nmeshctl status\n\n# Monitor specific agent\nmeshctl list --id agent-id-abc123\n\n# Show agents active in last hour\nmeshctl list --since 1h\n</code></pre>"},{"location":"meshctl-cli/#debugging-connection-issues","title":"Debugging Connection Issues","text":"<pre><code># Test registry connectivity\nmeshctl list --registry-url http://localhost:8000 --timeout 5\n\n# Verbose status for debugging\nmeshctl status --verbose --json\n\n# Check specific agent details\nmeshctl list --filter my-agent --verbose\n</code></pre>"},{"location":"meshctl-cli/#log-analysis","title":"Log Analysis","text":"<pre><code># Start with debug logging\nmeshctl start my_agent.py --debug --log-level DEBUG\n\n# Check status with verbose output\nmeshctl status --verbose\n</code></pre>"},{"location":"meshctl-cli/#integration-with-development-tools","title":"Integration with Development Tools","text":""},{"location":"meshctl-cli/#with-docker","title":"With Docker","text":"<pre><code># Start local registry\nmeshctl start --registry-only --registry-host 0.0.0.0\n\n# Connect agents to containerized registry\nmeshctl start my_agent.py --registry-url http://docker-registry:8000\n</code></pre>"},{"location":"meshctl-cli/#with-cicd","title":"With CI/CD","text":"<pre><code># Test agent startup in CI\nmeshctl start my_agent.py --startup-timeout 10 --quiet\n\n# Validate agent health\nmeshctl status --json | jq '.agents[] | select(.status != \"healthy\")'\n\n# Stop services after tests\npkill -f meshctl\n</code></pre>"},{"location":"meshctl-cli/#with-scripts","title":"With Scripts","text":"<pre><code>#!/bin/bash\n# development.sh - Start development environment\n\necho \"Starting MCP Mesh development environment...\"\n\n# Start registry\nmeshctl start --registry-only --detach --pid-file registry.pid\n\n# Wait for registry\nsleep 2\n\n# Start services\nmeshctl start services/*.py --detach --env-file .env.dev\n\n# Show status\nmeshctl list --wide\n\necho \"Development environment ready!\"\necho \"Run 'meshctl list' to monitor services\"\n</code></pre>"},{"location":"meshctl-cli/#common-use-cases","title":"Common Use Cases","text":""},{"location":"meshctl-cli/#1-local-development","title":"1. Local Development","text":"<pre><code># Start everything you need for development\nmeshctl start --registry-only --debug &amp;\nmeshctl start my_agent.py --debug --auto-restart\n</code></pre>"},{"location":"meshctl-cli/#2-testing-dependencies","title":"2. Testing Dependencies","text":"<pre><code># Start provider service\nmeshctl start provider_service.py --detach\n\n# Start consumer service\nmeshctl start consumer_service.py\n\n# Verify dependency resolution\nmeshctl list --wide\n</code></pre>"},{"location":"meshctl-cli/#3-multi-service-demo","title":"3. Multi-Service Demo","text":"<pre><code># Start complete demo environment\nmeshctl start \\\n  examples/system_agent.py \\\n  examples/hello_world.py \\\n  examples/weather_agent.py \\\n  --verbose\n\n# Monitor all services\nmeshctl list --wide\n</code></pre>"},{"location":"meshctl-cli/#4-remote-development","title":"4. Remote Development","text":"<pre><code># Connect to shared development registry\nmeshctl start my_agent.py --registry-url http://dev-registry.team.local:8000\n\n# List all team's agents\nmeshctl list --registry-url http://dev-registry.team.local:8000\n</code></pre>"},{"location":"meshctl-cli/#performance-and-scaling","title":"Performance and Scaling","text":""},{"location":"meshctl-cli/#resource-monitoring","title":"Resource Monitoring","text":"<pre><code># Monitor agent resource usage\nmeshctl list --wide --verbose\n\n# Check registry performance\nmeshctl status --json | jq '.registry.performance'\n</code></pre>"},{"location":"meshctl-cli/#load-testing-support","title":"Load Testing Support","text":"<pre><code># Start multiple instances\nfor i in {1..5}; do\n  meshctl start my_agent.py --agent-name \"agent-$i\" --detach\ndone\n\n# Monitor all instances\nmeshctl list --filter agent-\n</code></pre>"},{"location":"meshctl-cli/#next-steps","title":"Next Steps","text":"<p>Now that you know meshctl basics:</p> <ol> <li>Local Development - Professional development workflows</li> <li>Production Deployment - Container orchestration</li> <li>Mesh Decorators - @mesh.tool, @mesh.llm decorators</li> </ol> <p>\ud83d\udca1 Pro Tip: Use <code>meshctl list --wide</code> as your primary monitoring command - it shows everything you need at a glance.</p> <p>\ud83d\udd27 Development Tip: Keep a terminal with <code>watch 'meshctl list'</code> running to monitor your services in real-time.</p> <p>\ud83d\udcca Monitoring Tip: Use <code>meshctl status --json</code> for automated health checks and monitoring integrations.</p>"},{"location":"meshctl-scaffold/","title":"meshctl scaffold Command Reference","text":"<p>Generate MCP Mesh agents from templates with interactive or CLI-based configuration</p>"},{"location":"meshctl-scaffold/#overview","title":"Overview","text":"<p>The <code>meshctl scaffold</code> command generates new MCP Mesh agents from templates. It supports three agent types, multiple input modes, and extensive customization options.</p>"},{"location":"meshctl-scaffold/#quick-start","title":"Quick Start","text":"<pre><code># Interactive mode - guided wizard\nmeshctl scaffold\n\n# Generate a basic tool agent\nmeshctl scaffold --name my-tool --agent-type tool\n\n# Generate an LLM-powered agent\nmeshctl scaffold --name my-agent --agent-type llm-agent\n\n# Generate an LLM provider\nmeshctl scaffold --name claude-provider --agent-type llm-provider --model anthropic/claude-sonnet-4-5\n</code></pre>"},{"location":"meshctl-scaffold/#agent-types","title":"Agent Types","text":""},{"location":"meshctl-scaffold/#1-tool-agent-agent-type-tool","title":"1. Tool Agent (<code>--agent-type tool</code>)","text":"<p>Basic MCP tool agent using <code>@mesh.tool</code> decorator. Best for simple tools and utilities.</p> <pre><code>meshctl scaffold --name date-service --agent-type tool --port 9100\n</code></pre> <p>Generated structure:</p> <pre><code>date-service/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 __main__.py\n\u251c\u2500\u2500 main.py           # Agent with @mesh.tool decorated functions\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 requirements.txt\n</code></pre>"},{"location":"meshctl-scaffold/#2-llm-agent-agent-type-llm-agent","title":"2. LLM Agent (<code>--agent-type llm-agent</code>)","text":"<p>LLM-powered agent using <code>@mesh.llm</code> + <code>@mesh.tool</code> decorators. Best for AI-driven processing.</p> <pre><code>meshctl scaffold --name emotion-analyzer --agent-type llm-agent \\\n  --llm-selector claude \\\n  --response-format json \\\n  --max-iterations 1\n</code></pre> <p>Generated structure:</p> <pre><code>emotion-analyzer/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 __main__.py\n\u251c\u2500\u2500 main.py           # Agent with @mesh.llm decorator\n\u251c\u2500\u2500 prompts/          # Jinja2 prompt templates\n\u2502   \u2514\u2500\u2500 emotion-analyzer.jinja2\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 requirements.txt\n</code></pre>"},{"location":"meshctl-scaffold/#3-llm-provider-agent-type-llm-provider","title":"3. LLM Provider (<code>--agent-type llm-provider</code>)","text":"<p>Zero-code LLM provider using <code>@mesh.llm_provider</code> decorator. Exposes LLM access to other agents.</p> <pre><code>meshctl scaffold --name claude-provider --agent-type llm-provider \\\n  --model anthropic/claude-sonnet-4-5 \\\n  --port 9110\n</code></pre> <p>Generated structure:</p> <pre><code>claude-provider/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 __main__.py\n\u251c\u2500\u2500 main.py           # Provider with @mesh.llm_provider decorator\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 requirements.txt\n</code></pre>"},{"location":"meshctl-scaffold/#input-modes","title":"Input Modes","text":""},{"location":"meshctl-scaffold/#interactive-mode-default","title":"Interactive Mode (Default)","text":"<p>When no flags are provided, scaffold launches an interactive wizard:</p> <pre><code>meshctl scaffold\n</code></pre> <p>The wizard guides you through:</p> <ol> <li>Agent type selection</li> <li>Name and description</li> <li>Port configuration</li> <li>LLM-specific options (provider, filter, response format)</li> </ol>"},{"location":"meshctl-scaffold/#cli-flags-mode","title":"CLI Flags Mode","text":"<p>Specify all options via command-line flags:</p> <pre><code>meshctl scaffold \\\n  --name my-agent \\\n  --agent-type llm-agent \\\n  --llm-selector openai \\\n  --filter '{\"tags\":[\"executor\",\"tools\"]}' \\\n  --filter-mode all \\\n  --max-iterations 3 \\\n  --response-format json \\\n  --port 9200\n</code></pre>"},{"location":"meshctl-scaffold/#yaml-config-mode","title":"YAML Config Mode","text":"<p>Use a configuration file for complex setups:</p> <pre><code>meshctl scaffold --config agent-config.yaml\n</code></pre> <p>Example <code>agent-config.yaml</code>:</p> <pre><code>agent_type: llm-agent\nname: document-processor\ndescription: Process and analyze documents using LLM\nport: 9200\n\nllm:\n  provider: claude\n  provider_tags: [\"llm\", \"+claude\"]\n  max_iterations: 5\n  system_prompt: \"file://prompts/document.jinja2\"\n  context_param: doc_ctx\n  response_format: json\n  filter:\n    - capability: pdf_extractor\n    - tags: [\"document\", \"parser\"]\n  filter_mode: all\n\ntags:\n  - document\n  - analysis\n  - llm\n</code></pre>"},{"location":"meshctl-scaffold/#common-options","title":"Common Options","text":""},{"location":"meshctl-scaffold/#general-options","title":"General Options","text":"Flag Short Default Description <code>--name</code> <code>-n</code> Agent name (required) <code>--agent-type</code> <code>tool</code> Agent type: <code>tool</code>, <code>llm-agent</code>, <code>llm-provider</code> <code>--description</code> Agent description <code>--port</code> <code>-p</code> <code>9000</code> HTTP server port <code>--output</code> <code>-o</code> <code>.</code> Output directory <code>--lang</code> <code>-l</code> <code>python</code> Language: <code>python</code> <code>--tags</code> Tags for discovery (comma-separated) <code>--no-interactive</code> <code>false</code> Disable interactive mode"},{"location":"meshctl-scaffold/#llm-agent-options","title":"LLM Agent Options","text":"Flag Default Description <code>--llm-selector</code> <code>claude</code> LLM provider: <code>claude</code>, <code>openai</code> <code>--max-iterations</code> <code>1</code> Max agentic loop iterations <code>--system-prompt</code> System prompt (inline or <code>file://path</code>) <code>--context-param</code> <code>ctx</code> Context parameter name <code>--response-format</code> <code>text</code> Response format: <code>text</code>, <code>json</code> <code>--filter</code> Tool filter (JSON format) <code>--filter-mode</code> <code>all</code> Filter mode: <code>all</code>, <code>best_match</code>, <code>*</code>"},{"location":"meshctl-scaffold/#llm-provider-options","title":"LLM Provider Options","text":"Flag Default Description <code>--model</code> LiteLLM model (e.g., <code>anthropic/claude-sonnet-4-5</code>)"},{"location":"meshctl-scaffold/#tool-filter-configuration","title":"Tool Filter Configuration","text":"<p>The <code>--filter</code> flag controls which mesh tools the LLM agent can access.</p>"},{"location":"meshctl-scaffold/#filter-formats","title":"Filter Formats","text":"<pre><code># Simple capability filter\n--filter 'date_service'\n\n# Tag-based filter\n--filter '{\"tags\":[\"executor\",\"tools\"]}'\n\n# Capability + tags filter\n--filter '{\"capability\":\"document\",\"tags\":[\"pdf\",\"advanced\"]}'\n\n# Multiple filters (array)\n--filter '[{\"capability\":\"date_service\"},{\"tags\":[\"system\"]}]'\n</code></pre>"},{"location":"meshctl-scaffold/#filter-modes","title":"Filter Modes","text":"Mode Description <code>all</code> Include all tools matching any filter criteria <code>best_match</code> One tool per capability (best tag match) <code>*</code> All available tools in mesh (wildcard)"},{"location":"meshctl-scaffold/#examples","title":"Examples","text":"<pre><code># Access all tools with \"executor\" tag\nmeshctl scaffold --name dev-agent --agent-type llm-agent \\\n  --filter '{\"tags\":[\"executor\",\"tools\"]}' \\\n  --filter-mode all\n\n# Access specific capabilities\nmeshctl scaffold --name multi-agent --agent-type llm-agent \\\n  --filter '[{\"capability\":\"date_service\"},{\"capability\":\"weather\"}]'\n\n# Access ALL mesh tools (wildcard)\nmeshctl scaffold --name super-agent --agent-type llm-agent \\\n  --filter-mode '*'\n\n# No tool access (LLM-only, no tool calling)\nmeshctl scaffold --name chat-agent --agent-type llm-agent\n</code></pre>"},{"location":"meshctl-scaffold/#system-prompt-configuration","title":"System Prompt Configuration","text":""},{"location":"meshctl-scaffold/#inline-prompt","title":"Inline Prompt","text":"<pre><code>meshctl scaffold --name my-agent --agent-type llm-agent \\\n  --system-prompt \"You are a helpful assistant that processes user requests.\"\n</code></pre>"},{"location":"meshctl-scaffold/#file-based-prompt-jinja2","title":"File-based Prompt (Jinja2)","text":"<pre><code>meshctl scaffold --name my-agent --agent-type llm-agent \\\n  --system-prompt \"file://prompts/my-agent.jinja2\"\n</code></pre> <p>When using file-based prompts, context fields are available directly in the template:</p> <pre><code>{# prompts/my-agent.jinja2 #}\nYou are {{ agent_name }}, an AI assistant.\n\n## Input\n{{ input_text }}\n\n## Instructions\nAnalyze the input and respond appropriately.\n</code></pre> <p>Note: Context fields are accessed directly (e.g., <code>{{ input_text }}</code>), not via the context parameter (e.g., <code>{{ ctx.input_text }}</code>).</p>"},{"location":"meshctl-scaffold/#complete-examples","title":"Complete Examples","text":""},{"location":"meshctl-scaffold/#1-basic-tool-agent","title":"1. Basic Tool Agent","text":"<pre><code>meshctl scaffold \\\n  --name date-service \\\n  --agent-type tool \\\n  --description \"Provides date and time utilities\" \\\n  --port 9100 \\\n  --tags \"date,time,utility\"\n</code></pre>"},{"location":"meshctl-scaffold/#2-llm-agent-with-claude","title":"2. LLM Agent with Claude","text":"<pre><code>meshctl scaffold \\\n  --name sentiment-analyzer \\\n  --agent-type llm-agent \\\n  --description \"Analyze sentiment of text using Claude\" \\\n  --llm-selector claude \\\n  --response-format json \\\n  --max-iterations 1 \\\n  --port 9200\n</code></pre>"},{"location":"meshctl-scaffold/#3-llm-agent-with-tool-access","title":"3. LLM Agent with Tool Access","text":"<pre><code>meshctl scaffold \\\n  --name developer-agent \\\n  --agent-type llm-agent \\\n  --llm-selector claude \\\n  --filter '{\"tags\":[\"executor\",\"tools\"]}' \\\n  --filter-mode all \\\n  --max-iterations 10 \\\n  --port 9300\n</code></pre>"},{"location":"meshctl-scaffold/#4-openai-llm-provider","title":"4. OpenAI LLM Provider","text":"<pre><code>meshctl scaffold \\\n  --name openai-provider \\\n  --agent-type llm-provider \\\n  --model openai/gpt-4o \\\n  --port 9110 \\\n  --tags \"llm,openai,gpt,provider\"\n</code></pre>"},{"location":"meshctl-scaffold/#5-claude-llm-provider","title":"5. Claude LLM Provider","text":"<pre><code>meshctl scaffold \\\n  --name claude-provider \\\n  --agent-type llm-provider \\\n  --model anthropic/claude-sonnet-4-5 \\\n  --port 9111\n</code></pre>"},{"location":"meshctl-scaffold/#running-generated-agents","title":"Running Generated Agents","text":"<p>After scaffolding, start your agent with:</p> <pre><code>cd my-agent\nmeshctl start main.py\n\n# Or with debug logging\nmeshctl start main.py --debug\n</code></pre>"},{"location":"meshctl-scaffold/#project-structure-reference","title":"Project Structure Reference","text":""},{"location":"meshctl-scaffold/#tool-agent","title":"Tool Agent","text":"<pre><code>my-tool/\n\u251c\u2500\u2500 __init__.py       # Package initialization\n\u251c\u2500\u2500 __main__.py       # Module entry point\n\u251c\u2500\u2500 main.py           # @mesh.tool decorated functions\n\u251c\u2500\u2500 README.md         # Documentation\n\u2514\u2500\u2500 requirements.txt  # Dependencies\n</code></pre>"},{"location":"meshctl-scaffold/#llm-agent","title":"LLM Agent","text":"<pre><code>my-llm-agent/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 __main__.py\n\u251c\u2500\u2500 main.py           # @mesh.llm + @mesh.tool decorated function\n\u251c\u2500\u2500 prompts/\n\u2502   \u2514\u2500\u2500 my-llm-agent.jinja2  # Jinja2 system prompt\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 requirements.txt\n</code></pre>"},{"location":"meshctl-scaffold/#llm-provider","title":"LLM Provider","text":"<pre><code>my-provider/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 __main__.py\n\u251c\u2500\u2500 main.py           # @mesh.llm_provider decorated function\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 requirements.txt\n</code></pre>"},{"location":"meshctl-scaffold/#troubleshooting","title":"Troubleshooting","text":""},{"location":"meshctl-scaffold/#common-issues","title":"Common Issues","text":"<p>\"name is required\" error</p> <pre><code># Use --no-interactive when scripting\nmeshctl scaffold --name my-agent --agent-type tool --no-interactive\n</code></pre> <p>Invalid filter format</p> <pre><code># Ensure JSON is properly quoted\nmeshctl scaffold --name my-agent --agent-type llm-agent \\\n  --filter '{\"tags\":[\"a\",\"b\"]}'  # Correct\n</code></pre> <p>Template not found</p> <pre><code># Check template directory\nmeshctl scaffold --list-modes  # Shows available modes and templates\n</code></pre>"},{"location":"meshctl-scaffold/#see-also","title":"See Also","text":"<ul> <li>meshctl CLI Reference - All meshctl commands</li> <li>MCP Mesh Decorators - @mesh.tool, @mesh.llm, @mesh.llm_provider</li> <li>LLM Integration - Using LLM agents</li> </ul>"},{"location":"00-why-mcp-mesh/","title":"Why MCP Mesh?","text":""},{"location":"00-why-mcp-mesh/#the-problem-building-agents-is-easy-deploying-them-is-hard","title":"The Problem: Building Agents is Easy, Deploying Them is Hard","text":"<p>Every AI framework lets you build agents. But when it's time to deploy:</p> <ul> <li>How do you deploy 10 agents to Kubernetes?</li> <li>How do agents discover each other at runtime?</li> <li>How do you scale Agent A independently from Agent B?</li> <li>How do you monitor which agent called which?</li> </ul> <p>The answer from most frameworks: \"That's your problem.\"</p>"},{"location":"00-why-mcp-mesh/#mcp-mesh-build-and-deploy","title":"MCP Mesh: Build AND Deploy","text":"<p>MCP Mesh is a complete platform for building and deploying AI agents. You don't need LangGraph, CrewAI, or AutoGen.</p>"},{"location":"00-why-mcp-mesh/#what-mcp-mesh-provides","title":"What MCP Mesh Provides","text":"Capability How Build Agents <code>@mesh.agent</code> - Define agents with automatic registration Create Tools <code>@mesh.tool</code> - Tools with dependency injection Add LLM Intelligence <code>@mesh.llm</code> - Integrate any LLM provider Expose APIs <code>@mesh.route</code> - FastAPI endpoints with mesh integration Deploy to Production Helm charts, Docker Compose, K8s-native Monitor Everything Built-in Grafana, Tempo, health checks"},{"location":"00-why-mcp-mesh/#simple-example","title":"Simple Example","text":"<pre><code>from mcp_mesh import mesh\nfrom fastmcp import FastMCP\n\napp = FastMCP(\"My Agent\")\n\n# Define a tool with automatic dependency injection\n@app.tool()\n@mesh.tool(capability=\"greeting\", dependencies=[\"time_service\"])\nasync def greet(name: str, time_service: mesh.McpMeshTool = None):\n    current_time = await time_service() if time_service else \"unknown\"\n    return f\"Hello {name}! The time is {current_time}\"\n\n# Expose a REST endpoint\n@mesh.route(\"/api/greet/{name}\", methods=[\"GET\"])\nasync def greet_api(name: str):\n    return {\"message\": greet(name)}\n\n# Register as an agent\n@mesh.agent(name=\"greeting-agent\", port=8080)\nclass GreetingAgent:\n    pass\n</code></pre> <p>That's a complete agent with:</p> <ul> <li>Tool that other agents can call</li> <li>REST API for external access</li> <li>Automatic registration with the mesh</li> <li>Dependency injection from other agents</li> </ul>"},{"location":"00-why-mcp-mesh/#framework-comparison","title":"Framework Comparison","text":"Framework Build Agents K8s Deploy Independent Scaling Service Discovery MCP Mesh <code>@mesh.*</code> decorators Helm charts Per-agent pods Built-in registry LangGraph Graph-based Manual Same process DIY CrewAI Role-based Manual Limited None AutoGen Conversation Manual Manual DIY OpenAI Agents Function calling Manual Manual None"},{"location":"00-why-mcp-mesh/#key-insight","title":"Key Insight","text":"<ul> <li>LangGraph/CrewAI/AutoGen = Agent building frameworks (no deployment)</li> <li>MCP Mesh = Agent building + deployment + scaling + observability</li> </ul>"},{"location":"00-why-mcp-mesh/#what-makes-mcp-mesh-different","title":"What Makes MCP Mesh Different","text":""},{"location":"00-why-mcp-mesh/#1-decorators-that-do-everything","title":"1. Decorators That Do Everything","text":"<pre><code>@mesh.agent(name=\"my-agent\", port=8080)      # Register with mesh\n@mesh.tool(capability=\"process\")              # Expose as callable tool\n@mesh.llm(provider=\"anthropic\")               # Add LLM capabilities\n@mesh.route(\"/api/endpoint\")                  # REST API endpoint\n</code></pre>"},{"location":"00-why-mcp-mesh/#2-automatic-dependency-injection","title":"2. Automatic Dependency Injection","text":"<pre><code>@mesh.tool(\n    capability=\"analyze_data\",\n    dependencies=[\"db_service\", \"ml_service\"]\n)\nasync def analyze(data, db_service: mesh.McpMeshTool = None, ml_service: mesh.McpMeshTool = None):\n    # db_service and ml_service are automatically injected\n    # MCP Mesh finds them, connects them, handles failures\n    records = await db_service(query=data) if db_service else {}\n    return await ml_service(data=records) if ml_service else {}\n</code></pre>"},{"location":"00-why-mcp-mesh/#3-one-command-to-production","title":"3. One Command to Production","text":"<pre><code># Generate Docker Compose with observability\nmeshctl scaffold --compose --observability\n\n# Or deploy to Kubernetes (OCI registry)\nhelm install my-mesh oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-core \\\n  --version 0.8.0-beta.6 -n mcp-mesh --create-namespace\n</code></pre>"},{"location":"00-why-mcp-mesh/#4-built-in-observability","title":"4. Built-in Observability","text":"<ul> <li>Grafana dashboards - Pre-configured for agent metrics</li> <li>Distributed tracing - See request flow across agents</li> <li>Health monitoring - Automatic health checks and alerting</li> </ul>"},{"location":"00-why-mcp-mesh/#when-to-use-mcp-mesh","title":"When to Use MCP Mesh","text":""},{"location":"00-why-mcp-mesh/#use-mcp-mesh-when","title":"Use MCP Mesh When:","text":"<ul> <li>Building multi-agent AI systems</li> <li>Deploying agents to Kubernetes or Docker</li> <li>Agents need to discover and call each other</li> <li>You want independent scaling per agent</li> <li>You need production observability</li> </ul>"},{"location":"00-why-mcp-mesh/#maybe-skip-mcp-mesh-when","title":"Maybe Skip MCP Mesh When:","text":"<ul> <li>Single agent running locally only</li> <li>Pure prototyping with no deployment plans</li> </ul>"},{"location":"00-why-mcp-mesh/#quick-comparison-deploying-5-agents","title":"Quick Comparison: Deploying 5 Agents","text":""},{"location":"00-why-mcp-mesh/#without-mcp-mesh","title":"Without MCP Mesh","text":"<pre><code>\u251c\u2500\u2500 agent-1/\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 deployment.yaml\n\u2502   \u251c\u2500\u2500 service.yaml\n\u2502   \u2514\u2500\u2500 configmap.yaml\n\u251c\u2500\u2500 agent-2/\n\u2502   \u2514\u2500\u2500 ... (repeat)\n\u251c\u2500\u2500 service-discovery/\n\u2502   \u2514\u2500\u2500 (build your own)\n\u2514\u2500\u2500 monitoring/\n    \u2514\u2500\u2500 (set up yourself)\n</code></pre> <p>Result: 50+ files, weeks of work</p>"},{"location":"00-why-mcp-mesh/#with-mcp-mesh","title":"With MCP Mesh","text":"<pre><code># 5 Python files with @mesh.agent decorators\n</code></pre> <pre><code>meshctl scaffold --compose --observability\ndocker-compose up\n</code></pre> <p>Result: 5 files + 1 command</p>"},{"location":"00-why-mcp-mesh/#already-using-another-framework","title":"Already Using Another Framework?","text":"<p>If you're already invested in LangGraph, CrewAI, or AutoGen, MCP Mesh can help you deploy them to production:</p> <ul> <li>Wrap your existing agents with <code>@mesh.agent</code></li> <li>Get automatic K8s deployment via Helm</li> <li>Add observability without code changes</li> <li>Scale agents independently</li> </ul> <p>MCP Mesh doesn't replace your agent logic - it handles the infrastructure so you don't have to.</p>"},{"location":"00-why-mcp-mesh/#next-steps","title":"Next Steps","text":"<p>Ready to build your first agent?</p> <p>Get Started in 5 Minutes View Architecture</p>"},{"location":"01-getting-started/01-prerequisites/","title":"Prerequisites","text":"<p>Quick checklist before installing MCP Mesh</p>"},{"location":"01-getting-started/01-prerequisites/#essential-requirements","title":"Essential Requirements","text":"<p>You need Python 3.11+ and understanding of the dual decorator pattern:</p>"},{"location":"01-getting-started/01-prerequisites/#1-python-311","title":"1. Python 3.11+","text":"<pre><code># Check your Python version\npython --version\n\n# Should show: Python 3.11.x or higher\n</code></pre> <p>Don't have Python 3.11+?</p> <ul> <li>macOS: <code>brew install python@3.11</code></li> <li>Ubuntu/Debian: <code>sudo apt install python3.11</code></li> <li>Windows: Download from python.org</li> </ul>"},{"location":"01-getting-started/01-prerequisites/#2-pip-python-package-manager","title":"2. pip (Python Package Manager)","text":"<pre><code># Check pip is installed\npip --version\n\n# If not installed, get it with:\npython -m ensurepip --upgrade\n</code></pre>"},{"location":"01-getting-started/01-prerequisites/#3-understanding-the-dual-decorator-pattern","title":"3. Understanding the Dual Decorator Pattern","text":"<p>MCP Mesh uses the dual decorator pattern combining:</p> <ul> <li>FastMCP decorators (<code>@app.tool</code>, <code>@app.prompt</code>, <code>@app.resource</code>) - Familiar MCP development</li> <li>Mesh decorators (<code>@mesh.tool</code>, <code>@mesh.agent</code>) - Orchestration and dependency injection</li> </ul> <pre><code>import mesh\nfrom fastmcp import FastMCP\n\napp = FastMCP(\"My Service\")\n\n@app.tool()      # \u2190 FastMCP decorator\n@mesh.tool(      # \u2190 Mesh decorator\n    capability=\"greeting\",\n    dependencies=[\"time_service\"]\n)\nasync def hello(time_service: mesh.McpMeshTool = None):\n    return f\"Hello! Time: {await time_service()}\"\n</code></pre> <p>That's it! You're ready to install MCP Mesh.</p>"},{"location":"01-getting-started/01-prerequisites/#recommended-setup","title":"Recommended Setup","text":"<p>For the best experience, we recommend:</p>"},{"location":"01-getting-started/01-prerequisites/#use-a-virtual-environment","title":"Use a Virtual Environment","text":"<pre><code># Create a virtual environment\npython -m venv mcp-env\n\n# Activate it\nsource mcp-env/bin/activate  # Linux/macOS\n# or\nmcp-env\\Scripts\\activate     # Windows\n</code></pre>"},{"location":"01-getting-started/01-prerequisites/#have-curl-or-wget","title":"Have curl or wget","text":"<pre><code># For testing your agents\ncurl --version\n</code></pre>"},{"location":"01-getting-started/01-prerequisites/#system-support","title":"System Support","text":"<ul> <li>\u2705 Linux: All distributions with Python 3.11+</li> <li>\u2705 macOS: 10.15 (Catalina) or later</li> <li>\u2705 Windows: Windows 10/11 (WSL2 recommended for best experience)</li> </ul>"},{"location":"01-getting-started/01-prerequisites/#quick-check-script","title":"Quick Check Script","text":"<pre><code># Run this to check everything at once\npython3 -c \"\nimport sys\nprint('Python:', sys.version)\nprint('\u2705 Ready!' if sys.version_info &gt;= (3, 11) else '\u274c Need Python 3.11+')\n\"\n</code></pre>"},{"location":"01-getting-started/01-prerequisites/#optional-but-helpful","title":"Optional but Helpful","text":""},{"location":"01-getting-started/01-prerequisites/#network-ports","title":"Network Ports","text":"<p>MCP Mesh will use these ports (configurable):</p> <ul> <li>8000: Registry (starts automatically)</li> <li>8080-8090: Your agents (you choose)</li> </ul>"},{"location":"01-getting-started/01-prerequisites/#storage","title":"Storage","text":"<ul> <li>500MB: For MCP Mesh and dependencies</li> <li>100MB: For logs and data</li> </ul>"},{"location":"01-getting-started/01-prerequisites/#next-steps","title":"Next Steps","text":"<p>Once all prerequisites are met, proceed to Installation \u2192</p> <p>\ud83d\udca1 Tip: If you encounter issues, our Troubleshooting Guide covers common problems and solutions.</p> <p>\ud83d\udcda Note: For containerized deployments (Docker/Kubernetes), different prerequisites apply. See Docker Deployment or Kubernetes Basics.</p>"},{"location":"01-getting-started/01-prerequisites/#troubleshooting","title":"\ud83d\udd27 Troubleshooting","text":""},{"location":"01-getting-started/01-prerequisites/#common-issues","title":"Common Issues","text":"<ol> <li>Python version mismatch - Use <code>pyenv</code> or <code>conda</code> to manage multiple Python versions</li> <li>Permission denied on ports - Either use higher ports (&gt;1024) or run with appropriate permissions</li> <li>Git not found - Install via package manager (<code>apt</code>, <code>brew</code>, <code>choco</code>)</li> <li>Virtual environment issues - Ensure you're using the Python 3 venv module, not virtualenv</li> </ol> <p>For detailed solutions, see our Troubleshooting Guide.</p>"},{"location":"01-getting-started/01-prerequisites/#known-limitations","title":"\u26a0\ufe0f Known Limitations","text":"<ul> <li>Python 3.8 and below: Not supported due to typing features used</li> <li>32-bit systems: Limited support, 64-bit recommended</li> <li>Network proxies: May require additional configuration</li> <li>Corporate firewalls: May block agent communication on custom ports</li> </ul>"},{"location":"01-getting-started/02-installation/","title":"Installation","text":"<p>Get MCP Mesh running in under 2 minutes</p>"},{"location":"01-getting-started/02-installation/#quick-install-recommended","title":"Quick Install (Recommended)","text":"<pre><code># Install CLI tools (meshctl and mcp-mesh-registry)\nnpm install -g @mcpmesh/cli\n\n# Install Python runtime\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n\n# Verify installation\nmeshctl --version\nmcp-mesh-registry --version\n</code></pre> <p>What this installs:</p> <ul> <li>meshctl: CLI tool for managing the mesh</li> <li>mcp-mesh-registry: Service discovery and coordination server</li> <li>mcp-mesh (Python): Runtime for building agents</li> </ul>"},{"location":"01-getting-started/02-installation/#alternative-installation-methods","title":"Alternative Installation Methods","text":"Homebrew (macOS) <pre><code># Install CLI tools\nbrew tap dhyansraj/mcp-mesh\nbrew install mcp-mesh\n\n# Install Python package\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n\n# Verify installation\nmeshctl --version\n</code></pre> Install Script (Linux/macOS) <pre><code># Install Python package\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n\n# Download CLI tools\ncurl -sSL https://raw.githubusercontent.com/dhyansraj/mcp-mesh/main/install.sh | bash\n\n# Verify installation\nmeshctl --version\n</code></pre> Build from Source  For contributors or advanced users who want to build from source:  ### Prerequisites  - Python 3.11 or higher - Go 1.23 or higher - Make (build tool)  ### Quick Install (Recommended)  <pre><code># Clone the repository\ngit clone https://github.com/mcp-mesh/mcp-mesh.git\ncd mcp-mesh\n\n# Install everything with one command\nmake install\n\n# Activate the virtual environment that was created\nsource .venv/bin/activate\n\n# Verify installation\nmeshctl --version\n</code></pre>  That's it! The `make install` command:  - Builds the Go binaries - Creates a Python virtual environment in `.venv` (if needed) - Installs the Python package with all dependencies - Installs binaries to `/usr/local/bin` (may prompt for sudo)  &gt; **Note**: MCP Mesh always uses `.venv` in the project root for consistency  ### Manual Installation  If you prefer to control each step:  <pre><code># Build Go binaries\nmake build\n\n# Create and activate virtual environment\npython -m venv .venv\nsource .venv/bin/activate  # On Windows: .venv\\Scripts\\activate\n\n# Install Python package\npip install src/runtime/python/\n\n# Install binaries (optional, requires sudo)\nsudo make install\n\n# Or add to PATH instead\nexport PATH=$PATH:$(pwd)/bin\n</code></pre>"},{"location":"01-getting-started/02-installation/#what-gets-installed","title":"What Gets Installed?","text":"<p>When you install MCP Mesh, you get:</p> <ol> <li>Python Package (<code>mcp_mesh</code>): The decorators and runtime for your agents</li> <li>CLI Tool (<code>meshctl</code>): Go-based command-line tool for running agents</li> <li>Registry Binary (<code>mcp-mesh-registry</code>): Go-based service registry</li> </ol>"},{"location":"01-getting-started/02-installation/#system-requirements","title":"System Requirements","text":"<ul> <li>Python: 3.11 or higher</li> <li>OS: Linux, macOS, or Windows (WSL2 recommended)</li> <li>Memory: 1GB free RAM</li> <li>Disk: 500MB free space</li> </ul>"},{"location":"01-getting-started/02-installation/#for-developers","title":"For Developers","text":"<p>If you're contributing to MCP Mesh:</p> <pre><code># Development installation\nmake install-dev\n\n# This creates symlinks instead of copying binaries\n# and installs the Python package in editable mode\n</code></pre> <p>See our Contributing Guide for more details.</p>"},{"location":"01-getting-started/02-installation/#verify-installation","title":"Verify Installation","text":"<p>Run a quick test to ensure everything is working:</p> <pre><code># Make sure you're in the virtual environment\nsource .venv/bin/activate\n\n# Test the CLI\nmeshctl --version\n\n# Test Python import\npython -c \"from mcp_mesh import mesh_agent; print('\u2705 MCP Mesh is installed!')\"\n\n# Start the registry (in one terminal)\nmeshctl start --registry-only\n\n# Run an example agent (in another terminal)\nmeshctl start examples/hello_world.py\n</code></pre>"},{"location":"01-getting-started/02-installation/#your-first-agent-in-30-seconds","title":"Your First Agent in 30 Seconds","text":"<p>Create <code>hello.py</code>:</p> <pre><code>import mesh\nfrom fastmcp import FastMCP\n\n# Single FastMCP server instance\napp = FastMCP(\"Hello Service\")\n\n@app.tool()  # FastMCP decorator for MCP protocol\n@mesh.tool(capability=\"greeting\")  # Mesh decorator for orchestration\ndef say_hello(name: str = \"World\") -&gt; str:\n    return f\"Hello, {name}!\"\n\n# Agent configuration - mesh handles server startup\n@mesh.agent(\n    name=\"hello-service\",\n    http_port=8000,\n    auto_run=True  # No main method needed!\n)\nclass HelloService:\n    pass\n\n# Mesh discovers 'app' and handles everything automatically!\n</code></pre> <p>Run it:</p> <pre><code># Start your agent (registry starts automatically)\npython hello.py\n\n# Test it (MCP JSON-RPC format)\ncurl -X POST http://localhost:8000/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": 1,\n    \"method\": \"tools/call\",\n    \"params\": {\n      \"name\": \"say_hello\",\n      \"arguments\": {\"name\": \"MCP Mesh\"}\n    }\n  }'\n</code></pre> <p>That's it! You've just created and deployed your first MCP Mesh agent.</p>"},{"location":"01-getting-started/02-installation/#common-installation-issues","title":"Common Installation Issues","text":""},{"location":"01-getting-started/02-installation/#1-command-meshctl-not-found","title":"1. Command 'meshctl' not found","text":"<p>Solution: Ensure npm global binaries are in your PATH:</p> <pre><code># Check where npm installs global packages\nnpm config get prefix\n\n# Add to PATH (add to your shell profile for persistence)\nexport PATH=\"$(npm config get prefix)/bin:$PATH\"\n\n# Verify installation\nmeshctl --version\n</code></pre>"},{"location":"01-getting-started/02-installation/#2-importerror-no-module-named-mcp_mesh","title":"2. ImportError: No module named 'mcp_mesh'","text":"<p>Solution: Activate the virtual environment:</p> <pre><code>source .venv/bin/activate  # or your custom venv\npython -c \"import mcp_mesh\"\n</code></pre>"},{"location":"01-getting-started/02-installation/#3-port-8080-already-in-use","title":"3. Port 8080 already in use","text":"<p>Solution: Another service is using port 8080:</p> <pre><code># Find what's using port 8080\nlsof -i :8080\n\n# Kill the process (replace PID with actual process ID)\nkill &lt;PID&gt;\n\n# Or use a different port\nmeshctl start --registry-port 8081\n</code></pre>"},{"location":"01-getting-started/02-installation/#next-steps","title":"Next Steps","text":"<p>Now that MCP Mesh is installed, let's run your first example:</p> <p>Running Hello World Example \u2192</p>"},{"location":"01-getting-started/02-installation/#reference-guides","title":"Reference Guides","text":"<ul> <li>meshctl CLI - Command-line tool reference</li> <li>Environment Variables - Configuration options</li> </ul> <p>\ud83d\udca1 Tip: Keep the registry running in a separate terminal while working with agents.</p> <p>\ud83d\udcda Note: For production deployments, consider using Docker or Kubernetes for easier management. See our deployment guides for more options.</p>"},{"location":"01-getting-started/02-installation/#troubleshooting","title":"\ud83d\udd27 Troubleshooting","text":""},{"location":"01-getting-started/02-installation/#installation-issues","title":"Installation Issues","text":"<ol> <li>pip SSL errors - Update certificates or use <code>--trusted-host pypi.org</code></li> <li>Compilation errors - Install build tools (<code>build-essential</code> on Linux, Xcode on macOS)</li> <li>Permission errors - Never use <code>sudo pip</code>; use virtual environments</li> <li>Dependency conflicts - Create a fresh virtual environment</li> </ol> <p>For comprehensive solutions, see our Troubleshooting Guide.</p>"},{"location":"01-getting-started/02-installation/#known-limitations","title":"\u26a0\ufe0f Known Limitations","text":"<ul> <li>Windows: Native Windows support is limited; WSL2 or Docker recommended</li> <li>Building from source: Requires Go 1.23+ with CGO enabled for SQLite support</li> <li>Air-gapped environments: Requires manual dependency download</li> </ul>"},{"location":"01-getting-started/03-hello-world/","title":"Hello World Example","text":"<p>The simplest way to see MCP Mesh in action</p>"},{"location":"01-getting-started/03-hello-world/#overview","title":"Overview","text":"<p>This example demonstrates the dual decorator pattern - combining FastMCP's familiar development experience with MCP Mesh's powerful orchestration. No main methods, no manual server setup - just add decorators and go!</p>"},{"location":"01-getting-started/03-hello-world/#quick-start","title":"Quick Start","text":"<pre><code># 1. Start system agent (provides date service) - registry starts automatically\nmeshctl start examples/simple/system_agent.py\n\n# 2. Start hello world agent (uses date service)\nmeshctl start examples/simple/hello_world.py\n\n# 3. Test it\nmeshctl call hello_mesh_simple\n</code></pre> <p>Expected response:</p> <pre><code>{\n  \"content\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"\ud83d\udc4b Hello from MCP Mesh! Today is December 10, 2025 at 03:30 PM\"\n    }\n  ],\n  \"isError\": false\n}\n</code></pre>"},{"location":"01-getting-started/03-hello-world/#understanding-the-code","title":"Understanding the Code","text":""},{"location":"01-getting-started/03-hello-world/#hello-world-agent","title":"Hello World Agent","text":"<pre><code>from typing import Any\nimport mesh\nfrom fastmcp import FastMCP\n\napp = FastMCP(\"Hello World Service\")\n\n@app.tool()  # FastMCP: Exposes as MCP tool\n@mesh.tool(\n    capability=\"greeting\",\n    dependencies=[\"date_service\"]  # Mesh: Declares dependency\n)\nasync def hello_mesh_simple(date_service: Any = None) -&gt; str:\n    \"\"\"Greeting with dependency injection.\"\"\"\n    if date_service is None:\n        return \"Hello from MCP Mesh! (Date service not available)\"\n\n    current_date = await date_service()\n    return f\"Hello from MCP Mesh! Today is {current_date}\"\n\n@mesh.agent(name=\"hello-world\", http_port=9090, auto_run=True)\nclass HelloWorldAgent:\n    pass\n</code></pre>"},{"location":"01-getting-started/03-hello-world/#system-agent-provider","title":"System Agent (Provider)","text":"<pre><code>import mesh\nfrom fastmcp import FastMCP\nfrom datetime import datetime\n\napp = FastMCP(\"System Agent Service\")\n\n@app.tool()\n@mesh.tool(capability=\"date_service\")  # Other agents can depend on this\ndef get_current_time() -&gt; str:\n    \"\"\"Get current system date and time.\"\"\"\n    return datetime.now().strftime(\"%B %d, %Y at %I:%M %p\")\n\n@mesh.agent(name=\"system-agent\", http_port=8080, auto_run=True)\nclass SystemAgent:\n    pass\n</code></pre>"},{"location":"01-getting-started/03-hello-world/#key-concepts","title":"Key Concepts","text":""},{"location":"01-getting-started/03-hello-world/#dual-decorators","title":"Dual Decorators","text":"Decorator Purpose <code>@app.tool()</code> FastMCP - Exposes function as MCP tool <code>@mesh.tool()</code> MCP Mesh - Adds discovery and dependency injection"},{"location":"01-getting-started/03-hello-world/#capability-vs-function-name","title":"Capability vs Function Name","text":"<ul> <li>Function name (<code>hello_mesh_simple</code>) - Used in MCP <code>tools/call</code></li> <li>Capability (<code>greeting</code>) - What others depend on</li> </ul>"},{"location":"01-getting-started/03-hello-world/#dependency-injection","title":"Dependency Injection","text":"<pre><code>@mesh.tool(dependencies=[\"date_service\"])\nasync def my_tool(date_service: Any = None):\n    result = await date_service()  # Calls system agent automatically\n</code></pre> <p>MCP Mesh automatically:</p> <ol> <li>Finds an agent providing <code>date_service</code> capability</li> <li>Injects a proxy function as <code>date_service</code> parameter</li> <li>Routes calls to the remote agent</li> </ol>"},{"location":"01-getting-started/03-hello-world/#testing-your-setup","title":"Testing Your Setup","text":""},{"location":"01-getting-started/03-hello-world/#list-registered-agents","title":"List Registered Agents","text":"<pre><code>meshctl list\n</code></pre>"},{"location":"01-getting-started/03-hello-world/#call-a-tool","title":"Call a Tool","text":"<pre><code># Call hello_mesh_simple on any agent that provides it\nmeshctl call hello_mesh_simple\n\n# Call get_current_time from system agent\nmeshctl call get_current_time\n</code></pre>"},{"location":"01-getting-started/03-hello-world/#check-agent-status","title":"Check Agent Status","text":"<pre><code>meshctl status\n</code></pre> Alternative: Using curl directly <pre><code># List tools from an agent\ncurl -s -X POST http://localhost:9090/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tools/list\",\"params\":{}}'\n\n# View registry\ncurl -s http://localhost:8000/agents | jq '.agents[] | {name, capabilities}'\n</code></pre>"},{"location":"01-getting-started/03-hello-world/#troubleshooting","title":"Troubleshooting","text":""},{"location":"01-getting-started/03-hello-world/#port-already-in-use","title":"Port Already in Use","text":"<pre><code>lsof -i :9090  # Check hello world port\nlsof -i :8080  # Check system agent port\n</code></pre>"},{"location":"01-getting-started/03-hello-world/#dependency-not-injected","title":"Dependency Not Injected","text":"<p>The dependency appears as <code>None</code> if:</p> <ul> <li>System agent isn't running</li> <li>Capability name doesn't match</li> <li>Registry isn't reachable</li> </ul> <pre><code># Verify system agent is registered\ncurl -s http://localhost:8000/agents | jq '.agents[] | select(.name==\"system-agent\")'\n</code></pre>"},{"location":"01-getting-started/03-hello-world/#next-steps","title":"Next Steps","text":"<ul> <li>Dependency Injection - Deep dive into smart resolution</li> <li>Creating Your First Agent - Build a complete agent</li> <li>LLM Integration - Add AI capabilities</li> </ul>"},{"location":"01-getting-started/04-dependency-injection/","title":"Understanding Dependency Injection in MCP Mesh","text":"<p>How the dual decorator pattern enables smart service discovery and dependency injection</p>"},{"location":"01-getting-started/04-dependency-injection/#what-is-dependency-injection","title":"What is Dependency Injection?","text":"<p>MCP Mesh's dual decorator pattern provides powerful dependency injection:</p> <ul> <li>\ud83d\udd17 Smart capability matching using tags and metadata</li> <li>\ud83c\udfaf Type-safe injection with <code>mesh.McpMeshTool</code> or flexible <code>Any</code> types</li> <li>\ud83c\udff7\ufe0f Tag-based resolution for intelligent service selection</li> <li>\ud83d\udcde Seamless function calls - remote functions work like local ones</li> <li>\ud83d\udd04 Automatic discovery - no configuration files or service URLs needed</li> <li>\ud83d\ude80 Zero boilerplate - Mesh handles all the complexity</li> </ul>"},{"location":"01-getting-started/04-dependency-injection/#core-concepts","title":"Core Concepts","text":""},{"location":"01-getting-started/04-dependency-injection/#1-capabilities-vs-function-names","title":"1. Capabilities vs Function Names","text":"<p>There's an important distinction in MCP Mesh:</p> <ul> <li>Function names: What you call via MCP (<code>hello_mesh_simple</code>)</li> <li>Capability names: What other agents depend on (<code>greeting</code>)</li> </ul> <pre><code>import mesh\nfrom fastmcp import FastMCP\n\napp = FastMCP(\"Demo Service\")\n\n@app.tool()  # MCP calls use function name: \"get_current_time\"\n@mesh.tool(\n    capability=\"date_service\",  # Others depend on: \"date_service\"\n    tags=[\"system\", \"time\"]\n)\ndef get_current_time() -&gt; str:  # Function name can be anything!\n    return datetime.now().strftime(\"%B %d, %Y\")\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#2-simple-dependency-declaration","title":"2. Simple Dependency Declaration","text":"<p>Declare what capabilities you need:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"weather_advisor\",\n    dependencies=[\"date_service\"]  # \u2190 Simple capability name\n)\ndef get_weather_advice(date_service: mesh.McpMeshTool = None) -&gt; str:\n    if date_service:\n        current_date = date_service()  # Call remote function\n        return f\"Weather advice for {current_date}\"\n    return \"Weather advice (date not available)\"\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#3-smart-tag-based-dependencies","title":"3. Smart Tag-Based Dependencies","text":"<p>Use tags for intelligent service selection:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"system_reporter\",\n    dependencies=[\n        \"date_service\",  # Simple dependency\n        {\n            \"capability\": \"info\",\n            \"tags\": [\"system\", \"general\"]  # \u2190 Smart tag matching!\n        }\n    ]\n)\ndef create_system_report(\n    date_service: mesh.McpMeshTool = None,\n    info: mesh.McpMeshTool = None  # Gets general system info\n) -&gt; dict:\n    report = {\"generated_at\": \"unknown\", \"system_info\": \"unavailable\"}\n\n    if date_service:\n        report[\"generated_at\"] = date_service()\n\n    if info:\n        system_data = info()  # Smart matching gets general info\n        report[\"system_info\"] = system_data\n\n    return report\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#smart-tag-matching-in-action","title":"Smart Tag Matching in Action","text":""},{"location":"01-getting-started/04-dependency-injection/#multiple-services-same-capability","title":"Multiple Services, Same Capability","text":"<p>Consider a system agent providing two different <code>info</code> services:</p> <pre><code># System agent provides TWO info services with different tags\napp = FastMCP(\"System Agent\")\n\n@app.tool()\n@mesh.tool(\n    capability=\"info\",  # Same capability name\n    tags=[\"system\", \"general\"]  # General system info\n)\ndef fetch_system_overview() -&gt; dict:\n    return {\n        \"server_name\": \"system-agent\",\n        \"uptime\": \"120 seconds\",\n        \"version\": \"1.0.0\"\n    }\n\n@app.tool()\n@mesh.tool(\n    capability=\"info\",  # Same capability name\n    tags=[\"system\", \"disk\"]  # Disk-specific info\n)\ndef analyze_storage_and_os() -&gt; dict:\n    return {\n        \"disk_usage\": \"75%\",\n        \"filesystem\": \"ext4\",\n        \"mount_points\": [\"/\", \"/home\"]\n    }\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#smart-resolution-based-on-tags","title":"Smart Resolution Based on Tags","text":"<p>Now other agents can request specific info types:</p> <pre><code># Gets GENERAL system info (not disk info)\n@mesh.tool(\n    dependencies=[{\n        \"capability\": \"info\",\n        \"tags\": [\"system\", \"general\"]  # Matches first service\n    }]\n)\ndef get_general_status(info: mesh.McpMeshTool = None):\n    return info()  # Returns server_name, uptime, version\n\n# Gets DISK info (not general info)\n@mesh.tool(\n    dependencies=[{\n        \"capability\": \"info\",\n        \"tags\": [\"system\", \"disk\"]  # Matches second service\n    }]\n)\ndef get_storage_status(info: mesh.McpMeshTool = None):\n    return info()  # Returns disk_usage, filesystem, mount_points\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#type-safety-options","title":"Type Safety Options","text":""},{"location":"01-getting-started/04-dependency-injection/#option-1-type-safe-with-meshmcpmeshtool","title":"Option 1: Type-Safe with <code>mesh.McpMeshTool</code>","text":"<pre><code>@app.tool()\n@mesh.tool(\n    capability=\"analytics\",\n    dependencies=[\"time_service\", \"data_service\"]\n)\ndef analyze_data(\n    data: list,\n    time_service: mesh.McpMeshTool = None,  # Type-safe\n    data_service: mesh.McpMeshTool = None   # IDE support\n) -&gt; dict:\n    timestamp = time_service() if time_service else \"unknown\"\n    processed = data_service(data) if data_service else data\n\n    return {\n        \"analysis\": \"completed\",\n        \"timestamp\": timestamp,\n        \"processed_data\": processed\n    }\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#option-2-flexible-with-any","title":"Option 2: Flexible with <code>Any</code>","text":"<pre><code>from typing import Any\n\n@app.tool()\n@mesh.tool(\n    capability=\"flexible_processor\",\n    dependencies=[\"time_service\"]\n)\ndef process_flexibly(data: Any, time_service: Any = None) -&gt; dict:\n    # Maximum flexibility - works with any proxy implementation\n    result = {\"data\": data}\n    if time_service:\n        result[\"timestamp\"] = time_service()\n    return result\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#advanced-dependency-patterns","title":"Advanced Dependency Patterns","text":""},{"location":"01-getting-started/04-dependency-injection/#self-dependencies","title":"Self-Dependencies","text":"<p>Agents can depend on their own capabilities:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"health_check\",\n    dependencies=[\"date_service\"]  # Uses own date_service\n)\ndef perform_health_check(date_service: mesh.McpMeshTool = None) -&gt; dict:\n    status = {\"status\": \"healthy\", \"memory\": \"normal\"}\n\n    if date_service:\n        status[\"timestamp\"] = date_service()  # Self-dependency!\n\n    return status\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#complex-tag-combinations","title":"Complex Tag Combinations","text":"<pre><code>@app.tool()\n@mesh.tool(\n    capability=\"comprehensive_report\",\n    dependencies=[\n        \"date_service\",  # Simple dependency\n        {\n            \"capability\": \"info\",\n            \"tags\": [\"system\", \"general\"]  # General system info\n        },\n        {\n            \"capability\": \"info\",\n            \"tags\": [\"system\", \"disk\"]     # Disk info\n        }\n    ]\n)\ndef create_full_report(\n    date_service: mesh.McpMeshTool = None,\n    info: mesh.McpMeshTool = None,      # Gets general info\n    disk_info: mesh.McpMeshTool = None  # Gets disk info\n) -&gt; dict:\n    # This function gets THREE injected services!\n    return {\n        \"timestamp\": date_service() if date_service else \"unknown\",\n        \"system\": info() if info else {},\n        \"storage\": disk_info() if disk_info else {}\n    }\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#how-it-works-behind-the-scenes","title":"How It Works Behind the Scenes","text":""},{"location":"01-getting-started/04-dependency-injection/#1-service-registration","title":"1. Service Registration","text":"<p>When agents start, mesh automatically:</p> <pre><code># System agent registers:\n{\n    \"agent_id\": \"system-agent-abc123\",\n    \"capabilities\": {\n        \"date_service\": {\n            \"function\": \"get_current_time\",\n            \"tags\": [\"system\", \"time\"],\n            \"endpoint\": \"http://system-agent:8080/mcp\"\n        },\n        \"info\": [\n            {\n                \"function\": \"fetch_system_overview\",\n                \"tags\": [\"system\", \"general\"],\n                \"endpoint\": \"http://system-agent:8080/mcp\"\n            },\n            {\n                \"function\": \"analyze_storage_and_os\",\n                \"tags\": [\"system\", \"disk\"],\n                \"endpoint\": \"http://system-agent:8080/mcp\"\n            }\n        ]\n    }\n}\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#2-dependency-resolution","title":"2. Dependency Resolution","text":"<p>When hello world agent starts:</p> <pre><code># Mesh resolves dependencies:\ndependencies = [\n    \"date_service\",  # Finds: system-agent.get_current_time\n    {\n        \"capability\": \"info\",\n        \"tags\": [\"system\", \"general\"]  # Finds: system-agent.fetch_system_overview\n    }\n]\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#3-proxy-creation","title":"3. Proxy Creation","text":"<p>Mesh creates callable proxies:</p> <pre><code># Injected date_service becomes:\ndef date_service_proxy():\n    response = http_post(\"http://system-agent:8080/mcp\", {\n        \"jsonrpc\": \"2.0\",\n        \"method\": \"tools/call\",\n        \"params\": {\n            \"name\": \"get_current_time\",  # Function name!\n            \"arguments\": {}\n        }\n    })\n    return response.result\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#testing-dependency-injection","title":"Testing Dependency Injection","text":""},{"location":"01-getting-started/04-dependency-injection/#check-service-registration","title":"Check Service Registration","text":"<pre><code># See what agents are registered\nmeshctl list\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#test-individual-services","title":"Test Individual Services","text":"<pre><code># Test date service directly\nmeshctl call get_current_time\n\n# Test dependency injection (hello_mesh_simple calls date_service internally)\nmeshctl call hello_mesh_simple\n</code></pre> Alternative: Using curl directly <pre><code># View registry\ncurl -s http://localhost:8000/agents | \\\n  jq '.agents[] | {name: .name, capabilities: (.capabilities | keys)}'\n\n# Test date service directly\ncurl -s -X POST http://localhost:8080/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tools/call\",\"params\":{\"name\":\"get_current_time\",\"arguments\":{}}}'\n\n# Test dependency injection\ncurl -s -X POST http://localhost:9090/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tools/call\",\"params\":{\"name\":\"hello_mesh_simple\",\"arguments\":{}}}'\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#benefits-of-the-new-pattern","title":"Benefits of the New Pattern","text":""},{"location":"01-getting-started/04-dependency-injection/#for-developers","title":"For Developers","text":"<ul> <li>Familiar FastMCP - Keep using <code>@app.tool()</code> decorators</li> <li>Enhanced capabilities - Add <code>@mesh.tool()</code> for orchestration</li> <li>Type safety - Choose between <code>mesh.McpMeshTool</code> and <code>Any</code></li> <li>Smart resolution - Tag-based service selection</li> </ul>"},{"location":"01-getting-started/04-dependency-injection/#for-operations","title":"For Operations","text":"<ul> <li>Zero configuration - No service URLs or config files</li> <li>Automatic discovery - Services find each other automatically</li> <li>Graceful degradation - Functions work without dependencies</li> <li>Real-time updates - Dependencies resolve dynamically</li> </ul>"},{"location":"01-getting-started/04-dependency-injection/#troubleshooting","title":"Troubleshooting","text":""},{"location":"01-getting-started/04-dependency-injection/#dependency-not-injected","title":"Dependency Not Injected","text":"<pre><code># Quick check - see if all dependencies are resolved (e.g., \"4/4\")\nmeshctl list\n\n# Detailed view - shows capabilities, resolved dependencies, and endpoints\nmeshctl status\n</code></pre>"},{"location":"01-getting-started/04-dependency-injection/#wrong-service-selected","title":"Wrong Service Selected","text":"<ul> <li>Check your tags - they determine which service is selected</li> <li>Use specific tag combinations for precise matching</li> <li>Remember: <code>\"general\"</code> vs <code>\"disk\"</code> tags select different services</li> </ul>"},{"location":"01-getting-started/04-dependency-injection/#type-errors","title":"Type Errors","text":"<ul> <li>Use <code>mesh.McpMeshTool</code> for better IDE support</li> <li>Use <code>Any</code> for maximum flexibility</li> <li>Always check if dependency is <code>None</code> before calling</li> </ul>"},{"location":"01-getting-started/04-dependency-injection/#next-steps","title":"Next Steps","text":"<p>Now that you understand dependency injection, let's create a complete agent:</p> <p>Creating Your First Agent \u2192</p>"},{"location":"01-getting-started/04-dependency-injection/#reference-guides","title":"Reference Guides","text":"<ul> <li>Mesh Decorators - Complete decorator parameters and patterns</li> </ul> <p>\ud83d\udca1 Key Insight: The dual decorator pattern gives you familiar FastMCP development with powerful mesh orchestration - the best of both worlds!</p> <p>\ud83c\udff7\ufe0f Pro Tip: Use tags strategically to enable smart service selection - same capability name, different behaviors based on tags.</p>"},{"location":"01-getting-started/05-first-agent/","title":"Creating Your First Agent","text":"<p>Build a complete weather service agent using the dual decorator pattern</p>"},{"location":"01-getting-started/05-first-agent/#overview","title":"Overview","text":"<p>In this guide, you'll create a sophisticated weather service agent that demonstrates:</p> <ul> <li>\ud83c\udf24\ufe0f Multiple MCP decorators - <code>@app.tool</code>, <code>@app.prompt</code>, <code>@app.resource</code></li> <li>\ud83d\udd17 Smart dependency injection - Type-safe dependencies with tag-based resolution</li> <li>\ud83d\udcca Advanced patterns - Self-dependencies and complex service integration</li> <li>\ud83c\udfaf Zero boilerplate - No main methods or manual server setup</li> <li>\ud83c\udff7\ufe0f Tag-based resolution - Intelligent service selection</li> </ul>"},{"location":"01-getting-started/05-first-agent/#project-structure","title":"Project Structure","text":"<p>Create a new directory for your agent:</p> <pre><code>mkdir weather-agent\ncd weather-agent\n\n# Create the structure\ntouch weather_agent.py\ntouch requirements.txt\ntouch README.md\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#step-1-basic-weather-agent-with-dual-decorators","title":"Step 1: Basic Weather Agent with Dual Decorators","text":"<p>Create <code>weather_agent.py</code>:</p> <pre><code>#!/usr/bin/env python3\n\"\"\"\nAdvanced Weather Service Agent\n\nDemonstrates:\n- Dual decorator pattern (@app + @mesh)\n- All MCP decorators (tool, prompt, resource)\n- Smart dependency injection with type safety\n- Tag-based service resolution\n- Self-dependencies\n\"\"\"\n\nimport json\nimport random\nfrom datetime import datetime\nfrom typing import Any\n\nimport mesh\nfrom fastmcp import FastMCP\n\n# Single FastMCP server instance\napp = FastMCP(\"Weather Service\")\n\n# Simulated weather data\nWEATHER_CONDITIONS = [\"sunny\", \"cloudy\", \"rainy\", \"snowy\", \"foggy\", \"windy\"]\nCITIES_DATA = {\n    \"new york\": {\"lat\": 40.7128, \"lon\": -74.0060, \"timezone\": \"EST\"},\n    \"london\": {\"lat\": 51.5074, \"lon\": -0.1278, \"timezone\": \"GMT\"},\n    \"tokyo\": {\"lat\": 35.6762, \"lon\": 139.6503, \"timezone\": \"JST\"},\n    \"sydney\": {\"lat\": -33.8688, \"lon\": 151.2093, \"timezone\": \"AEST\"},\n    \"paris\": {\"lat\": 48.8566, \"lon\": 2.3522, \"timezone\": \"CET\"},\n}\n\n# ===== TOOLS with Smart Dependencies =====\n\n@app.tool()\n@mesh.tool(\n    capability=\"time_service\",\n    tags=[\"weather\", \"time\"],\n    description=\"Get current time for weather timestamp\"\n)\ndef get_weather_time() -&gt; str:\n    \"\"\"Get current time in weather service format.\"\"\"\n    return datetime.now().strftime(\"%Y-%m-%d %H:%M:%S UTC\")\n\n@app.tool()\n@mesh.tool(\n    capability=\"weather_data\",\n    dependencies=[\"time_service\"],  # Self-dependency!\n    tags=[\"weather\", \"core\"],\n    description=\"Get weather data for a city\"\n)\ndef get_weather(\n    city: str,\n    time_service: mesh.McpMeshTool = None\n) -&gt; dict[str, Any]:\n    \"\"\"\n    Get weather information for a specified city.\n\n    Demonstrates self-dependency: uses own time_service capability.\n    \"\"\"\n    city_lower = city.lower()\n\n    if city_lower not in CITIES_DATA:\n        return {\n            \"error\": f\"City '{city}' not found\",\n            \"available_cities\": list(CITIES_DATA.keys()),\n            \"timestamp\": time_service() if time_service else \"unknown\"\n        }\n\n    # Simulate weather data\n    temp_celsius = random.randint(-10, 40)\n    condition = random.choice(WEATHER_CONDITIONS)\n    humidity = random.randint(20, 95)\n    wind_speed = random.randint(0, 60)\n\n    weather_data = {\n        \"city\": city.title(),\n        \"coordinates\": CITIES_DATA[city_lower],\n        \"temperature\": {\n            \"celsius\": temp_celsius,\n            \"fahrenheit\": round((temp_celsius * 9/5) + 32, 1)\n        },\n        \"condition\": condition,\n        \"humidity\": f\"{humidity}%\",\n        \"wind_speed\": f\"{wind_speed} km/h\",\n        \"visibility\": \"10 km\" if condition != \"foggy\" else \"2 km\",\n        \"timestamp\": time_service() if time_service else \"unknown\"\n    }\n\n    return weather_data\n\n@app.tool()\n@mesh.tool(\n    capability=\"weather_forecast\",\n    dependencies=[\n        \"time_service\",  # Self-dependency\n        {\n            \"capability\": \"info\",  # External dependency\n            \"tags\": [\"system\", \"general\"]  # Smart tag matching\n        }\n    ],\n    tags=[\"weather\", \"forecast\"],\n    description=\"Get weather forecast with system info\"\n)\ndef get_forecast(\n    city: str,\n    days: int = 3,\n    time_service: mesh.McpMeshTool = None,\n    info: mesh.McpMeshTool = None\n) -&gt; dict[str, Any]:\n    \"\"\"\n    Get weather forecast for multiple days.\n\n    Demonstrates:\n    - Self-dependency (time_service)\n    - External dependency (system info)\n    - Smart tag-based resolution\n    \"\"\"\n    if days &lt; 1 or days &gt; 7:\n        days = 3\n\n    forecast = {\n        \"city\": city.title(),\n        \"forecast_days\": days,\n        \"generated_at\": time_service() if time_service else \"unknown\",\n        \"days\": []\n    }\n\n    # Add system info if available\n    if info:\n        try:\n            system_data = info()\n            forecast[\"system_info\"] = {\n                \"server\": system_data.get(\"server_name\", \"unknown\"),\n                \"uptime\": system_data.get(\"uptime_formatted\", \"unknown\")\n            }\n        except Exception as e:\n            forecast[\"system_info\"] = f\"Error: {e}\"\n\n    # Generate forecast days\n    for day in range(days):\n        temp = random.randint(-5, 35)\n        forecast[\"days\"].append({\n            \"day\": day + 1,\n            \"date\": f\"2024-01-{day + 1:02d}\",\n            \"temperature\": {\n                \"high\": temp + random.randint(0, 10),\n                \"low\": temp - random.randint(0, 8)\n            },\n            \"condition\": random.choice(WEATHER_CONDITIONS),\n            \"precipitation\": f\"{random.randint(0, 100)}%\"\n        })\n\n    return forecast\n\n# ===== PROMPTS with Dependencies =====\n\n@app.prompt()\n@mesh.tool(\n    capability=\"weather_prompt\",\n    dependencies=[\"weather_data\"],\n    tags=[\"weather\", \"ai\"],\n    description=\"Generate weather analysis prompt\"\n)\ndef weather_analysis_prompt(\n    city: str,\n    analysis_type: str = \"detailed\",\n    weather_data: mesh.McpMeshTool = None\n) -&gt; str:\n    \"\"\"Generate weather analysis prompt with real data.\"\"\"\n\n    # Get current weather\n    weather = {}\n    if weather_data:\n        try:\n            weather = weather_data(city)\n        except Exception as e:\n            weather = {\"error\": str(e)}\n\n    prompt = f\"\"\"Analyze the weather conditions for {city.title()}:\n\nCurrent Weather Data:\n{json.dumps(weather, indent=2)}\n\nAnalysis Type: {analysis_type}\n\nPlease provide:\n1. Current conditions summary\n2. Comfort level assessment\n3. Activity recommendations\n4. What to wear suggestions\n5. Weather pattern insights\n\nFocus on practical advice for residents and visitors.\"\"\"\n\n    return prompt\n\n# ===== RESOURCES with Complex Dependencies =====\n\n@app.resource(\"weather://config/{city}\")\n@mesh.tool(\n    capability=\"weather_config\",\n    dependencies=[\"time_service\"],\n    tags=[\"weather\", \"config\"],\n    description=\"Weather service configuration\"\n)\nasync def weather_config(city: str, time_service: mesh.McpMeshTool = None) -&gt; str:\n    \"\"\"Weather service configuration for specific city.\"\"\"\n\n    config = {\n        \"service_name\": \"Weather Service\",\n        \"version\": \"1.0.0\",\n        \"city\": city.title(),\n        \"capabilities\": [\n            \"weather_data\",\n            \"weather_forecast\",\n            \"weather_prompt\",\n            \"weather_config\",\n            \"time_service\"\n        ],\n        \"features\": {\n            \"real_time_data\": False,\n            \"forecast_days\": 7,\n            \"multiple_cities\": True,\n            \"ai_analysis\": True\n        },\n        \"dependencies\": {\n            \"internal\": [\"time_service\"],\n            \"external\": [\"info (system.general)\"]\n        },\n        \"last_updated\": time_service() if time_service else \"unknown\"\n    }\n\n    return json.dumps(config, indent=2)\n\n@app.resource(\"weather://stats/{metric}\")\n@mesh.tool(\n    capability=\"weather_stats\",\n    dependencies=[\"weather_data\", \"time_service\"],\n    tags=[\"weather\", \"metrics\"],\n    description=\"Weather service statistics\"\n)\nasync def weather_stats(\n    metric: str,\n    weather_data: mesh.McpMeshTool = None,\n    time_service: mesh.McpMeshTool = None\n) -&gt; str:\n    \"\"\"Get weather service statistics.\"\"\"\n\n    stats = {\n        \"metric_type\": metric,\n        \"service_status\": \"operational\",\n        \"cities_supported\": len(CITIES_DATA),\n        \"features_count\": 5,\n        \"dependencies_resolved\": {\n            \"weather_data\": weather_data is not None,\n            \"time_service\": time_service is not None\n        },\n        \"generated_at\": time_service() if time_service else \"unknown\"\n    }\n\n    if metric == \"performance\":\n        stats.update({\n            \"avg_response_time\": \"150ms\",\n            \"uptime\": \"99.9%\",\n            \"requests_per_second\": 42\n        })\n    elif metric == \"usage\":\n        stats.update({\n            \"daily_requests\": 1250,\n            \"popular_cities\": [\"new york\", \"london\", \"tokyo\"],\n            \"forecast_vs_current\": \"60/40\"\n        })\n\n    return json.dumps(stats, indent=2)\n\n# ===== AGENT CONFIGURATION =====\n\n@mesh.agent(\n    name=\"weather-service\",\n    version=\"1.0.0\",\n    description=\"Advanced weather service with FastMCP and mesh integration\",\n    http_port=9091,\n    enable_http=True,\n    auto_run=True  # Zero boilerplate!\n)\nclass WeatherService:\n    \"\"\"\n    Weather Service Agent using dual decorator pattern.\n\n    Features:\n    - All MCP decorators: tools, prompts, resources\n    - Smart dependency injection with type safety\n    - Self-dependencies for internal coordination\n    - External dependencies with tag-based resolution\n    - Zero boilerplate - mesh handles everything\n    \"\"\"\n    pass\n\n# No main method needed!\n# Mesh processor automatically:\n# 1. Discovers the 'app' FastMCP instance\n# 2. Applies dependency injection to all decorated functions\n# 3. Starts HTTP server on configured port\n# 4. Registers all capabilities with mesh registry\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#step-2-dependencies-file","title":"Step 2: Dependencies File","text":"<p>Create <code>requirements.txt</code>:</p> <pre><code>mcp-mesh&gt;=0.8,&lt;0.9\nfastmcp&gt;=2.8.0\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#step-3-documentation","title":"Step 3: Documentation","text":"<p>Create <code>README.md</code>:</p> <pre><code># Weather Service Agent\n\nAdvanced weather service using MCP Mesh's dual decorator pattern.\n\n## Features\n\n- **All MCP Decorators**: Tools, prompts, and resources\n- **Smart Dependencies**: Type-safe injection with tag-based resolution\n- **Self-Dependencies**: Internal service coordination\n- **Zero Boilerplate**: No main methods or manual setup\n\n## Usage\n\n```bash\n# Start the weather service\npython weather_agent.py\n\n# Start system agent (for external dependencies)\npython ../examples/simple/system_agent.py\n```\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#testing","title":"Testing","text":"<pre><code># Test weather data\nmeshctl call get_weather '{\"city\":\"tokyo\"}'\n\n# Test forecast with dependencies\nmeshctl call get_forecast '{\"city\":\"london\",\"days\":5}'\n</code></pre> <pre><code>## Step 4: Testing Your Agent\n\n### Start the Services\n\n```bash\n# Terminal 1: Start system agent (provides external dependencies)\npython examples/simple/system_agent.py\n\n# Terminal 2: Start your weather agent\npython weather_agent.py\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#test-all-features","title":"Test All Features","text":"<pre><code># 1. Test basic weather data (self-dependency)\nmeshctl call get_weather '{\"city\":\"tokyo\"}'\n\n# 2. Test forecast (self + external dependencies)\nmeshctl call get_forecast '{\"city\":\"london\",\"days\":3}'\n</code></pre> Testing prompts and resources (requires curl) <pre><code># 3. Test prompt generation\ncurl -s -X POST http://localhost:9091/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"prompts/get\",\"params\":{\"name\":\"weather_analysis_prompt\",\"arguments\":{\"city\":\"paris\",\"analysis_type\":\"detailed\"}}}'\n\n# 4. Test resource access\ncurl -s -X POST http://localhost:9091/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"resources/read\",\"params\":{\"uri\":\"weather://config/sydney\"}}'\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#verify-service-integration","title":"Verify Service Integration","text":"<pre><code># Quick check - shows agent count and dependency resolution\nmeshctl list\n\n# Detailed view - shows capabilities, dependencies, endpoints\nmeshctl status\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#understanding-what-you-built","title":"Understanding What You Built","text":""},{"location":"01-getting-started/05-first-agent/#the-dual-decorator-pattern","title":"The Dual Decorator Pattern","text":"<p>Your agent demonstrates the power of MCP Mesh:</p> <pre><code>@app.tool()      # \u2190 FastMCP: Handles MCP protocol\n@mesh.tool(      # \u2190 Mesh: Adds orchestration\n    capability=\"weather_data\",\n    dependencies=[\"time_service\"]  # Smart dependency injection\n)\ndef get_weather(city: str, time_service: mesh.McpMeshTool = None):\n    # Business logic here\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#key-innovations","title":"Key Innovations","text":"<ol> <li>All MCP Decorators: <code>@app.tool</code>, <code>@app.prompt</code>, <code>@app.resource</code></li> <li>Smart Dependencies: Tag-based resolution with type safety</li> <li>Self-Dependencies: Internal service coordination</li> <li>Zero Boilerplate: Mesh discovers <code>app</code> and handles everything</li> </ol>"},{"location":"01-getting-started/05-first-agent/#dependency-flow","title":"Dependency Flow","text":"<pre><code>Weather Agent Dependencies:\n\u251c\u2500\u2500 Internal (Self-dependencies)\n\u2502   \u2514\u2500\u2500 time_service \u2192 get_weather_time()\n\u251c\u2500\u2500 External (Cross-service)\n\u2502   \u2514\u2500\u2500 info (system.general) \u2192 system_agent.fetch_system_overview()\n\u2514\u2500\u2500 Automatic Resolution\n    \u251c\u2500\u2500 Mesh finds providers\n    \u251c\u2500\u2500 Creates type-safe proxies\n    \u2514\u2500\u2500 Injects into function parameters\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#advanced-patterns-demonstrated","title":"Advanced Patterns Demonstrated","text":""},{"location":"01-getting-started/05-first-agent/#1-self-dependencies","title":"1. Self-Dependencies","text":"<pre><code># Agent uses its own time service\n@mesh.tool(\n    capability=\"weather_data\",\n    dependencies=[\"time_service\"]  # Own capability!\n)\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#2-smart-tag-resolution","title":"2. Smart Tag Resolution","text":"<pre><code># Gets general system info (not disk info)\ndependencies=[{\n    \"capability\": \"info\",\n    \"tags\": [\"system\", \"general\"]  # Smart matching\n}]\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#3-type-safety","title":"3. Type Safety","text":"<pre><code># Type-safe injection\ndef get_forecast(\n    time_service: mesh.McpMeshTool = None,  # IDE support\n    info: mesh.McpMeshTool = None          # Type hints\n):\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#4-graceful-degradation","title":"4. Graceful Degradation","text":"<pre><code># Works with or without dependencies\ntimestamp = time_service() if time_service else \"unknown\"\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#troubleshooting","title":"Troubleshooting","text":""},{"location":"01-getting-started/05-first-agent/#service-not-starting","title":"Service Not Starting","text":"<pre><code># Check port availability\nlsof -i :9091\n\n# Check for import errors\npython -c \"import mesh, fastmcp; print('Dependencies OK')\"\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#dependencies-not-injected","title":"Dependencies Not Injected","text":"<pre><code># Quick check - see if all dependencies are resolved (e.g., \"4/4\")\nmeshctl list\n\n# Detailed view - shows capabilities, resolved dependencies, and endpoints\nmeshctl status\n</code></pre>"},{"location":"01-getting-started/05-first-agent/#function-not-found","title":"Function Not Found","text":"<ul> <li>MCP calls use function names: <code>get_weather</code></li> <li>Dependencies use capability names: <code>weather_data</code></li> <li>Make sure both are correct in your decorators</li> </ul>"},{"location":"01-getting-started/05-first-agent/#next-steps","title":"Next Steps","text":"<p>Congratulations! You've built a sophisticated agent using MCP Mesh. You've learned:</p> <p>\u2705 Dual decorator pattern - FastMCP + Mesh orchestration \u2705 All MCP decorators - Tools, prompts, and resources \u2705 Smart dependencies - Type-safe injection with tags \u2705 Zero boilerplate - Automatic service discovery and startup</p>"},{"location":"01-getting-started/05-first-agent/#whats-next","title":"What's Next?","text":"<ol> <li>Local Development - Set up professional dev environment</li> <li>Docker Deployment - Containerize your agents</li> <li>Kubernetes - Scale to production</li> </ol>"},{"location":"01-getting-started/05-first-agent/#reference-guides","title":"Reference Guides","text":"<ul> <li>Mesh Decorators - Complete decorator reference with all parameters</li> <li>meshctl CLI - Command-line tool for managing agents</li> <li>Environment Variables - Configuration options and templates</li> </ul> <p>\ud83d\udca1 Key Insight: The dual decorator pattern gives you the familiar FastMCP experience enhanced with powerful mesh orchestration!</p> <p>\ud83c\udfaf Pro Tip: Use self-dependencies for internal coordination and tag-based dependencies for smart external service selection.</p> <p>\ud83d\ude80 Achievement Unlocked: You've mastered the MCP Mesh dual decorator pattern! Ready for production deployment?</p>"},{"location":"01-getting-started/06-llm-integration/","title":"LLM Integration with @mesh.llm","text":"<p>Inject LLM agents as dependencies with automatic tool discovery and type-safe prompt templates</p>"},{"location":"01-getting-started/06-llm-integration/#what-is-meshllm","title":"What is @mesh.llm?","text":"<p>New in v0.7: MCP Mesh treats LLMs as first-class agents in the mesh. With <code>@mesh.llm()</code>, you can:</p> <ul> <li>\ud83e\udd16 Inject LLM agents like any other dependency</li> <li>\ud83d\udd0d Auto-discover tools based on capability filters</li> <li>\ud83d\udcdd Type-safe prompt templates using Jinja2 and Pydantic</li> <li>\ud83d\udd17 Dual injection - combine LLM agents with MCP agents in one function</li> <li>\ud83c\udfaf Enhanced schemas - Field descriptions help LLMs construct contexts correctly</li> </ul> <p>This transforms LLMs from external services into orchestratable mesh capabilities.</p>"},{"location":"01-getting-started/06-llm-integration/#quick-example","title":"Quick Example","text":"<pre><code>import mesh\nfrom fastmcp import FastMCP\nfrom pydantic import BaseModel, Field\n\napp = FastMCP(\"Analysis Service\")\n\n# 1. Simple LLM injection\n@app.tool()\n@mesh.llm(provider=\"claude\", model=\"anthropic/claude-sonnet-4-5\")\n@mesh.tool(capability=\"simple_chat\")\nasync def chat(message: str, llm: mesh.MeshLlmAgent = None) -&gt; str:\n    \"\"\"LLM agent auto-injected, no configuration needed.\"\"\"\n    return await llm(message)\n\n# 2. LLM with tool discovery filter\n@app.tool()\n@mesh.llm(\n    system_prompt=\"You are a helpful system analyst.\",\n    filter={\"tags\": [\"system\"]},  # Auto-discover system tools\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"system_analysis\")\nasync def analyze(query: str, llm: mesh.MeshLlmAgent = None) -&gt; dict:\n    \"\"\"LLM automatically has access to all system-tagged tools.\"\"\"\n    return await llm(query)\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#core-concepts","title":"Core Concepts","text":""},{"location":"01-getting-started/06-llm-integration/#1-llm-dependency-injection","title":"1. LLM Dependency Injection","text":"<p>LLMs are injected as <code>MeshLlmAgent</code> parameters, just like MCP agents:</p> <pre><code>@app.tool()\n@mesh.llm(provider=\"claude\", model=\"anthropic/claude-sonnet-4-5\")\n@mesh.tool(capability=\"assistant\")\nasync def help_user(\n    question: str,\n    llm: mesh.MeshLlmAgent = None  # \u2190 Injected LLM agent\n) -&gt; str:\n    if llm is None:\n        return \"LLM service unavailable\"\n\n    result = await llm(question)\n    return result\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#2-automatic-tool-discovery","title":"2. Automatic Tool Discovery","text":"<p>Use <code>filter</code> to automatically discover and inject tools into the LLM's context:</p> <pre><code>@app.tool()\n@mesh.llm(\n    filter={\n        \"capability\": \"weather_service\",  # Specific capability\n        \"tags\": [\"weather\", \"forecast\"]    # Or by tags\n    },\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"weather_chat\")\nasync def weather_assistant(query: str, llm: mesh.MeshLlmAgent = None):\n    \"\"\"LLM automatically gets weather tools without manual configuration.\"\"\"\n    return await llm(query)\n</code></pre> <p>The LLM will have access to all tools matching the filter - no manual tool specification needed!</p>"},{"location":"01-getting-started/06-llm-integration/#3-type-safe-prompt-templates","title":"3. Type-Safe Prompt Templates","text":"<p>Use Jinja2 templates with Pydantic models for validated, reusable prompts:</p> <pre><code>from mesh import MeshContextModel\n\n# Define type-safe context\nclass AnalysisContext(MeshContextModel):\n    \"\"\"Context for analysis prompts.\"\"\"\n    domain: str = Field(..., description=\"Analysis domain: infrastructure, security, or performance\")\n    user_level: str = Field(default=\"beginner\", description=\"User expertise: beginner, intermediate, expert\")\n    focus_areas: list[str] = Field(default_factory=list, description=\"Specific areas to analyze\")\n\n@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/analyst.jinja2\",  # Load from file\n    context_param=\"ctx\",  # Which parameter contains context\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"analysis\")\nasync def analyze_system(\n    query: str,\n    ctx: AnalysisContext,  # Type-safe context\n    llm: mesh.MeshLlmAgent = None\n) -&gt; dict:\n    # Template auto-rendered with ctx before LLM call\n    return await llm(query)\n</code></pre> <p>Template file (<code>prompts/analyst.jinja2</code>):</p> <pre><code>You are a {{ domain }} analysis expert.\nUser expertise level: {{ user_level }}\n\n{% if focus_areas %}\nFocus your analysis on: {{ focus_areas | join(\", \") }}\n{% endif %}\n\nProvide detailed analysis appropriate for {{ user_level }}-level users.\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#meshllm-decorator-reference","title":"@mesh.llm Decorator Reference","text":""},{"location":"01-getting-started/06-llm-integration/#parameters","title":"Parameters","text":"Parameter Type Default Description <code>system_prompt</code> <code>str</code> <code>None</code> Literal prompt or <code>file://path/to/template.jinja2</code> <code>filter</code> <code>dict</code> <code>None</code> Tool discovery filter (capability, tags, version) <code>provider</code> <code>str</code> <code>\"claude\"</code> LLM provider (claude, openai, etc.) <code>model</code> <code>str</code> Required Model identifier <code>context_param</code> <code>str</code> <code>None</code> Parameter name containing template context <code>max_iterations</code> <code>int</code> <code>5</code> Max agentic loop iterations"},{"location":"01-getting-started/06-llm-integration/#basic-usage-patterns","title":"Basic Usage Patterns","text":""},{"location":"01-getting-started/06-llm-integration/#pattern-1-simple-llm-chat","title":"Pattern 1: Simple LLM Chat","text":"<pre><code>@app.tool()\n@mesh.llm(\n    system_prompt=\"You are a helpful assistant.\",\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"chat\")\nasync def chat(message: str, llm: mesh.MeshLlmAgent = None) -&gt; str:\n    return await llm(message)\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#pattern-2-llm-with-tool-access","title":"Pattern 2: LLM with Tool Access","text":"<pre><code>@app.tool()\n@mesh.llm(\n    system_prompt=\"You are a system administrator with access to monitoring tools.\",\n    filter={\"tags\": [\"system\", \"monitoring\"]},  # Auto-discover tools\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"system_admin\")\nasync def admin_assistant(task: str, llm: mesh.MeshLlmAgent = None):\n    return await llm(task)\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#pattern-3-template-based-prompts","title":"Pattern 3: Template-Based Prompts","text":"<pre><code>@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/chat.jinja2\",\n    context_param=\"ctx\",\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"personalized_chat\")\nasync def chat(\n    message: str,\n    ctx: dict,  # Can be dict or MeshContextModel\n    llm: mesh.MeshLlmAgent = None\n):\n    return await llm(message)\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#advanced-dual-injection-llm-mcp-agent","title":"Advanced: Dual Injection (LLM + MCP Agent)","text":"<p>New in v0.7: Inject both LLM agents AND MCP agents into the same function:</p> <pre><code>from pydantic import BaseModel\n\nclass EnrichedResult(BaseModel):\n    \"\"\"LLM result enriched with MCP agent data.\"\"\"\n    analysis: str\n    recommendations: list[str]\n    timestamp: str\n    system_info: str\n\n@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/dual_injection.jinja2\",\n    filter={\"tags\": [\"system\"]},  # LLM gets system tools\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(\n    capability=\"enriched_analysis\",\n    dependencies=[{\n        \"capability\": \"date_service\",\n        \"tags\": [\"system\", \"time\"]\n    }]  # Direct MCP agent dependency\n)\nasync def analyze_with_enrichment(\n    query: str,\n    llm: mesh.MeshLlmAgent = None,        # \u2190 Injected LLM\n    date_service: mesh.McpMeshTool = None  # \u2190 Injected MCP agent\n) -&gt; EnrichedResult:\n    \"\"\"Both LLM and MCP agents injected!\"\"\"\n\n    # Step 1: Get LLM analysis (with system tools)\n    llm_result = await llm(query)\n\n    # Step 2: Call MCP agent directly for enrichment\n    timestamp = await date_service() if date_service else \"N/A\"\n\n    # Step 3: Combine results\n    return EnrichedResult(\n        analysis=llm_result.analysis,\n        recommendations=llm_result.recommendations,\n        timestamp=timestamp,\n        system_info=\"Analysis enriched with real-time data\"\n    )\n</code></pre> <p>This pattern lets you:</p> <ul> <li>Use LLM for intelligent analysis (with filtered tool access)</li> <li>Call specific MCP agents directly for data enrichment</li> <li>Orchestrate both in a single, clean function</li> </ul>"},{"location":"01-getting-started/06-llm-integration/#meshcontextmodel-for-type-safety","title":"MeshContextModel for Type Safety","text":"<p><code>MeshContextModel</code> provides Pydantic-based validation for prompt contexts:</p> <pre><code>from mesh import MeshContextModel\nfrom pydantic import Field\n\nclass ChatContext(MeshContextModel):\n    \"\"\"Type-safe context for chat prompts.\"\"\"\n    user_name: str = Field(..., description=\"User's display name\")\n    domain: str = Field(..., description=\"Conversation domain\")\n    expertise_level: str = Field(\n        default=\"beginner\",\n        description=\"User expertise: beginner, intermediate, expert\"\n    )\n\n@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/chat.jinja2\",\n    context_param=\"ctx\",\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"smart_chat\")\nasync def chat(\n    message: str,\n    ctx: ChatContext,  # Validated at runtime\n    llm: mesh.MeshLlmAgent = None\n):\n    # ctx is guaranteed to have user_name, domain, expertise_level\n    return await llm(message)\n\n# Usage\nchat(\n    \"What's the weather?\",\n    ctx=ChatContext(\n        user_name=\"Alice\",\n        domain=\"meteorology\",\n        expertise_level=\"expert\"\n    )\n)\n</code></pre> <p>Benefits:</p> <ul> <li>\u2705 Runtime validation of context fields</li> <li>\u2705 IDE autocomplete for context attributes</li> <li>\u2705 Self-documenting prompts</li> <li>\u2705 Field descriptions exported to tool schemas</li> </ul>"},{"location":"01-getting-started/06-llm-integration/#enhanced-schemas-for-llm-chains","title":"Enhanced Schemas for LLM Chains","text":"<p>When LLMs call other LLMs, Field descriptions are automatically included in tool schemas:</p> <pre><code># Specialist LLM with MeshContextModel\nclass AnalysisContext(MeshContextModel):\n    domain: str = Field(\n        ...,\n        description=\"Analysis domain: infrastructure, security, or performance\"\n    )\n    user_level: str = Field(\n        default=\"beginner\",\n        description=\"User expertise level: beginner, intermediate, or expert\"\n    )\n\n@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/analyst.jinja2\",\n    context_param=\"ctx\",\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"specialist_analysis\")\nasync def analyze(request: str, ctx: AnalysisContext, llm: mesh.MeshLlmAgent = None):\n    return await llm(request)\n\n# Orchestrator LLM that calls specialist\n@app.tool()\n@mesh.llm(\n    filter={\"capability\": \"specialist_analysis\"},  # Discovers specialist\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"orchestrator\")\nasync def orchestrate(task: str, llm: mesh.MeshLlmAgent = None):\n    # LLM sees enhanced schema with Field descriptions\n    # Knows domain is \"infrastructure|security|performance\"\n    # Knows user_level is \"beginner|intermediate|expert\"\n    return await llm(task)\n</code></pre> <p>The orchestrator LLM receives:</p> <pre><code>{\n  \"name\": \"analyze\",\n  \"inputSchema\": {\n    \"properties\": {\n      \"ctx\": {\n        \"properties\": {\n          \"domain\": {\n            \"type\": \"string\",\n            \"description\": \"Analysis domain: infrastructure, security, or performance\"\n          },\n          \"user_level\": {\n            \"type\": \"string\",\n            \"default\": \"beginner\",\n            \"description\": \"User expertise level: beginner, intermediate, or expert\"\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>This dramatically improves LLM chain success rates!</p>"},{"location":"01-getting-started/06-llm-integration/#prompt-template-features","title":"Prompt Template Features","text":""},{"location":"01-getting-started/06-llm-integration/#file-based-templates","title":"File-Based Templates","text":"<p>Use <code>file://</code> prefix to load templates from files:</p> <pre><code>@mesh.llm(\n    system_prompt=\"file://prompts/analyst.jinja2\",  # Relative path\n    # OR\n    system_prompt=\"file:///absolute/path/to/template.jinja2\"  # Absolute path\n)\n</code></pre> <p>Templates are cached after first load for performance.</p>"},{"location":"01-getting-started/06-llm-integration/#context-detection","title":"Context Detection","text":"<p>MCP Mesh auto-detects context parameters using:</p> <ol> <li>Explicit (recommended): <code>context_param=\"ctx\"</code></li> <li>Convention: Parameters named <code>prompt_context</code>, <code>llm_context</code>, or <code>ctx</code></li> <li>Type hint: Any parameter typed as <code>MeshContextModel</code> subclass</li> </ol> <pre><code># Explicit - recommended for clarity\n@mesh.llm(system_prompt=\"file://prompts/chat.jinja2\", context_param=\"my_ctx\")\ndef chat(msg: str, my_ctx: dict, llm=None): ...\n\n# Convention - auto-detected\n@mesh.llm(system_prompt=\"file://prompts/chat.jinja2\")\ndef chat(msg: str, ctx: dict, llm=None): ...  # \"ctx\" detected\n\n# Type hint - auto-detected\n@mesh.llm(system_prompt=\"file://prompts/chat.jinja2\")\ndef chat(msg: str, analysis_ctx: AnalysisContext, llm=None): ...  # MeshContextModel detected\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#jinja2-template-features","title":"Jinja2 Template Features","text":"<p>Full Jinja2 support including:</p> <p>Variables:</p> <pre><code>Hello {{ user_name }}! You are in {{ domain }} domain.\n</code></pre> <p>Conditionals:</p> <pre><code>{% if user_level == \"expert\" %}\nBe concise and technical.\n{% else %}\nExplain concepts in simple terms.\n{% endif %}\n</code></pre> <p>Loops:</p> <pre><code>Focus on these areas:\n{% for area in focus_areas %}\n  - {{ area }}\n{% endfor %}\n</code></pre> <p>Filters:</p> <pre><code>{{ capabilities | join(\", \") }}\n{{ task_type | upper }}\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#context-types","title":"Context Types","text":"<p>Three context types are supported:</p> <pre><code># 1. MeshContextModel (recommended - type safe)\n@mesh.llm(system_prompt=\"file://prompts/chat.jinja2\")\nasync def chat(msg: str, ctx: ChatContext, llm=None):\n    # ctx validated by Pydantic\n    pass\n\n# 2. Dict (flexible)\n@mesh.llm(system_prompt=\"file://prompts/chat.jinja2\", context_param=\"ctx\")\nasync def chat(msg: str, ctx: dict, llm=None):\n    # ctx used directly\n    pass\n\n# 3. None (static template)\n@mesh.llm(system_prompt=\"file://prompts/static.jinja2\")\nasync def chat(msg: str, llm=None):\n    # Template rendered with empty dict {}\n    pass\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#complete-example-multi-llm-system","title":"Complete Example: Multi-LLM System","text":"<pre><code>import mesh\nfrom fastmcp import FastMCP\nfrom mesh import MeshContextModel\nfrom pydantic import BaseModel, Field\n\napp = FastMCP(\"Multi-LLM Service\")\n\n# 1. Context models\nclass DocumentContext(MeshContextModel):\n    doc_type: str = Field(..., description=\"Document type: technical, business, legal\")\n    audience: str = Field(..., description=\"Target audience: engineer, executive, lawyer\")\n    max_length: int = Field(default=1000, description=\"Max output length\")\n\n# 2. Specialist LLM - Document Analyzer\n@app.tool()\n@mesh.llm(\n    system_prompt=\"file://prompts/document_analyzer.jinja2\",\n    context_param=\"ctx\",\n    filter={\"tags\": [\"document\", \"ocr\"]},  # Gets document tools\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"document_analysis\", tags=[\"llm\", \"analysis\"])\nasync def analyze_document(\n    document: str,\n    ctx: DocumentContext,\n    llm: mesh.MeshLlmAgent = None\n) -&gt; dict:\n    return await llm(document)\n\n# 3. Orchestrator LLM - Coordinates specialists\n@app.tool()\n@mesh.llm(\n    system_prompt=\"You are an orchestrator coordinating document workflows.\",\n    filter={\"capability\": \"document_analysis\"},  # Discovers analyzer\n    provider=\"claude\",\n    model=\"anthropic/claude-sonnet-4-5\"\n)\n@mesh.tool(capability=\"document_orchestrator\")\nasync def process_document_workflow(\n    task: str,\n    llm: mesh.MeshLlmAgent = None\n) -&gt; dict:\n    # Orchestrator calls specialist with proper context\n    return await llm(task)\n\n# 4. Configure agent\n@mesh.agent(\n    name=\"multi-llm-service\",\n    version=\"1.0.0\",\n    http_port=8080,\n    enable_http=True,\n    auto_run=True\n)\nclass MultiLlmAgent:\n    pass\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#best-practices","title":"Best Practices","text":""},{"location":"01-getting-started/06-llm-integration/#1-use-type-safe-contexts","title":"1. Use Type-Safe Contexts","text":"<p>\u2705 Good:</p> <pre><code>class AnalysisContext(MeshContextModel):\n    domain: str = Field(..., description=\"Analysis domain\")\n    user_level: str = Field(default=\"beginner\")\n\n@mesh.llm(system_prompt=\"file://prompts/analyst.jinja2\", context_param=\"ctx\")\ndef analyze(query: str, ctx: AnalysisContext, llm=None):\n    pass\n</code></pre> <p>\u274c Avoid:</p> <pre><code>@mesh.llm(system_prompt=\"file://prompts/analyst.jinja2\")\ndef analyze(query: str, ctx: dict, llm=None):  # No validation\n    pass\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#2-add-field-descriptions","title":"2. Add Field Descriptions","text":"<p>\u2705 Good:</p> <pre><code>class AnalysisContext(MeshContextModel):\n    domain: str = Field(..., description=\"Analysis domain: infrastructure, security, or performance\")\n    # Helps LLMs in chains understand valid values\n</code></pre> <p>\u274c Avoid:</p> <pre><code>class AnalysisContext(MeshContextModel):\n    domain: str  # No description for LLMs to use\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#3-version-prompts-separately","title":"3. Version Prompts Separately","text":"<p>\u2705 Good:</p> <pre><code># prompts/analyst_v1.jinja2\n# prompts/analyst_v2.jinja2\n@mesh.llm(system_prompt=\"file://prompts/analyst_v2.jinja2\")\n</code></pre> <p>\u274c Avoid:</p> <pre><code>@mesh.llm(system_prompt=\"You are an analyst. Do X. Do Y. Do Z...\")  # Hardcoded\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#4-use-filters-for-tool-discovery","title":"4. Use Filters for Tool Discovery","text":"<p>\u2705 Good:</p> <pre><code>@mesh.llm(filter={\"tags\": [\"system\", \"monitoring\"]})  # Discovers tools dynamically\n</code></pre> <p>\u274c Avoid:</p> <pre><code># Manually listing tools in system prompt\n@mesh.llm(system_prompt=\"You have access to get_cpu, get_memory, get_disk...\")\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#5-always-check-for-none","title":"5. Always Check for None","text":"<p>\u2705 Good:</p> <pre><code>async def chat(msg: str, llm: mesh.MeshLlmAgent = None):\n    if llm is None:\n        return \"LLM service unavailable\"\n    return await llm(msg)\n</code></pre> <p>\u274c Avoid:</p> <pre><code>async def chat(msg: str, llm: mesh.MeshLlmAgent = None):\n    return await llm(msg)  # Crashes if LLM unavailable\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#troubleshooting","title":"Troubleshooting","text":""},{"location":"01-getting-started/06-llm-integration/#llm-not-injected-llm-is-none","title":"LLM Not Injected (llm is None)","text":"<p>Cause: Missing provider configuration or API key</p> <p>Solution:</p> <pre><code>export ANTHROPIC_API_KEY=your-api-key\n# or\nexport OPENAI_API_KEY=your-api-key\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#template-file-not-found","title":"Template File Not Found","text":"<p>Cause: Incorrect path resolution</p> <p>Solution:</p> <pre><code># Use absolute path for debugging\n@mesh.llm(system_prompt=\"file:///absolute/path/to/template.jinja2\")\n\n# Or ensure relative path is from agent file location\n# If agent is in /app/agent.py\n# Template should be in /app/prompts/template.jinja2\n@mesh.llm(system_prompt=\"file://prompts/template.jinja2\")\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#template-rendering-error","title":"Template Rendering Error","text":"<p>Cause: Missing variables or syntax errors</p> <p>Solution:</p> <ul> <li>Check Jinja2 syntax in template</li> <li>Ensure all variables in template exist in context</li> <li>Use <code>{% if variable %}</code> for optional variables</li> </ul> <pre><code>{# Safe template with optional variables #}\nHello {{ user_name | default(\"Guest\") }}!\n\n{% if expertise_level %}\nYour level: {{ expertise_level }}\n{% endif %}\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#context-validation-errors","title":"Context Validation Errors","text":"<p>Cause: Missing required fields in MeshContextModel</p> <p>Solution:</p> <pre><code># All required fields must be provided\nchat(\n    \"Hello\",\n    ctx=ChatContext(\n        user_name=\"Alice\",  # Required\n        domain=\"tech\"       # Required\n        # expertise_level optional (has default)\n    )\n)\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#filter-not-finding-tools","title":"Filter Not Finding Tools","text":"<p>Cause: No tools match the filter criteria</p> <p>Solution:</p> <pre><code># Check tool registration\nmeshctl list --wide  # See all capabilities and tags\n\n# Broaden filter\n@mesh.llm(filter={\"tags\": [\"system\"]})  # Instead of specific tags\n</code></pre>"},{"location":"01-getting-started/06-llm-integration/#whats-next","title":"What's Next?","text":"<ul> <li>Advanced Patterns - Multi-LLM orchestration</li> <li>Observability - Monitor LLM calls and performance</li> <li>Production Deployment - Deploy LLM agents to Kubernetes</li> </ul> <p>\ud83d\udca1 Pro Tip: Start with simple LLM injection, then add filters, then templates. Build complexity gradually.</p> <p>\ud83d\udd10 Security Note: Never commit API keys. Use environment variables or secret management.</p> <p>\ud83d\udcca Monitoring: LLM calls are automatically traced - check Grafana dashboards for performance metrics.</p>"},{"location":"01-getting-started/troubleshooting/","title":"Troubleshooting Guide - Getting Started","text":"<p>Solutions to common issues when starting with MCP Mesh</p>"},{"location":"01-getting-started/troubleshooting/#quick-diagnostics","title":"Quick Diagnostics","text":"<p>Run this diagnostic script to check common issues:</p> <pre><code>#!/bin/bash\n# save as diagnose.sh\n\necho \"MCP Mesh Diagnostic Tool\"\necho \"=======================\"\n\n# Check Python version\necho -n \"Python version: \"\npython3 --version || echo \"\u274c Python not found\"\n\n# Check if MCP Mesh is installed\necho -n \"MCP Mesh installed: \"\npython3 -c \"import mcp_mesh; print('\u2705 Yes')\" 2&gt;/dev/null || echo \"\u274c No\"\n\n# Check ports\nfor port in 8000 8080 8081; do\n    echo -n \"Port $port: \"\n    if lsof -i :$port &gt;/dev/null 2&gt;&amp;1; then\n        echo \"\u274c In use\"\n    else\n        echo \"\u2705 Available\"\n    fi\ndone\n\n# Check registry\necho -n \"Registry health: \"\ncurl -s http://localhost:8000/health &gt;/dev/null 2&gt;&amp;1 &amp;&amp; echo \"\u2705 Healthy\" || echo \"\u274c Not reachable\"\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#common-issues-and-solutions","title":"Common Issues and Solutions","text":""},{"location":"01-getting-started/troubleshooting/#1-python-import-errors","title":"1. Python Import Errors","text":""},{"location":"01-getting-started/troubleshooting/#problem","title":"Problem","text":"<pre><code>ImportError: No module named 'mcp_mesh'\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#solutions","title":"Solutions","text":"<p>Check virtual environment is activated:</p> <pre><code># Should show your venv path\nwhich python\n\n# If not, activate it\nsource venv/bin/activate  # or .venv/bin/activate\n</code></pre> <p>Reinstall MCP Mesh:</p> <pre><code>pip uninstall mcp-mesh\npip install mcp-mesh\n</code></pre> <p>Check installation:</p> <pre><code>pip list | grep mcp-mesh\npython -c \"import mcp_mesh; print(mcp_mesh.__version__)\"\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#2-registry-connection-failed","title":"2. Registry Connection Failed","text":""},{"location":"01-getting-started/troubleshooting/#problem_1","title":"Problem","text":"<pre><code>ERROR: Failed to connect to registry at http://localhost:8000\nConnection refused\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#solutions_1","title":"Solutions","text":"<p>Start the registry:</p> <pre><code># In a separate terminal\npython -m mcp_mesh.registry.server\n\n# Or with custom port\npython -m mcp_mesh.registry.server --port 8001\n</code></pre> <p>Check if registry is running:</p> <pre><code># Check process\nps aux | grep mcp_mesh.registry\n\n# Check port\nlsof -i :8000\n\n# Test health endpoint\ncurl http://localhost:8000/health\n</code></pre> <p>Use correct registry URL:</p> <pre><code># Set environment variable\nexport MCP_MESH_REGISTRY_URL=http://localhost:8000\n\n# Or pass directly to agent\npython my_agent.py --registry-url http://localhost:8000\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#3-port-already-in-use","title":"3. Port Already in Use","text":""},{"location":"01-getting-started/troubleshooting/#problem_2","title":"Problem","text":"<pre><code>OSError: [Errno 48] Address already in use\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#solutions_2","title":"Solutions","text":"<p>Find what's using the port:</p> <pre><code># On macOS/Linux\nlsof -i :8080\n\n# On Windows\nnetstat -ano | findstr :8080\n</code></pre> <p>Kill the process:</p> <pre><code># Get PID from lsof output\nkill -9 &lt;PID&gt;\n\n# Or kill by port (macOS/Linux)\nkill -9 $(lsof -t -i:8080)\n</code></pre> <p>Use a different port:</p> <pre><code># In your agent\n@mesh_agent(\n    capability=\"my_agent\",\n    enable_http=True,\n    http_port=8090  # Different port\n)\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#4-dependency-not-resolved","title":"4. Dependency Not Resolved","text":""},{"location":"01-getting-started/troubleshooting/#problem_3","title":"Problem","text":"<pre><code>ERROR: Failed to resolve dependency: SystemAgent_getDate\nNo agents found providing capability: SystemAgent\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#solutions_3","title":"Solutions","text":"<p>Ensure dependency agent is running:</p> <pre><code># Start the system agent\ncd examples\npython system_agent.py\n</code></pre> <p>Check agent registration:</p> <pre><code># List all agents\ncurl http://localhost:8000/agents\n\n# Check specific capability\ncurl http://localhost:8000/agents?capability=SystemAgent\n</code></pre> <p>Verify dependency name:</p> <pre><code># Dependency names must match exactly\ndependencies=[\"SystemAgent_getDate\"]  # Correct\ndependencies=[\"systemagent_getdate\"]  # Wrong - case sensitive\ndependencies=[\"SystemAgent.getDate\"]  # Wrong - use underscore\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#5-agent-registration-failed","title":"5. Agent Registration Failed","text":""},{"location":"01-getting-started/troubleshooting/#problem_4","title":"Problem","text":"<pre><code>ERROR: Agent registration failed: 400 Bad Request\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#solutions_4","title":"Solutions","text":"<p>Check agent configuration:</p> <pre><code>@mesh_agent(\n    capability=\"weather\",  # Must be non-empty\n    version=\"1.0.0\",      # Must be valid semver\n    enable_http=True,\n    http_port=8080        # Must be valid port\n)\n</code></pre> <p>Enable debug logging:</p> <pre><code>export MCP_MESH_LOG_LEVEL=DEBUG\npython my_agent.py\n</code></pre> <p>Verify network connectivity:</p> <pre><code># Can you reach the registry?\nping localhost\ncurl http://localhost:8000/health\n\n# Check firewall\nsudo iptables -L  # Linux\nsudo pfctl -s rules  # macOS\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#6-heartbeat-failures","title":"6. Heartbeat Failures","text":""},{"location":"01-getting-started/troubleshooting/#problem_5","title":"Problem","text":"<pre><code>WARNING: Heartbeat failed: Connection timeout\nAgent marked as unhealthy\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#solutions_5","title":"Solutions","text":"<p>Increase heartbeat interval:</p> <pre><code>@mesh_agent(\n    capability=\"slow_agent\",\n    heartbeat_interval=60,  # Increase from default 30s\n    heartbeat_timeout=10    # Increase timeout\n)\n</code></pre> <p>Check network stability:</p> <pre><code># Monitor network\nping -c 100 localhost\n\n# Check for packet loss\nmtr localhost\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#7-performance-issues","title":"7. Performance Issues","text":""},{"location":"01-getting-started/troubleshooting/#problem_6","title":"Problem","text":"<ul> <li>Slow agent startup</li> <li>High latency between agents</li> <li>Memory usage growing</li> </ul>"},{"location":"01-getting-started/troubleshooting/#solutions_6","title":"Solutions","text":"<p>Profile your code:</p> <pre><code>import cProfile\nimport pstats\n\nprofiler = cProfile.Profile()\nprofiler.enable()\n\n# Your agent code\n\nprofiler.disable()\nstats = pstats.Stats(profiler)\nstats.sort_stats('cumulative')\nstats.print_stats(10)\n</code></pre> <p>Enable connection pooling:</p> <pre><code># In your agent initialization\nimport aiohttp\n\nconnector = aiohttp.TCPConnector(\n    limit=100,\n    limit_per_host=30,\n    ttl_dns_cache=300\n)\n</code></pre> <p>Monitor memory:</p> <pre><code>import tracemalloc\ntracemalloc.start()\n\n# Your code\n\ncurrent, peak = tracemalloc.get_traced_memory()\nprint(f\"Current memory: {current / 10**6:.1f} MB\")\nprint(f\"Peak memory: {peak / 10**6:.1f} MB\")\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#8-dockercontainer-issues","title":"8. Docker/Container Issues","text":""},{"location":"01-getting-started/troubleshooting/#problem_7","title":"Problem","text":"<ul> <li>Container can't connect to registry</li> <li>Agents can't find each other in containers</li> </ul>"},{"location":"01-getting-started/troubleshooting/#solutions_7","title":"Solutions","text":"<p>Use correct network:</p> <pre><code># docker-compose.yml\nservices:\n  agent:\n    networks:\n      - mcp-mesh\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n\nnetworks:\n  mcp-mesh:\n    driver: bridge\n</code></pre> <p>Use container names:</p> <pre><code># Not localhost when in containers\nexport MCP_MESH_REGISTRY_URL=http://mcp-core-mcp-mesh-registry:8000\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#9-windows-specific-issues","title":"9. Windows-Specific Issues","text":""},{"location":"01-getting-started/troubleshooting/#problem_8","title":"Problem","text":"<ul> <li>Path separator issues</li> <li>Encoding problems</li> <li>Process management</li> </ul>"},{"location":"01-getting-started/troubleshooting/#solutions_8","title":"Solutions","text":"<p>Use pathlib for paths:</p> <pre><code>from pathlib import Path\n\nconfig_path = Path(\"configs\") / \"agent.yaml\"\n</code></pre> <p>Set encoding:</p> <pre><code># At top of file\n# -*- coding: utf-8 -*-\n\n# When opening files\nwith open(file, 'r', encoding='utf-8') as f:\n    content = f.read()\n</code></pre> <p>Use cross-platform commands:</p> <pre><code>import sys\nimport subprocess\n\nif sys.platform == \"win32\":\n    subprocess.run([\"cmd\", \"/c\", \"dir\"])\nelse:\n    subprocess.run([\"ls\", \"-la\"])\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#debug-techniques","title":"Debug Techniques","text":""},{"location":"01-getting-started/troubleshooting/#1-enable-verbose-logging","title":"1. Enable Verbose Logging","text":"<pre><code>import logging\nimport sys\n\n# Configure detailed logging\nlogging.basicConfig(\n    level=logging.DEBUG,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\n    handlers=[\n        logging.StreamHandler(sys.stdout),\n        logging.FileHandler('debug.log')\n    ]\n)\n\n# Enable HTTP request logging\nlogging.getLogger('aiohttp').setLevel(logging.DEBUG)\nlogging.getLogger('urllib3').setLevel(logging.DEBUG)\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#2-use-registry-api","title":"2. Use Registry API","text":"<pre><code># Get all agents\ncurl http://localhost:8000/agents | jq\n\n# Get agent details\ncurl http://localhost:8000/agents/&lt;agent-id&gt; | jq\n\n# Check dependencies\ncurl http://localhost:8000/dependencies | jq\n\n# View logs\ncurl http://localhost:8000/logs?level=error | jq\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#3-test-individual-components","title":"3. Test Individual Components","text":"<pre><code># test_components.py\nimport asyncio\nfrom mcp_mesh.registry import RegistryClient\n\nasync def test_registry():\n    client = RegistryClient(\"http://localhost:8000\")\n\n    # Test connection\n    health = await client.health_check()\n    print(f\"Registry health: {health}\")\n\n    # Test registration\n    agent_id = await client.register_agent({\n        \"name\": \"test-agent\",\n        \"capabilities\": [\"test\"],\n        \"endpoint\": \"http://localhost:9999\"\n    })\n    print(f\"Registered with ID: {agent_id}\")\n\n    # Test discovery\n    agents = await client.find_agents(\"test\")\n    print(f\"Found agents: {agents}\")\n\nasyncio.run(test_registry())\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#getting-help","title":"Getting Help","text":""},{"location":"01-getting-started/troubleshooting/#1-gather-information","title":"1. Gather Information","text":"<p>Before asking for help, collect:</p> <pre><code># System info\npython --version\npip list | grep mcp\nuname -a  # or system info on Windows\n\n# Error logs\npython my_agent.py 2&gt;&amp;1 | tee error.log\n\n# Registry state\ncurl http://localhost:8000/agents &gt; agents.json\ncurl http://localhost:8000/health &gt; health.json\n</code></pre>"},{"location":"01-getting-started/troubleshooting/#2-check-resources","title":"2. Check Resources","text":"<ol> <li>GitHub Issues</li> <li>GitHub Discussions</li> <li>Discord Community</li> </ol>"},{"location":"01-getting-started/troubleshooting/#3-report-issues","title":"3. Report Issues","text":"<p>Include in your report:</p> <ul> <li>MCP Mesh version</li> <li>Python version</li> <li>Operating system</li> <li>Full error message</li> <li>Minimal code to reproduce</li> <li>What you've already tried</li> </ul>"},{"location":"01-getting-started/troubleshooting/#prevention-tips","title":"Prevention Tips","text":"<ol> <li>Always use virtual environments</li> <li>Keep dependencies updated</li> <li>Use consistent Python versions</li> <li>Test in Docker before production</li> <li>Monitor logs continuously</li> <li>Set up health checks</li> <li>Use connection pooling</li> <li>Handle errors gracefully</li> </ol> <p>\ud83d\udca1 Quick Fix: Most issues are resolved by: 1) Checking the registry is running, 2) Verifying ports are available, 3) Ensuring virtual environment is activated.</p> <p>\ud83d\udcda Next Steps: If you're still having issues, ask in the community Discord or open an issue on GitHub.</p>"},{"location":"03-docker-deployment/04-networking/","title":"Networking in Docker Compose","text":"<p>How agents discover and communicate with each other in Docker</p>"},{"location":"03-docker-deployment/04-networking/#overview","title":"Overview","text":"<p>MCP Mesh agents communicate through the registry. In Docker Compose, all services on the same network can reach each other by service name. No special networking configuration is needed.</p>"},{"location":"03-docker-deployment/04-networking/#how-it-works","title":"How It Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Docker Network                        \u2502\n\u2502                                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502  \u2502 Registry \u2502\u25c4\u2500\u2500\u2500\u2502 Agent A  \u2502    \u2502 Agent B  \u2502          \u2502\n\u2502  \u2502 :8000    \u2502    \u2502 :8080    \u2502\u25c4\u2500\u2500\u25ba\u2502 :8081    \u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502       \u25b2                               \u2502                 \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2502                                                          \u2502\n\u2502  Agents register with registry, discover each other     \u2502\n\u2502  automatically. No depends_on needed between agents.    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"03-docker-deployment/04-networking/#simple-setup","title":"Simple Setup","text":"PythonTypeScript <pre><code># docker-compose.yml\nservices:\n  registry:\n    image: mcpmesh/registry:0.8\n    ports:\n      - \"8000:8000\"\n\n  my-agent:\n    image: mcpmesh/python-runtime:0.8\n    volumes:\n      - ./my-agent:/app/agent:ro\n    command: [\"python\", \"/app/agent/main.py\"]\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n\n  another-agent:\n    image: mcpmesh/python-runtime:0.8\n    volumes:\n      - ./another-agent:/app/agent:ro\n    command: [\"python\", \"/app/agent/main.py\"]\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n\nnetworks:\n  default:\n    name: mcp-mesh\n</code></pre> <pre><code># docker-compose.yml\nservices:\n  registry:\n    image: mcpmesh/registry:0.8\n    ports:\n      - \"8000:8000\"\n\n  my-agent:\n    image: mcpmesh/typescript-runtime:0.8\n    volumes:\n      - ./my-agent:/app/agent:ro\n    command: [\"npx\", \"tsx\", \"/app/agent/src/index.ts\"]\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n\n  another-agent:\n    image: mcpmesh/typescript-runtime:0.8\n    volumes:\n      - ./another-agent:/app/agent:ro\n    command: [\"npx\", \"tsx\", \"/app/agent/src/index.ts\"]\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n\nnetworks:\n  default:\n    name: mcp-mesh\n</code></pre> <p>That's it! Docker Compose creates a default network, and agents find each other through the registry.</p>"},{"location":"03-docker-deployment/04-networking/#key-points","title":"Key Points","text":"<ol> <li>No <code>depends_on</code> between agents - Agents are resilient and auto-wire when dependencies become available</li> <li>Use service names - <code>http://registry:8000</code> works because Docker DNS resolves service names</li> <li>Single network is fine - All services on the default network can communicate</li> </ol>"},{"location":"03-docker-deployment/04-networking/#environment-variables","title":"Environment Variables","text":"Variable Description Example <code>MCP_MESH_REGISTRY_URL</code> Registry URL <code>http://registry:8000</code> <code>MCP_MESH_HTTP_PORT</code> Agent port (optional) <code>8080</code> <code>MCP_MESH_LOG_LEVEL</code> Log level (optional) <code>DEBUG</code>"},{"location":"03-docker-deployment/04-networking/#troubleshooting","title":"Troubleshooting","text":""},{"location":"03-docker-deployment/04-networking/#agent-cant-reach-registry","title":"Agent can't reach registry","text":"<pre><code># Check if registry is running\ndocker compose ps\n\n# Check registry logs\ndocker compose logs registry\n\n# Test connectivity from agent container\ndocker compose exec my-agent curl http://registry:8000/health\n</code></pre>"},{"location":"03-docker-deployment/04-networking/#agents-not-discovering-each-other","title":"Agents not discovering each other","text":"<pre><code># Check if agents are registered\ncurl http://localhost:8000/agents | jq '.agents[].name'\n\n# Or use meshctl\nmeshctl list\n</code></pre>"},{"location":"03-docker-deployment/04-networking/#next-steps","title":"Next Steps","text":"<ul> <li>Troubleshooting - Common Docker deployment issues</li> </ul>"},{"location":"03-docker-deployment/troubleshooting/","title":"Docker Deployment Troubleshooting Guide","text":"<p>Quick solutions to common Docker deployment issues with MCP Mesh</p>"},{"location":"03-docker-deployment/troubleshooting/#overview","title":"Overview","text":"<p>This comprehensive troubleshooting guide addresses common issues encountered when deploying MCP Mesh agents with Docker. Each issue includes diagnostic steps, root cause analysis, and proven solutions.</p>"},{"location":"03-docker-deployment/troubleshooting/#quick-diagnostics","title":"Quick Diagnostics","text":"<p>Run this comprehensive diagnostic script:</p> <pre><code>#!/bin/bash\necho \"MCP Mesh Docker Diagnostics\"\necho \"===========================\"\n\n# Check Docker daemon\necho -n \"Docker daemon: \"\ndocker version &gt; /dev/null 2&gt;&amp;1 &amp;&amp; echo \"RUNNING\" || echo \"NOT RUNNING\"\n\n# Check Docker Compose\necho -n \"Docker Compose: \"\ndocker-compose version &gt; /dev/null 2&gt;&amp;1 &amp;&amp; echo \"INSTALLED\" || echo \"NOT FOUND\"\n\n# Check running containers\necho -e \"\\nRunning containers:\"\ndocker ps --format \"table {% raw %}{{.Names}}{% endraw %}\\t{% raw %}{{.Status}}{% endraw %}\\t{% raw %}{{.Ports}}{% endraw %}\"\n\n# Check networks\necho -e \"\\nDocker networks:\"\ndocker network ls --filter name=mesh\n\n# Check volumes\necho -e \"\\nDocker volumes:\"\ndocker volume ls --filter name=mesh\n\n# Check resource usage\necho -e \"\\nResource usage:\"\ndocker system df\n\n# Check container health\necho -e \"\\nContainer health:\"\ndocker ps --format \"table {% raw %}{{.Names}}{% endraw %}\\t{% raw %}{{.Status}}{% endraw %}\" | grep -E \"(healthy|unhealthy|starting)\"\n\n# Check registry connectivity\necho -e \"\\nRegistry status:\"\ncurl -s http://localhost:8000/health 2&gt;/dev/null | jq -r '.status' || echo \"NOT ACCESSIBLE\"\n</code></pre>"},{"location":"03-docker-deployment/troubleshooting/#common-issues-and-solutions","title":"Common Issues and Solutions","text":""},{"location":"03-docker-deployment/troubleshooting/#issue-1-container-fails-to-start","title":"Issue 1: Container Fails to Start","text":"<p>Symptoms:</p> <pre><code>ERROR: for agent Cannot start service agent: OCI runtime create failed\n</code></pre> <p>Diagnosis:</p> <pre><code># Check logs\ndocker-compose logs agent\n\n# Inspect container\ndocker inspect $(docker-compose ps -q agent)\n\n# Check events\ndocker events --since 10m --filter container=agent\n</code></pre> <p>Solutions:</p> <ol> <li>Image not found:</li> </ol> <pre><code># Build missing image\ndocker-compose build agent\n\n# Or pull from registry\ndocker-compose pull agent\n</code></pre> <ol> <li>Port already in use:</li> </ol> <pre><code># Find process using port\nsudo lsof -i :8000\n\n# Change port in docker-compose.yml\nports:\n  - \"8001:8000\"  # Use different host port\n</code></pre> <ol> <li>Permission issues: <pre><code># Fix in Dockerfile\nRUN chmod +x /entrypoint.sh\nUSER 1000:1000\n</code></pre></li> </ol>"},{"location":"03-docker-deployment/troubleshooting/#issue-2-agent-cant-connect-to-registry","title":"Issue 2: Agent Can't Connect to Registry","text":"<p>Symptoms:</p> <pre><code>Failed to register with registry: connection refused\nRegistry at http://localhost:8000 not accessible\n</code></pre> <p>Diagnosis:</p> <pre><code># Test from host\ncurl http://localhost:8000/health\n\n# Test from container\ndocker-compose exec agent curl http://registry:8000/health\n\n# Check DNS resolution\ndocker-compose exec agent nslookup registry\n</code></pre> <p>Solutions:</p> <ol> <li>Wrong hostname:</li> </ol> <pre><code>environment:\n  # Use service name, not localhost\n  MCP_MESH_REGISTRY_URL: http://registry:8000\n</code></pre> <ol> <li>Network isolation:</li> </ol> <pre><code>services:\n  agent:\n    networks:\n      - mesh-net # Same network as registry\n  registry:\n    networks:\n      - mesh-net\n</code></pre> <ol> <li>Startup order: <pre><code>depends_on:\n  registry:\n    condition: service_healthy\n</code></pre></li> </ol>"},{"location":"03-docker-deployment/troubleshooting/#issue-3-database-connection-errors","title":"Issue 3: Database Connection Errors","text":"<p>Symptoms:</p> <pre><code>FATAL: password authentication failed for user \"postgres\"\ncould not connect to server: Connection refused\n</code></pre> <p>Solutions:</p> <ol> <li>Environment variables not set:</li> </ol> <pre><code># Use .env file\nenvironment:\n  POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}\n\n# Or docker-compose override\ndocker-compose run -e POSTGRES_PASSWORD=secret postgres\n</code></pre> <ol> <li>Database not initialized:</li> </ol> <pre><code># Remove old volume and reinitialize\ndocker-compose down -v\ndocker volume rm project_postgres_data\ndocker-compose up -d postgres\n</code></pre> <ol> <li>Health check timing: <pre><code>healthcheck:\n  test: [\"CMD-SHELL\", \"pg_isready -U postgres\"]\n  interval: 10s\n  timeout: 5s\n  retries: 5\n  start_period: 30s # Give time to initialize\n</code></pre></li> </ol>"},{"location":"03-docker-deployment/troubleshooting/#issue-4-container-keeps-restarting","title":"Issue 4: Container Keeps Restarting","text":"<p>Symptoms:</p> <pre><code>STATUS: Restarting (1) X seconds ago\nContainer exits immediately after starting\n</code></pre> <p>Diagnosis:</p> <pre><code># Check exit code\ndocker-compose ps\n\n# View recent logs\ndocker-compose logs --tail=50 agent\n\n# Check restart policy\ndocker inspect agent | jq '.[0].HostConfig.RestartPolicy'\n</code></pre> <p>Solutions:</p> <ol> <li>Application crashes:</li> </ol> <pre><code># Temporarily disable restart\nrestart: \"no\"\n\n# Run interactively to debug\ndocker-compose run --rm agent bash\n</code></pre> <ol> <li>Missing environment variables:</li> </ol> <pre><code>environment:\n  - REQUIRED_VAR=${REQUIRED_VAR:?Error: REQUIRED_VAR not set}\n</code></pre> <ol> <li>Entrypoint issues: <pre><code># Use exec form to handle signals properly\nENTRYPOINT [\"./bin/meshctl\"]\nCMD [\"start\", \"examples/simple/agent.py\"]\n</code></pre></li> </ol>"},{"location":"03-docker-deployment/troubleshooting/#issue-5-out-of-memory-errors","title":"Issue 5: Out of Memory Errors","text":"<p>Symptoms:</p> <pre><code>Container killed due to OOM (Out of Memory)\nAgent becomes unresponsive\n</code></pre> <p>Solutions:</p> <ol> <li>Set memory limits:</li> </ol> <pre><code>deploy:\n  resources:\n    limits:\n      memory: 512M\n    reservations:\n      memory: 256M\n</code></pre> <ol> <li>Optimize application:</li> </ol> <pre><code># In agent code\nimport gc\n\ndef process_large_data():\n    # Process in chunks\n    for chunk in data_chunks:\n        process(chunk)\n        gc.collect()  # Force garbage collection\n</code></pre> <ol> <li>Monitor memory usage:</li> </ol> <pre><code># Real-time monitoring\ndocker stats\n\n# Historical data\ndocker-compose exec agent cat /proc/meminfo\n</code></pre>"},{"location":"03-docker-deployment/troubleshooting/#issue-6-volume-permission-issues","title":"Issue 6: Volume Permission Issues","text":"<p>Symptoms:</p> <pre><code>Permission denied when writing to volume\nCannot create directory: Operation not permitted\n</code></pre> <p>Solutions:</p> <ol> <li>Fix ownership:</li> </ol> <pre><code># Check current ownership\ndocker-compose exec agent ls -la /data\n\n# Fix from host\nsudo chown -R 1000:1000 ./data\n\n# Or use init container\nservices:\n  init-permissions:\n    image: busybox\n    volumes:\n      - data:/data\n    command: chown -R 1000:1000 /data\n</code></pre> <ol> <li>Use proper user in container: <pre><code># Create user with specific UID\nRUN useradd -m -u 1000 appuser\nUSER appuser\n</code></pre></li> </ol>"},{"location":"03-docker-deployment/troubleshooting/#issue-7-slow-container-startup","title":"Issue 7: Slow Container Startup","text":"<p>Symptoms:</p> <ul> <li>Container takes minutes to become ready</li> <li>Health checks timing out</li> </ul> <p>Solutions:</p> <ol> <li>Optimize image:</li> </ol> <pre><code># Multi-stage build\nFROM python:3.11 AS builder\nCOPY requirements.txt .\nRUN pip wheel --no-cache-dir -r requirements.txt\n\nFROM python:3.11-slim\nCOPY --from=builder *.whl .\nRUN pip install --no-cache-dir *.whl\n</code></pre> <ol> <li>Adjust health check timing:</li> </ol> <pre><code>healthcheck:\n  start_period: 60s # Allow more startup time\n  interval: 30s\n  timeout: 10s\n</code></pre> <ol> <li>Pre-compile Python: <pre><code>RUN python -m compileall /app\n</code></pre></li> </ol>"},{"location":"03-docker-deployment/troubleshooting/#issue-8-network-communication-issues","title":"Issue 8: Network Communication Issues","text":"<p>Symptoms:</p> <ul> <li>Containers can't reach each other</li> <li>DNS resolution failures</li> <li>Intermittent connection errors</li> </ul> <p>Solutions:</p> <ol> <li>DNS debugging:</li> </ol> <pre><code># Test DNS from container\ndocker-compose exec agent nslookup registry\ndocker-compose exec agent ping -c 3 registry\n\n# Check resolv.conf\ndocker-compose exec agent cat /etc/resolv.conf\n</code></pre> <ol> <li>Network inspection:</li> </ol> <pre><code># List networks\ndocker network ls\n\n# Inspect network\ndocker network inspect mesh-net\n\n# Check container networks\ndocker inspect agent | jq '.[0].NetworkSettings.Networks'\n</code></pre> <ol> <li>Fix network configuration: <pre><code>networks:\n  mesh-net:\n    driver: bridge\n    driver_opts:\n      com.docker.network.bridge.enable_icc: \"true\"\n      com.docker.network.bridge.enable_ip_masquerade: \"true\"\n</code></pre></li> </ol>"},{"location":"03-docker-deployment/troubleshooting/#issue-9-build-failures","title":"Issue 9: Build Failures","text":"<p>Symptoms:</p> <pre><code>ERROR: Service 'agent' failed to build\nPackage installation fails\n</code></pre> <p>Solutions:</p> <ol> <li>Clear build cache:</li> </ol> <pre><code># Remove all build cache\ndocker builder prune -a\n\n# Build without cache\ndocker-compose build --no-cache agent\n</code></pre> <ol> <li>Fix package sources:</li> </ol> <pre><code># Update package lists\nRUN apt-get update &amp;&amp; apt-get install -y ...\n\n# Use specific package versions\nRUN pip install package==1.2.3\n</code></pre> <ol> <li>Handle network issues: <pre><code># Retry on failure\nRUN for i in 1 2 3; do \\\n    pip install -r requirements.txt &amp;&amp; break || sleep 5; \\\ndone\n</code></pre></li> </ol>"},{"location":"03-docker-deployment/troubleshooting/#issue-10-docker-compose-version-issues","title":"Issue 10: Docker Compose Version Issues","text":"<p>Symptoms:</p> <pre><code>ERROR: Version in \"./docker-compose.yml\" is unsupported\nInvalid compose file\n</code></pre> <p>Solutions:</p> <ol> <li>Check Docker Compose version:</li> </ol> <pre><code>docker-compose version\n\n# Upgrade if needed\nsudo pip install --upgrade docker-compose\n</code></pre> <ol> <li>Use compatible syntax:</li> </ol> <pre><code># Use version 3.8 features carefully\nversion: '3.8'\n\n# Or downgrade to widely supported version\nversion: '3.3'\n</code></pre>"},{"location":"03-docker-deployment/troubleshooting/#performance-issues","title":"Performance Issues","text":""},{"location":"03-docker-deployment/troubleshooting/#high-cpu-usage","title":"High CPU Usage","text":"<pre><code># Find CPU-hungry containers\ndocker stats --no-stream --format \"table {% raw %}{{.Container}}{% endraw %}\\t{% raw %}{{.CPUPerc}}{% endraw %}\"\n\n# Limit CPU usage\nservices:\n  agent:\n    deploy:\n      resources:\n        limits:\n          cpus: '0.5'\n</code></pre>"},{"location":"03-docker-deployment/troubleshooting/#disk-space-issues","title":"Disk Space Issues","text":"<pre><code># Check disk usage\ndocker system df\n\n# Clean up\ndocker system prune -a --volumes\n\n# Remove specific items\ndocker container prune\ndocker image prune\ndocker volume prune\ndocker network prune\n</code></pre>"},{"location":"03-docker-deployment/troubleshooting/#emergency-recovery","title":"Emergency Recovery","text":""},{"location":"03-docker-deployment/troubleshooting/#complete-reset","title":"Complete Reset","text":"<pre><code>#!/bin/bash\n# emergency-reset.sh\n\necho \"WARNING: This will delete all Docker data!\"\nread -p \"Continue? (y/N) \" -n 1 -r\necho\n\nif [[ $REPLY =~ ^[Yy]$ ]]; then\n    # Stop all containers\n    docker-compose down\n\n    # Remove all containers\n    docker rm -f $(docker ps -aq) 2&gt;/dev/null\n\n    # Remove all images\n    docker rmi -f $(docker images -q) 2&gt;/dev/null\n\n    # Remove all volumes\n    docker volume rm $(docker volume ls -q) 2&gt;/dev/null\n\n    # Remove all networks\n    docker network rm $(docker network ls -q) 2&gt;/dev/null\n\n    # Restart Docker\n    sudo systemctl restart docker\n\n    echo \"Docker reset complete\"\nfi\n</code></pre>"},{"location":"03-docker-deployment/troubleshooting/#backup-before-troubleshooting","title":"Backup Before Troubleshooting","text":"<pre><code>#!/bin/bash\n# backup-docker-state.sh\n\nBACKUP_DIR=\"docker-backup-$(date +%Y%m%d-%H%M%S)\"\nmkdir -p \"$BACKUP_DIR\"\n\n# Export compose configuration\ndocker-compose config &gt; \"$BACKUP_DIR/docker-compose.resolved.yml\"\n\n# Save running container state\ndocker ps -a &gt; \"$BACKUP_DIR/containers.txt\"\n\n# Export volumes\nfor volume in $(docker volume ls -q); do\n    docker run --rm -v $volume:/data -v $(pwd)/$BACKUP_DIR:/backup \\\n        busybox tar czf /backup/$volume.tar.gz /data\ndone\n\necho \"Backup saved to $BACKUP_DIR\"\n</code></pre>"},{"location":"03-docker-deployment/troubleshooting/#getting-help","title":"Getting Help","text":"<p>If these solutions don't resolve your issue:</p> <ol> <li>Collect diagnostic information:</li> </ol> <pre><code>docker-compose logs &gt; docker-logs.txt\ndocker-compose ps &gt; docker-status.txt\ndocker-compose config &gt; docker-config.txt\ndocker version &gt; docker-version.txt\n</code></pre> <ol> <li> <p>Check GitHub issues:</p> </li> <li> <p>https://github.com/dhyansraj/mcp-mesh/issues</p> </li> <li> <p>Community support:</p> </li> <li>MCP Discord: https://discord.gg/mcp</li> <li>Stack Overflow: Tag with <code>mcp-mesh</code> and <code>docker</code></li> </ol> <p>\ud83d\udca1 Tip: Always test solutions in a development environment first</p> <p>\ud83d\udcda Reference: Docker Troubleshooting Guide</p> <p>\ud83d\udd0d Debug Mode: Set <code>COMPOSE_DEBUG=true</code> for verbose Docker Compose output</p>"},{"location":"04-kubernetes-basics/05-troubleshooting/","title":"Troubleshooting K8s Deployments","text":"<p>Comprehensive guide to diagnosing and fixing common MCP Mesh deployment issues on Kubernetes</p>"},{"location":"04-kubernetes-basics/05-troubleshooting/#overview","title":"Overview","text":"<p>This troubleshooting guide addresses the most common issues encountered when deploying MCP Mesh on Kubernetes. Each issue includes symptoms, diagnostic steps, root cause analysis, and proven solutions. We'll cover pod failures, networking issues, storage problems, and performance bottlenecks.</p>"},{"location":"04-kubernetes-basics/05-troubleshooting/#quick-diagnostics","title":"Quick Diagnostics","text":"<p>Run this comprehensive diagnostic script:</p> <pre><code>#!/bin/bash\n# mcp-mesh-k8s-diagnostics.sh\n\nNAMESPACE=${1:-mcp-mesh}\n\necho \"MCP Mesh Kubernetes Diagnostics for namespace: $NAMESPACE\"\necho \"=======================================================\"\n\n# Check namespace exists\necho -e \"\\n1. Checking namespace...\"\nkubectl get namespace $NAMESPACE || {\n    echo \"ERROR: Namespace $NAMESPACE not found\"\n    exit 1\n}\n\n# Check pods\necho -e \"\\n2. Pod Status:\"\nkubectl get pods -n $NAMESPACE -o wide\necho -e \"\\nProblematic pods:\"\nkubectl get pods -n $NAMESPACE --field-selector=status.phase!=Running,status.phase!=Succeeded\n\n# Check services\necho -e \"\\n3. Service Status:\"\nkubectl get svc -n $NAMESPACE\necho -e \"\\nService endpoints:\"\nkubectl get endpoints -n $NAMESPACE\n\n# Check registry\necho -e \"\\n4. Registry Status:\"\nkubectl get statefulset,pod,svc -n $NAMESPACE -l app.kubernetes.io/name=mcp-mesh-registry\n\n# Check events\necho -e \"\\n5. Recent Events:\"\nkubectl get events -n $NAMESPACE --sort-by='.lastTimestamp' | tail -20\n\n# Check resource usage\necho -e \"\\n6. Resource Usage:\"\nkubectl top nodes\nkubectl top pods -n $NAMESPACE\n\n# Check persistent volumes\necho -e \"\\n7. Storage:\"\nkubectl get pvc -n $NAMESPACE\n\n# Network connectivity test\necho -e \"\\n8. Network Test:\"\nkubectl run test-network --rm -it --image=busybox --restart=Never -n $NAMESPACE -- \\\n    sh -c \"nslookup mcp-mesh-registry &amp;&amp; echo 'DNS OK' || echo 'DNS FAILED'\"\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#common-issues-and-solutions","title":"Common Issues and Solutions","text":""},{"location":"04-kubernetes-basics/05-troubleshooting/#issue-1-pods-stuck-in-pending-state","title":"Issue 1: Pods Stuck in Pending State","text":"<p>Symptoms:</p> <pre><code>NAME                          READY   STATUS    RESTARTS   AGE\nmcp-mesh-registry-0           0/1     Pending   0          5m\nweather-agent-abc123          0/1     Pending   0          3m\n</code></pre> <p>Diagnosis:</p> <pre><code># Check pod events\nkubectl describe pod &lt;pod-name&gt; -n mcp-mesh\n\n# Check node resources\nkubectl describe nodes\nkubectl top nodes\n\n# Check PVC status\nkubectl get pvc -n mcp-mesh\n</code></pre> <p>Common Causes and Solutions:</p> <ol> <li>Insufficient Resources</li> </ol> <pre><code># Check resource requests\nkubectl describe pod &lt;pod-name&gt; -n mcp-mesh | grep -A10 Requests\n\n# Solution: Scale down other pods or add nodes\nkubectl scale deployment &lt;other-deployment&gt; --replicas=0 -n mcp-mesh\n\n# Or reduce resource requests\nkubectl patch deployment &lt;deployment-name&gt; -n mcp-mesh -p '\n{\n  \"spec\": {\n    \"template\": {\n      \"spec\": {\n        \"containers\": [{\n          \"name\": \"agent\",\n          \"resources\": {\n            \"requests\": {\n              \"cpu\": \"50m\",\n              \"memory\": \"64Mi\"\n            }\n          }\n        }]\n      }\n    }\n  }\n}'\n</code></pre> <ol> <li>PVC Not Bound</li> </ol> <pre><code># Check PVC status\nkubectl get pvc -n mcp-mesh\n\n# Check available storage classes\nkubectl get storageclass\n\n# Create PVC with correct storage class\nkubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: registry-data\n  namespace: mcp-mesh\nspec:\n  accessModes: [\"ReadWriteOnce\"]\n  storageClassName: standard  # Use available class\n  resources:\n    requests:\n      storage: 5Gi\nEOF\n</code></pre> <ol> <li>Node Selector/Affinity Not Satisfied</li> </ol> <pre><code># Check node labels\nkubectl get nodes --show-labels\n\n# Remove node selector temporarily\nkubectl patch deployment &lt;deployment-name&gt; -n mcp-mesh --type='json' -p='[\n  {\"op\": \"remove\", \"path\": \"/spec/template/spec/nodeSelector\"}\n]'\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#issue-2-pods-in-crashloopbackoff","title":"Issue 2: Pods in CrashLoopBackOff","text":"<p>Symptoms:</p> <pre><code>NAME                          READY   STATUS             RESTARTS   AGE\nanalytics-agent-xyz789        0/1     CrashLoopBackOff   5          10m\n</code></pre> <p>Diagnosis:</p> <pre><code># Check logs from current run\nkubectl logs &lt;pod-name&gt; -n mcp-mesh\n\n# Check logs from previous run\nkubectl logs &lt;pod-name&gt; -n mcp-mesh --previous\n\n# Check container exit code\nkubectl describe pod &lt;pod-name&gt; -n mcp-mesh | grep -A10 \"Last State\"\n</code></pre> <p>Common Causes and Solutions:</p> <ol> <li>Missing Environment Variables</li> </ol> <pre><code># Check current env vars\nkubectl exec &lt;pod-name&gt; -n mcp-mesh -- env\n\n# Add missing variables\nkubectl set env deployment/&lt;deployment-name&gt; \\\n  MCP_MESH_REGISTRY_URL=http://mcp-core-mcp-mesh-registry:8000 \\\n  -n mcp-mesh\n</code></pre> <ol> <li>Registry Connection Failed</li> </ol> <pre><code># Add init container to wait for registry\nspec:\n  initContainers:\n    - name: wait-for-registry\n      image: busybox:1.35\n      command: [\"sh\", \"-c\"]\n      args:\n        - |\n          until nc -z mcp-mesh-registry 8000; do\n            echo \"Waiting for registry...\"\n            sleep 2\n          done\n</code></pre> <ol> <li>Permission Errors <pre><code># Fix file permissions\nspec:\n  securityContext:\n    runAsUser: 1000\n    runAsGroup: 1000\n    fsGroup: 1000\n  containers:\n    - name: agent\n      securityContext:\n        allowPrivilegeEscalation: false\n        runAsNonRoot: true\n</code></pre></li> </ol>"},{"location":"04-kubernetes-basics/05-troubleshooting/#issue-3-service-discovery-not-working","title":"Issue 3: Service Discovery Not Working","text":"<p>Symptoms:</p> <ul> <li>Agents can't find registry</li> <li>\"connection refused\" errors</li> <li>DNS resolution failures</li> </ul> <p>Diagnosis:</p> <pre><code># Test DNS from pod\nkubectl exec -it &lt;pod-name&gt; -n mcp-mesh -- nslookup mcp-mesh-registry\n\n# Check service endpoints\nkubectl get endpoints mcp-mesh-registry -n mcp-mesh\n\n# Test connectivity\nkubectl exec -it &lt;pod-name&gt; -n mcp-mesh -- wget -O- http://mcp-core-mcp-mesh-registry:8000/health\n</code></pre> <p>Solutions:</p> <ol> <li>DNS Issues</li> </ol> <pre><code># Configure pod DNS\nspec:\n  dnsPolicy: ClusterFirst\n  dnsConfig:\n    options:\n      - name: ndots\n        value: \"1\"\n</code></pre> <ol> <li>Service Selector Mismatch</li> </ol> <pre><code># Verify labels match\nkubectl get svc mcp-mesh-registry -o yaml | grep -A5 selector\nkubectl get pods -l app.kubernetes.io/name=mcp-mesh-registry --show-labels\n</code></pre> <ol> <li>Network Policy Blocking</li> </ol> <pre><code># Check network policies\nkubectl get networkpolicy -n mcp-mesh\n\n# Temporarily disable\nkubectl delete networkpolicy --all -n mcp-mesh\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#issue-4-high-memorycpu-usage","title":"Issue 4: High Memory/CPU Usage","text":"<p>Symptoms:</p> <ul> <li>Pods getting OOMKilled</li> <li>Slow response times</li> <li>Node pressure</li> </ul> <p>Diagnosis:</p> <pre><code># Check resource usage\nkubectl top pods -n mcp-mesh\nkubectl describe pod &lt;pod-name&gt; -n mcp-mesh | grep -A20 Containers\n\n# Check for memory leaks\nkubectl exec &lt;pod-name&gt; -n mcp-mesh -- ps aux\n</code></pre> <p>Solutions:</p> <ol> <li>Increase Resource Limits</li> </ol> <pre><code>resources:\n  requests:\n    memory: \"256Mi\"\n    cpu: \"100m\"\n  limits:\n    memory: \"1Gi\"\n    cpu: \"1000m\"\n</code></pre> <ol> <li>Enable Horizontal Pod Autoscaling</li> </ol> <pre><code>kubectl autoscale deployment &lt;deployment-name&gt; \\\n  --min=2 --max=10 \\\n  --cpu-percent=70 \\\n  -n mcp-mesh\n</code></pre> <ol> <li>Optimize Application <pre><code>env:\n  - name: GOGC\n    value: \"50\" # More aggressive garbage collection\n  - name: GOMEMLIMIT\n    value: \"900MiB\" # Soft memory limit\n</code></pre></li> </ol>"},{"location":"04-kubernetes-basics/05-troubleshooting/#issue-5-persistent-volume-issues","title":"Issue 5: Persistent Volume Issues","text":"<p>Symptoms:</p> <ul> <li>Data loss after pod restart</li> <li>Permission denied errors</li> <li>Disk full errors</li> </ul> <p>Diagnosis:</p> <pre><code># Check PVC status\nkubectl get pvc -n mcp-mesh\nkubectl describe pvc &lt;pvc-name&gt; -n mcp-mesh\n\n# Check disk usage in pod\nkubectl exec &lt;pod-name&gt; -n mcp-mesh -- df -h\n</code></pre> <p>Solutions:</p> <ol> <li>Expand PVC</li> </ol> <pre><code># For expandable storage classes\nkubectl patch pvc &lt;pvc-name&gt; -n mcp-mesh -p '{\"spec\":{\"resources\":{\"requests\":{\"storage\":\"20Gi\"}}}}'\n</code></pre> <ol> <li>Fix Permissions <pre><code># Add init container to fix permissions\ninitContainers:\n  - name: fix-permissions\n    image: busybox\n    command: [\"sh\", \"-c\", \"chown -R 1000:1000 /data\"]\n    volumeMounts:\n      - name: data\n        mountPath: /data\n</code></pre></li> </ol>"},{"location":"04-kubernetes-basics/05-troubleshooting/#issue-6-image-pull-errors","title":"Issue 6: Image Pull Errors","text":"<p>Symptoms:</p> <pre><code>Failed to pull image \"mcpmesh/python-runtime:0.8\": rpc error: code = Unknown desc = Error response from daemon: pull access denied\n</code></pre> <p>Solutions:</p> <ol> <li>For Minikube Local Images</li> </ol> <pre><code># Use Minikube's Docker\neval $(minikube docker-env)\ndocker build -t mcp-mesh/agent:0.2 .\n\n# Set imagePullPolicy\nkubectl patch deployment &lt;deployment-name&gt; -n mcp-mesh -p '\n{\n  \"spec\": {\n    \"template\": {\n      \"spec\": {\n        \"containers\": [{\n          \"name\": \"agent\",\n          \"imagePullPolicy\": \"Never\"\n        }]\n      }\n    }\n  }\n}'\n</code></pre> <ol> <li>For Private Registry</li> </ol> <pre><code># Create pull secret\nkubectl create secret docker-registry regcred \\\n  --docker-server=myregistry.io \\\n  --docker-username=user \\\n  --docker-password=pass \\\n  --docker-email=email@example.com \\\n  -n mcp-mesh\n\n# Add to deployment\nkubectl patch deployment &lt;deployment-name&gt; -n mcp-mesh -p '\n{\n  \"spec\": {\n    \"template\": {\n      \"spec\": {\n        \"imagePullSecrets\": [{\"name\": \"regcred\"}]\n      }\n    }\n  }\n}'\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#performance-troubleshooting","title":"Performance Troubleshooting","text":""},{"location":"04-kubernetes-basics/05-troubleshooting/#slow-agent-startup","title":"Slow Agent Startup","text":"<p>Diagnosis:</p> <pre><code># Check startup time\nkubectl logs &lt;pod-name&gt; -n mcp-mesh | grep -E \"started|ready\"\n\n# Profile startup\nkubectl exec &lt;pod-name&gt; -n mcp-mesh -- python -m cProfile -o profile.stats agent.py\n</code></pre> <p>Solutions:</p> <ol> <li>Add startup probe with longer timeout</li> <li>Optimize imports and initialization</li> <li>Use init containers for pre-warming</li> </ol>"},{"location":"04-kubernetes-basics/05-troubleshooting/#high-latency-between-agents","title":"High Latency Between Agents","text":"<p>Diagnosis:</p> <pre><code># Test network latency\nkubectl exec -it &lt;pod-name&gt; -n mcp-mesh -- ping &lt;other-pod-ip&gt;\n\n# Check service mesh metrics (if using Istio)\nkubectl exec -it &lt;pod-name&gt; -c istio-proxy -n mcp-mesh -- curl localhost:15000/stats/prometheus\n</code></pre> <p>Solutions:</p> <ol> <li>Use node affinity to colocate related agents</li> <li>Enable pod topology spread constraints</li> <li>Optimize serialization/deserialization</li> </ol>"},{"location":"04-kubernetes-basics/05-troubleshooting/#debugging-tools-and-commands","title":"Debugging Tools and Commands","text":""},{"location":"04-kubernetes-basics/05-troubleshooting/#essential-kubectl-commands","title":"Essential kubectl Commands","text":"<pre><code># Get comprehensive pod info\nkubectl get pod &lt;pod-name&gt; -n mcp-mesh -o yaml\n\n# Watch pod status changes\nkubectl get pods -n mcp-mesh -w\n\n# Get all resources in namespace\nkubectl get all -n mcp-mesh\n\n# Describe problematic resources\nkubectl describe pod/deployment/service &lt;name&gt; -n mcp-mesh\n\n# Check RBAC permissions\nkubectl auth can-i --list --namespace=mcp-mesh\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#advanced-debugging","title":"Advanced Debugging","text":"<pre><code># Enable verbose logging\nkubectl set env deployment/&lt;deployment-name&gt; LOG_LEVEL=DEBUG -n mcp-mesh\n\n# Port forward for direct access\nkubectl port-forward pod/&lt;pod-name&gt; 8080:8080 -n mcp-mesh\n\n# Copy files from pod\nkubectl cp &lt;pod-name&gt;:/path/to/file ./local-file -n mcp-mesh\n\n# Run debug container\nkubectl debug &lt;pod-name&gt; -it --image=busybox -n mcp-mesh\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#monitoring-commands","title":"Monitoring Commands","text":"<pre><code># Real-time resource monitoring\nwatch -n 2 'kubectl top pods -n mcp-mesh'\n\n# Check cluster events\nkubectl get events -n mcp-mesh --sort-by='.lastTimestamp' -w\n\n# View audit logs (if enabled)\nkubectl logs -n kube-system -l component=kube-apiserver | grep mcp-mesh\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#recovery-procedures","title":"Recovery Procedures","text":""},{"location":"04-kubernetes-basics/05-troubleshooting/#emergency-pod-recovery","title":"Emergency Pod Recovery","text":"<pre><code>#!/bin/bash\n# emergency-recovery.sh\n\nNAMESPACE=mcp-mesh\n\necho \"Starting emergency recovery...\"\n\n# Delete stuck pods\nkubectl delete pods --field-selector=status.phase=Failed -n $NAMESPACE\nkubectl delete pods --field-selector=status.phase=Unknown -n $NAMESPACE\n\n# Restart all deployments\nkubectl rollout restart deployment -n $NAMESPACE\n\n# Force delete stuck PVCs\nkubectl patch pvc &lt;pvc-name&gt; -n $NAMESPACE -p '{\"metadata\":{\"finalizers\":null}}'\n\n# Reset failed jobs\nkubectl delete jobs --field-selector=status.successful=0 -n $NAMESPACE\n\necho \"Recovery complete. Checking status...\"\nkubectl get all -n $NAMESPACE\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#data-recovery","title":"Data Recovery","text":"<pre><code># Backup registry data\nkubectl exec mcp-mesh-registry-0 -n mcp-mesh -- \\\n  tar czf /tmp/backup.tar.gz /data\n\nkubectl cp mcp-mesh-registry-0:/tmp/backup.tar.gz ./registry-backup.tar.gz -n mcp-mesh\n\n# Restore registry data\nkubectl cp ./registry-backup.tar.gz mcp-mesh-registry-0:/tmp/backup.tar.gz -n mcp-mesh\nkubectl exec mcp-mesh-registry-0 -n mcp-mesh -- \\\n  tar xzf /tmp/backup.tar.gz -C /\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#prevention-strategies","title":"Prevention Strategies","text":""},{"location":"04-kubernetes-basics/05-troubleshooting/#resource-management","title":"Resource Management","text":"<pre><code># Set up ResourceQuota\napiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: mcp-mesh-quota\n  namespace: mcp-mesh\nspec:\n  hard:\n    requests.cpu: \"10\"\n    requests.memory: 20Gi\n    persistentvolumeclaims: \"10\"\n    pods: \"50\"\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#pod-disruption-budgets","title":"Pod Disruption Budgets","text":"<pre><code># Ensure availability during updates\napiVersion: policy/v1\nkind: PodDisruptionBudget\nmetadata:\n  name: registry-pdb\n  namespace: mcp-mesh\nspec:\n  minAvailable: 2\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: mcp-mesh-registry\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#monitoring-setup","title":"Monitoring Setup","text":"<pre><code># ServiceMonitor for Prometheus\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: mcp-mesh-agents\n  namespace: mcp-mesh\nspec:\n  selector:\n    matchLabels:\n      app.kubernetes.io/component: agent\n  endpoints:\n    - port: metrics\n      interval: 30s\n      path: /metrics\n</code></pre>"},{"location":"04-kubernetes-basics/05-troubleshooting/#getting-help","title":"Getting Help","text":"<p>If these solutions don't resolve your issue:</p> <ol> <li>Collect Diagnostics:</li> </ol> <pre><code>kubectl cluster-info dump --namespace=mcp-mesh &gt; cluster-dump.txt\n</code></pre> <ol> <li>Check MCP Mesh Logs:</li> </ol> <pre><code>kubectl logs -l app.kubernetes.io/part-of=mcp-mesh -n mcp-mesh &gt; mcp-mesh-logs.txt\n</code></pre> <ol> <li>Community Resources:</li> <li>GitHub Issues: https://github.com/dhyansraj/mcp-mesh/issues</li> <li>Kubernetes Slack: #mcp-mesh channel</li> </ol> <p>\ud83d\udca1 Tip: Always check <code>kubectl get events -n mcp-mesh</code> first - most issues are explained there</p> <p>\ud83d\udcda Reference: Kubernetes Troubleshooting Guide</p> <p>\ud83d\udd0d Debug Mode: Set <code>MCP_MESH_DEBUG=true</code> in pod environment for verbose logging</p>"},{"location":"07-observability/01-prometheus-integration/","title":"Prometheus Integration","text":"<p>Collect, store, and query metrics from your MCP Mesh deployment</p>"},{"location":"07-observability/01-prometheus-integration/#overview","title":"Overview","text":"<p>Prometheus is the de facto standard for metrics collection in Kubernetes environments. This guide covers integrating Prometheus with MCP Mesh to collect metrics from the registry, agents, and infrastructure. You'll learn how to configure scraping, create recording rules, optimize storage, and write efficient queries.</p> <p>Proper Prometheus integration provides the foundation for monitoring, alerting, and performance analysis of your MCP Mesh deployment.</p>"},{"location":"07-observability/01-prometheus-integration/#key-concepts","title":"Key Concepts","text":"<ul> <li>Metrics Types: Counter, Gauge, Histogram, Summary</li> <li>Service Discovery: Kubernetes SD for automatic target discovery</li> <li>Recording Rules: Pre-computed queries for efficiency</li> <li>Federation: Scaling Prometheus across clusters</li> <li>Remote Storage: Long-term retention strategies</li> </ul>"},{"location":"07-observability/01-prometheus-integration/#step-by-step-guide","title":"Step-by-Step Guide","text":""},{"location":"07-observability/01-prometheus-integration/#step-1-deploy-prometheus-operator","title":"Step 1: Deploy Prometheus Operator","text":"<p>The Prometheus Operator simplifies deployment and management:</p> <pre><code># Install kube-prometheus-stack\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\n\n# Create monitoring namespace\nkubectl create namespace monitoring\n\n# Install with custom values\ncat &gt; prometheus-values.yaml &lt;&lt; 'EOF'\nprometheus:\n  prometheusSpec:\n    # Enable ServiceMonitor discovery\n    serviceMonitorSelectorNilUsesHelmValues: false\n    podMonitorSelectorNilUsesHelmValues: false\n\n    # Retention configuration\n    retention: 30d\n    retentionSize: 50GB\n\n    # Resource allocation\n    resources:\n      requests:\n        memory: 2Gi\n        cpu: 1\n      limits:\n        memory: 4Gi\n        cpu: 2\n\n    # Storage configuration\n    storageSpec:\n      volumeClaimTemplate:\n        spec:\n          storageClassName: fast-ssd\n          accessModes: [\"ReadWriteOnce\"]\n          resources:\n            requests:\n              storage: 100Gi\n\n    # Scrape configuration\n    scrapeInterval: 30s\n    evaluationInterval: 30s\n\n    # Enable features\n    enableFeatures:\n      - exemplar-storage\n      - memory-snapshot-on-shutdown\n\n# Grafana configuration\ngrafana:\n  enabled: true\n  adminPassword: \"changeme\"\n  persistence:\n    enabled: true\n    size: 10Gi\n\n# AlertManager configuration\nalertmanager:\n  enabled: true\n  config:\n    global:\n      resolve_timeout: 5m\n    route:\n      group_by: ['alertname', 'namespace']\n      group_wait: 10s\n      group_interval: 10s\n      repeat_interval: 12h\n      receiver: 'default'\n    receivers:\n    - name: 'default'\n      slack_configs:\n      - api_url: 'YOUR_SLACK_WEBHOOK_URL'\n        channel: '#alerts'\nEOF\n\n# Install Prometheus stack\nhelm install prometheus prometheus-community/kube-prometheus-stack \\\n  --namespace monitoring \\\n  --values prometheus-values.yaml\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#step-2-configure-mcp-mesh-metrics","title":"Step 2: Configure MCP Mesh Metrics","text":"<p>Implement metrics in MCP Mesh components:</p> <pre><code># mcp_mesh/metrics.py\nfrom prometheus_client import Counter, Histogram, Gauge, Info\nfrom prometheus_client import CollectorRegistry, generate_latest\nimport time\nfrom functools import wraps\n\n# Create registry\nREGISTRY = CollectorRegistry()\n\n# Define metrics\nagent_info = Info(\n    'mcp_mesh_agent',\n    'MCP Mesh agent information',\n    ['agent_name', 'version', 'capabilities'],\n    registry=REGISTRY\n)\n\nrequest_count = Counter(\n    'mcp_mesh_requests_total',\n    'Total number of requests processed',\n    ['agent', 'method', 'status'],\n    registry=REGISTRY\n)\n\nrequest_duration = Histogram(\n    'mcp_mesh_request_duration_seconds',\n    'Request duration in seconds',\n    ['agent', 'method'],\n    buckets=(0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1.0, 2.5, 5.0),\n    registry=REGISTRY\n)\n\nactive_connections = Gauge(\n    'mcp_mesh_connections_active',\n    'Number of active connections',\n    ['agent', 'type'],\n    registry=REGISTRY\n)\n\nregistry_agents = Gauge(\n    'mcp_mesh_registry_agents_total',\n    'Total number of registered agents',\n    ['status'],\n    registry=REGISTRY\n)\n\n# Decorator for timing functions\ndef track_request_duration(agent_name, method):\n    def decorator(func):\n        @wraps(func)\n        async def wrapper(*args, **kwargs):\n            start_time = time.time()\n            status = \"success\"\n            try:\n                result = await func(*args, **kwargs)\n                return result\n            except Exception as e:\n                status = \"error\"\n                raise\n            finally:\n                duration = time.time() - start_time\n                request_count.labels(\n                    agent=agent_name,\n                    method=method,\n                    status=status\n                ).inc()\n                request_duration.labels(\n                    agent=agent_name,\n                    method=method\n                ).observe(duration)\n        return wrapper\n    return decorator\n\n# Metrics endpoint handler\nasync def metrics_handler(request):\n    \"\"\"Prometheus metrics endpoint\"\"\"\n    metrics = generate_latest(REGISTRY)\n    return Response(\n        body=metrics,\n        content_type=\"text/plain; version=0.0.4; charset=utf-8\"\n    )\n\n# Usage in agent\nclass WeatherAgent:\n    def __init__(self, name=\"weather-agent\"):\n        self.name = name\n        # Set agent info\n        agent_info.labels(\n            agent_name=self.name,\n            version=\"1.0.0\",\n            capabilities=\"weather_forecast,weather_current\"\n        ).set(1)\n\n        # Track connections\n        active_connections.labels(\n            agent=self.name,\n            type=\"client\"\n        ).set(0)\n\n    @track_request_duration(\"weather-agent\", \"get_forecast\")\n    async def get_forecast(self, location: str):\n        \"\"\"Get weather forecast with metrics\"\"\"\n        # Increment active connections\n        active_connections.labels(\n            agent=self.name,\n            type=\"client\"\n        ).inc()\n\n        try:\n            # Your forecast logic here\n            forecast = await self._fetch_forecast(location)\n            return forecast\n        finally:\n            # Decrement active connections\n            active_connections.labels(\n                agent=self.name,\n                type=\"client\"\n            ).dec()\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#step-3-create-servicemonitors","title":"Step 3: Create ServiceMonitors","text":"<p>Define ServiceMonitors for Prometheus to discover MCP Mesh services:</p> <pre><code># servicemonitor-registry.yaml\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: mcp-mesh-registry\n  namespace: mcp-mesh\n  labels:\n    app: mcp-mesh\n    component: registry\nspec:\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: mcp-mesh-registry\n  endpoints:\n    - port: http\n      interval: 30s\n      path: /metrics\n      # Add trace_id to metrics for correlation\n      metricRelabelings:\n        - sourceLabels: [__name__]\n          targetLabel: __tmp_prometheus_job_name\n        - sourceLabels: [trace_id]\n          targetLabel: trace_id\n          regex: \"(.*)\"\n          replacement: \"${1}\"\n        # Drop high-cardinality metrics\n        - sourceLabels: [__name__]\n          regex: \"go_memstats_.*\"\n          action: drop\n\n---\n# servicemonitor-agents.yaml\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: mcp-mesh-agents\n  namespace: mcp-mesh\n  labels:\n    app: mcp-mesh\n    component: agent\nspec:\n  selector:\n    matchLabels:\n      app.kubernetes.io/part-of: mcp-mesh\n      app.kubernetes.io/component: agent\n  endpoints:\n    - port: metrics\n      interval: 30s\n      path: /metrics\n      # Honor agent-provided timestamps\n      honorTimestamps: true\n      # Add agent name from pod label\n      relabelings:\n        - sourceLabels: [__meta_kubernetes_pod_label_agent_name]\n          targetLabel: agent\n        - sourceLabels: [__meta_kubernetes_pod_namespace]\n          targetLabel: namespace\n        - sourceLabels: [__meta_kubernetes_pod_name]\n          targetLabel: pod\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#step-4-configure-recording-rules","title":"Step 4: Configure Recording Rules","text":"<p>Create recording rules for common queries:</p> <pre><code># recording-rules.yaml\napiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  name: mcp-mesh-recording-rules\n  namespace: monitoring\n  labels:\n    prometheus: kube-prometheus\nspec:\n  groups:\n    - name: mcp_mesh.rules\n      interval: 30s\n      rules:\n        # Request rate by agent\n        - record: mcp_mesh:request_rate\n          expr: |\n            sum by (agent, namespace) (\n              rate(mcp_mesh_requests_total[5m])\n            )\n\n        # Error rate by agent\n        - record: mcp_mesh:error_rate\n          expr: |\n            sum by (agent, namespace) (\n              rate(mcp_mesh_requests_total{status=\"error\"}[5m])\n            ) / ignoring(status) group_left\n            sum by (agent, namespace) (\n              rate(mcp_mesh_requests_total[5m])\n            )\n\n        # P95 latency by agent\n        - record: mcp_mesh:request_duration:p95\n          expr: |\n            histogram_quantile(0.95,\n              sum by (agent, namespace, le) (\n                rate(mcp_mesh_request_duration_seconds_bucket[5m])\n              )\n            )\n\n        # Active connections per agent\n        - record: mcp_mesh:connections:sum\n          expr: |\n            sum by (agent, namespace) (\n              mcp_mesh_connections_active\n            )\n\n        # Registry health score\n        - record: mcp_mesh:registry:health_score\n          expr: |\n            (\n              up{job=\"mcp-mesh-registry\"} * 100\n              + (1 - mcp_mesh:error_rate{agent=\"registry\"}) * 50\n              + (mcp_mesh:request_duration:p95{agent=\"registry\"} &lt; 0.5) * 50\n            ) / 2\n\n    - name: mcp_mesh.slo\n      interval: 30s\n      rules:\n        # Availability SLO\n        - record: mcp_mesh:slo:availability\n          expr: |\n            1 - (\n              sum by (agent) (\n                rate(mcp_mesh_requests_total{status=\"error\"}[5m])\n              ) / ignoring(status) group_left\n              sum by (agent) (\n                rate(mcp_mesh_requests_total[5m])\n              )\n            )\n\n        # Latency SLO\n        - record: mcp_mesh:slo:latency\n          expr: |\n            histogram_quantile(0.95,\n              sum by (agent, le) (\n                rate(mcp_mesh_request_duration_seconds_bucket[5m])\n              )\n            ) &lt; bool 1.0\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#step-5-optimize-prometheus-performance","title":"Step 5: Optimize Prometheus Performance","text":"<p>Configure Prometheus for optimal performance:</p> <pre><code># prometheus-config.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: prometheus-config-custom\n  namespace: monitoring\ndata:\n  prometheus.yaml: |\n    global:\n      scrape_interval: 30s\n      scrape_timeout: 10s\n      evaluation_interval: 30s\n\n      # External labels for federation\n      external_labels:\n        cluster: 'production'\n        region: 'us-east-1'\n\n    # Remote write for long-term storage\n    remote_write:\n    - url: https://prometheus-storage.example.com/api/v1/write\n      remote_timeout: 30s\n      queue_config:\n        capacity: 10000\n        max_shards: 30\n        min_shards: 1\n        max_samples_per_send: 5000\n        batch_send_deadline: 5s\n        min_backoff: 30ms\n        max_backoff: 100ms\n\n      # Only send aggregated metrics\n      write_relabel_configs:\n      - source_labels: [__name__]\n        regex: 'mcp_mesh:.*'\n        action: keep\n\n    # Alerting configuration\n    alerting:\n      alertmanagers:\n      - static_configs:\n        - targets:\n          - alertmanager:9093\n\n    # Scrape configs\n    scrape_configs:\n    # MCP Mesh registry with higher frequency\n    - job_name: 'mcp-mesh-registry'\n      scrape_interval: 15s\n      kubernetes_sd_configs:\n      - role: endpoints\n        namespaces:\n          names:\n          - mcp-mesh\n      relabel_configs:\n      - source_labels: [__meta_kubernetes_service_name]\n        regex: '.*registry.*'\n        action: keep\n      - source_labels: [__meta_kubernetes_namespace]\n        target_label: namespace\n      - source_labels: [__meta_kubernetes_service_name]\n        target_label: service\n\n    # MCP Mesh agents\n    - job_name: 'mcp-mesh-agents'\n      kubernetes_sd_configs:\n      - role: pod\n        namespaces:\n          names:\n          - mcp-mesh\n      relabel_configs:\n      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]\n        action: keep\n        regex: true\n      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]\n        action: replace\n        target_label: __metrics_path__\n        regex: (.+)\n      - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]\n        action: replace\n        regex: ([^:]+)(?::\\d+)?;(\\d+)\n        replacement: $1:$2\n        target_label: __address__\n      - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_name]\n        target_label: agent_name\n      - source_labels: [__meta_kubernetes_pod_namespace]\n        target_label: namespace\n      - source_labels: [__meta_kubernetes_pod_name]\n        target_label: pod\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#step-6-set-up-federation","title":"Step 6: Set Up Federation","text":"<p>Configure Prometheus federation for multi-cluster setups:</p> <pre><code># federation-config.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: prometheus-federation\n  namespace: monitoring\ndata:\n  federation.yaml: |\n    # Global Prometheus configuration\n    scrape_configs:\n    - job_name: 'federate'\n      scrape_interval: 15s\n      honor_labels: true\n      metrics_path: '/federate'\n      params:\n        'match[]':\n        # Only federate aggregated metrics\n        - 'mcp_mesh:.*'\n        - 'up{job=~\"mcp-mesh.*\"}'\n        - 'prometheus_build_info'\n      static_configs:\n      - targets:\n        - 'prometheus-us-east-1:9090'\n        - 'prometheus-us-west-2:9090'\n        - 'prometheus-eu-west-1:9090'\n      relabel_configs:\n      - source_labels: [__address__]\n        regex: 'prometheus-(.*):9090'\n        target_label: source_cluster\n        replacement: '$1'\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#configuration-options","title":"Configuration Options","text":"Component Configuration Description Scrape Interval <code>30s</code> How often to collect metrics Retention <code>30d</code> How long to keep metrics Storage <code>100Gi</code> Prometheus data storage Memory <code>4Gi</code> Prometheus memory limit Remote Write Enabled Long-term storage"},{"location":"07-observability/01-prometheus-integration/#examples","title":"Examples","text":""},{"location":"07-observability/01-prometheus-integration/#example-1-custom-business-metrics","title":"Example 1: Custom Business Metrics","text":"<pre><code># business_metrics.py\nfrom prometheus_client import Counter, Histogram, Gauge\n\n# Business KPIs\nrevenue_counter = Counter(\n    'mcp_mesh_business_revenue_total',\n    'Total revenue processed',\n    ['agent', 'currency', 'product'],\n    registry=REGISTRY\n)\n\napi_calls_counter = Counter(\n    'mcp_mesh_business_api_calls_total',\n    'Total external API calls',\n    ['agent', 'api_provider', 'endpoint'],\n    registry=REGISTRY\n)\n\ncache_hit_rate = Gauge(\n    'mcp_mesh_cache_hit_rate',\n    'Cache hit rate percentage',\n    ['agent', 'cache_type'],\n    registry=REGISTRY\n)\n\nclass AnalyticsAgent:\n    @track_request_duration(\"analytics\", \"process_transaction\")\n    async def process_transaction(self, transaction):\n        \"\"\"Process transaction with business metrics\"\"\"\n        # Track revenue\n        revenue_counter.labels(\n            agent=\"analytics\",\n            currency=transaction.currency,\n            product=transaction.product\n        ).inc(transaction.amount)\n\n        # Track API usage\n        if transaction.requires_external_validation:\n            api_calls_counter.labels(\n                agent=\"analytics\",\n                api_provider=\"payment-gateway\",\n                endpoint=\"validate\"\n            ).inc()\n\n        # Update cache metrics\n        hit_rate = await self.cache.get_hit_rate()\n        cache_hit_rate.labels(\n            agent=\"analytics\",\n            cache_type=\"redis\"\n        ).set(hit_rate * 100)\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#example-2-advanced-queries","title":"Example 2: Advanced Queries","text":"<pre><code># Top 5 agents by request rate\ntopk(5,\n  sum by (agent) (\n    rate(mcp_mesh_requests_total[5m])\n  )\n)\n\n# Agents with error rate &gt; 1%\nsum by (agent) (\n  rate(mcp_mesh_requests_total{status=\"error\"}[5m])\n) / ignoring(status) group_left\nsum by (agent) (\n  rate(mcp_mesh_requests_total[5m])\n) &gt; 0.01\n\n# Request duration heatmap\nsum by (le) (\n  rate(mcp_mesh_request_duration_seconds_bucket[5m])\n)\n\n# Week-over-week comparison\n(\n  sum by (agent) (\n    rate(mcp_mesh_requests_total[5m])\n  ) -\n  sum by (agent) (\n    rate(mcp_mesh_requests_total[5m] offset 1w)\n  )\n) / sum by (agent) (\n  rate(mcp_mesh_requests_total[5m] offset 1w)\n) * 100\n\n# Predict resource usage\npredict_linear(\n  mcp_mesh_connections_active[1h],\n  3600 * 4  # 4 hours\n)\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#best-practices","title":"Best Practices","text":"<ol> <li>Label Cardinality: Keep label values bounded</li> <li>Metric Naming: Follow Prometheus conventions</li> <li>Recording Rules: Pre-compute expensive queries</li> <li>Retention Policy: Balance cost vs history</li> <li>Federation: Only federate aggregated metrics</li> </ol>"},{"location":"07-observability/01-prometheus-integration/#common-pitfalls","title":"Common Pitfalls","text":""},{"location":"07-observability/01-prometheus-integration/#pitfall-1-high-cardinality","title":"Pitfall 1: High Cardinality","text":"<p>Problem: Too many unique label combinations</p> <p>Solution: Limit label values:</p> <pre><code># Bad - unbounded cardinality\nrequest_count.labels(\n    user_id=user.id,  # Millions of values!\n    endpoint=endpoint\n).inc()\n\n# Good - bounded cardinality\nrequest_count.labels(\n    user_type=user.type,  # Limited values\n    endpoint=endpoint\n).inc()\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#pitfall-2-missing-metrics","title":"Pitfall 2: Missing Metrics","text":"<p>Problem: Metrics not appearing in Prometheus</p> <p>Solution: Check discovery and networking:</p> <pre><code># Verify endpoints\nkubectl get endpoints -n mcp-mesh\n\n# Check ServiceMonitor\nkubectl describe servicemonitor mcp-mesh-registry -n mcp-mesh\n\n# Test metrics endpoint\nkubectl port-forward -n mcp-mesh svc/mcp-mesh-registry 8080\ncurl http://localhost:8080/metrics\n\n# Check Prometheus targets\nkubectl port-forward -n monitoring svc/prometheus-operated 9090\n# Visit http://localhost:9090/targets\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#testing","title":"Testing","text":""},{"location":"07-observability/01-prometheus-integration/#validate-metrics","title":"Validate Metrics","text":"<pre><code># test_metrics.py\nimport pytest\nfrom prometheus_client import REGISTRY\nfrom prometheus_client.parser import text_string_to_metric_families\n\ndef test_metrics_registration():\n    \"\"\"Test that all metrics are properly registered\"\"\"\n    # Get all metrics\n    metrics = list(REGISTRY.collect())\n\n    # Verify expected metrics exist\n    metric_names = [m.name for m in metrics]\n    assert 'mcp_mesh_requests_total' in metric_names\n    assert 'mcp_mesh_request_duration_seconds' in metric_names\n\ndef test_metrics_format():\n    \"\"\"Test metrics are in correct format\"\"\"\n    from mcp_mesh.metrics import generate_latest\n\n    output = generate_latest(REGISTRY).decode('utf-8')\n\n    # Parse metrics\n    families = list(text_string_to_metric_families(output))\n\n    # Verify format\n    for family in families:\n        assert family.name.startswith('mcp_mesh_')\n        assert family.documentation\n        assert family.type in ['counter', 'gauge', 'histogram', 'summary']\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#load-testing","title":"Load Testing","text":"<pre><code>#!/bin/bash\n# load-test-metrics.sh\n\necho \"Testing Prometheus under load...\"\n\n# Generate load\nfor i in {1..1000}; do\n  curl -s http://mcp-mesh-registry:8080/api/agents &amp;\ndone\nwait\n\n# Check Prometheus performance\ncurl -s http://prometheus:9090/api/v1/query \\\n  -d 'query=rate(prometheus_engine_query_duration_seconds_sum[5m])' | \\\n  jq '.data.result[0].value[1]'\n\n# Check memory usage\ncurl -s http://prometheus:9090/api/v1/query \\\n  -d 'query=prometheus_tsdb_symbol_table_size_bytes' | \\\n  jq '.data.result[0].value[1]' | \\\n  awk '{print $1/1024/1024 \" MB\"}'\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#monitoring-and-debugging","title":"Monitoring and Debugging","text":""},{"location":"07-observability/01-prometheus-integration/#monitor-prometheus-health","title":"Monitor Prometheus Health","text":"<pre><code># prometheus-monitoring.yaml\napiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  name: prometheus-health\n  namespace: monitoring\nspec:\n  groups:\n    - name: prometheus.rules\n      rules:\n        - alert: PrometheusHighMemoryUsage\n          expr: |\n            (\n              prometheus_tsdb_symbol_table_size_bytes /\n              prometheus_tsdb_storage_blocks_bytes\n            ) &gt; 0.5\n          for: 15m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Prometheus high memory usage\"\n            description: \"Prometheus {% raw %}{{ $labels.instance }}{% endraw %} memory usage is high\"\n\n        - alert: PrometheusTargetDown\n          expr: up{job=~\"mcp-mesh.*\"} == 0\n          for: 5m\n          labels:\n            severity: critical\n          annotations:\n            summary: \"MCP Mesh target down\"\n            description: \"Target {% raw %}{{ $labels.instance }}{% endraw %} is down\"\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#debug-metrics-issues","title":"Debug Metrics Issues","text":"<pre><code># Check Prometheus configuration\nkubectl exec -n monitoring prometheus-0 -- \\\n  promtool check config /etc/prometheus/config_out/prometheus.env.yaml\n\n# View Prometheus logs\nkubectl logs -n monitoring prometheus-0 -c prometheus\n\n# Check TSDB status\nkubectl exec -n monitoring prometheus-0 -- \\\n  promtool tsdb analyze /prometheus\n\n# Cardinality analysis\nkubectl port-forward -n monitoring svc/prometheus-operated 9090\ncurl -s http://localhost:9090/api/v1/label/__name__/values | \\\n  jq -r '.data[]' | wc -l\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#troubleshooting","title":"\ud83d\udd27 Troubleshooting","text":""},{"location":"07-observability/01-prometheus-integration/#issue-1-metrics-not-collected","title":"Issue 1: Metrics Not Collected","text":"<p>Symptoms: No data in Prometheus for MCP Mesh</p> <p>Cause: ServiceMonitor not matched or network issues</p> <p>Solution:</p> <pre><code># Check ServiceMonitor labels match Prometheus\nkubectl get prometheus -n monitoring -o yaml | grep -A5 serviceMonitorSelector\n\n# Ensure labels match\nkubectl label servicemonitor mcp-mesh-registry -n mcp-mesh \\\n  prometheus=kube-prometheus\n\n# Restart Prometheus\nkubectl rollout restart statefulset prometheus-prometheus -n monitoring\n</code></pre>"},{"location":"07-observability/01-prometheus-integration/#issue-2-high-memory-usage","title":"Issue 2: High Memory Usage","text":"<p>Symptoms: Prometheus OOMKilled</p> <p>Cause: Too many metrics or high cardinality</p> <p>Solution:</p> <pre><code># Add metric relabeling to drop unnecessary metrics\nmetricRelabelings:\n  - sourceLabels: [__name__]\n    regex: \"go_.*|process_.*\"\n    action: drop\n\n# Reduce retention\nprometheusSpec:\n  retention: 7d\n  retentionSize: 20GB\n</code></pre> <p>For more issues, see the section troubleshooting guide.</p>"},{"location":"07-observability/01-prometheus-integration/#known-limitations","title":"\u26a0\ufe0f Known Limitations","text":"<ul> <li>Storage: Local storage not suitable for HA</li> <li>Cardinality: Limited by available memory</li> <li>Query Performance: Complex queries can be slow</li> <li>Data Loss: Possible during restarts without persistent storage</li> </ul>"},{"location":"07-observability/01-prometheus-integration/#todo","title":"\ud83d\udcdd TODO","text":"<ul> <li> Add Thanos sidecar configuration</li> <li> Document multi-tenancy setup</li> <li> Create example Jsonnet dashboards</li> <li> Add PromQL query library</li> <li> Document sharding strategies</li> </ul>"},{"location":"07-observability/01-prometheus-integration/#summary","title":"Summary","text":"<p>You now have Prometheus integrated with MCP Mesh:</p> <p>Key takeaways:</p> <ul> <li>\ud83d\udd11 Metrics collection from all components</li> <li>\ud83d\udd11 Efficient storage and querying</li> <li>\ud83d\udd11 Recording rules for performance</li> <li>\ud83d\udd11 Federation for multi-cluster</li> </ul>"},{"location":"07-observability/01-prometheus-integration/#next-steps","title":"Next Steps","text":"<p>Let's visualize these metrics with Grafana dashboards.</p> <p>Continue to Grafana Dashboards \u2192</p> <p>\ud83d\udca1 Tip: Use Prometheus query inspector to understand query performance: <code>EXPLAIN &lt;query&gt;</code></p> <p>\ud83d\udcda Reference: Prometheus Best Practices</p> <p>\ud83e\uddea Try It: Write a recording rule for your most common query to improve dashboard performance</p>"},{"location":"07-observability/02-grafana-dashboards/","title":"Grafana Dashboards","text":"<p>Visualize and analyze MCP Mesh metrics with powerful, customizable dashboards</p>"},{"location":"07-observability/02-grafana-dashboards/#overview","title":"Overview","text":"<p>Grafana provides rich visualization capabilities for monitoring MCP Mesh deployments. This guide covers creating comprehensive dashboards, implementing drill-down navigation, setting up variables for dynamic filtering, and sharing dashboards across teams. You'll learn to build dashboards that provide actionable insights into agent performance, system health, and business metrics.</p> <p>Well-designed Grafana dashboards transform raw metrics into meaningful visualizations that enable quick decision-making and proactive issue resolution.</p>"},{"location":"07-observability/02-grafana-dashboards/#key-concepts","title":"Key Concepts","text":"<ul> <li>Dashboard Organization: Logical grouping and navigation</li> <li>Panel Types: Time series, stat, gauge, heatmap, logs</li> <li>Variables: Dynamic filtering and drill-down</li> <li>Annotations: Correlating events with metrics</li> <li>Alerting: Visual alerts and notifications</li> </ul>"},{"location":"07-observability/02-grafana-dashboards/#step-by-step-guide","title":"Step-by-Step Guide","text":""},{"location":"07-observability/02-grafana-dashboards/#step-1-access-and-configure-grafana","title":"Step 1: Access and Configure Grafana","text":"<p>Connect to Grafana and configure data sources:</p> <pre><code># Port forward to Grafana\nkubectl port-forward -n monitoring svc/prometheus-grafana 3000:80\n\n# Default credentials (from kube-prometheus-stack)\n# Username: admin\n# Password: prom-operator\n\n# Or get password from secret\nkubectl get secret -n monitoring prometheus-grafana \\\n  -o jsonpath=\"{.data.admin-password}\" | base64 --decode\n</code></pre> <p>Configure Prometheus data source:</p> <pre><code># datasource-config.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: grafana-datasources\n  namespace: monitoring\ndata:\n  prometheus.yaml: |\n    apiVersion: 1\n    datasources:\n    - name: Prometheus\n      type: prometheus\n      access: proxy\n      url: http://prometheus-operated:9090\n      isDefault: true\n      jsonData:\n        timeInterval: 30s\n        queryTimeout: 60s\n        httpMethod: POST\n      # Enable exemplars for trace correlation\n      exemplarTraceIdDestinations:\n      - name: traceID\n        datasourceUid: tempo\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#step-2-create-mcp-mesh-overview-dashboard","title":"Step 2: Create MCP Mesh Overview Dashboard","text":"<p>Create a comprehensive overview dashboard:</p> <pre><code>{\n  \"dashboard\": {\n    \"title\": \"MCP Mesh Overview\",\n    \"uid\": \"mcp-mesh-overview\",\n    \"description\": \"High-level overview of MCP Mesh platform health and performance\",\n    \"tags\": [\"mcp-mesh\", \"overview\"],\n    \"timezone\": \"browser\",\n    \"schemaVersion\": 30,\n    \"version\": 1,\n    \"refresh\": \"30s\",\n\n    \"variables\": {\n      \"list\": [\n        {\n          \"name\": \"namespace\",\n          \"type\": \"query\",\n          \"datasource\": \"Prometheus\",\n          \"query\": \"label_values(mcp_mesh_requests_total, namespace)\",\n          \"refresh\": 1,\n          \"multi\": false,\n          \"includeAll\": true,\n          \"allValue\": \".*\"\n        },\n        {\n          \"name\": \"agent\",\n          \"type\": \"query\",\n          \"datasource\": \"Prometheus\",\n          \"query\": \"label_values(mcp_mesh_requests_total{namespace=~\\\"$namespace\\\"}, agent)\",\n          \"refresh\": 1,\n          \"multi\": true,\n          \"includeAll\": true,\n          \"allValue\": \".*\"\n        },\n        {\n          \"name\": \"interval\",\n          \"type\": \"interval\",\n          \"options\": [\n            { \"text\": \"1m\", \"value\": \"1m\" },\n            { \"text\": \"5m\", \"value\": \"5m\" },\n            { \"text\": \"10m\", \"value\": \"10m\" },\n            { \"text\": \"30m\", \"value\": \"30m\" },\n            { \"text\": \"1h\", \"value\": \"1h\" }\n          ],\n          \"current\": {\n            \"text\": \"5m\",\n            \"value\": \"5m\"\n          }\n        }\n      ]\n    },\n\n    \"panels\": [\n      {\n        \"title\": \"System Health Score\",\n        \"type\": \"stat\",\n        \"gridPos\": { \"h\": 4, \"w\": 6, \"x\": 0, \"y\": 0 },\n        \"targets\": [\n          {\n            \"expr\": \"avg(mcp_mesh:registry:health_score)\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"options\": {\n          \"reduceOptions\": {\n            \"calcs\": [\"lastNotNull\"]\n          },\n          \"colorMode\": \"background\",\n          \"graphMode\": \"none\",\n          \"orientation\": \"horizontal\"\n        },\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"percent\",\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                { \"color\": \"red\", \"value\": 0 },\n                { \"color\": \"yellow\", \"value\": 80 },\n                { \"color\": \"green\", \"value\": 95 }\n              ]\n            }\n          }\n        }\n      },\n\n      {\n        \"title\": \"Active Agents\",\n        \"type\": \"stat\",\n        \"gridPos\": { \"h\": 4, \"w\": 6, \"x\": 6, \"y\": 0 },\n        \"targets\": [\n          {\n            \"expr\": \"count(up{job=~\\\"mcp-mesh.*\\\", namespace=~\\\"$namespace\\\"} == 1)\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"options\": {\n          \"colorMode\": \"value\",\n          \"graphMode\": \"area\",\n          \"orientation\": \"horizontal\"\n        }\n      },\n\n      {\n        \"title\": \"Total Request Rate\",\n        \"type\": \"stat\",\n        \"gridPos\": { \"h\": 4, \"w\": 6, \"x\": 12, \"y\": 0 },\n        \"targets\": [\n          {\n            \"expr\": \"sum(rate(mcp_mesh_requests_total{namespace=~\\\"$namespace\\\", agent=~\\\"$agent\\\"}[$interval]))\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"reqps\",\n            \"decimals\": 2\n          }\n        }\n      },\n\n      {\n        \"title\": \"Error Rate\",\n        \"type\": \"stat\",\n        \"gridPos\": { \"h\": 4, \"w\": 6, \"x\": 18, \"y\": 0 },\n        \"targets\": [\n          {\n            \"expr\": \"sum(rate(mcp_mesh_requests_total{namespace=~\\\"$namespace\\\", agent=~\\\"$agent\\\", status=\\\"error\\\"}[$interval])) / sum(rate(mcp_mesh_requests_total{namespace=~\\\"$namespace\\\", agent=~\\\"$agent\\\"}[$interval])) * 100\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"percent\",\n            \"decimals\": 2,\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                { \"color\": \"green\", \"value\": 0 },\n                { \"color\": \"yellow\", \"value\": 1 },\n                { \"color\": \"red\", \"value\": 5 }\n              ]\n            }\n          }\n        }\n      },\n\n      {\n        \"title\": \"Request Rate by Agent\",\n        \"type\": \"timeseries\",\n        \"gridPos\": { \"h\": 8, \"w\": 12, \"x\": 0, \"y\": 4 },\n        \"targets\": [\n          {\n            \"expr\": \"sum by (agent) (rate(mcp_mesh_requests_total{namespace=~\\\"$namespace\\\", agent=~\\\"$agent\\\"}[$interval]))\",\n            \"legendFormat\": \"{% raw %}{{agent}}{% endraw %}\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"reqps\",\n            \"custom\": {\n              \"drawStyle\": \"line\",\n              \"lineInterpolation\": \"smooth\",\n              \"lineWidth\": 2,\n              \"fillOpacity\": 10,\n              \"gradientMode\": \"opacity\",\n              \"spanNulls\": false,\n              \"showPoints\": \"never\",\n              \"stacking\": {\n                \"mode\": \"none\"\n              }\n            }\n          }\n        }\n      },\n\n      {\n        \"title\": \"Response Time Heatmap\",\n        \"type\": \"heatmap\",\n        \"gridPos\": { \"h\": 8, \"w\": 12, \"x\": 12, \"y\": 4 },\n        \"targets\": [\n          {\n            \"expr\": \"sum by (le) (increase(mcp_mesh_request_duration_seconds_bucket{namespace=~\\\"$namespace\\\", agent=~\\\"$agent\\\"}[$interval]))\",\n            \"format\": \"heatmap\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"options\": {\n          \"calculate\": false,\n          \"yAxis\": {\n            \"unit\": \"s\",\n            \"decimals\": 2\n          },\n          \"cellGap\": 1,\n          \"colorScheme\": \"interpolateSpectral\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#step-3-create-agent-specific-dashboard","title":"Step 3: Create Agent-Specific Dashboard","text":"<p>Build detailed dashboards for individual agents:</p> <pre><code>{\n  \"dashboard\": {\n    \"title\": \"MCP Mesh Agent Details\",\n    \"uid\": \"mcp-mesh-agent-details\",\n    \"description\": \"Detailed metrics for individual MCP Mesh agents\",\n\n    \"panels\": [\n      {\n        \"title\": \"Agent Info\",\n        \"type\": \"table\",\n        \"gridPos\": { \"h\": 4, \"w\": 24, \"x\": 0, \"y\": 0 },\n        \"targets\": [\n          {\n            \"expr\": \"mcp_mesh_agent{agent=\\\"$agent\\\"}\",\n            \"format\": \"table\",\n            \"instant\": true,\n            \"refId\": \"A\"\n          }\n        ],\n        \"transformations\": [\n          {\n            \"id\": \"filterFieldsByName\",\n            \"options\": {\n              \"include\": {\n                \"names\": [\"agent_name\", \"version\", \"capabilities\", \"Value\"]\n              }\n            }\n          }\n        ]\n      },\n\n      {\n        \"title\": \"Request Latency Percentiles\",\n        \"type\": \"timeseries\",\n        \"gridPos\": { \"h\": 8, \"w\": 12, \"x\": 0, \"y\": 4 },\n        \"targets\": [\n          {\n            \"expr\": \"histogram_quantile(0.50, sum by (le) (rate(mcp_mesh_request_duration_seconds_bucket{agent=\\\"$agent\\\"}[$interval])))\",\n            \"legendFormat\": \"p50\",\n            \"refId\": \"A\"\n          },\n          {\n            \"expr\": \"histogram_quantile(0.95, sum by (le) (rate(mcp_mesh_request_duration_seconds_bucket{agent=\\\"$agent\\\"}[$interval])))\",\n            \"legendFormat\": \"p95\",\n            \"refId\": \"B\"\n          },\n          {\n            \"expr\": \"histogram_quantile(0.99, sum by (le) (rate(mcp_mesh_request_duration_seconds_bucket{agent=\\\"$agent\\\"}[$interval])))\",\n            \"legendFormat\": \"p99\",\n            \"refId\": \"C\"\n          }\n        ],\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"s\",\n            \"custom\": {\n              \"axisLabel\": \"Response Time\",\n              \"drawStyle\": \"line\",\n              \"lineWidth\": 2,\n              \"fillOpacity\": 0\n            }\n          },\n          \"overrides\": [\n            {\n              \"matcher\": { \"id\": \"byName\", \"options\": \"p99\" },\n              \"properties\": [\n                {\n                  \"id\": \"color\",\n                  \"value\": { \"mode\": \"fixed\", \"fixedColor\": \"red\" }\n                }\n              ]\n            }\n          ]\n        }\n      },\n\n      {\n        \"title\": \"Request Types Distribution\",\n        \"type\": \"piechart\",\n        \"gridPos\": { \"h\": 8, \"w\": 12, \"x\": 12, \"y\": 4 },\n        \"targets\": [\n          {\n            \"expr\": \"sum by (method) (increase(mcp_mesh_requests_total{agent=\\\"$agent\\\"}[$interval]))\",\n            \"legendFormat\": \"{% raw %}{{method}}{% endraw %}\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"options\": {\n          \"reduceOptions\": {\n            \"values\": false,\n            \"calcs\": [\"lastNotNull\"]\n          },\n          \"pieType\": \"donut\",\n          \"displayLabels\": [\"name\", \"percent\"],\n          \"legendDisplayMode\": \"table\",\n          \"legendPlacement\": \"right\"\n        }\n      },\n\n      {\n        \"title\": \"Active Connections\",\n        \"type\": \"graph\",\n        \"gridPos\": { \"h\": 8, \"w\": 12, \"x\": 0, \"y\": 12 },\n        \"targets\": [\n          {\n            \"expr\": \"mcp_mesh_connections_active{agent=\\\"$agent\\\"}\",\n            \"legendFormat\": \"{% raw %}{{type}}{% endraw %}\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"yaxes\": [\n          {\n            \"label\": \"Connections\",\n            \"format\": \"short\",\n            \"min\": 0\n          }\n        ]\n      },\n\n      {\n        \"title\": \"Resource Usage\",\n        \"type\": \"timeseries\",\n        \"gridPos\": { \"h\": 8, \"w\": 12, \"x\": 12, \"y\": 12 },\n        \"targets\": [\n          {\n            \"expr\": \"rate(container_cpu_usage_seconds_total{pod=~\\\"$agent.*\\\"}[$interval]) * 100\",\n            \"legendFormat\": \"CPU %\",\n            \"refId\": \"A\"\n          },\n          {\n            \"expr\": \"container_memory_working_set_bytes{pod=~\\\"$agent.*\\\"} / 1024 / 1024\",\n            \"legendFormat\": \"Memory (MB)\",\n            \"refId\": \"B\"\n          }\n        ],\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"custom\": {\n              \"drawStyle\": \"line\",\n              \"lineWidth\": 2,\n              \"fillOpacity\": 10\n            }\n          },\n          \"overrides\": [\n            {\n              \"matcher\": { \"id\": \"byName\", \"options\": \"CPU %\" },\n              \"properties\": [\n                { \"id\": \"unit\", \"value\": \"percent\" },\n                { \"id\": \"custom.axisPlacement\", \"value\": \"left\" }\n              ]\n            },\n            {\n              \"matcher\": { \"id\": \"byName\", \"options\": \"Memory (MB)\" },\n              \"properties\": [\n                { \"id\": \"unit\", \"value\": \"decmbytes\" },\n                { \"id\": \"custom.axisPlacement\", \"value\": \"right\" }\n              ]\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#step-4-create-business-metrics-dashboard","title":"Step 4: Create Business Metrics Dashboard","text":"<p>Visualize business-specific KPIs:</p> <pre><code>{\n  \"dashboard\": {\n    \"title\": \"MCP Mesh Business Metrics\",\n    \"uid\": \"mcp-mesh-business\",\n    \"description\": \"Business KPIs and analytics for MCP Mesh\",\n\n    \"panels\": [\n      {\n        \"title\": \"Revenue by Agent\",\n        \"type\": \"bargauge\",\n        \"gridPos\": { \"h\": 8, \"w\": 12, \"x\": 0, \"y\": 0 },\n        \"targets\": [\n          {\n            \"expr\": \"sum by (agent) (increase(mcp_mesh_business_revenue_total[$__range]))\",\n            \"legendFormat\": \"{% raw %}{{agent}}{% endraw %}\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"options\": {\n          \"orientation\": \"horizontal\",\n          \"displayMode\": \"gradient\",\n          \"showUnfilled\": true\n        },\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"currencyUSD\",\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                { \"color\": \"green\", \"value\": 0 },\n                { \"color\": \"yellow\", \"value\": 10000 },\n                { \"color\": \"red\", \"value\": 50000 }\n              ]\n            }\n          }\n        }\n      },\n\n      {\n        \"title\": \"API Usage Costs\",\n        \"type\": \"timeseries\",\n        \"gridPos\": { \"h\": 8, \"w\": 12, \"x\": 12, \"y\": 0 },\n        \"targets\": [\n          {\n            \"expr\": \"sum by (api_provider) (increase(mcp_mesh_business_api_calls_total[$interval]) * 0.001)\",\n            \"legendFormat\": \"{% raw %}{{api_provider}}{% endraw %} ($0.001/call)\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"currencyUSD\",\n            \"custom\": {\n              \"stacking\": {\n                \"mode\": \"normal\"\n              },\n              \"fillOpacity\": 50\n            }\n          }\n        }\n      },\n\n      {\n        \"title\": \"Cache Performance\",\n        \"type\": \"gauge\",\n        \"gridPos\": { \"h\": 8, \"w\": 8, \"x\": 0, \"y\": 8 },\n        \"targets\": [\n          {\n            \"expr\": \"avg(mcp_mesh_cache_hit_rate)\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"options\": {\n          \"orientation\": \"auto\",\n          \"showThresholdLabels\": true,\n          \"showThresholdMarkers\": true\n        },\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"percent\",\n            \"min\": 0,\n            \"max\": 100,\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                { \"color\": \"red\", \"value\": 0 },\n                { \"color\": \"yellow\", \"value\": 60 },\n                { \"color\": \"green\", \"value\": 80 }\n              ]\n            }\n          }\n        }\n      },\n\n      {\n        \"title\": \"SLO Compliance\",\n        \"type\": \"stat\",\n        \"gridPos\": { \"h\": 8, \"w\": 8, \"x\": 8, \"y\": 8 },\n        \"targets\": [\n          {\n            \"expr\": \"avg(mcp_mesh:slo:availability) * 100\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"options\": {\n          \"colorMode\": \"background\",\n          \"graphMode\": \"none\",\n          \"orientation\": \"horizontal\"\n        },\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"percent\",\n            \"decimals\": 3,\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                { \"color\": \"red\", \"value\": 0 },\n                { \"color\": \"yellow\", \"value\": 99 },\n                { \"color\": \"green\", \"value\": 99.9 }\n              ]\n            }\n          }\n        }\n      },\n\n      {\n        \"title\": \"Cost per Transaction\",\n        \"type\": \"timeseries\",\n        \"gridPos\": { \"h\": 8, \"w\": 8, \"x\": 16, \"y\": 8 },\n        \"targets\": [\n          {\n            \"expr\": \"(sum(rate(container_cpu_usage_seconds_total{namespace=\\\"mcp-mesh\\\"}[$interval])) * 0.05 + sum(container_memory_working_set_bytes{namespace=\\\"mcp-mesh\\\"}) / 1024 / 1024 / 1024 * 0.01) / sum(rate(mcp_mesh_requests_total[$interval]))\",\n            \"legendFormat\": \"Cost per transaction\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"currencyUSD\",\n            \"decimals\": 6,\n            \"custom\": {\n              \"drawStyle\": \"line\",\n              \"lineWidth\": 2,\n              \"fillOpacity\": 20,\n              \"gradientMode\": \"opacity\"\n            }\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#step-5-implement-dynamic-dashboards","title":"Step 5: Implement Dynamic Dashboards","text":"<p>Create dashboards with advanced features:</p> <pre><code># dashboard-configmap.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: grafana-dashboards-dynamic\n  namespace: monitoring\ndata:\n  dynamic-dashboard.json: |\n    {\n      \"dashboard\": {\n        \"title\": \"MCP Mesh Dynamic Analysis\",\n        \"templating\": {\n          \"list\": [\n            {\n              \"name\": \"datasource\",\n              \"type\": \"datasource\",\n              \"query\": \"prometheus\",\n              \"current\": {\n                \"text\": \"Prometheus\",\n                \"value\": \"Prometheus\"\n              }\n            },\n            {\n              \"name\": \"agent_regex\",\n              \"type\": \"textbox\",\n              \"current\": {\n                \"text\": \".*\",\n                \"value\": \".*\"\n              },\n              \"label\": \"Agent Filter (regex)\"\n            },\n            {\n              \"name\": \"percentile\",\n              \"type\": \"custom\",\n              \"current\": {\n                \"text\": \"0.95\",\n                \"value\": \"0.95\"\n              },\n              \"options\": [\n                {\"text\": \"p50\", \"value\": \"0.5\"},\n                {\"text\": \"p90\", \"value\": \"0.9\"},\n                {\"text\": \"p95\", \"value\": \"0.95\"},\n                {\"text\": \"p99\", \"value\": \"0.99\"}\n              ]\n            }\n          ]\n        },\n\n        \"annotations\": {\n          \"list\": [\n            {\n              \"datasource\": \"Prometheus\",\n              \"enable\": true,\n              \"expr\": \"changes(mcp_mesh_agent{agent=~\\\"$agent_regex\\\"}[5m]) &gt; 0\",\n              \"iconColor\": \"rgba(0, 211, 255, 1)\",\n              \"name\": \"Agent Restarts\",\n              \"tagKeys\": \"agent,version\"\n            },\n            {\n              \"datasource\": \"Prometheus\",\n              \"enable\": true,\n              \"expr\": \"ALERTS{alertstate=\\\"firing\\\",namespace=\\\"mcp-mesh\\\"}\",\n              \"iconColor\": \"rgba(255, 96, 96, 1)\",\n              \"name\": \"Active Alerts\",\n              \"tagKeys\": \"alertname,severity\"\n            }\n          ]\n        },\n\n        \"links\": [\n          {\n            \"title\": \"Drill Down\",\n            \"type\": \"dashboards\",\n            \"tags\": [\"mcp-mesh\", \"agent\"],\n            \"includeVars\": true,\n            \"keepTime\": true\n          },\n          {\n            \"title\": \"View in Jaeger\",\n            \"type\": \"link\",\n            \"url\": \"http://jaeger:16686/search?service=${agent}&amp;start=${__from}&amp;end=${__to}\",\n            \"targetBlank\": true\n          }\n        ],\n\n        \"panels\": [\n          {\n            \"title\": \"Dynamic Latency Analysis\",\n            \"type\": \"graph\",\n            \"gridPos\": {\"h\": 10, \"w\": 24, \"x\": 0, \"y\": 0},\n            \"targets\": [\n              {\n                \"expr\": \"histogram_quantile($percentile, sum by (agent, le) (rate(mcp_mesh_request_duration_seconds_bucket{agent=~\\\"$agent_regex\\\"}[$interval])))\",\n                \"legendFormat\": \"{% raw %}{{agent}}{% endraw %} - p${percentile:raw}\",\n                \"refId\": \"A\"\n              }\n            ],\n            \"options\": {\n              \"dataLinks\": [\n                {\n                  \"title\": \"View traces\",\n                  \"url\": \"/explore?left={\\\"datasource\\\":\\\"Tempo\\\",\\\"queries\\\":[{\\\"query\\\":\\\"agent=${__series.labels.agent}\\\"}],\\\"range\\\":{\\\"from\\\":\\\"${__value.time}\\\",\\\"to\\\":\\\"${__value.time}\\\"}}\"\n                }\n              ]\n            }\n          },\n\n          {\n            \"title\": \"Adaptive Thresholds\",\n            \"type\": \"timeseries\",\n            \"gridPos\": {\"h\": 10, \"w\": 24, \"x\": 0, \"y\": 10},\n            \"targets\": [\n              {\n                \"expr\": \"mcp_mesh:request_rate{agent=~\\\"$agent_regex\\\"}\",\n                \"legendFormat\": \"{% raw %}{{agent}}{% endraw %} - actual\",\n                \"refId\": \"A\"\n              },\n              {\n                \"expr\": \"predict_linear(mcp_mesh:request_rate{agent=~\\\"$agent_regex\\\"}[1h], 3600)\",\n                \"legendFormat\": \"{% raw %}{{agent}}{% endraw %} - predicted\",\n                \"refId\": \"B\"\n              },\n              {\n                \"expr\": \"mcp_mesh:request_rate{agent=~\\\"$agent_regex\\\"} + 2 * stddev_over_time(mcp_mesh:request_rate{agent=~\\\"$agent_regex\\\"}[1h])\",\n                \"legendFormat\": \"{% raw %}{{agent}}{% endraw %} - upper bound\",\n                \"refId\": \"C\"\n              }\n            ],\n            \"fieldConfig\": {\n              \"overrides\": [\n                {\n                  \"matcher\": {\"id\": \"byRegexp\", \"options\": \".*predicted.*\"},\n                  \"properties\": [\n                    {\n                      \"id\": \"custom.lineStyle\",\n                      \"value\": {\"fill\": \"dash\", \"dash\": [10, 10]}\n                    }\n                  ]\n                },\n                {\n                  \"matcher\": {\"id\": \"byRegexp\", \"options\": \".*upper bound.*\"},\n                  \"properties\": [\n                    {\n                      \"id\": \"custom.lineStyle\",\n                      \"value\": {\"fill\": \"dot\", \"dash\": [2, 5]}\n                    },\n                    {\n                      \"id\": \"color\",\n                      \"value\": {\"mode\": \"fixed\", \"fixedColor\": \"red\"}\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#step-6-set-up-dashboard-provisioning","title":"Step 6: Set Up Dashboard Provisioning","text":"<p>Automate dashboard deployment:</p> <pre><code># dashboard-provisioning.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: grafana-dashboard-provider\n  namespace: monitoring\ndata:\n  dashboards.yaml: |\n    apiVersion: 1\n    providers:\n    - name: 'MCP Mesh Dashboards'\n      orgId: 1\n      folder: 'MCP Mesh'\n      type: file\n      disableDeletion: false\n      updateIntervalSeconds: 10\n      allowUiUpdates: true\n      options:\n        path: /var/lib/grafana/dashboards/mcp-mesh\n\n    - name: 'MCP Mesh Generated'\n      orgId: 1\n      folder: 'MCP Mesh - Auto'\n      type: file\n      disableDeletion: true\n      updateIntervalSeconds: 30\n      options:\n        path: /var/lib/grafana/dashboards/generated\n\n---\n# Script to generate dashboards dynamically\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: dashboard-generator\n  namespace: monitoring\ndata:\n  generate.py: |\n    #!/usr/bin/env python3\n    import json\n    import os\n    from prometheus_api_client import PrometheusConnect\n\n    # Connect to Prometheus\n    prom = PrometheusConnect(url=\"http://prometheus-operated:9090\")\n\n    # Get all agents\n    agents = prom.custom_query('group by (agent) (mcp_mesh_requests_total)')\n\n    # Generate dashboard for each agent\n    for agent_data in agents:\n        agent = agent_data['metric']['agent']\n\n        dashboard = {\n            \"dashboard\": {\n                \"title\": f\"MCP Mesh - {agent}\",\n                \"uid\": f\"mcp-mesh-auto-{agent}\",\n                \"tags\": [\"mcp-mesh\", \"auto-generated\", agent],\n                \"panels\": generate_panels_for_agent(agent)\n            }\n        }\n\n        # Save dashboard\n        with open(f'/var/lib/grafana/dashboards/generated/{agent}.json', 'w') as f:\n            json.dump(dashboard, f, indent=2)\n\n    def generate_panels_for_agent(agent):\n        return [\n            {\n                \"title\": f\"{agent} - Request Rate\",\n                \"type\": \"graph\",\n                \"targets\": [\n                    {\n                        \"expr\": f'rate(mcp_mesh_requests_total{% raw %}{{agent=\"{agent}\"}}{% endraw %}[5m])',\n                        \"refId\": \"A\"\n                    }\n                ]\n            }\n            # Add more panels...\n        ]\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#configuration-options","title":"Configuration Options","text":"Feature Configuration Purpose Variables <code>templating.list</code> Dynamic filtering Annotations <code>annotations.list</code> Event markers Links <code>links</code> Navigation between dashboards Alerts <code>alert</code> Visual alert rules Transforms <code>transformations</code> Data manipulation"},{"location":"07-observability/02-grafana-dashboards/#examples","title":"Examples","text":""},{"location":"07-observability/02-grafana-dashboards/#example-1-multi-cluster-dashboard","title":"Example 1: Multi-Cluster Dashboard","text":"<pre><code>{\n  \"dashboard\": {\n    \"title\": \"MCP Mesh Multi-Cluster View\",\n    \"panels\": [\n      {\n        \"title\": \"Cluster Comparison\",\n        \"type\": \"table\",\n        \"gridPos\": { \"h\": 10, \"w\": 24, \"x\": 0, \"y\": 0 },\n        \"targets\": [\n          {\n            \"expr\": \"sum by (cluster, agent) (rate(mcp_mesh_requests_total[5m]))\",\n            \"format\": \"table\",\n            \"instant\": true,\n            \"refId\": \"A\"\n          }\n        ],\n        \"transformations\": [\n          {\n            \"id\": \"pivot\",\n            \"options\": {\n              \"pivotField\": \"cluster\",\n              \"valueField\": \"Value\",\n              \"groupByField\": \"agent\"\n            }\n          }\n        ],\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"custom\": {\n              \"displayMode\": \"color-background\",\n              \"colorMode\": \"value\"\n            },\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                { \"color\": \"green\", \"value\": 0 },\n                { \"color\": \"yellow\", \"value\": 10 },\n                { \"color\": \"red\", \"value\": 50 }\n              ]\n            }\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#example-2-slo-dashboard","title":"Example 2: SLO Dashboard","text":"<pre><code>{\n  \"dashboard\": {\n    \"title\": \"MCP Mesh SLO Tracking\",\n    \"panels\": [\n      {\n        \"title\": \"Error Budget Remaining\",\n        \"type\": \"gauge\",\n        \"targets\": [\n          {\n            \"expr\": \"(1 - ((1 - avg(mcp_mesh:slo:availability)) / (1 - 0.999))) * 100\",\n            \"refId\": \"A\"\n          }\n        ],\n        \"options\": {\n          \"showThresholdLabels\": true,\n          \"showThresholdMarkers\": true,\n          \"text\": {\n            \"titleSize\": 24,\n            \"valueSize\": 48\n          }\n        },\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"percent\",\n            \"min\": 0,\n            \"max\": 100,\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                { \"color\": \"red\", \"value\": 0 },\n                { \"color\": \"yellow\", \"value\": 25 },\n                { \"color\": \"green\", \"value\": 50 }\n              ]\n            }\n          }\n        }\n      },\n\n      {\n        \"title\": \"SLO Burn Rate\",\n        \"type\": \"timeseries\",\n        \"targets\": [\n          {\n            \"expr\": \"1 - mcp_mesh:slo:availability\",\n            \"legendFormat\": \"Current burn rate\",\n            \"refId\": \"A\"\n          },\n          {\n            \"expr\": \"0.001\",\n            \"legendFormat\": \"SLO threshold (99.9%)\",\n            \"refId\": \"B\"\n          }\n        ]\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#best-practices","title":"Best Practices","text":"<ol> <li>Organize Dashboards: Use folders and tags</li> <li>Use Variables: Enable dynamic filtering</li> <li>Add Documentation: Include panel descriptions</li> <li>Set Refresh Rates: Balance freshness vs load</li> <li>Export/Import: Version control dashboards</li> </ol>"},{"location":"07-observability/02-grafana-dashboards/#common-pitfalls","title":"Common Pitfalls","text":""},{"location":"07-observability/02-grafana-dashboards/#pitfall-1-overwhelming-dashboards","title":"Pitfall 1: Overwhelming Dashboards","text":"<p>Problem: Too many panels, hard to understand</p> <p>Solution: Create focused dashboards:</p> <pre><code>{\n  \"dashboard\": {\n    \"title\": \"MCP Mesh - Quick Health\",\n    \"description\": \"High-level health indicators only\",\n    \"panels\": [\n      // Limit to 6-8 key metrics\n    ]\n  }\n}\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#pitfall-2-slow-queries","title":"Pitfall 2: Slow Queries","text":"<p>Problem: Dashboard takes forever to load</p> <p>Solution: Use recording rules:</p> <pre><code># Instead of complex query in dashboard\nhistogram_quantile(0.95,\n  sum by (le) (\n    rate(mcp_mesh_request_duration_seconds_bucket[5m])\n  )\n)\n\n# Use pre-computed recording rule\nmcp_mesh:request_duration:p95\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#testing","title":"Testing","text":""},{"location":"07-observability/02-grafana-dashboards/#validate-dashboard-json","title":"Validate Dashboard JSON","text":"<pre><code># test_dashboards.py\nimport json\nimport glob\n\ndef test_dashboard_validity():\n    \"\"\"Validate all dashboard JSON files\"\"\"\n    for dashboard_file in glob.glob(\"dashboards/*.json\"):\n        with open(dashboard_file) as f:\n            dashboard = json.load(f)\n\n        # Check required fields\n        assert \"dashboard\" in dashboard\n        assert \"title\" in dashboard[\"dashboard\"]\n        assert \"panels\" in dashboard[\"dashboard\"]\n\n        # Check panels\n        for panel in dashboard[\"dashboard\"][\"panels\"]:\n            assert \"type\" in panel\n            assert \"gridPos\" in panel\n            assert \"targets\" in panel\n\ndef test_dashboard_queries():\n    \"\"\"Validate Prometheus queries in dashboards\"\"\"\n    from prometheus_api_client import PrometheusConnect\n\n    prom = PrometheusConnect(url=\"http://localhost:9090\")\n\n    for dashboard_file in glob.glob(\"dashboards/*.json\"):\n        with open(dashboard_file) as f:\n            dashboard = json.load(f)\n\n        for panel in dashboard[\"dashboard\"][\"panels\"]:\n            for target in panel.get(\"targets\", []):\n                if \"expr\" in target:\n                    # Test query syntax\n                    try:\n                        prom.custom_query(target[\"expr\"])\n                    except Exception as e:\n                        raise AssertionError(\n                            f\"Invalid query in {dashboard_file}: {target['expr']}\"\n                        ) from e\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#performance-testing","title":"Performance Testing","text":"<pre><code>#!/bin/bash\n# test-dashboard-performance.sh\n\nGRAFANA_URL=\"http://localhost:3000\"\nDASHBOARD_UID=\"mcp-mesh-overview\"\n\n# Measure dashboard load time\ntime curl -s -o /dev/null \\\n  -H \"Authorization: Bearer $GRAFANA_API_KEY\" \\\n  \"$GRAFANA_URL/api/dashboards/uid/$DASHBOARD_UID\"\n\n# Check panel query performance\ncurl -s \\\n  -H \"Authorization: Bearer $GRAFANA_API_KEY\" \\\n  \"$GRAFANA_URL/api/dashboards/uid/$DASHBOARD_UID\" | \\\n  jq -r '.dashboard.panels[].targets[].expr' | \\\n  while read -r query; do\n    echo \"Testing query: $query\"\n    time curl -s -o /dev/null --data-urlencode \"query=$query\" \\\n      \"http://prometheus:9090/api/v1/query\"\n  done\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#monitoring-and-debugging","title":"Monitoring and Debugging","text":""},{"location":"07-observability/02-grafana-dashboards/#monitor-grafana-performance","title":"Monitor Grafana Performance","text":"<pre><code># grafana-monitoring.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: grafana-monitoring-dashboard\n  namespace: monitoring\ndata:\n  grafana-performance.json: |\n    {\n      \"dashboard\": {\n        \"title\": \"Grafana Performance\",\n        \"panels\": [\n          {\n            \"title\": \"Dashboard Load Time\",\n            \"type\": \"graph\",\n            \"targets\": [\n              {\n                \"expr\": \"histogram_quantile(0.95, grafana_api_dashboard_get_milliseconds_bucket)\",\n                \"legendFormat\": \"p95 load time\"\n              }\n            ]\n          },\n          {\n            \"title\": \"Active Users\",\n            \"type\": \"stat\",\n            \"targets\": [\n              {\n                \"expr\": \"grafana_stat_active_users\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#debug-dashboard-issues","title":"Debug Dashboard Issues","text":"<pre><code># Enable debug logging\nkubectl set env deployment/prometheus-grafana -n monitoring \\\n  GF_LOG_LEVEL=debug\n\n# View Grafana logs\nkubectl logs -n monitoring deployment/prometheus-grafana -f\n\n# Check dashboard provisioning\nkubectl exec -n monitoring deployment/prometheus-grafana -- \\\n  ls -la /var/lib/grafana/dashboards/\n\n# Test data source connection\nkubectl exec -n monitoring deployment/prometheus-grafana -- \\\n  curl -s http://prometheus-operated:9090/api/v1/query?query=up\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#troubleshooting","title":"\ud83d\udd27 Troubleshooting","text":""},{"location":"07-observability/02-grafana-dashboards/#issue-1-dashboard-not-loading","title":"Issue 1: Dashboard Not Loading","text":"<p>Symptoms: Dashboard shows \"No Data\" or loading spinner</p> <p>Cause: Data source misconfiguration or query errors</p> <p>Solution:</p> <pre><code># Check data source configuration\ncurl -s -H \"Authorization: Bearer $API_KEY\" \\\n  http://localhost:3000/api/datasources\n\n# Test query directly in Prometheus\ncurl -G http://localhost:9090/api/v1/query \\\n  --data-urlencode 'query=mcp_mesh_requests_total'\n\n# Check time range\n# Ensure data exists for selected time range\n</code></pre>"},{"location":"07-observability/02-grafana-dashboards/#issue-2-variables-not-working","title":"Issue 2: Variables Not Working","text":"<p>Symptoms: Template variables show \"None\" or don't filter</p> <p>Cause: Incorrect query or label values</p> <p>Solution:</p> <pre><code>{\n  \"templating\": {\n    \"list\": [\n      {\n        \"name\": \"agent\",\n        \"type\": \"query\",\n        \"datasource\": \"Prometheus\",\n        \"query\": \"label_values(up{job=~\\\"mcp-mesh.*\\\"}, instance)\",\n        \"refresh\": 2, // on time range change\n        \"sort\": 1 // alphabetical\n      }\n    ]\n  }\n}\n</code></pre> <p>For more issues, see the section troubleshooting guide.</p>"},{"location":"07-observability/02-grafana-dashboards/#known-limitations","title":"\u26a0\ufe0f Known Limitations","text":"<ul> <li>Panel Limit: Performance degrades with &gt;50 panels</li> <li>Query Timeout: Default 30s timeout for queries</li> <li>Variable Cardinality: High cardinality slows dropdown</li> <li>Annotation Limit: Too many annotations impact performance</li> </ul>"},{"location":"07-observability/02-grafana-dashboards/#todo","title":"\ud83d\udcdd TODO","text":"<ul> <li> Add dashboard templating with Jsonnet</li> <li> Create mobile-responsive dashboards</li> <li> Implement dashboard versioning</li> <li> Add automated screenshot testing</li> <li> Create dashboard marketplace</li> </ul>"},{"location":"07-observability/02-grafana-dashboards/#summary","title":"Summary","text":"<p>You now have comprehensive Grafana dashboards for MCP Mesh:</p> <p>Key takeaways:</p> <ul> <li>\ud83d\udd11 Multi-level dashboards from overview to details</li> <li>\ud83d\udd11 Dynamic filtering with variables</li> <li>\ud83d\udd11 Performance optimization techniques</li> <li>\ud83d\udd11 Automated provisioning and generation</li> </ul>"},{"location":"07-observability/02-grafana-dashboards/#next-steps","title":"Next Steps","text":"<p>Let's add distributed tracing to correlate with metrics.</p> <p>Continue to Distributed Tracing \u2192</p> <p>\ud83d\udca1 Tip: Use Grafana's built-in explore mode to test queries before adding to dashboards</p> <p>\ud83d\udcda Reference: Grafana Best Practices</p> <p>\ud83e\uddea Try It: Create a custom dashboard for your specific use case using the examples as templates</p>"},{"location":"07-observability/03-distributed-tracing/","title":"Distributed Tracing","text":"<p>Real-time trace correlation and analysis for MCP Mesh using Redis Streams</p>"},{"location":"07-observability/03-distributed-tracing/#overview","title":"Overview","text":"<p>MCP Mesh implements a high-performance distributed tracing system built on Redis Streams that provides end-to-end visibility into request flows across multiple agents. Unlike traditional OpenTelemetry setups, this system is specifically designed for MCP's JSON-RPC protocol with automatic context propagation and real-time correlation.</p>"},{"location":"07-observability/03-distributed-tracing/#architecture-components","title":"Architecture Components","text":""},{"location":"07-observability/03-distributed-tracing/#1-python-agent-tracing-publishers","title":"1. Python Agent Tracing (Publishers)","text":"<p>Python agents automatically publish trace events to Redis Streams when decorated with <code>@mesh.tool()</code>:</p> <pre><code>@app.tool()\n@mesh.tool(depends_on=[\"data-processor\"])\nasync def generate_report(title: str) -&gt; str:\n    # Automatic trace context creation and propagation\n    # publishes span_start -&gt; calls dependency -&gt; publishes span_end\n    processor = await mesh.get_agent(\"data-processor\")\n    return await processor.process_data({\"title\": title})\n</code></pre> <p>Event Types Published: - <code>span_start</code>: Operation begins - <code>span_end</code>: Operation completes successfully - <code>error</code>: Operation fails with error details</p>"},{"location":"07-observability/03-distributed-tracing/#2-redis-streams-transport-layer","title":"2. Redis Streams (Transport Layer)","text":"<p>Stream Name: <code>mcp-mesh:traces</code> Consumer Group: <code>mcp-mesh-registry-processors</code></p> <p>Events are published asynchronously without blocking agent operations:</p> <pre><code># View recent trace events\nredis-cli XREVRANGE mcp-mesh:traces + - COUNT 10\n\n# Monitor stream length\nredis-cli XLEN mcp-mesh:traces\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#3-go-registry-consumer-correlator","title":"3. Go Registry (Consumer &amp; Correlator)","text":"<p>The registry consumes events and correlates them into complete traces:</p> <ul> <li>Consumer: Reads from Redis Streams with automatic failover</li> <li>Correlator: Builds complete traces from individual span events</li> <li>Exporters: Output traces in multiple formats (console, JSON, stats)</li> </ul>"},{"location":"07-observability/03-distributed-tracing/#configuration","title":"Configuration","text":""},{"location":"07-observability/03-distributed-tracing/#environment-variables","title":"Environment Variables","text":"Variable Default Description <code>MCP_MESH_DISTRIBUTED_TRACING_ENABLED</code> <code>false</code> Enable tracing system <code>TRACE_EXPORTER_TYPE</code> <code>console</code> Export format <code>TRACE_PRETTY_OUTPUT</code> <code>true</code> Pretty console output <code>TRACE_ENABLE_STATS</code> <code>true</code> Collect statistics <code>TRACE_JSON_OUTPUT_DIR</code> <code>/tmp</code> JSON export directory <code>TRACE_BATCH_SIZE</code> <code>100</code> Consumer batch size <code>TRACE_TIMEOUT</code> <code>5m</code> Trace completion timeout"},{"location":"07-observability/03-distributed-tracing/#enable-tracing","title":"Enable Tracing","text":"<pre><code># Enable in registry\nexport MCP_MESH_DISTRIBUTED_TRACING_ENABLED=true\nexport TRACE_EXPORTER_TYPE=console\nexport TRACE_PRETTY_OUTPUT=true\n\nmeshctl start --registry-only\n</code></pre> <p>Python agents automatically detect when tracing is enabled and begin publishing events.</p>"},{"location":"07-observability/03-distributed-tracing/#trace-data-model","title":"Trace Data Model","text":""},{"location":"07-observability/03-distributed-tracing/#traceevent-structure","title":"TraceEvent Structure","text":"<pre><code>{\n  \"trace_id\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n  \"span_id\": \"x1y2z3w4-a5b6-c789-def0-123456789abc\", \n  \"parent_span\": \"parent-span-id-if-exists\",\n  \"agent_name\": \"weather-service\",\n  \"agent_id\": \"weather-123\",\n  \"ip_address\": \"192.168.1.100\",\n  \"event_type\": \"span_start|span_end|error\",\n  \"operation\": \"tool:get_weather\",\n  \"timestamp\": 1640995200.123,\n  \"duration_ms\": 150,\n  \"success\": true,\n  \"error_message\": null,\n  \"capability\": \"get_weather\",\n  \"target_agent\": \"data-processor\",\n  \"runtime\": \"python-3.11\"\n}\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#completedtrace-structure","title":"CompletedTrace Structure","text":"<pre><code>{\n  \"trace_id\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n  \"spans\": [\n    {\n      \"span_id\": \"x1y2z3w4-a5b6-c789-def0-123456789abc\",\n      \"agent_name\": \"weather-service\", \n      \"operation\": \"tool:get_weather\",\n      \"start_time\": \"2024-01-01T10:00:00Z\",\n      \"end_time\": \"2024-01-01T10:00:00.150Z\",\n      \"duration_ms\": 150,\n      \"success\": true\n    }\n  ],\n  \"start_time\": \"2024-01-01T10:00:00Z\",\n  \"end_time\": \"2024-01-01T10:00:00.300Z\", \n  \"duration\": \"300ms\",\n  \"success\": true,\n  \"span_count\": 3,\n  \"agent_count\": 2,\n  \"agents\": [\"weather-service\", \"data-processor\"]\n}\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#trace-correlation-logic","title":"Trace Correlation Logic","text":""},{"location":"07-observability/03-distributed-tracing/#1-event-collection","title":"1. Event Collection","text":"<p>Events are correlated by <code>trace_id</code> and individual spans by <code>span_id</code>:</p> <pre><code>span_start[trace_id=ABC, span_id=123] + span_end[trace_id=ABC, span_id=123] = Complete Span\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#2-completion-detection","title":"2. Completion Detection","text":"<p>Traces are considered complete when: - All spans have both start and end events - No new events for 5 seconds - Contains at least one span</p>"},{"location":"07-observability/03-distributed-tracing/#3-export-triggers","title":"3. Export Triggers","text":"<p>Traces are exported when: - Immediately: When completion is detected during event processing - Cleanup: Every minute, completed traces are found and exported - Expiry: After 5 minutes of inactivity (incomplete traces)</p>"},{"location":"07-observability/03-distributed-tracing/#export-formats","title":"Export Formats","text":""},{"location":"07-observability/03-distributed-tracing/#console-exporter","title":"Console Exporter","text":"<p>Real-time trace visualization in terminal:</p> <pre><code>export TRACE_EXPORTER_TYPE=console\nexport TRACE_PRETTY_OUTPUT=true\n</code></pre> <p>Output Example: <pre><code>\ud83d\udd17 TRACE a1b2c3d4 (285ms) - SUCCESS (3 spans across 2 agents)\n  \ud83d\udccd Agent: weather-service\n    \u2705 tool:get_weather [get_weather] (150ms)\n  \ud83d\udccd Agent: data-processor  \n    \u2705 tool:process_data [process_data] (100ms)\n    \u2705 tool:validate_result [validate_result] (35ms)\n</code></pre></p>"},{"location":"07-observability/03-distributed-tracing/#json-exporter","title":"JSON Exporter","text":"<p>Structured export for external systems:</p> <pre><code>export TRACE_EXPORTER_TYPE=json\nexport TRACE_JSON_OUTPUT_DIR=/var/log/traces\n</code></pre> <p>Output Files: - <code>/var/log/traces/trace-{trace_id}.json</code> - One file per completed trace</p>"},{"location":"07-observability/03-distributed-tracing/#statistics-exporter","title":"Statistics Exporter","text":"<p>Aggregate metrics collection:</p> <pre><code>export TRACE_EXPORTER_TYPE=multi  # Enables all exporters\nexport TRACE_ENABLE_STATS=true\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#query-api","title":"Query API","text":""},{"location":"07-observability/03-distributed-tracing/#trace-status","title":"Trace Status","text":"<pre><code>GET /trace/status\n</code></pre> <p>Returns tracing configuration and runtime statistics:</p> <pre><code>{\n  \"enabled\": true,\n  \"consumer\": {\n    \"stream_name\": \"mcp-mesh:traces\",\n    \"consumer_group\": \"mcp-mesh-registry-processors\",\n    \"status\": \"running\"\n  },\n  \"correlator\": {\n    \"active_traces\": 5,\n    \"total_spans\": 12,\n    \"oldest_trace_age\": \"45s\"\n  },\n  \"exporter\": {\n    \"type\": \"console\",\n    \"exported_traces\": 147\n  }\n}\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#list-recent-traces","title":"List Recent Traces","text":"<pre><code>GET /trace/list?limit=20&amp;offset=0\n</code></pre> <p>Returns paginated list of completed traces, newest first.</p>"},{"location":"07-observability/03-distributed-tracing/#get-specific-trace","title":"Get Specific Trace","text":"<pre><code>GET /trace/{trace_id}\n</code></pre> <p>Retrieve complete trace details by ID.</p>"},{"location":"07-observability/03-distributed-tracing/#search-traces","title":"Search Traces","text":"<pre><code>GET /trace/search?agent_name=weather&amp;success=true&amp;min_duration_ms=100\n</code></pre> <p>Search Parameters:</p> Parameter Type Description <code>parent_span_id</code> string Filter by parent span <code>agent_name</code> string Filter by agent name <code>operation</code> string Filter by operation (partial match) <code>success</code> boolean Filter by success status <code>start_time</code> RFC3339 Filter by start time (after) <code>end_time</code> RFC3339 Filter by end time (before) <code>min_duration_ms</code> integer Minimum duration filter <code>max_duration_ms</code> integer Maximum duration filter <code>limit</code> integer Result limit (max 100)"},{"location":"07-observability/03-distributed-tracing/#trace-statistics","title":"Trace Statistics","text":"<pre><code>GET /trace/stats\n</code></pre> <p>Returns aggregate statistics:</p> <pre><code>{\n  \"total_traces\": 1250,\n  \"success_traces\": 1189,\n  \"failed_traces\": 61,\n  \"success_rate\": 95.12,\n  \"avg_duration_ms\": 234.5,\n  \"avg_spans_per_trace\": 2.8,\n  \"agents_involved\": [\"weather\", \"data-processor\", \"report-gen\"],\n  \"top_operations\": [\n    {\"operation\": \"tool:get_weather\", \"count\": 456},\n    {\"operation\": \"tool:process_data\", \"count\": 389}\n  ]\n}\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#performance-analysis-examples","title":"Performance Analysis Examples","text":""},{"location":"07-observability/03-distributed-tracing/#find-slow-operations","title":"Find Slow Operations","text":"<pre><code># Operations taking longer than 1 second\ncurl \"http://localhost:8000/trace/search?min_duration_ms=1000&amp;limit=10\" | jq '.traces[] | {trace_id, duration, agents}'\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#debug-failed-operations","title":"Debug Failed Operations","text":"<pre><code># Get recent failures with details\ncurl \"http://localhost:8000/trace/search?success=false&amp;limit=5\" | jq '.traces[] | {trace_id, agents, spans: [.spans[] | select(.success == false)]}'\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#agent-performance-analysis","title":"Agent Performance Analysis","text":"<pre><code># Analyze specific agent performance\ncurl \"http://localhost:8000/trace/search?agent_name=weather-service&amp;limit=50\" | jq '[.traces[].duration] | add / length'\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#time-based-analysis","title":"Time-based Analysis","text":"<pre><code># Get traces from last hour\nHOUR_AGO=$(date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%SZ)\ncurl \"http://localhost:8000/trace/search?start_time=$HOUR_AGO&amp;limit=100\" | jq '.traces | length'\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#advanced-features","title":"Advanced Features","text":""},{"location":"07-observability/03-distributed-tracing/#context-propagation","title":"Context Propagation","text":"<p>Trace context automatically flows between agents:</p> <pre><code># Parent agent\n@mesh.tool(depends_on=[\"child-agent\"])  \nasync def parent_operation():\n    # trace_id and span_id automatically propagated\n    child = await mesh.get_agent(\"child-agent\")\n    return await child.child_operation()\n\n# Child agent  \n@mesh.tool()\nasync def child_operation():\n    # Inherits trace context from parent\n    # New span created with parent span ID\n    pass\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#error-correlation","title":"Error Correlation","text":"<p>Failed operations are automatically correlated:</p> <pre><code>@mesh.tool()\nasync def failing_operation():\n    try:\n        # operation logic\n        pass\n    except Exception as e:\n        # Error event automatically published with trace context\n        raise  # Re-raise to maintain error handling\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#multi-agent-traces","title":"Multi-Agent Traces","text":"<p>Complex workflows spanning multiple agents are automatically traced:</p> <pre><code>User Request \u2192 Agent A \u2192 Agent B \u2192 Agent C\n      \u2193            \u2193         \u2193         \u2193\n   trace_id    same_id   same_id   same_id\n   span_1      span_2    span_3    span_4\n              parent=1  parent=2  parent=3\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#storage-and-retention","title":"Storage and Retention","text":""},{"location":"07-observability/03-distributed-tracing/#in-memory-storage","title":"In-Memory Storage","text":"<ul> <li>Active Traces: Stored until completion or 5-minute timeout</li> <li>Completed Traces: Last 1000 traces kept for querying</li> <li>Automatic Cleanup: Oldest 20% removed when limit exceeded</li> </ul>"},{"location":"07-observability/03-distributed-tracing/#redis-stream-retention","title":"Redis Stream Retention","text":"<pre><code># Configure Redis stream retention\nredis-cli CONFIG SET stream-node-max-bytes 4096\nredis-cli CONFIG SET stream-node-max-entries 100\n\n# Manual stream cleanup (if needed)\nredis-cli XTRIM mcp-mesh:traces MAXLEN ~ 10000\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#troubleshooting","title":"Troubleshooting","text":""},{"location":"07-observability/03-distributed-tracing/#no-traces-appearing","title":"No Traces Appearing","text":"<p>Check tracing status: <pre><code>curl http://localhost:8000/trace/status | jq .enabled\n</code></pre></p> <p>Verify Redis stream: <pre><code>redis-cli XLEN mcp-mesh:traces\nredis-cli XINFO GROUPS mcp-mesh:traces\n</code></pre></p> <p>Check agent connectivity: <pre><code># Python agents should log tracing status on startup\n# Look for: \"Tracing enabled, publishing to redis://...\"\n</code></pre></p>"},{"location":"07-observability/03-distributed-tracing/#incomplete-traces","title":"Incomplete Traces","text":"<p>Check for orphaned events: <pre><code>redis-cli XREVRANGE mcp-mesh:traces + - COUNT 20\n</code></pre></p> <p>Monitor correlator status: <pre><code>curl http://localhost:8000/trace/status | jq .correlator\n</code></pre></p>"},{"location":"07-observability/03-distributed-tracing/#performance-issues","title":"Performance Issues","text":"<p>Monitor consumer lag: <pre><code>redis-cli XINFO GROUPS mcp-mesh:traces\n# Look for \"lag\" field in consumer info\n</code></pre></p> <p>Check memory usage: <pre><code>curl http://localhost:8000/trace/stats | jq .\n# Monitor active_traces count\n</code></pre></p>"},{"location":"07-observability/03-distributed-tracing/#integration-examples","title":"Integration Examples","text":""},{"location":"07-observability/03-distributed-tracing/#prometheus-metrics","title":"Prometheus Metrics","text":"<pre><code>#!/bin/bash\n# Export trace metrics to Prometheus\n\nSTATS=$(curl -s http://localhost:8000/trace/stats)\nSUCCESS_RATE=$(echo $STATS | jq .success_rate)\nAVG_DURATION=$(echo $STATS | jq .avg_duration_ms)\n\necho \"mcp_mesh_trace_success_rate $SUCCESS_RATE\" | curl -X POST --data-binary @- http://pushgateway:9091/metrics/job/mcp-mesh\necho \"mcp_mesh_trace_avg_duration_ms $AVG_DURATION\" | curl -X POST --data-binary @- http://pushgateway:9091/metrics/job/mcp-mesh\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#external-apm-integration","title":"External APM Integration","text":"<pre><code>#!/bin/bash\n# Send traces to external APM (e.g., Datadog, New Relic)\n\ncurl -s \"http://localhost:8000/trace/list?limit=100\" | \\\n  jq -c '.traces[]' | \\\n  while read trace; do\n    curl -X POST \"https://api.datadoghq.com/api/v1/traces\" \\\n      -H \"DD-API-KEY: $DD_API_KEY\" \\\n      -H \"Content-Type: application/json\" \\\n      -d \"$trace\"\n  done\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#log-correlation","title":"Log Correlation","text":"<pre><code>#!/bin/bash\n# Correlate traces with application logs\n\n# Extract trace IDs and search logs\ncurl -s \"http://localhost:8000/trace/search?success=false&amp;limit=10\" | \\\n  jq -r '.traces[].trace_id' | \\\n  while read trace_id; do\n    echo \"=== Logs for trace $trace_id ===\"\n    grep \"$trace_id\" /var/log/mcp-mesh/*.log\n  done\n</code></pre>"},{"location":"07-observability/03-distributed-tracing/#best-practices","title":"Best Practices","text":""},{"location":"07-observability/03-distributed-tracing/#1-monitoring","title":"1. Monitoring","text":"<ul> <li>Set up alerts on trace export failures</li> <li>Monitor trace completion rates  </li> <li>Track trace duration trends</li> <li>Alert on error rate spikes</li> </ul>"},{"location":"07-observability/03-distributed-tracing/#2-performance","title":"2. Performance","text":"<ul> <li>Use <code>multi</code> exporter for comprehensive observability</li> <li>Configure appropriate Redis retention policies</li> <li>Monitor correlator memory usage</li> <li>Tune batch sizes for high throughput</li> </ul>"},{"location":"07-observability/03-distributed-tracing/#3-debugging","title":"3. Debugging","text":"<ul> <li>Use search API for targeted investigation</li> <li>Correlate traces with application logs</li> <li>Monitor Redis stream health</li> <li>Check agent trace context propagation</li> </ul>"},{"location":"07-observability/03-distributed-tracing/#4-production-deployment","title":"4. Production Deployment","text":"<ul> <li>Configure JSON export for trace persistence</li> <li>Set up external metrics collection  </li> <li>Implement trace sampling for high-volume systems</li> <li>Monitor registry resource usage</li> </ul>"},{"location":"07-observability/03-distributed-tracing/#performance-characteristics","title":"Performance Characteristics","text":"<ul> <li>Throughput: 10,000+ spans/second sustained</li> <li>Latency: &lt;1ms trace event publishing (async)</li> <li>Memory: ~1MB per 1000 completed traces  </li> <li>Storage: Configurable retention in Redis and memory</li> <li>Correlation: Real-time span correlation and export</li> <li>Availability: Registry failure doesn't impact agents</li> </ul>"},{"location":"07-observability/03-distributed-tracing/#next-steps","title":"Next Steps","text":"<p>The distributed tracing system provides comprehensive observability out of the box. Consider extending with:</p> <ol> <li>Custom Exporters: Implement organization-specific backends</li> <li>Trace Sampling: Add intelligent sampling for high-volume scenarios  </li> <li>SLA Monitoring: Extract SLA metrics from trace data</li> <li>Automated Alerting: Set up proactive monitoring based on trace patterns</li> </ol> <p>\ud83d\udca1 Tip: Use the trace search API with time windows to identify performance trends and system bottlenecks</p> <p>\ud83d\udcca Performance: Monitor trace statistics regularly to ensure optimal system performance</p> <p>\ud83d\udd17 Integration: Export traces to your existing observability stack using JSON exporter or custom exporters</p>"},{"location":"07-observability/04-centralized-logging/","title":"Centralized Logging","text":"<p>Aggregate, search, and analyze logs from all MCP Mesh components in one place</p>"},{"location":"07-observability/04-centralized-logging/#overview","title":"Overview","text":"<p>Centralized logging is essential for troubleshooting and monitoring distributed MCP Mesh deployments. This guide covers implementing the ELK stack (Elasticsearch, Logstash/Fluentd, Kibana) for log aggregation, configuring structured logging in agents, creating powerful search queries, and building log-based dashboards. You'll learn to correlate logs with traces and metrics for comprehensive observability.</p> <p>Effective centralized logging enables quick problem resolution, security monitoring, and operational insights across your entire MCP Mesh system.</p>"},{"location":"07-observability/04-centralized-logging/#key-concepts","title":"Key Concepts","text":"<ul> <li>Log Aggregation: Collecting logs from all sources</li> <li>Structured Logging: JSON-formatted logs with metadata</li> <li>Log Parsing: Extracting fields from log messages</li> <li>Index Management: Lifecycle policies for log retention</li> <li>Correlation: Linking logs with traces and metrics</li> </ul>"},{"location":"07-observability/04-centralized-logging/#step-by-step-guide","title":"Step-by-Step Guide","text":""},{"location":"07-observability/04-centralized-logging/#step-1-deploy-the-elk-stack","title":"Step 1: Deploy the ELK Stack","text":"<p>Set up Elasticsearch, Logstash/Fluentd, and Kibana:</p> <pre><code># Add Elastic Helm repository\nhelm repo add elastic https://helm.elastic.co\nhelm repo update\n\n# Create namespace\nkubectl create namespace logging\n\n# Deploy Elasticsearch\ncat &gt; elasticsearch-values.yaml &lt;&lt; 'EOF'\nclusterName: \"mcp-mesh-logs\"\nnodeGroup: \"master\"\n\nreplicas: 3\nminimumMasterNodes: 2\n\nresources:\n  requests:\n    cpu: \"1000m\"\n    memory: \"2Gi\"\n  limits:\n    cpu: \"2000m\"\n    memory: \"4Gi\"\n\nvolumeClaimTemplate:\n  accessModes: [\"ReadWriteOnce\"]\n  resources:\n    requests:\n      storage: 100Gi\n  storageClassName: fast-ssd\n\nesConfig:\n  elasticsearch.yml: |\n    cluster.name: \"mcp-mesh-logs\"\n    network.host: 0.0.0.0\n    discovery.seed_hosts: [\"elasticsearch-master-0\", \"elasticsearch-master-1\", \"elasticsearch-master-2\"]\n    cluster.initial_master_nodes: [\"elasticsearch-master-0\", \"elasticsearch-master-1\", \"elasticsearch-master-2\"]\n    xpack.security.enabled: true\n    xpack.security.transport.ssl.enabled: true\n    xpack.security.transport.ssl.verification_mode: certificate\n    xpack.security.transport.ssl.keystore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\n    xpack.security.transport.ssl.truststore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\n    xpack.monitoring.collection.enabled: true\n\nextraEnvs:\n  - name: ELASTIC_PASSWORD\n    valueFrom:\n      secretKeyRef:\n        name: elastic-credentials\n        key: password\n\npersistence:\n  enabled: true\n  labels:\n    enabled: true\n\nantiAffinity: \"hard\"\n\n# Lifecycle policy for log rotation\nlifecycle:\n  enabled: true\n  policies:\n    mcp_mesh_logs:\n      phases:\n        hot:\n          min_age: \"0ms\"\n          actions:\n            rollover:\n              max_age: \"1d\"\n              max_size: \"50gb\"\n            set_priority:\n              priority: 100\n        warm:\n          min_age: \"2d\"\n          actions:\n            shrink:\n              number_of_shards: 1\n            forcemerge:\n              max_num_segments: 1\n            set_priority:\n              priority: 50\n        cold:\n          min_age: \"7d\"\n          actions:\n            set_priority:\n              priority: 0\n        delete:\n          min_age: \"30d\"\n          actions:\n            delete: {}\nEOF\n\n# Create credentials secret\nkubectl create secret generic elastic-credentials \\\n  --from-literal=password=changeme \\\n  -n logging\n\n# Install Elasticsearch\nhelm install elasticsearch elastic/elasticsearch \\\n  --namespace logging \\\n  --values elasticsearch-values.yaml\n\n# Deploy Kibana\ncat &gt; kibana-values.yaml &lt;&lt; 'EOF'\nelasticsearchHosts: \"http://elasticsearch-master:9200\"\n\nreplicas: 2\n\nresources:\n  requests:\n    cpu: \"500m\"\n    memory: \"1Gi\"\n  limits:\n    cpu: \"1000m\"\n    memory: \"2Gi\"\n\nkibanaConfig:\n  kibana.yml: |\n    server.name: kibana\n    server.host: \"0\"\n    elasticsearch.hosts: [\"http://elasticsearch-master:9200\"]\n    elasticsearch.username: \"elastic\"\n    elasticsearch.password: \"${ELASTIC_PASSWORD}\"\n    xpack.monitoring.ui.container.elasticsearch.enabled: true\n    logging.json: true\n\nextraEnvs:\n  - name: ELASTIC_PASSWORD\n    valueFrom:\n      secretKeyRef:\n        name: elastic-credentials\n        key: password\n\ningress:\n  enabled: true\n  className: nginx\n  hosts:\n    - host: kibana.mcp-mesh.local\n      paths:\n        - path: /\n          pathType: Prefix\n\nservice:\n  type: ClusterIP\n  port: 5601\nEOF\n\n# Install Kibana\nhelm install kibana elastic/kibana \\\n  --namespace logging \\\n  --values kibana-values.yaml\n\n# Deploy Fluentd for log collection\ncat &gt; fluentd-values.yaml &lt;&lt; 'EOF'\nimage:\n  repository: fluent/fluentd-kubernetes-daemonset\n  tag: v1.16-debian-elasticsearch7-1\n\nelasticsearch:\n  host: elasticsearch-master\n  port: 9200\n  scheme: http\n  user: elastic\n  password: changeme\n\nrbac:\n  create: true\n\nresources:\n  limits:\n    memory: 512Mi\n  requests:\n    cpu: 100m\n    memory: 200Mi\n\n# Fluentd configuration\nconfigMaps:\n  useDefaults:\n    systemdConf: false\n    containersInputConf: true\n    systemInputConf: false\n    forwardInputConf: false\n    monitoringConf: true\n    outputConf: false\n\nfileConfigs:\n  01_sources.conf: |\n    &lt;source&gt;\n      @type tail\n      @id in_tail_container_logs\n      path /var/log/containers/*mcp-mesh*.log\n      pos_file /var/log/fluentd-containers.log.pos\n      tag kubernetes.*\n      exclude_path [\"/var/log/containers/*fluentd*\"]\n      read_from_head true\n      &lt;parse&gt;\n        @type multi_format\n        &lt;pattern&gt;\n          format json\n          time_key timestamp\n          time_format %Y-%m-%dT%H:%M:%S.%NZ\n        &lt;/pattern&gt;\n        &lt;pattern&gt;\n          format /^(?&lt;time&gt;.+) (?&lt;stream&gt;stdout|stderr) [^ ]* (?&lt;log&gt;.*)$/\n          time_format %Y-%m-%dT%H:%M:%S.%N%:z\n        &lt;/pattern&gt;\n      &lt;/parse&gt;\n    &lt;/source&gt;\n\n  02_filters.conf: |\n    &lt;filter kubernetes.**&gt;\n      @type kubernetes_metadata\n      @id filter_kube_metadata\n      kubernetes_url \"#{ENV['KUBERNETES_URL']}\"\n      verify_ssl \"#{ENV['KUBERNETES_VERIFY_SSL']}\"\n      ca_file \"#{ENV['KUBERNETES_CA_FILE']}\"\n      skip_labels false\n      skip_container_metadata false\n      skip_master_url false\n      skip_namespace_metadata false\n    &lt;/filter&gt;\n\n    &lt;filter kubernetes.**&gt;\n      @type parser\n      @id filter_parser\n      key_name log\n      reserve_data true\n      remove_key_name_field true\n      &lt;parse&gt;\n        @type multi_format\n        &lt;pattern&gt;\n          format json\n        &lt;/pattern&gt;\n        &lt;pattern&gt;\n          format none\n        &lt;/pattern&gt;\n      &lt;/parse&gt;\n    &lt;/filter&gt;\n\n    &lt;filter kubernetes.**&gt;\n      @type record_transformer\n      @id filter_records\n      &lt;record&gt;\n        hostname ${hostname}\n        environment \"#{ENV['ENVIRONMENT'] || 'development'}\"\n        cluster_name \"#{ENV['CLUSTER_NAME'] || 'mcp-mesh'}\"\n      &lt;/record&gt;\n    &lt;/filter&gt;\n\n  03_outputs.conf: |\n    &lt;match kubernetes.**&gt;\n      @type elasticsearch\n      @id out_es\n      @log_level info\n      include_tag_key true\n      host \"#{ENV['FLUENT_ELASTICSEARCH_HOST']}\"\n      port \"#{ENV['FLUENT_ELASTICSEARCH_PORT']}\"\n      scheme \"#{ENV['FLUENT_ELASTICSEARCH_SCHEME'] || 'http'}\"\n      ssl_verify \"#{ENV['FLUENT_ELASTICSEARCH_SSL_VERIFY'] || 'true'}\"\n      ssl_version \"#{ENV['FLUENT_ELASTICSEARCH_SSL_VERSION'] || 'TLSv1_2'}\"\n      user \"#{ENV['FLUENT_ELASTICSEARCH_USER'] || 'elastic'}\"\n      password \"#{ENV['FLUENT_ELASTICSEARCH_PASSWORD']}\"\n      reload_connections false\n      reconnect_on_error true\n      reload_on_failure true\n      log_es_400_reason true\n      logstash_prefix mcp-mesh-logs\n      logstash_dateformat %Y.%m.%d\n      include_timestamp true\n      template_name mcp-mesh-logs\n      template_file /fluentd/etc/elasticsearch-template.json\n      template_overwrite true\n      &lt;buffer&gt;\n        flush_thread_count 8\n        flush_interval 5s\n        chunk_limit_size 2M\n        queue_limit_length 32\n        retry_max_interval 30\n        retry_forever true\n      &lt;/buffer&gt;\n    &lt;/match&gt;\n\ntolerations:\n  - key: node-role.kubernetes.io/master\n    operator: Exists\n    effect: NoSchedule\nEOF\n\n# Install Fluentd\nhelm install fluentd bitnami/fluentd \\\n  --namespace logging \\\n  --values fluentd-values.yaml\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#step-2-configure-structured-logging-in-mcp-mesh","title":"Step 2: Configure Structured Logging in MCP Mesh","text":"<p>Implement structured logging in agents:</p> <pre><code># mcp_mesh/logging.py\nimport logging\nimport json\nimport sys\nimport os\nfrom datetime import datetime\nfrom pythonjsonlogger import jsonlogger\nfrom opentelemetry import trace\nimport asyncio\nfrom contextvars import ContextVar\n\n# Context variables for request tracking\nrequest_id_var: ContextVar[str] = ContextVar('request_id', default='')\nuser_id_var: ContextVar[str] = ContextVar('user_id', default='')\n\nclass MCPMeshLogFormatter(jsonlogger.JsonFormatter):\n    \"\"\"Custom JSON formatter for MCP Mesh logs\"\"\"\n\n    def add_fields(self, log_record, record, message_dict):\n        super().add_fields(log_record, record, message_dict)\n\n        # Add timestamp\n        log_record['timestamp'] = datetime.utcnow().isoformat() + 'Z'\n\n        # Add log level\n        log_record['level'] = record.levelname\n\n        # Add service information\n        log_record['service'] = {\n            'name': os.getenv('SERVICE_NAME', 'unknown'),\n            'version': os.getenv('SERVICE_VERSION', '1.0.0'),\n            'environment': os.getenv('ENVIRONMENT', 'development'),\n            'instance_id': os.getenv('HOSTNAME', 'unknown')\n        }\n\n        # Add Kubernetes metadata\n        log_record['kubernetes'] = {\n            'namespace': os.getenv('K8S_NAMESPACE', 'default'),\n            'pod_name': os.getenv('HOSTNAME', 'unknown'),\n            'node_name': os.getenv('NODE_NAME', 'unknown')\n        }\n\n        # Add trace context\n        span = trace.get_current_span()\n        if span and span.get_span_context().is_valid:\n            ctx = span.get_span_context()\n            log_record['trace'] = {\n                'trace_id': format(ctx.trace_id, '032x'),\n                'span_id': format(ctx.span_id, '016x'),\n                'trace_flags': format(ctx.trace_flags, '02x')\n            }\n\n        # Add request context\n        request_id = request_id_var.get()\n        if request_id:\n            log_record['request_id'] = request_id\n\n        user_id = user_id_var.get()\n        if user_id:\n            log_record['user_id'] = user_id\n\n        # Add source location\n        log_record['source'] = {\n            'file': record.pathname,\n            'line': record.lineno,\n            'function': record.funcName\n        }\n\n        # Move message to correct field\n        if 'message' in log_record:\n            log_record['msg'] = log_record.pop('message')\n\ndef setup_logging(service_name: str, log_level: str = \"INFO\"):\n    \"\"\"Set up structured logging for MCP Mesh service\"\"\"\n\n    # Create logger\n    logger = logging.getLogger('mcp_mesh')\n    logger.setLevel(getattr(logging, log_level.upper()))\n\n    # Remove existing handlers\n    logger.handlers = []\n\n    # Create console handler with JSON formatter\n    handler = logging.StreamHandler(sys.stdout)\n    formatter = MCPMeshLogFormatter(\n        '%(timestamp)s %(level)s %(name)s %(message)s'\n    )\n    handler.setFormatter(formatter)\n    logger.addHandler(handler)\n\n    # Add exception hook for unhandled exceptions\n    def handle_exception(exc_type, exc_value, exc_traceback):\n        if issubclass(exc_type, KeyboardInterrupt):\n            sys.__excepthook__(exc_type, exc_value, exc_traceback)\n            return\n\n        logger.critical(\n            \"Unhandled exception\",\n            exc_info=(exc_type, exc_value, exc_traceback),\n            extra={\n                'exception_type': exc_type.__name__,\n                'exception_message': str(exc_value)\n            }\n        )\n\n    sys.excepthook = handle_exception\n\n    return logger\n\n# Logging utilities\nclass LogContext:\n    \"\"\"Context manager for adding fields to logs\"\"\"\n\n    def __init__(self, **kwargs):\n        self.fields = kwargs\n        self.tokens = []\n\n    def __enter__(self):\n        # Set context variables\n        if 'request_id' in self.fields:\n            self.tokens.append(request_id_var.set(self.fields['request_id']))\n        if 'user_id' in self.fields:\n            self.tokens.append(user_id_var.set(self.fields['user_id']))\n        return self\n\n    def __exit__(self, exc_type, exc_val, exc_tb):\n        # Reset context variables\n        for token in self.tokens:\n            request_id_var.reset(token)\n\n# Enhanced logger for agents\nclass AgentLogger:\n    \"\"\"Agent-specific logger with additional functionality\"\"\"\n\n    def __init__(self, agent_name: str):\n        self.agent_name = agent_name\n        self.logger = setup_logging(f\"mcp-mesh-{agent_name}\")\n        self._metrics = {\n            'requests_total': 0,\n            'errors_total': 0,\n            'warnings_total': 0\n        }\n\n    def _log(self, level: str, message: str, **kwargs):\n        \"\"\"Internal log method with agent context\"\"\"\n        extra = {\n            'agent': {\n                'name': self.agent_name,\n                'type': 'mcp-mesh'\n            }\n        }\n        extra.update(kwargs)\n\n        # Update metrics\n        if level == 'ERROR':\n            self._metrics['errors_total'] += 1\n        elif level == 'WARNING':\n            self._metrics['warnings_total'] += 1\n\n        getattr(self.logger, level.lower())(message, extra=extra)\n\n    def info(self, message: str, **kwargs):\n        self._log('INFO', message, **kwargs)\n\n    def warning(self, message: str, **kwargs):\n        self._log('WARNING', message, **kwargs)\n\n    def error(self, message: str, **kwargs):\n        self._log('ERROR', message, **kwargs)\n\n    def debug(self, message: str, **kwargs):\n        self._log('DEBUG', message, **kwargs)\n\n    def request(self, method: str, params: dict = None,\n               duration_ms: float = None, status: str = \"success\"):\n        \"\"\"Log API request with standard fields\"\"\"\n        self._metrics['requests_total'] += 1\n\n        self.info(\n            f\"Request processed: {method}\",\n            request={\n                'method': method,\n                'params': params or {},\n                'duration_ms': duration_ms,\n                'status': status\n            },\n            metrics={\n                'duration_ms': duration_ms\n            }\n        )\n\n    def exception(self, message: str, exc: Exception, **kwargs):\n        \"\"\"Log exception with full context\"\"\"\n        import traceback\n\n        self.error(\n            message,\n            exception={\n                'type': type(exc).__name__,\n                'message': str(exc),\n                'traceback': traceback.format_exc()\n            },\n            **kwargs\n        )\n\n    def audit(self, action: str, resource: str, result: str, **kwargs):\n        \"\"\"Log audit event\"\"\"\n        self.info(\n            f\"Audit: {action} {resource}\",\n            audit={\n                'action': action,\n                'resource': resource,\n                'result': result,\n                'timestamp': datetime.utcnow().isoformat()\n            },\n            **kwargs\n        )\n\n# Example usage in an agent\nclass LoggedWeatherAgent:\n    def __init__(self):\n        self.logger = AgentLogger(\"weather-agent\")\n        self.cache = {}\n\n    async def get_forecast(self, location: str, days: int = 7):\n        \"\"\"Get weather forecast with comprehensive logging\"\"\"\n        start_time = asyncio.get_event_loop().time()\n\n        # Create request context\n        request_id = f\"req-{start_time}\"\n\n        with LogContext(request_id=request_id):\n            self.logger.info(\n                f\"Getting forecast for {location}\",\n                location=location,\n                days=days,\n                cache_keys=list(self.cache.keys())\n            )\n\n            try:\n                # Check cache\n                cache_key = f\"{location}:{days}\"\n                if cache_key in self.cache:\n                    self.logger.debug(\n                        \"Cache hit\",\n                        cache_key=cache_key,\n                        cache_size=len(self.cache)\n                    )\n                    return self.cache[cache_key]\n\n                # Call external API\n                self.logger.info(\n                    \"Calling weather API\",\n                    api_endpoint=\"https://api.weather.com/forecast\",\n                    timeout=30\n                )\n\n                # Simulate API call\n                await asyncio.sleep(0.1)\n                result = {\"temp\": 72, \"conditions\": \"sunny\"}\n\n                # Cache result\n                self.cache[cache_key] = result\n\n                # Calculate duration\n                duration_ms = (asyncio.get_event_loop().time() - start_time) * 1000\n\n                # Log successful request\n                self.logger.request(\n                    method=\"get_forecast\",\n                    params={\"location\": location, \"days\": days},\n                    duration_ms=duration_ms,\n                    status=\"success\"\n                )\n\n                # Audit log\n                self.logger.audit(\n                    action=\"forecast_retrieved\",\n                    resource=f\"location:{location}\",\n                    result=\"success\",\n                    user_id=\"api-user-123\"\n                )\n\n                return result\n\n            except Exception as e:\n                duration_ms = (asyncio.get_event_loop().time() - start_time) * 1000\n\n                self.logger.exception(\n                    f\"Failed to get forecast for {location}\",\n                    exc=e,\n                    location=location,\n                    duration_ms=duration_ms\n                )\n\n                self.logger.request(\n                    method=\"get_forecast\",\n                    params={\"location\": location, \"days\": days},\n                    duration_ms=duration_ms,\n                    status=\"error\"\n                )\n\n                raise\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#step-3-create-elasticsearch-index-templates","title":"Step 3: Create Elasticsearch Index Templates","text":"<p>Define index templates for optimal log storage:</p> <pre><code>// elasticsearch-template.json\n{\n  \"index_patterns\": [\"mcp-mesh-logs-*\"],\n  \"template\": {\n    \"settings\": {\n      \"number_of_shards\": 3,\n      \"number_of_replicas\": 1,\n      \"index.lifecycle.name\": \"mcp-mesh-logs\",\n      \"index.lifecycle.rollover_alias\": \"mcp-mesh-logs\",\n      \"analysis\": {\n        \"analyzer\": {\n          \"log_analyzer\": {\n            \"type\": \"custom\",\n            \"tokenizer\": \"standard\",\n            \"filter\": [\"lowercase\", \"stop\", \"snowball\"]\n          }\n        }\n      }\n    },\n    \"mappings\": {\n      \"properties\": {\n        \"timestamp\": {\n          \"type\": \"date\",\n          \"format\": \"strict_date_time\"\n        },\n        \"level\": {\n          \"type\": \"keyword\"\n        },\n        \"msg\": {\n          \"type\": \"text\",\n          \"analyzer\": \"log_analyzer\",\n          \"fields\": {\n            \"keyword\": {\n              \"type\": \"keyword\",\n              \"ignore_above\": 256\n            }\n          }\n        },\n        \"service\": {\n          \"properties\": {\n            \"name\": { \"type\": \"keyword\" },\n            \"version\": { \"type\": \"keyword\" },\n            \"environment\": { \"type\": \"keyword\" },\n            \"instance_id\": { \"type\": \"keyword\" }\n          }\n        },\n        \"kubernetes\": {\n          \"properties\": {\n            \"namespace\": { \"type\": \"keyword\" },\n            \"pod_name\": { \"type\": \"keyword\" },\n            \"node_name\": { \"type\": \"keyword\" },\n            \"container_name\": { \"type\": \"keyword\" },\n            \"labels\": { \"type\": \"object\" }\n          }\n        },\n        \"trace\": {\n          \"properties\": {\n            \"trace_id\": { \"type\": \"keyword\" },\n            \"span_id\": { \"type\": \"keyword\" },\n            \"trace_flags\": { \"type\": \"keyword\" }\n          }\n        },\n        \"request\": {\n          \"properties\": {\n            \"method\": { \"type\": \"keyword\" },\n            \"params\": { \"type\": \"object\" },\n            \"duration_ms\": { \"type\": \"float\" },\n            \"status\": { \"type\": \"keyword\" }\n          }\n        },\n        \"exception\": {\n          \"properties\": {\n            \"type\": { \"type\": \"keyword\" },\n            \"message\": { \"type\": \"text\" },\n            \"traceback\": { \"type\": \"text\" }\n          }\n        },\n        \"audit\": {\n          \"properties\": {\n            \"action\": { \"type\": \"keyword\" },\n            \"resource\": { \"type\": \"keyword\" },\n            \"result\": { \"type\": \"keyword\" },\n            \"user_id\": { \"type\": \"keyword\" }\n          }\n        },\n        \"metrics\": {\n          \"properties\": {\n            \"duration_ms\": { \"type\": \"float\" },\n            \"count\": { \"type\": \"long\" },\n            \"size_bytes\": { \"type\": \"long\" }\n          }\n        },\n        \"agent\": {\n          \"properties\": {\n            \"name\": { \"type\": \"keyword\" },\n            \"type\": { \"type\": \"keyword\" }\n          }\n        },\n        \"source\": {\n          \"properties\": {\n            \"file\": { \"type\": \"keyword\" },\n            \"line\": { \"type\": \"long\" },\n            \"function\": { \"type\": \"keyword\" }\n          }\n        }\n      }\n    }\n  },\n  \"composed_of\": [\"mcp-mesh-logs-settings\", \"mcp-mesh-logs-mappings\"],\n  \"priority\": 200,\n  \"version\": 1,\n  \"_meta\": {\n    \"description\": \"Template for MCP Mesh application logs\"\n  }\n}\n</code></pre> <p>Apply the template:</p> <pre><code># Create index template\ncurl -X PUT \"http://localhost:9200/_index_template/mcp-mesh-logs\" \\\n  -H \"Content-Type: application/json\" \\\n  -u elastic:changeme \\\n  -d @elasticsearch-template.json\n\n# Create initial index with alias\ncurl -X PUT \"http://localhost:9200/mcp-mesh-logs-000001\" \\\n  -H \"Content-Type: application/json\" \\\n  -u elastic:changeme \\\n  -d '{\n    \"aliases\": {\n      \"mcp-mesh-logs\": {\n        \"is_write_index\": true\n      }\n    }\n  }'\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#step-4-build-kibana-dashboards","title":"Step 4: Build Kibana Dashboards","text":"<p>Create saved searches and visualizations:</p> <pre><code>// kibana-dashboard.json\n{\n  \"version\": \"8.11.0\",\n  \"objects\": [\n    {\n      \"id\": \"mcp-mesh-logs-search\",\n      \"type\": \"search\",\n      \"attributes\": {\n        \"title\": \"MCP Mesh Logs\",\n        \"columns\": [\"timestamp\", \"level\", \"service.name\", \"msg\"],\n        \"sort\": [[\"timestamp\", \"desc\"]],\n        \"kibanaSavedObjectMeta\": {\n          \"searchSourceJSON\": {\n            \"index\": \"mcp-mesh-logs-*\",\n            \"query\": {\n              \"match_all\": {}\n            },\n            \"filter\": []\n          }\n        }\n      }\n    },\n    {\n      \"id\": \"mcp-mesh-error-timeline\",\n      \"type\": \"visualization\",\n      \"attributes\": {\n        \"title\": \"Error Timeline\",\n        \"visState\": {\n          \"type\": \"line\",\n          \"params\": {\n            \"grid\": { \"categoryLines\": false, \"style\": { \"color\": \"#eee\" } },\n            \"categoryAxes\": [\n              {\n                \"id\": \"CategoryAxis-1\",\n                \"type\": \"category\",\n                \"position\": \"bottom\",\n                \"show\": true,\n                \"style\": {},\n                \"scale\": { \"type\": \"linear\" },\n                \"labels\": { \"show\": true, \"filter\": true, \"truncate\": 100 },\n                \"title\": {}\n              }\n            ],\n            \"valueAxes\": [\n              {\n                \"id\": \"ValueAxis-1\",\n                \"name\": \"LeftAxis-1\",\n                \"type\": \"value\",\n                \"position\": \"left\",\n                \"show\": true,\n                \"style\": {},\n                \"scale\": { \"type\": \"linear\", \"mode\": \"normal\" },\n                \"labels\": {\n                  \"show\": true,\n                  \"rotate\": 0,\n                  \"filter\": false,\n                  \"truncate\": 100\n                },\n                \"title\": { \"text\": \"Error Count\" }\n              }\n            ],\n            \"seriesParams\": [\n              {\n                \"show\": true,\n                \"type\": \"line\",\n                \"mode\": \"normal\",\n                \"data\": { \"label\": \"Error Count\", \"id\": \"1\" },\n                \"valueAxis\": \"ValueAxis-1\",\n                \"drawLinesBetweenPoints\": true,\n                \"showCircles\": true\n              }\n            ],\n            \"addTooltip\": true,\n            \"addLegend\": true,\n            \"legendPosition\": \"right\",\n            \"times\": [],\n            \"addTimeMarker\": false\n          },\n          \"aggs\": [\n            {\n              \"id\": \"1\",\n              \"enabled\": true,\n              \"type\": \"count\",\n              \"schema\": \"metric\",\n              \"params\": {}\n            },\n            {\n              \"id\": \"2\",\n              \"enabled\": true,\n              \"type\": \"date_histogram\",\n              \"schema\": \"segment\",\n              \"params\": {\n                \"field\": \"timestamp\",\n                \"interval\": \"auto\",\n                \"customInterval\": \"2h\",\n                \"min_doc_count\": 1,\n                \"extended_bounds\": {}\n              }\n            },\n            {\n              \"id\": \"3\",\n              \"enabled\": true,\n              \"type\": \"filters\",\n              \"schema\": \"group\",\n              \"params\": {\n                \"filters\": [\n                  { \"input\": { \"query\": \"level:ERROR\" }, \"label\": \"Errors\" },\n                  { \"input\": { \"query\": \"level:WARNING\" }, \"label\": \"Warnings\" }\n                ]\n              }\n            }\n          ]\n        },\n        \"kibanaSavedObjectMeta\": {\n          \"searchSourceJSON\": {\n            \"index\": \"mcp-mesh-logs-*\",\n            \"query\": { \"match_all\": {} },\n            \"filter\": []\n          }\n        }\n      }\n    },\n    {\n      \"id\": \"mcp-mesh-agent-logs\",\n      \"type\": \"lens\",\n      \"attributes\": {\n        \"title\": \"Logs by Agent\",\n        \"state\": {\n          \"datasourceStates\": {\n            \"indexpattern\": {\n              \"layers\": {\n                \"layer1\": {\n                  \"columns\": {\n                    \"col1\": {\n                      \"label\": \"Count\",\n                      \"dataType\": \"number\",\n                      \"operationType\": \"count\",\n                      \"sourceField\": \"Records\"\n                    },\n                    \"col2\": {\n                      \"label\": \"Agent\",\n                      \"dataType\": \"string\",\n                      \"operationType\": \"terms\",\n                      \"sourceField\": \"agent.name\",\n                      \"params\": {\n                        \"size\": 10,\n                        \"orderBy\": { \"type\": \"column\", \"columnId\": \"col1\" },\n                        \"orderDirection\": \"desc\"\n                      }\n                    },\n                    \"col3\": {\n                      \"label\": \"Level\",\n                      \"dataType\": \"string\",\n                      \"operationType\": \"terms\",\n                      \"sourceField\": \"level\",\n                      \"params\": {\n                        \"size\": 5,\n                        \"orderBy\": { \"type\": \"alphabetical\" },\n                        \"orderDirection\": \"asc\"\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          },\n          \"visualization\": {\n            \"legend\": { \"isVisible\": true, \"position\": \"right\" },\n            \"valueLabels\": \"hide\",\n            \"fittingFunction\": \"None\",\n            \"axisTitlesVisibilitySettings\": {\n              \"x\": true,\n              \"yLeft\": true,\n              \"yRight\": true\n            },\n            \"gridlinesVisibilitySettings\": {\n              \"x\": true,\n              \"yLeft\": true,\n              \"yRight\": true\n            },\n            \"preferredSeriesType\": \"bar_stacked\",\n            \"layers\": [\n              {\n                \"layerId\": \"layer1\",\n                \"seriesType\": \"bar_stacked\",\n                \"xAccessor\": \"col2\",\n                \"accessors\": [\"col1\"],\n                \"splitAccessor\": \"col3\"\n              }\n            ]\n          }\n        }\n      }\n    },\n    {\n      \"id\": \"mcp-mesh-log-dashboard\",\n      \"type\": \"dashboard\",\n      \"attributes\": {\n        \"title\": \"MCP Mesh Log Analysis\",\n        \"hits\": 0,\n        \"description\": \"Comprehensive log analysis for MCP Mesh\",\n        \"panelsJSON\": \"[{\\\"version\\\":\\\"8.11.0\\\",\\\"type\\\":\\\"visualization\\\",\\\"gridData\\\":{\\\"x\\\":0,\\\"y\\\":0,\\\"w\\\":48,\\\"h\\\":15,\\\"i\\\":\\\"1\\\"},\\\"panelIndex\\\":\\\"1\\\",\\\"embeddableConfig\\\":{\\\"enhancements\\\":{}},\\\"panelRefName\\\":\\\"panel_1\\\"},{\\\"version\\\":\\\"8.11.0\\\",\\\"type\\\":\\\"lens\\\",\\\"gridData\\\":{\\\"x\\\":0,\\\"y\\\":15,\\\"w\\\":24,\\\"h\\\":15,\\\"i\\\":\\\"2\\\"},\\\"panelIndex\\\":\\\"2\\\",\\\"embeddableConfig\\\":{\\\"enhancements\\\":{}},\\\"panelRefName\\\":\\\"panel_2\\\"},{\\\"version\\\":\\\"8.11.0\\\",\\\"type\\\":\\\"search\\\",\\\"gridData\\\":{\\\"x\\\":24,\\\"y\\\":15,\\\"w\\\":24,\\\"h\\\":30,\\\"i\\\":\\\"3\\\"},\\\"panelIndex\\\":\\\"3\\\",\\\"embeddableConfig\\\":{\\\"enhancements\\\":{}},\\\"panelRefName\\\":\\\"panel_3\\\"}]\",\n        \"optionsJSON\": \"{\\\"useMargins\\\":true,\\\"syncColors\\\":false,\\\"hidePanelTitles\\\":false}\",\n        \"timeRestore\": true,\n        \"timeTo\": \"now\",\n        \"timeFrom\": \"now-24h\",\n        \"refreshInterval\": { \"pause\": false, \"value\": 30000 },\n        \"kibanaSavedObjectMeta\": {\n          \"searchSourceJSON\": \"{\\\"query\\\":{\\\"query\\\":\\\"\\\",\\\"language\\\":\\\"kuery\\\"},\\\"filter\\\":[]}\"\n        }\n      },\n      \"references\": [\n        {\n          \"id\": \"mcp-mesh-error-timeline\",\n          \"name\": \"panel_1\",\n          \"type\": \"visualization\"\n        },\n        { \"id\": \"mcp-mesh-agent-logs\", \"name\": \"panel_2\", \"type\": \"lens\" },\n        { \"id\": \"mcp-mesh-logs-search\", \"name\": \"panel_3\", \"type\": \"search\" }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#step-5-implement-log-analysis-queries","title":"Step 5: Implement Log Analysis Queries","text":"<p>Create powerful log analysis queries:</p> <pre><code># log_analysis.py\nfrom elasticsearch import Elasticsearch\nfrom datetime import datetime, timedelta\nimport json\n\nclass LogAnalyzer:\n    \"\"\"Analyze logs from Elasticsearch\"\"\"\n\n    def __init__(self, es_host: str = \"localhost:9200\",\n                 username: str = \"elastic\",\n                 password: str = \"changeme\"):\n        self.es = Elasticsearch(\n            [es_host],\n            basic_auth=(username, password)\n        )\n        self.index_pattern = \"mcp-mesh-logs-*\"\n\n    def search_by_trace_id(self, trace_id: str):\n        \"\"\"Find all logs for a specific trace\"\"\"\n        query = {\n            \"query\": {\n                \"term\": {\n                    \"trace.trace_id\": trace_id\n                }\n            },\n            \"sort\": [\n                {\"timestamp\": \"asc\"}\n            ],\n            \"size\": 1000\n        }\n\n        response = self.es.search(\n            index=self.index_pattern,\n            body=query\n        )\n\n        return [hit[\"_source\"] for hit in response[\"hits\"][\"hits\"]]\n\n    def find_errors_by_agent(self, agent_name: str,\n                            hours: int = 24):\n        \"\"\"Find recent errors for an agent\"\"\"\n        query = {\n            \"query\": {\n                \"bool\": {\n                    \"must\": [\n                        {\"term\": {\"agent.name\": agent_name}},\n                        {\"term\": {\"level\": \"ERROR\"}},\n                        {\"range\": {\n                            \"timestamp\": {\n                                \"gte\": f\"now-{hours}h\"\n                            }\n                        }}\n                    ]\n                }\n            },\n            \"aggs\": {\n                \"error_types\": {\n                    \"terms\": {\n                        \"field\": \"exception.type\",\n                        \"size\": 10\n                    }\n                },\n                \"error_timeline\": {\n                    \"date_histogram\": {\n                        \"field\": \"timestamp\",\n                        \"fixed_interval\": \"1h\"\n                    }\n                }\n            },\n            \"size\": 100\n        }\n\n        response = self.es.search(\n            index=self.index_pattern,\n            body=query\n        )\n\n        return {\n            \"errors\": [hit[\"_source\"] for hit in response[\"hits\"][\"hits\"]],\n            \"error_types\": response[\"aggregations\"][\"error_types\"][\"buckets\"],\n            \"timeline\": response[\"aggregations\"][\"error_timeline\"][\"buckets\"]\n        }\n\n    def analyze_request_patterns(self, hours: int = 1):\n        \"\"\"Analyze request patterns across all agents\"\"\"\n        query = {\n            \"query\": {\n                \"bool\": {\n                    \"must\": [\n                        {\"exists\": {\"field\": \"request.method\"}},\n                        {\"range\": {\n                            \"timestamp\": {\n                                \"gte\": f\"now-{hours}h\"\n                            }\n                        }}\n                    ]\n                }\n            },\n            \"aggs\": {\n                \"requests_by_agent\": {\n                    \"terms\": {\n                        \"field\": \"agent.name\",\n                        \"size\": 20\n                    },\n                    \"aggs\": {\n                        \"methods\": {\n                            \"terms\": {\n                                \"field\": \"request.method\",\n                                \"size\": 10\n                            }\n                        },\n                        \"avg_duration\": {\n                            \"avg\": {\n                                \"field\": \"request.duration_ms\"\n                            }\n                        },\n                        \"error_rate\": {\n                            \"terms\": {\n                                \"field\": \"request.status\",\n                                \"size\": 2\n                            }\n                        }\n                    }\n                },\n                \"slow_requests\": {\n                    \"top_hits\": {\n                        \"sort\": [\n                            {\"request.duration_ms\": \"desc\"}\n                        ],\n                        \"size\": 10,\n                        \"_source\": [\"timestamp\", \"agent.name\",\n                                   \"request.method\", \"request.duration_ms\"]\n                    }\n                }\n            },\n            \"size\": 0\n        }\n\n        response = self.es.search(\n            index=self.index_pattern,\n            body=query\n        )\n\n        return response[\"aggregations\"]\n\n    def detect_anomalies(self, agent_name: str):\n        \"\"\"Detect anomalous patterns in logs\"\"\"\n        # Use machine learning features if available\n        query = {\n            \"query\": {\n                \"bool\": {\n                    \"must\": [\n                        {\"term\": {\"agent.name\": agent_name}},\n                        {\"range\": {\n                            \"timestamp\": {\n                                \"gte\": \"now-1h\"\n                            }\n                        }}\n                    ]\n                }\n            },\n            \"aggs\": {\n                \"log_rate\": {\n                    \"date_histogram\": {\n                        \"field\": \"timestamp\",\n                        \"fixed_interval\": \"1m\"\n                    },\n                    \"aggs\": {\n                        \"level_breakdown\": {\n                            \"terms\": {\n                                \"field\": \"level\"\n                            }\n                        }\n                    }\n                },\n                \"unique_errors\": {\n                    \"cardinality\": {\n                        \"field\": \"exception.message.keyword\"\n                    }\n                },\n                \"rare_terms\": {\n                    \"rare_terms\": {\n                        \"field\": \"msg.keyword\",\n                        \"max_doc_count\": 2\n                    }\n                }\n            }\n        }\n\n        response = self.es.search(\n            index=self.index_pattern,\n            body=query\n        )\n\n        # Analyze for anomalies\n        anomalies = []\n\n        # Check for sudden spike in errors\n        for bucket in response[\"aggregations\"][\"log_rate\"][\"buckets\"]:\n            error_count = next(\n                (b[\"doc_count\"] for b in bucket[\"level_breakdown\"][\"buckets\"]\n                 if b[\"key\"] == \"ERROR\"), 0\n            )\n            if error_count &gt; 10:  # Threshold\n                anomalies.append({\n                    \"type\": \"error_spike\",\n                    \"timestamp\": bucket[\"key_as_string\"],\n                    \"count\": error_count\n                })\n\n        # Check for new error types\n        unique_errors = response[\"aggregations\"][\"unique_errors\"][\"value\"]\n        if unique_errors &gt; 5:  # Threshold\n            anomalies.append({\n                \"type\": \"high_error_variety\",\n                \"unique_count\": unique_errors\n            })\n\n        return anomalies\n\n    def export_logs(self, query: dict, output_file: str):\n        \"\"\"Export logs matching query to file\"\"\"\n        from elasticsearch.helpers import scan\n\n        with open(output_file, 'w') as f:\n            for doc in scan(\n                self.es,\n                index=self.index_pattern,\n                query=query,\n                size=1000\n            ):\n                f.write(json.dumps(doc[\"_source\"]) + \"\\n\")\n\n# Usage example\nanalyzer = LogAnalyzer()\n\n# Find logs for a trace\ntrace_logs = analyzer.search_by_trace_id(\"abc123def456\")\nfor log in trace_logs:\n    print(f\"{log['timestamp']} [{log['level']}] {log['msg']}\")\n\n# Analyze errors\nerrors = analyzer.find_errors_by_agent(\"weather-agent\")\nprint(f\"Found {len(errors['errors'])} errors\")\nfor error_type in errors['error_types']:\n    print(f\"  {error_type['key']}: {error_type['doc_count']}\")\n\n# Detect anomalies\nanomalies = analyzer.detect_anomalies(\"payment-agent\")\nif anomalies:\n    print(\"Anomalies detected:\")\n    for anomaly in anomalies:\n        print(f\"  {anomaly['type']}: {anomaly}\")\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#step-6-set-up-log-retention-and-archival","title":"Step 6: Set Up Log Retention and Archival","text":"<p>Configure log lifecycle management:</p> <pre><code># Create S3 repository for snapshots\ncurl -X PUT \"localhost:9200/_snapshot/mcp_mesh_backup\" \\\n  -H \"Content-Type: application/json\" \\\n  -u elastic:changeme \\\n  -d '{\n    \"type\": \"s3\",\n    \"settings\": {\n      \"bucket\": \"mcp-mesh-logs-backup\",\n      \"region\": \"us-east-1\",\n      \"access_key\": \"YOUR_ACCESS_KEY\",\n      \"secret_key\": \"YOUR_SECRET_KEY\"\n    }\n  }'\n\n# Create snapshot lifecycle policy\ncurl -X PUT \"localhost:9200/_slm/policy/daily-snapshots\" \\\n  -H \"Content-Type: application/json\" \\\n  -u elastic:changeme \\\n  -d '{\n    \"schedule\": \"0 30 1 * * ?\",\n    \"name\": \"&lt;mcp-mesh-logs-{now/d}&gt;\",\n    \"repository\": \"mcp_mesh_backup\",\n    \"config\": {\n      \"indices\": [\"mcp-mesh-logs-*\"],\n      \"include_global_state\": false,\n      \"partial\": false\n    },\n    \"retention\": {\n      \"expire_after\": \"90d\",\n      \"min_count\": 5,\n      \"max_count\": 50\n    }\n  }'\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#configuration-options","title":"Configuration Options","text":"Component Setting Description Index Shards <code>3</code> Number of primary shards Retention <code>30 days</code> How long to keep logs Refresh Interval <code>5s</code> How often to make logs searchable Batch Size <code>2MB</code> Fluentd batch size Replicas <code>1</code> Number of replica shards"},{"location":"07-observability/04-centralized-logging/#examples","title":"Examples","text":""},{"location":"07-observability/04-centralized-logging/#example-1-security-audit-dashboard","title":"Example 1: Security Audit Dashboard","text":"<pre><code>{\n  \"dashboard\": {\n    \"title\": \"MCP Mesh Security Audit\",\n    \"panels\": [\n      {\n        \"title\": \"Authentication Events\",\n        \"query\": {\n          \"query_string\": {\n            \"query\": \"audit.action:(login OR logout OR auth_failure)\"\n          }\n        },\n        \"visualization\": \"data_table\"\n      },\n      {\n        \"title\": \"Access Patterns by User\",\n        \"query\": {\n          \"bool\": {\n            \"must\": [\n              { \"exists\": { \"field\": \"audit.user_id\" } },\n              { \"term\": { \"audit.result\": \"success\" } }\n            ]\n          }\n        },\n        \"visualization\": \"heatmap\",\n        \"x_axis\": \"timestamp\",\n        \"y_axis\": \"audit.user_id\"\n      },\n      {\n        \"title\": \"Failed Access Attempts\",\n        \"query\": {\n          \"bool\": {\n            \"must\": [\n              { \"term\": { \"audit.result\": \"failure\" } },\n              { \"range\": { \"timestamp\": { \"gte\": \"now-1h\" } } }\n            ]\n          }\n        },\n        \"visualization\": \"map\",\n        \"geo_field\": \"client.geo.location\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#example-2-performance-analysis","title":"Example 2: Performance Analysis","text":"<pre><code># performance_logs.py\ndef analyze_performance_logs(es_client, agent_name: str):\n    \"\"\"Analyze performance from logs\"\"\"\n\n    query = {\n        \"query\": {\n            \"bool\": {\n                \"must\": [\n                    {\"term\": {\"agent.name\": agent_name}},\n                    {\"exists\": {\"field\": \"metrics.duration_ms\"}},\n                    {\"range\": {\"timestamp\": {\"gte\": \"now-1h\"}}}\n                ]\n            }\n        },\n        \"aggs\": {\n            \"percentiles\": {\n                \"percentiles\": {\n                    \"field\": \"metrics.duration_ms\",\n                    \"percents\": [50, 95, 99]\n                }\n            },\n            \"outliers\": {\n                \"terms\": {\n                    \"field\": \"request.method\",\n                    \"size\": 10,\n                    \"order\": {\"max_duration\": \"desc\"}\n                },\n                \"aggs\": {\n                    \"max_duration\": {\n                        \"max\": {\"field\": \"metrics.duration_ms\"}\n                    },\n                    \"sample_logs\": {\n                        \"top_hits\": {\n                            \"size\": 1,\n                            \"sort\": [{\"metrics.duration_ms\": \"desc\"}]\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    result = es_client.search(index=\"mcp-mesh-logs-*\", body=query)\n\n    print(f\"Performance Analysis for {agent_name}:\")\n    print(f\"P50: {result['aggregations']['percentiles']['values']['50.0']}ms\")\n    print(f\"P95: {result['aggregations']['percentiles']['values']['95.0']}ms\")\n    print(f\"P99: {result['aggregations']['percentiles']['values']['99.0']}ms\")\n\n    print(\"\\nSlowest Operations:\")\n    for bucket in result['aggregations']['outliers']['buckets']:\n        print(f\"  {bucket['key']}: {bucket['max_duration']['value']}ms\")\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#best-practices","title":"Best Practices","text":"<ol> <li>Structured Logging: Always use JSON format</li> <li>Correlation IDs: Include trace and request IDs</li> <li>Log Levels: Use appropriate levels consistently</li> <li>Retention Policy: Balance cost with compliance</li> <li>Security: Never log sensitive data</li> </ol>"},{"location":"07-observability/04-centralized-logging/#common-pitfalls","title":"Common Pitfalls","text":""},{"location":"07-observability/04-centralized-logging/#pitfall-1-logging-too-much","title":"Pitfall 1: Logging Too Much","text":"<p>Problem: Excessive logging impacts performance and storage</p> <p>Solution: Implement smart logging:</p> <pre><code># Use sampling for high-frequency logs\nif random.random() &lt; 0.01:  # 1% sampling\n    logger.debug(\"High frequency event\", sampled=True)\n\n# Aggregate before logging\nif time.time() - self.last_log &gt; 60:  # Log every minute\n    logger.info(f\"Processed {self.count} requests\", count=self.count)\n    self.count = 0\n    self.last_log = time.time()\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#pitfall-2-missing-context","title":"Pitfall 2: Missing Context","text":"<p>Problem: Logs lack context for troubleshooting</p> <p>Solution: Always include relevant context:</p> <pre><code>logger.error(\n    \"Database connection failed\",\n    error=str(e),\n    database_host=db_config[\"host\"],\n    retry_count=retry_count,\n    connection_pool_size=pool.size,\n    active_connections=pool.active_count\n)\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#testing","title":"Testing","text":""},{"location":"07-observability/04-centralized-logging/#test-log-pipeline","title":"Test Log Pipeline","text":"<pre><code># test_logging.py\nimport pytest\nimport json\nfrom io import StringIO\nimport logging\n\ndef test_structured_logging():\n    \"\"\"Test that logs are properly structured\"\"\"\n    stream = StringIO()\n    handler = logging.StreamHandler(stream)\n\n    logger = setup_logging(\"test-service\")\n    logger.handlers = [handler]\n\n    # Log test message\n    with LogContext(request_id=\"test-123\"):\n        logger.info(\"Test message\", custom_field=\"value\")\n\n    # Parse log output\n    stream.seek(0)\n    log_data = json.loads(stream.getvalue())\n\n    # Verify structure\n    assert log_data[\"level\"] == \"INFO\"\n    assert log_data[\"msg\"] == \"Test message\"\n    assert log_data[\"custom_field\"] == \"value\"\n    assert log_data[\"request_id\"] == \"test-123\"\n    assert \"timestamp\" in log_data\n    assert \"service\" in log_data\n\ndef test_exception_logging():\n    \"\"\"Test exception logging\"\"\"\n    logger = AgentLogger(\"test-agent\")\n\n    try:\n        raise ValueError(\"Test error\")\n    except ValueError as e:\n        logger.exception(\"Operation failed\", e, operation=\"test_op\")\n\n    # Verify exception was logged with context\n    # (Would need to capture and verify in real test)\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#load-test-logging","title":"Load Test Logging","text":"<pre><code>#!/bin/bash\n# load-test-logging.sh\n\necho \"Testing logging pipeline under load...\"\n\n# Generate high log volume\nfor i in {1..10000}; do\n  echo '{\"timestamp\":\"2024-01-15T10:00:00Z\",\"level\":\"INFO\",\"msg\":\"Test log '$i'\",\"service\":{\"name\":\"load-test\"}}' | \\\n    curl -X POST \"http://localhost:9200/mcp-mesh-logs/_doc\" \\\n      -H \"Content-Type: application/json\" \\\n      -u elastic:changeme \\\n      --data-binary @- &amp;\n\n  if [ $((i % 100)) -eq 0 ]; then\n    wait\n  fi\ndone\n\n# Check ingestion rate\ncurl -s \"http://localhost:9200/mcp-mesh-logs/_stats/indexing\" \\\n  -u elastic:changeme | \\\n  jq '.indices[\"mcp-mesh-logs\"].primaries.indexing.index_total'\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#monitoring-and-debugging","title":"Monitoring and Debugging","text":""},{"location":"07-observability/04-centralized-logging/#monitor-log-pipeline-health","title":"Monitor Log Pipeline Health","text":"<pre><code># logging-monitoring.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: logging-alerts\n  namespace: logging\ndata:\n  alerts.yaml: |\n    groups:\n    - name: logging\n      rules:\n      - alert: LogIngestionRate\n        expr: |\n          rate(fluentd_output_status_num_records_total[5m]) &lt; 100\n        for: 10m\n        labels:\n          severity: warning\n        annotations:\n          summary: \"Low log ingestion rate\"\n          description: \"Log ingestion rate is {% raw %}{{ $value }}{% endraw %} logs/sec\"\n\n      - alert: ElasticsearchDiskSpace\n        expr: |\n          elasticsearch_filesystem_data_available_bytes /\n          elasticsearch_filesystem_data_size_bytes &lt; 0.1\n        for: 15m\n        labels:\n          severity: critical\n        annotations:\n          summary: \"Elasticsearch disk space low\"\n\n      - alert: LogParsingErrors\n        expr: |\n          rate(fluentd_filter_records_total{result=\"error\"}[5m]) &gt; 0.05\n        for: 10m\n        labels:\n          severity: warning\n        annotations:\n          summary: \"High log parsing error rate\"\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#debug-log-issues","title":"Debug Log Issues","text":"<pre><code># Check Fluentd status\nkubectl logs -n logging daemonset/fluentd\n\n# Test log parsing\necho '{\"timestamp\":\"2024-01-15T10:00:00Z\",\"level\":\"INFO\",\"msg\":\"Test\"}' | \\\n  kubectl exec -n logging fluentd-xxxxx -- \\\n  fluentd -c /fluentd/etc/fluent.conf --dry-run\n\n# Check Elasticsearch health\ncurl -s http://localhost:9200/_cluster/health?pretty -u elastic:changeme\n\n# View index stats\ncurl -s http://localhost:9200/mcp-mesh-logs-*/_stats?pretty -u elastic:changeme\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#troubleshooting","title":"\ud83d\udd27 Troubleshooting","text":""},{"location":"07-observability/04-centralized-logging/#issue-1-logs-not-appearing","title":"Issue 1: Logs Not Appearing","text":"<p>Symptoms: Logs not visible in Kibana</p> <p>Cause: Parsing errors or connection issues</p> <p>Solution:</p> <pre><code># Check Fluentd logs for errors\nkubectl logs -n logging daemonset/fluentd | grep ERROR\n\n# Verify index exists\ncurl -s http://localhost:9200/_cat/indices/mcp-mesh-logs-* -u elastic:changeme\n\n# Check for parsing errors\nkubectl exec -n logging fluentd-xxxxx -- \\\n  cat /var/log/fluentd-containers.log.pos\n</code></pre>"},{"location":"07-observability/04-centralized-logging/#issue-2-high-memory-usage","title":"Issue 2: High Memory Usage","text":"<p>Symptoms: Elasticsearch using too much memory</p> <p>Cause: Large indices or inefficient queries</p> <p>Solution:</p> <pre><code># Force merge old indices\ncurl -X POST \"http://localhost:9200/mcp-mesh-logs-*/_forcemerge?max_num_segments=1\" \\\n  -u elastic:changeme\n\n# Update index settings\ncurl -X PUT \"http://localhost:9200/mcp-mesh-logs-*/_settings\" \\\n  -H \"Content-Type: application/json\" \\\n  -u elastic:changeme \\\n  -d '{\n    \"index\": {\n      \"refresh_interval\": \"30s\",\n      \"number_of_replicas\": 0\n    }\n  }'\n</code></pre> <p>For more issues, see the section troubleshooting guide.</p>"},{"location":"07-observability/04-centralized-logging/#known-limitations","title":"\u26a0\ufe0f Known Limitations","text":"<ul> <li>Index Size: Single index limited by shard size</li> <li>Query Performance: Complex queries can be slow</li> <li>Storage Cost: Logs consume significant disk space</li> <li>Retention Trade-offs: Longer retention increases costs</li> </ul>"},{"location":"07-observability/04-centralized-logging/#todo","title":"\ud83d\udcdd TODO","text":"<ul> <li> Add log anomaly detection with ML</li> <li> Implement log sampling strategies</li> <li> Create automated log analysis reports</li> <li> Add integration with SIEM tools</li> <li> Document multi-region log aggregation</li> </ul>"},{"location":"07-observability/04-centralized-logging/#summary","title":"Summary","text":"<p>You now have centralized logging implemented:</p> <p>Key takeaways:</p> <ul> <li>\ud83d\udd11 All logs aggregated in Elasticsearch</li> <li>\ud83d\udd11 Structured logging with full context</li> <li>\ud83d\udd11 Powerful search and analysis capabilities</li> <li>\ud83d\udd11 Correlation with traces and metrics</li> </ul>"},{"location":"07-observability/04-centralized-logging/#next-steps","title":"Next Steps","text":"<p>Let's complete observability with alerting and SLOs.</p> <p>Continue to Alerting and SLOs \u2192</p> <p>\ud83d\udca1 Tip: Use Kibana's machine learning features to detect anomalies in log patterns automatically</p> <p>\ud83d\udcda Reference: Elastic Stack Documentation</p> <p>\ud83e\uddea Try It: Create a custom log dashboard for your specific use case using Kibana Lens</p>"},{"location":"07-observability/05-alerting-slos/","title":"Alerting and SLOs","text":"<p>Define service level objectives and implement proactive alerting for MCP Mesh</p>"},{"location":"07-observability/05-alerting-slos/#overview","title":"Overview","text":"<p>Effective alerting and well-defined Service Level Objectives (SLOs) are crucial for maintaining reliable MCP Mesh deployments. This guide covers establishing SLIs (Service Level Indicators), setting appropriate SLOs, implementing multi-tier alerting strategies, and creating runbooks for incident response. You'll learn to balance alerting sensitivity with alert fatigue while ensuring critical issues are never missed.</p> <p>Proper alerting and SLO management enables proactive incident response, maintains service reliability, and provides clear communication about system performance to stakeholders.</p>"},{"location":"07-observability/05-alerting-slos/#key-concepts","title":"Key Concepts","text":"<ul> <li>SLI (Service Level Indicator): Metrics that measure service behavior</li> <li>SLO (Service Level Objective): Target values for SLIs</li> <li>Error Budget: Allowable unreliability within SLO</li> <li>Alert Fatigue: Too many non-actionable alerts</li> <li>Runbooks: Documented response procedures</li> </ul>"},{"location":"07-observability/05-alerting-slos/#step-by-step-guide","title":"Step-by-Step Guide","text":""},{"location":"07-observability/05-alerting-slos/#step-1-define-service-level-indicators","title":"Step 1: Define Service Level Indicators","text":"<p>Identify and implement key SLIs for MCP Mesh:</p> <pre><code># sli-definitions.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: mcp-mesh-slis\n  namespace: monitoring\ndata:\n  slis.yaml: |\n    # MCP Mesh Service Level Indicators\n    slis:\n      # Availability SLI\n      availability:\n        description: \"Percentage of successful requests\"\n        query: |\n          (\n            sum(rate(mcp_mesh_requests_total{status!=\"error\"}[5m]))\n            /\n            sum(rate(mcp_mesh_requests_total[5m]))\n          ) * 100\n        unit: \"percent\"\n\n      # Latency SLI - P95\n      latency_p95:\n        description: \"95th percentile request latency\"\n        query: |\n          histogram_quantile(0.95,\n            sum by (le) (\n              rate(mcp_mesh_request_duration_seconds_bucket[5m])\n            )\n          )\n        unit: \"seconds\"\n\n      # Latency SLI - P99\n      latency_p99:\n        description: \"99th percentile request latency\"\n        query: |\n          histogram_quantile(0.99,\n            sum by (le) (\n              rate(mcp_mesh_request_duration_seconds_bucket[5m])\n            )\n          )\n        unit: \"seconds\"\n\n      # Error Rate SLI\n      error_rate:\n        description: \"Percentage of failed requests\"\n        query: |\n          (\n            sum(rate(mcp_mesh_requests_total{status=\"error\"}[5m]))\n            /\n            sum(rate(mcp_mesh_requests_total[5m]))\n          ) * 100\n        unit: \"percent\"\n\n      # Throughput SLI\n      throughput:\n        description: \"Requests processed per second\"\n        query: |\n          sum(rate(mcp_mesh_requests_total[5m]))\n        unit: \"requests/second\"\n\n      # Registry Health SLI\n      registry_health:\n        description: \"Registry availability and responsiveness\"\n        query: |\n          min(\n            up{job=\"mcp-mesh-registry\"} * 100,\n            (\n              rate(mcp_mesh_registry_request_duration_seconds_bucket{le=\"0.5\"}[5m])\n              /\n              rate(mcp_mesh_registry_request_duration_seconds_count[5m])\n            ) * 100\n          )\n        unit: \"percent\"\n\n      # Agent Registration SLI\n      agent_registration_time:\n        description: \"Time to register new agent\"\n        query: |\n          histogram_quantile(0.95,\n            sum by (le) (\n              rate(mcp_mesh_registry_registration_duration_seconds_bucket[5m])\n            )\n          )\n        unit: \"seconds\"\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#step-2-establish-service-level-objectives","title":"Step 2: Establish Service Level Objectives","text":"<p>Define SLOs based on business requirements:</p> <pre><code># slo-definitions.yaml\napiVersion: sloth.slok.dev/v1\nkind: PrometheusServiceLevel\nmetadata:\n  name: mcp-mesh-slos\n  namespace: monitoring\nspec:\n  service: \"mcp-mesh\"\n  labels:\n    team: \"platform\"\n    tier: \"critical\"\n\n  # SLO definitions\n  slos:\n    # 99.9% Availability SLO\n    - name: \"requests-availability\"\n      objective: 99.9\n      description: \"99.9% of requests should be successful\"\n\n      sli:\n        raw:\n          error_ratio_query: |\n            sum(rate(mcp_mesh_requests_total{status=\"error\"}[{% raw %}{{.window}}{% endraw %}]))\n            /\n            sum(rate(mcp_mesh_requests_total[{% raw %}{{.window}}{% endraw %}]))\n\n      alerting:\n        name: MCP_Mesh_HighErrorRate\n        page_alert:\n          labels:\n            severity: critical\n            team: platform\n        ticket_alert:\n          labels:\n            severity: warning\n            team: platform\n\n    # Latency SLO - 95% of requests under 500ms\n    - name: \"latency-p95\"\n      objective: 95\n      description: \"95% of requests should complete within 500ms\"\n\n      sli:\n        raw:\n          error_ratio_query: |\n            (\n              sum(rate(mcp_mesh_request_duration_seconds_bucket{le=\"0.5\"}[{% raw %}{{.window}}{% endraw %}]))\n              /\n              sum(rate(mcp_mesh_request_duration_seconds_count[{% raw %}{{.window}}{% endraw %}]))\n            )\n\n      alerting:\n        name: MCP_Mesh_HighLatency\n        page_alert:\n          labels:\n            severity: critical\n        ticket_alert:\n          labels:\n            severity: warning\n\n    # Registry Availability - 99.95%\n    - name: \"registry-availability\"\n      objective: 99.95\n      description: \"Registry should be available 99.95% of the time\"\n\n      sli:\n        raw:\n          error_ratio_query: |\n            1 - avg(up{job=\"mcp-mesh-registry\"})\n\n      alerting:\n        name: MCP_Mesh_RegistryDown\n        page_alert:\n          labels:\n            severity: critical\n            component: registry\n\n---\n# Error Budget Policy\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: error-budget-policy\n  namespace: monitoring\ndata:\n  policy.yaml: |\n    error_budget_policies:\n      # When error budget is exhausted\n      exhausted:\n        - freeze_deployments: true\n        - require_approval_for_changes: true\n        - increase_testing_coverage: true\n        - conduct_postmortem: true\n\n      # When error budget is at risk (&lt; 20% remaining)\n      at_risk:\n        - notify_on_call: true\n        - review_recent_changes: true\n        - increase_monitoring: true\n\n      # When error budget is healthy (&gt; 80% remaining)\n      healthy:\n        - allow_experimentation: true\n        - deploy_normally: true\n        - consider_relaxing_slos: false\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#step-3-implement-multi-tier-alerting","title":"Step 3: Implement Multi-Tier Alerting","text":"<p>Create comprehensive alerting rules:</p> <pre><code># alerting-rules.yaml\napiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  name: mcp-mesh-alerts\n  namespace: monitoring\n  labels:\n    prometheus: kube-prometheus\nspec:\n  groups:\n    # Critical Alerts - Page immediately\n    - name: mcp-mesh.critical\n      interval: 30s\n      rules:\n        - alert: MCP_Mesh_RegistryDown\n          expr: |\n            up{job=\"mcp-mesh-registry\"} == 0\n          for: 2m\n          labels:\n            severity: critical\n            component: registry\n            team: platform\n          annotations:\n            summary: \"MCP Mesh Registry is down\"\n            description: \"Registry {% raw %}{{ $labels.instance }}{% endraw %} has been down for more than 2 minutes\"\n            runbook_url: \"https://wiki.mcp-mesh.io/runbooks/registry-down\"\n            dashboard_url: \"https://grafana.mcp-mesh.io/d/registry/overview\"\n\n        - alert: MCP_Mesh_HighErrorRate\n          expr: |\n            (\n              sum(rate(mcp_mesh_requests_total{status=\"error\"}[5m]))\n              /\n              sum(rate(mcp_mesh_requests_total[5m]))\n            ) &gt; 0.05\n          for: 5m\n          labels:\n            severity: critical\n            team: platform\n          annotations:\n            summary: \"High error rate detected\"\n            description: \"Error rate is {% raw %}{{ $value | humanizePercentage }}{% endraw %} (threshold: 5%)\"\n            runbook_url: \"https://wiki.mcp-mesh.io/runbooks/high-error-rate\"\n\n        - alert: MCP_Mesh_SLO_BurnRate_High\n          expr: |\n            (\n              mcp_mesh:slo:error_budget_burn_rate:1h &gt; 14.4\n              and\n              mcp_mesh:slo:error_budget_burn_rate:5m &gt; 14.4\n            )\n            or\n            (\n              mcp_mesh:slo:error_budget_burn_rate:6h &gt; 6\n              and\n              mcp_mesh:slo:error_budget_burn_rate:30m &gt; 6\n            )\n          labels:\n            severity: critical\n            team: platform\n          annotations:\n            summary: \"SLO burn rate is critically high\"\n            description: \"At this rate, the error budget will be exhausted in {% raw %}{{ $value | humanizeDuration }}{% endraw %}\"\n            runbook_url: \"https://wiki.mcp-mesh.io/runbooks/slo-burn-rate\"\n\n    # Warning Alerts - Create ticket\n    - name: mcp-mesh.warning\n      interval: 60s\n      rules:\n        - alert: MCP_Mesh_HighLatency\n          expr: |\n            histogram_quantile(0.95,\n              sum by (agent, le) (\n                rate(mcp_mesh_request_duration_seconds_bucket[5m])\n              )\n            ) &gt; 0.5\n          for: 10m\n          labels:\n            severity: warning\n            team: platform\n          annotations:\n            summary: \"High latency on {% raw %}{{ $labels.agent }}{% endraw %}\"\n            description: \"P95 latency is {% raw %}{{ $value }}{% endraw %}s (threshold: 0.5s)\"\n            dashboard_url: \"https://grafana.mcp-mesh.io/d/agents/{% raw %}{{ $labels.agent }}{% endraw %}\"\n\n        - alert: MCP_Mesh_HighMemoryUsage\n          expr: |\n            (\n              container_memory_working_set_bytes{pod=~\"mcp-mesh-.*\"}\n              /\n              container_spec_memory_limit_bytes{pod=~\"mcp-mesh-.*\"}\n            ) &gt; 0.8\n          for: 15m\n          labels:\n            severity: warning\n            team: platform\n          annotations:\n            summary: \"High memory usage in {% raw %}{{ $labels.pod }}{% endraw %}\"\n            description: \"Memory usage is {% raw %}{{ $value | humanizePercentage }}{% endraw %} of limit\"\n\n        - alert: MCP_Mesh_PodRestarts\n          expr: |\n            increase(kube_pod_container_status_restarts_total{namespace=\"mcp-mesh\"}[1h]) &gt; 5\n          labels:\n            severity: warning\n            team: platform\n          annotations:\n            summary: \"Pod {% raw %}{{ $labels.pod }}{% endraw %} is restarting frequently\"\n            description: \"{% raw %}{{ $value }}{% endraw %} restarts in the last hour\"\n\n    # Info Alerts - Dashboard only\n    - name: mcp-mesh.info\n      interval: 5m\n      rules:\n        - alert: MCP_Mesh_DeploymentInProgress\n          expr: |\n            kube_deployment_status_replicas{namespace=\"mcp-mesh\"}\n            !=\n            kube_deployment_status_replicas_available{namespace=\"mcp-mesh\"}\n          labels:\n            severity: info\n            team: platform\n          annotations:\n            summary: \"Deployment in progress for {% raw %}{{ $labels.deployment }}{% endraw %}\"\n            description: \"{% raw %}{{ $labels.deployment }}{% endraw %} has {% raw %}{{ $value }}{% endraw %} replicas updating\"\n\n        - alert: MCP_Mesh_CertificateExpiring\n          expr: |\n            (cert_manager_certificate_expiration_timestamp_seconds - time()) / 86400 &lt; 30\n          labels:\n            severity: info\n            team: platform\n          annotations:\n            summary: \"Certificate expiring soon\"\n            description: \"Certificate {% raw %}{{ $labels.name }}{% endraw %} expires in {% raw %}{{ $value }}{% endraw %} days\"\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#step-4-create-runbooks","title":"Step 4: Create Runbooks","text":"<p>Document response procedures for each alert:</p> <pre><code># runbooks/registry-down.md\n\n# MCP Mesh Registry Down Runbook\n\n## Alert: MCP_Mesh_RegistryDown\n\n### Impact\n\n- New agents cannot register\n- Existing agents cannot discover services\n- Service mesh functionality degraded\n\n### Verification Steps\n\n1. Check registry pod status:\n   ```bash\n   kubectl get pods -n mcp-mesh -l app=mcp-mesh-registry\n   ```\n</code></pre> <ol> <li>Check recent events:</li> </ol> <pre><code>kubectl get events -n mcp-mesh --sort-by='.lastTimestamp' | grep registry\n</code></pre> <ol> <li>Check logs:    <pre><code>kubectl logs -n mcp-mesh -l app=mcp-mesh-registry --tail=100\n</code></pre></li> </ol>"},{"location":"07-observability/05-alerting-slos/#resolution-steps","title":"Resolution Steps","text":""},{"location":"07-observability/05-alerting-slos/#step-1-quick-recovery","title":"Step 1: Quick Recovery","text":"<pre><code># Try restarting the registry\nkubectl rollout restart deployment/mcp-mesh-registry -n mcp-mesh\n\n# Wait for rollout\nkubectl rollout status deployment/mcp-mesh-registry -n mcp-mesh\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#step-2-check-database-connection","title":"Step 2: Check Database Connection","text":"<pre><code># Test database connectivity\nkubectl exec -n mcp-mesh deployment/mcp-mesh-registry -- \\\n  pg_isready -h $DB_HOST -p $DB_PORT\n\n# Check database status\nkubectl get pods -n mcp-mesh -l app=postgresql\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#step-3-scale-out","title":"Step 3: Scale Out","text":"<pre><code># If single pod issue, scale up\nkubectl scale deployment/mcp-mesh-registry -n mcp-mesh --replicas=3\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#step-4-failover-to-backup","title":"Step 4: Failover to Backup","text":"<pre><code># If primary region down, failover to secondary\nkubectl apply -f /emergency/registry-failover.yaml\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#post-incident","title":"Post-Incident","text":"<ol> <li>Create incident report</li> <li>Update monitoring thresholds if needed</li> <li>Review registry HA configuration</li> <li>Schedule postmortem meeting</li> </ol> <pre><code>### Step 5: Implement SLO Dashboards\n\nCreate comprehensive SLO monitoring dashboards:\n\n```json\n{\n  \"dashboard\": {\n    \"title\": \"MCP Mesh SLO Overview\",\n    \"uid\": \"mcp-mesh-slo\",\n    \"panels\": [\n      {\n        \"title\": \"Error Budget Status\",\n        \"type\": \"stat\",\n        \"gridPos\": {\"h\": 8, \"w\": 8, \"x\": 0, \"y\": 0},\n        \"targets\": [\n          {\n            \"expr\": \"(1 - ((1 - 0.999) - (1 - avg_over_time(mcp_mesh:slo:availability[30d])))) * 100\",\n            \"legendFormat\": \"Remaining Budget %\"\n          }\n        ],\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"percent\",\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                {\"color\": \"red\", \"value\": 0},\n                {\"color\": \"yellow\", \"value\": 20},\n                {\"color\": \"green\", \"value\": 50}\n              ]\n            }\n          }\n        }\n      },\n\n      {\n        \"title\": \"SLO Compliance - 28 Days\",\n        \"type\": \"gauge\",\n        \"gridPos\": {\"h\": 8, \"w\": 8, \"x\": 8, \"y\": 0},\n        \"targets\": [\n          {\n            \"expr\": \"avg_over_time(mcp_mesh:slo:availability[28d]) * 100\",\n            \"legendFormat\": \"Availability\"\n          }\n        ],\n        \"options\": {\n          \"showThresholdLabels\": true,\n          \"showThresholdMarkers\": true\n        },\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"percent\",\n            \"min\": 95,\n            \"max\": 100,\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                {\"color\": \"red\", \"value\": 95},\n                {\"color\": \"yellow\", \"value\": 99},\n                {\"color\": \"green\", \"value\": 99.9}\n              ]\n            }\n          }\n        }\n      },\n\n      {\n        \"title\": \"Burn Rate\",\n        \"type\": \"timeseries\",\n        \"gridPos\": {\"h\": 8, \"w\": 8, \"x\": 16, \"y\": 0},\n        \"targets\": [\n          {\n            \"expr\": \"mcp_mesh:slo:error_budget_burn_rate:1h\",\n            \"legendFormat\": \"1h burn rate\"\n          },\n          {\n            \"expr\": \"mcp_mesh:slo:error_budget_burn_rate:24h\",\n            \"legendFormat\": \"24h burn rate\"\n          }\n        ],\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"custom\": {\n              \"drawStyle\": \"line\",\n              \"lineWidth\": 2,\n              \"fillOpacity\": 10\n            },\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                {\"color\": \"green\", \"value\": 0},\n                {\"color\": \"yellow\", \"value\": 1},\n                {\"color\": \"red\", \"value\": 10}\n              ]\n            }\n          }\n        }\n      },\n\n      {\n        \"title\": \"SLI Trends\",\n        \"type\": \"timeseries\",\n        \"gridPos\": {\"h\": 10, \"w\": 24, \"x\": 0, \"y\": 8},\n        \"targets\": [\n          {\n            \"expr\": \"mcp_mesh:sli:availability\",\n            \"legendFormat\": \"Availability\"\n          },\n          {\n            \"expr\": \"100 - (mcp_mesh:sli:error_rate * 100)\",\n            \"legendFormat\": \"Success Rate\"\n          },\n          {\n            \"expr\": \"(mcp_mesh:sli:latency_p95 &lt; 0.5) * 100\",\n            \"legendFormat\": \"Latency SLI\"\n          }\n        ],\n        \"fieldConfig\": {\n          \"defaults\": {\n            \"unit\": \"percent\",\n            \"min\": 90,\n            \"max\": 100\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#step-6-implement-alert-routing","title":"Step 6: Implement Alert Routing","text":"<p>Configure intelligent alert routing:</p> <pre><code># alertmanager-config.yaml\napiVersion: v1\nkind: Secret\nmetadata:\n  name: alertmanager-mcp-mesh\n  namespace: monitoring\nstringData:\n  alertmanager.yaml: |\n    global:\n      resolve_timeout: 5m\n      slack_api_url: ${SLACK_API_URL}\n      pagerduty_url: https://events.pagerduty.com/v2/enqueue\n\n    # Alert routing tree\n    route:\n      group_by: ['alertname', 'cluster', 'service']\n      group_wait: 10s\n      group_interval: 10s\n      repeat_interval: 12h\n      receiver: 'default'\n\n      routes:\n      # Critical alerts - page immediately\n      - match:\n          severity: critical\n        receiver: pagerduty-critical\n        group_wait: 0s\n        repeat_interval: 1h\n        continue: true\n\n      # Critical alerts also go to Slack\n      - match:\n          severity: critical\n        receiver: slack-critical\n\n      # Warning alerts - ticket only\n      - match:\n          severity: warning\n        receiver: slack-warnings\n        group_wait: 5m\n        group_interval: 5m\n        repeat_interval: 4h\n\n      # Info alerts - dashboard only\n      - match:\n          severity: info\n        receiver: slack-info\n        group_wait: 30m\n        group_interval: 30m\n        repeat_interval: 24h\n\n      # Team-specific routing\n      - match:\n          team: platform\n        receiver: platform-team\n        routes:\n        - match:\n            component: registry\n          receiver: registry-oncall\n\n    # Inhibition rules\n    inhibit_rules:\n    - source_match:\n        severity: 'critical'\n      target_match:\n        severity: 'warning'\n      equal: ['alertname', 'instance']\n\n    - source_match:\n        alertname: 'MCP_Mesh_RegistryDown'\n      target_match_re:\n        alertname: 'MCP_Mesh_.*'\n      equal: ['instance']\n\n    # Receivers\n    receivers:\n    - name: 'default'\n      slack_configs:\n      - channel: '#alerts-default'\n        title: 'MCP Mesh Alert'\n        text: '{% raw %}{{ range .Alerts }}{% endraw %}{% raw %}{{ .Annotations.summary }}{% endraw %}{% raw %}{{ end }}{% endraw %}'\n\n    - name: 'pagerduty-critical'\n      pagerduty_configs:\n      - service_key: ${PAGERDUTY_SERVICE_KEY}\n        description: '{% raw %}{{ .GroupLabels.alertname }}{% endraw %}: {% raw %}{{ .CommonAnnotations.summary }}{% endraw %}'\n        details:\n          firing: '{% raw %}{{ .Alerts.Firing | len }}{% endraw %}'\n          resolved: '{% raw %}{{ .Alerts.Resolved | len }}{% endraw %}'\n          labels: '{% raw %}{{ .CommonLabels }}{% endraw %}'\n        links:\n        - href: '{% raw %}{{ .CommonAnnotations.dashboard_url }}{% endraw %}'\n          text: 'Dashboard'\n        - href: '{% raw %}{{ .CommonAnnotations.runbook_url }}{% endraw %}'\n          text: 'Runbook'\n\n    - name: 'slack-critical'\n      slack_configs:\n      - channel: '#alerts-critical'\n        color: 'danger'\n        title: '\ud83d\udea8 CRITICAL: {% raw %}{{ .GroupLabels.alertname }}{% endraw %}'\n        text: |\n          {% raw %}{{ range .Alerts.Firing }}{% endraw %}\n          *Alert:* {% raw %}{{ .Annotations.summary }}{% endraw %}\n          *Description:* {% raw %}{{ .Annotations.description }}{% endraw %}\n          *Runbook:* &lt;{% raw %}{{ .Annotations.runbook_url }}{% endraw %}|View Runbook&gt;\n          *Dashboard:* &lt;{% raw %}{{ .Annotations.dashboard_url }}{% endraw %}|View Dashboard&gt;\n          {% raw %}{{ end }}{% endraw %}\n        send_resolved: true\n\n    - name: 'slack-warnings'\n      slack_configs:\n      - channel: '#alerts-warning'\n        color: 'warning'\n        title: '\u26a0\ufe0f Warning: {% raw %}{{ .GroupLabels.alertname }}{% endraw %}'\n        text: '{% raw %}{{ .CommonAnnotations.summary }}{% endraw %}'\n        send_resolved: true\n\n    - name: 'platform-team'\n      webhook_configs:\n      - url: 'http://incident-bot:8080/webhook'\n        send_resolved: true\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#configuration-options","title":"Configuration Options","text":"Component Setting Description SLO Target <code>99.9%</code> Availability objective Error Budget <code>0.1%</code> Allowable downtime Burn Rate Alert <code>14.4x</code> 1-hour burn rate threshold Alert Evaluation <code>30s</code> How often to evaluate rules Alert Delay <code>5m</code> Wait before firing"},{"location":"07-observability/05-alerting-slos/#examples","title":"Examples","text":""},{"location":"07-observability/05-alerting-slos/#example-1-custom-slo-for-business-metrics","title":"Example 1: Custom SLO for Business Metrics","text":"<pre><code># business-slo.yaml\napiVersion: sloth.slok.dev/v1\nkind: PrometheusServiceLevel\nmetadata:\n  name: business-slos\nspec:\n  service: \"mcp-mesh-business\"\n  slos:\n    - name: \"transaction-success\"\n      objective: 99.95\n      description: \"99.95% of payment transactions should succeed\"\n\n      sli:\n        raw:\n          error_ratio_query: |\n            sum(rate(mcp_mesh_business_transactions_total{status=\"failed\"}[{% raw %}{{.window}}{% endraw %}]))\n            /\n            sum(rate(mcp_mesh_business_transactions_total[{% raw %}{{.window}}{% endraw %}]))\n\n      alerting:\n        name: BusinessTransactionFailures\n        page_alert:\n          labels:\n            severity: critical\n            team: business\n\n    - name: \"api-cost-efficiency\"\n      objective: 95\n      description: \"95% of API calls should stay under cost threshold\"\n\n      sli:\n        raw:\n          error_ratio_query: |\n            (\n              sum(rate(mcp_mesh_api_calls_total{cost_exceeded=\"true\"}[{% raw %}{{.window}}{% endraw %}]))\n              /\n              sum(rate(mcp_mesh_api_calls_total[{% raw %}{{.window}}{% endraw %}]))\n            )\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#example-2-adaptive-alerting","title":"Example 2: Adaptive Alerting","text":"<pre><code># adaptive_alerting.py\nfrom prometheus_api_client import PrometheusConnect\nimport numpy as np\nfrom datetime import datetime, timedelta\n\nclass AdaptiveAlerting:\n    \"\"\"Implement adaptive thresholds based on historical data\"\"\"\n\n    def __init__(self, prometheus_url: str):\n        self.prom = PrometheusConnect(url=prometheus_url)\n\n    def calculate_dynamic_threshold(self, metric: str,\n                                  lookback_days: int = 7,\n                                  sensitivity: float = 3.0):\n        \"\"\"Calculate dynamic threshold using statistical methods\"\"\"\n\n        # Get historical data\n        end_time = datetime.now()\n        start_time = end_time - timedelta(days=lookback_days)\n\n        # Query data points\n        data = self.prom.custom_query_range(\n            query=metric,\n            start_time=start_time,\n            end_time=end_time,\n            step='5m'\n        )\n\n        if not data:\n            return None\n\n        # Extract values\n        values = [float(point[1]) for point in data[0]['values']]\n\n        # Calculate statistics\n        mean = np.mean(values)\n        std = np.std(values)\n\n        # Calculate percentiles\n        p50 = np.percentile(values, 50)\n        p95 = np.percentile(values, 95)\n        p99 = np.percentile(values, 99)\n\n        # Dynamic threshold based on time of day\n        hour = datetime.now().hour\n        if 9 &lt;= hour &lt;= 17:  # Business hours\n            threshold = mean + (sensitivity * std)\n        else:  # Off hours\n            threshold = mean + ((sensitivity + 1) * std)\n\n        return {\n            'threshold': threshold,\n            'mean': mean,\n            'std': std,\n            'p50': p50,\n            'p95': p95,\n            'p99': p99,\n            'current_hour': hour\n        }\n\n    def generate_alert_rule(self, metric_name: str,\n                          threshold_info: dict):\n        \"\"\"Generate Prometheus alert rule with dynamic threshold\"\"\"\n\n        return f\"\"\"\n        - alert: {metric_name}_DynamicThreshold\n          expr: |\n            {metric_name} &gt; {threshold_info['threshold']}\n          for: 5m\n          labels:\n            severity: warning\n            threshold_type: dynamic\n          annotations:\n            summary: \"{metric_name} exceeds dynamic threshold\"\n            description: |\n              Current value: {% raw %}{{{{ $value }}{% endraw %}}}\n              Dynamic threshold: {threshold_info['threshold']:.2f}\n              Based on mean: {threshold_info['mean']:.2f} (\u00b1{threshold_info['std']:.2f})\n              P95: {threshold_info['p95']:.2f}, P99: {threshold_info['p99']:.2f}\n        \"\"\"\n\n# Usage\nalerting = AdaptiveAlerting(\"http://prometheus:9090\")\n\n# Calculate dynamic threshold for request rate\nthreshold = alerting.calculate_dynamic_threshold(\n    \"rate(mcp_mesh_requests_total[5m])\"\n)\n\nprint(f\"Dynamic threshold: {threshold['threshold']:.2f} req/s\")\nprint(f\"Based on historical mean: {threshold['mean']:.2f} (\u00b1{threshold['std']:.2f})\")\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#best-practices","title":"Best Practices","text":"<ol> <li>Start with Loose SLOs: Tighten gradually based on data</li> <li>Multi-Window Alerts: Use multiple burn rate windows</li> <li>Actionable Alerts: Every alert should have clear actions</li> <li>Regular Review: Review SLOs and alerts monthly</li> <li>Blameless Culture: Focus on improvement, not blame</li> </ol>"},{"location":"07-observability/05-alerting-slos/#common-pitfalls","title":"Common Pitfalls","text":""},{"location":"07-observability/05-alerting-slos/#pitfall-1-too-many-alerts","title":"Pitfall 1: Too Many Alerts","text":"<p>Problem: Alert fatigue from non-actionable alerts</p> <p>Solution: Implement alert quality metrics:</p> <pre><code># Track alert quality\n- record: alerts:quality:actionable_ratio\n  expr: |\n    sum(rate(alertmanager_alerts_resolved{resolved_by=\"human\"}[7d]))\n    /\n    sum(rate(alertmanager_alerts_resolved[7d]))\n\n# Remove alerts with low actionable ratio\n- alert: AlertQualityLow\n  expr: alerts:quality:actionable_ratio &lt; 0.5\n  annotations:\n    summary: \"Alert {% raw %}{{ $labels.alertname }}{% endraw %} has low actionable ratio\"\n    description: \"Only {% raw %}{{ $value | humanizePercentage }}{% endraw %} of alerts were actionable\"\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#pitfall-2-unrealistic-slos","title":"Pitfall 2: Unrealistic SLOs","text":"<p>Problem: SLOs set too high, constantly violated</p> <p>Solution: Base SLOs on historical performance:</p> <pre><code># Calculate realistic SLO based on past performance\n# Use P90 of historical availability as starting point\nquantile_over_time(0.9,\n  avg_over_time(\n    up{job=\"mcp-mesh\"}[1d]\n  )[30d:1d]\n) * 100\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#testing","title":"Testing","text":""},{"location":"07-observability/05-alerting-slos/#test-alert-rules","title":"Test Alert Rules","text":"<pre><code># test_alerts.py\nimport pytest\nfrom prometheus_api_client import PrometheusConnect\n\ndef test_alert_rules():\n    \"\"\"Test that alert rules are valid and fire correctly\"\"\"\n    prom = PrometheusConnect(url=\"http://localhost:9090\")\n\n    # Get all configured alerts\n    alerts = prom.custom_query(\"ALERTS\")\n\n    # Test specific alert conditions\n    test_cases = [\n        {\n            \"alert\": \"MCP_Mesh_HighErrorRate\",\n            \"condition\": \"rate(mcp_mesh_requests_total{status='error'}[5m]) &gt; 0.05\",\n            \"should_fire\": True\n        },\n        {\n            \"alert\": \"MCP_Mesh_RegistryDown\",\n            \"condition\": \"up{job='mcp-mesh-registry'} == 0\",\n            \"should_fire\": False  # Should not fire in healthy system\n        }\n    ]\n\n    for test in test_cases:\n        result = prom.custom_query(test[\"condition\"])\n        if test[\"should_fire\"]:\n            assert len(result) &gt; 0, f\"{test['alert']} should fire\"\n        else:\n            assert len(result) == 0, f\"{test['alert']} should not fire\"\n\ndef test_slo_calculations():\n    \"\"\"Test SLO calculation accuracy\"\"\"\n    prom = PrometheusConnect(url=\"http://localhost:9090\")\n\n    # Test availability SLO\n    availability = prom.custom_query(\n        \"avg_over_time(mcp_mesh:slo:availability[1h])\"\n    )\n    assert 0 &lt;= float(availability[0]['value'][1]) &lt;= 1\n\n    # Test error budget\n    error_budget = prom.custom_query(\n        \"mcp_mesh:slo:error_budget_remaining\"\n    )\n    assert 0 &lt;= float(error_budget[0]['value'][1]) &lt;= 1\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#chaos-testing-for-alerts","title":"Chaos Testing for Alerts","text":"<pre><code>#!/bin/bash\n# chaos-test-alerts.sh\n\necho \"Testing alert firing conditions...\"\n\n# Test 1: High error rate\necho \"Injecting errors...\"\nfor i in {1..100}; do\n  curl -X POST http://localhost:8080/error-injection \\\n    -d '{\"error_rate\": 0.1, \"duration\": \"60s\"}'\ndone\n\n# Wait for alert\nsleep 120\nkubectl logs -n monitoring alertmanager-0 | grep \"MCP_Mesh_HighErrorRate\"\n\n# Test 2: Registry failure\necho \"Stopping registry...\"\nkubectl scale deployment mcp-mesh-registry -n mcp-mesh --replicas=0\n\n# Check if alert fires within 5 minutes\nsleep 300\nkubectl logs -n monitoring alertmanager-0 | grep \"MCP_Mesh_RegistryDown\"\n\n# Restore\nkubectl scale deployment mcp-mesh-registry -n mcp-mesh --replicas=3\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#monitoring-and-debugging","title":"Monitoring and Debugging","text":""},{"location":"07-observability/05-alerting-slos/#monitor-alert-health","title":"Monitor Alert Health","text":"<pre><code># alert-health-dashboard.json\n{\n  \"dashboard\":\n    {\n      \"title\": \"Alert Health\",\n      \"panels\":\n        [\n          {\n            \"title\": \"Alert Firing Rate\",\n            \"targets\":\n              [\n                {\n                  \"expr\": \"sum by (alertname) (rate(alertmanager_notifications_total[5m]))\",\n                },\n              ],\n          },\n          {\n            \"title\": \"Alert Resolution Time\",\n            \"targets\":\n              [\n                {\n                  \"expr\": \"histogram_quantile(0.95, alertmanager_alert_resolution_duration_seconds_bucket)\",\n                },\n              ],\n          },\n          {\n            \"title\": \"Failed Notifications\",\n            \"targets\":\n              [\n                {\n                  \"expr\": \"sum by (integration) (rate(alertmanager_notifications_failed_total[5m]))\",\n                },\n              ],\n          },\n        ],\n    },\n}\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#debug-slo-violations","title":"Debug SLO Violations","text":"<pre><code># Check SLO status\ncurl -s http://prometheus:9090/api/v1/query \\\n  -d 'query=mcp_mesh:slo:error_budget_remaining' | jq\n\n# Get burn rate history\ncurl -s http://prometheus:9090/api/v1/query_range \\\n  -d 'query=mcp_mesh:slo:error_budget_burn_rate:1h' \\\n  -d 'start=now-24h' \\\n  -d 'end=now' \\\n  -d 'step=5m' | jq\n\n# Find when budget was exhausted\ncurl -s http://prometheus:9090/api/v1/query \\\n  -d 'query=mcp_mesh:slo:error_budget_remaining == 0' | jq\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#troubleshooting","title":"\ud83d\udd27 Troubleshooting","text":""},{"location":"07-observability/05-alerting-slos/#issue-1-alerts-not-firing","title":"Issue 1: Alerts Not Firing","text":"<p>Symptoms: Known issues but no alerts received</p> <p>Cause: Misconfigured rules or routing</p> <p>Solution:</p> <pre><code># Check if alerts are pending\nkubectl exec -n monitoring prometheus-0 -- \\\n  promtool query instant http://localhost:9090 'ALERTS{alertstate=\"pending\"}'\n\n# Verify AlertManager configuration\nkubectl logs -n monitoring alertmanager-0 | grep error\n\n# Test alert routing\namtool config routes test \\\n  --config.file=/etc/alertmanager/alertmanager.yaml \\\n  --tree \\\n  --verify.receivers=slack-critical \\\n  severity=critical alertname=TestAlert\n</code></pre>"},{"location":"07-observability/05-alerting-slos/#issue-2-slo-always-violated","title":"Issue 2: SLO Always Violated","text":"<p>Symptoms: SLO compliance always below target</p> <p>Cause: Unrealistic objectives or calculation errors</p> <p>Solution:</p> <pre><code># Debug SLO calculation\n# Check raw error ratio\nsum(rate(mcp_mesh_requests_total{status=\"error\"}[5m]))\n/\nsum(rate(mcp_mesh_requests_total[5m]))\n\n# Check if data exists\nsum(rate(mcp_mesh_requests_total[5m])) &gt; 0\n\n# Verify time windows\nincrease(mcp_mesh_requests_total[30d])\n</code></pre> <p>For more issues, see the section troubleshooting guide.</p>"},{"location":"07-observability/05-alerting-slos/#known-limitations","title":"\u26a0\ufe0f Known Limitations","text":"<ul> <li>SLO Window: Minimum practical window is 28 days</li> <li>Alert Delay: Minimum 30s evaluation interval</li> <li>Burn Rate: Requires sufficient traffic for accuracy</li> <li>Multi-Region: SLOs are per-region, not global</li> </ul>"},{"location":"07-observability/05-alerting-slos/#todo","title":"\ud83d\udcdd TODO","text":"<ul> <li> Add ML-based anomaly detection</li> <li> Implement alert correlation</li> <li> Create mobile app integration</li> <li> Add voice call escalation</li> <li> Document multi-region SLOs</li> </ul>"},{"location":"07-observability/05-alerting-slos/#summary","title":"Summary","text":"<p>You now have comprehensive alerting and SLOs:</p> <p>Key takeaways:</p> <ul> <li>\ud83d\udd11 Well-defined SLIs and SLOs</li> <li>\ud83d\udd11 Multi-tier alerting strategy</li> <li>\ud83d\udd11 Error budget tracking</li> <li>\ud83d\udd11 Runbooks for every alert</li> </ul>"},{"location":"07-observability/05-alerting-slos/#next-steps","title":"Next Steps","text":"<p>Complete the observability section with troubleshooting guide.</p> <p>Continue to Observability Troubleshooting \u2192</p> <p>\ud83d\udca1 Tip: Use error budget policies to automatically restrict deployments when budget is low</p> <p>\ud83d\udcda Reference: Google SRE Book - Alerting</p> <p>\ud83e\uddea Try It: Implement a game day to test your alerting and response procedures</p>"},{"location":"07-observability/troubleshooting/","title":"Observability Troubleshooting","text":"<p>Comprehensive guide to diagnosing and resolving observability issues in MCP Mesh</p>"},{"location":"07-observability/troubleshooting/#overview","title":"Overview","text":"<p>This troubleshooting guide covers common issues encountered when implementing observability for MCP Mesh. Each issue includes symptoms, root causes, diagnostic steps, and solutions. The guide is organized by observability component to help you quickly find relevant solutions.</p>"},{"location":"07-observability/troubleshooting/#quick-diagnostics","title":"Quick Diagnostics","text":"<p>Run this diagnostic script first:</p> <pre><code>#!/bin/bash\n# observability-diagnostics.sh\n\necho \"=== MCP Mesh Observability Diagnostics ===\"\necho \"Date: $(date)\"\necho \"\"\n\n# Check Prometheus\necho \"1. Prometheus Status:\"\nkubectl get pods -n monitoring -l app.kubernetes.io/name=prometheus\nkubectl top pods -n monitoring -l app.kubernetes.io/name=prometheus\n\n# Check Grafana\necho -e \"\\n2. Grafana Status:\"\nkubectl get pods -n monitoring -l app.kubernetes.io/name=grafana\ncurl -s http://localhost:3000/api/health || echo \"Grafana not accessible\"\n\n# Check Jaeger\necho -e \"\\n3. Jaeger Status:\"\nkubectl get pods -n observability -l app.kubernetes.io/name=jaeger\ncurl -s http://localhost:16686/api/services || echo \"Jaeger not accessible\"\n\n# Check Elasticsearch\necho -e \"\\n4. Elasticsearch Status:\"\nkubectl get pods -n logging -l app.kubernetes.io/name=elasticsearch\ncurl -s http://localhost:9200/_cluster/health?pretty -u elastic:changeme || echo \"Elasticsearch not accessible\"\n\n# Check metrics collection\necho -e \"\\n5. Metrics Collection:\"\ncurl -s http://localhost:9090/api/v1/targets | jq '.data.activeTargets | length' || echo \"0\"\n\n# Check for recent errors\necho -e \"\\n6. Recent Errors:\"\nkubectl logs -n monitoring -l app.kubernetes.io/name=prometheus --tail=20 | grep -i error || echo \"No errors\"\nkubectl logs -n logging -l app.kubernetes.io/name=fluentd --tail=20 | grep -i error || echo \"No errors\"\n\n# Check resource usage\necho -e \"\\n7. Resource Usage:\"\nkubectl top nodes\n</code></pre>"},{"location":"07-observability/troubleshooting/#common-issues-by-component","title":"Common Issues by Component","text":""},{"location":"07-observability/troubleshooting/#prometheus-issues","title":"\ud83d\udd0d Prometheus Issues","text":""},{"location":"07-observability/troubleshooting/#issue-1-high-memory-usage","title":"Issue 1: High Memory Usage","text":"<p>Symptoms:</p> <ul> <li>Prometheus pod OOMKilled</li> <li>Slow query performance</li> <li>Incomplete metrics data</li> </ul> <p>Diagnosis:</p> <pre><code># Check memory usage\nkubectl top pod -n monitoring -l app.kubernetes.io/name=prometheus\n\n# Check TSDB stats\nkubectl exec -n monitoring prometheus-0 -- \\\n  promtool tsdb analyze /prometheus\n\n# Check cardinality\ncurl -s http://localhost:9090/api/v1/label/__name__/values | \\\n  jq -r '.data | length'\n</code></pre> <p>Solution:</p> <pre><code># Reduce cardinality\n# 1. Drop unnecessary metrics\nmetricRelabelings:\n  - sourceLabels: [__name__]\n    regex: \"go_.*|process_.*\"\n    action: drop\n\n  # 2. Limit label values\n  - sourceLabels: [path]\n    regex: \"/api/v1/users/[0-9]+\"\n    targetLabel: path\n    replacement: \"/api/v1/users/{id}\"\n\n# 3. Increase memory limits\nresources:\n  limits:\n    memory: 8Gi\n  requests:\n    memory: 4Gi\n\n# 4. Reduce retention\nprometheusSpec:\n  retention: 15d\n  retentionSize: 50GB\n</code></pre>"},{"location":"07-observability/troubleshooting/#issue-2-missing-metrics","title":"Issue 2: Missing Metrics","text":"<p>Symptoms:</p> <ul> <li>No data in Grafana dashboards</li> <li>Targets showing as DOWN</li> <li>ServiceMonitor not discovered</li> </ul> <p>Diagnosis:</p> <pre><code># Check targets\ncurl -s http://localhost:9090/api/v1/targets | jq '.data.activeTargets[] | {job: .job, health: .health}'\n\n# Check ServiceMonitor discovery\nkubectl get servicemonitor -A\nkubectl describe prometheus -n monitoring | grep -A10 \"Service Monitor Selector\"\n\n# Test metric endpoint\nkubectl port-forward -n mcp-mesh svc/mcp-mesh-registry 8080\ncurl http://localhost:8080/metrics\n</code></pre> <p>Solution:</p> <pre><code># Fix ServiceMonitor labels\nkubectl label servicemonitor mcp-mesh-registry -n mcp-mesh \\\n  release=prometheus\n\n# Fix network policies\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-prometheus-scrape\n  namespace: mcp-mesh\nspec:\n  podSelector: {}\n  ingress:\n  - from:\n    - namespaceSelector:\n        matchLabels:\n          name: monitoring\n    ports:\n    - protocol: TCP\n      port: 8080\n\n# Fix service discovery\n# Ensure Prometheus can discover all namespaces\nprometheusSpec:\n  serviceMonitorNamespaceSelector: {}\n  serviceMonitorSelector: {}\n</code></pre>"},{"location":"07-observability/troubleshooting/#grafana-issues","title":"\ud83d\udcca Grafana Issues","text":""},{"location":"07-observability/troubleshooting/#issue-3-dashboard-not-loading","title":"Issue 3: Dashboard Not Loading","text":"<p>Symptoms:</p> <ul> <li>\"No Data\" in panels</li> <li>Timeout errors</li> <li>Template variables not working</li> </ul> <p>Diagnosis:</p> <pre><code># Check data source\ncurl -s -H \"Authorization: Bearer $GRAFANA_API_KEY\" \\\n  http://localhost:3000/api/datasources\n\n# Test query\ncurl -G http://localhost:9090/api/v1/query \\\n  --data-urlencode 'query=up{job=\"mcp-mesh-registry\"}'\n\n# Check Grafana logs\nkubectl logs -n monitoring deployment/prometheus-grafana | grep -i error\n</code></pre> <p>Solution:</p> <pre><code>// Fix data source configuration\n{\n  \"name\": \"Prometheus\",\n  \"type\": \"prometheus\",\n  \"url\": \"http://prometheus-operated:9090\",\n  \"access\": \"proxy\",\n  \"jsonData\": {\n    \"timeInterval\": \"30s\",\n    \"queryTimeout\": \"60s\",\n    \"httpMethod\": \"POST\"\n  }\n}\n\n// Fix template variables\n{\n  \"templating\": {\n    \"list\": [{\n      \"name\": \"namespace\",\n      \"type\": \"query\",\n      \"datasource\": \"Prometheus\",\n      \"query\": \"label_values(up, namespace)\",\n      \"refresh\": 2,\n      \"regex\": \"mcp-mesh.*\",\n      \"sort\": 1\n    }]\n  }\n}\n</code></pre>"},{"location":"07-observability/troubleshooting/#issue-4-slow-dashboard-performance","title":"Issue 4: Slow Dashboard Performance","text":"<p>Symptoms:</p> <ul> <li>Long load times</li> <li>Browser hanging</li> <li>Query timeouts</li> </ul> <p>Solution:</p> <pre><code># Use recording rules instead of complex queries\n# Bad - complex query in dashboard\nhistogram_quantile(0.95,\n  sum by (agent, le) (\n    rate(mcp_mesh_request_duration_seconds_bucket[$__interval])\n  )\n)\n\n# Good - pre-computed recording rule\nmcp_mesh:request_duration:p95\n\n# Optimize time ranges\n# Use $__interval instead of fixed intervals\nrate(metric[$__interval])\n\n# Limit query results\ntopk(10, metric)\n</code></pre>"},{"location":"07-observability/troubleshooting/#distributed-tracing-issues","title":"\ud83d\udd0e Distributed Tracing Issues","text":""},{"location":"07-observability/troubleshooting/#issue-5-traces-not-appearing","title":"Issue 5: Traces Not Appearing","text":"<p>Symptoms:</p> <ul> <li>No traces in Jaeger UI</li> <li>Broken trace continuity</li> <li>Missing spans</li> </ul> <p>Diagnosis:</p> <pre><code># Check OTEL collector\nkubectl logs -n observability deployment/otel-collector | grep -E \"receiver|exporter\"\n\n# Verify trace export\ncurl -X POST http://localhost:4318/v1/traces \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"resourceSpans\": []}'\n\n# Check Jaeger ingestion\nkubectl port-forward -n observability svc/mcp-mesh-jaeger-collector 14268\ncurl http://localhost:14268/api/sampling?service=test\n</code></pre> <p>Solution:</p> <pre><code># Fix trace context propagation\nfrom opentelemetry.propagate import set_global_textmap\nfrom opentelemetry.trace.propagation.tracecontext import TraceContextTextMapPropagator\n\n# Set up propagator\nset_global_textmap(TraceContextTextMapPropagator())\n\n# Ensure context is propagated in async code\nimport contextvars\nfrom opentelemetry import trace, context\n\ntrace_context = contextvars.ContextVar('trace_context')\n\nasync def parent_operation():\n    with tracer.start_as_current_span(\"parent\") as span:\n        ctx = context.get_current()\n        await child_operation(ctx)\n\nasync def child_operation(parent_ctx):\n    # Restore parent context\n    token = context.attach(parent_ctx)\n    try:\n        with tracer.start_as_current_span(\"child\") as span:\n            # Span will be properly linked\n            pass\n    finally:\n        context.detach(token)\n</code></pre>"},{"location":"07-observability/troubleshooting/#issue-6-high-trace-volume","title":"Issue 6: High Trace Volume","text":"<p>Symptoms:</p> <ul> <li>Storage filling up quickly</li> <li>Slow Jaeger queries</li> <li>Collector dropping traces</li> </ul> <p>Solution:</p> <pre><code># Implement intelligent sampling\nprocessors:\n  tail_sampling:\n    decision_wait: 10s\n    num_traces: 100000\n    expected_new_traces_per_sec: 1000\n    policies:\n      # Always sample errors\n      - name: error-sampler\n        type: status_code\n        status_code:\n          status_codes: [ERROR]\n\n      # Sample slow traces\n      - name: latency-sampler\n        type: latency\n        latency:\n          threshold_ms: 1000\n\n      # Rate limit per service\n      - name: service-rate-limit\n        type: rate_limiting\n        rate_limiting:\n          spans_per_second: 100\n\n      # Probabilistic fallback\n      - name: probabilistic-sampler\n        type: probabilistic\n        probabilistic:\n          sampling_percentage: 1\n</code></pre>"},{"location":"07-observability/troubleshooting/#centralized-logging-issues","title":"\ud83d\udcdd Centralized Logging Issues","text":""},{"location":"07-observability/troubleshooting/#issue-7-logs-not-indexed","title":"Issue 7: Logs Not Indexed","text":"<p>Symptoms:</p> <ul> <li>Logs not appearing in Kibana</li> <li>Fluentd errors</li> <li>Index pattern missing</li> </ul> <p>Diagnosis:</p> <pre><code># Check Fluentd status\nkubectl logs -n logging daemonset/fluentd | tail -50\n\n# Check Elasticsearch indices\ncurl -s http://localhost:9200/_cat/indices?v -u elastic:changeme\n\n# Test log parsing\necho '{\"level\":\"INFO\",\"msg\":\"test\",\"timestamp\":\"2024-01-15T10:00:00Z\"}' | \\\n  kubectl exec -n logging fluentd-xxxxx -- \\\n  fluent-cat test.log\n</code></pre> <p>Solution:</p> <pre><code># Fix Fluentd parsing\n&lt;parse&gt;\n  @type multi_format\n  # JSON logs\n  &lt;pattern&gt;\n    format json\n    time_key timestamp\n    time_format %Y-%m-%dT%H:%M:%S.%NZ\n  &lt;/pattern&gt;\n  # Plain text fallback\n  &lt;pattern&gt;\n    format none\n    message_key log\n  &lt;/pattern&gt;\n&lt;/parse&gt;\n\n# Fix index template\nPUT _index_template/mcp-mesh-logs\n{\n  \"index_patterns\": [\"mcp-mesh-logs-*\"],\n  \"template\": {\n    \"settings\": {\n      \"number_of_shards\": 3,\n      \"number_of_replicas\": 1\n    },\n    \"mappings\": {\n      \"properties\": {\n        \"timestamp\": {\n          \"type\": \"date\"\n        },\n        \"level\": {\n          \"type\": \"keyword\"\n        }\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"07-observability/troubleshooting/#issue-8-log-storage-full","title":"Issue 8: Log Storage Full","text":"<p>Symptoms:</p> <ul> <li>Elasticsearch disk usage high</li> <li>Write failures</li> <li>Slow queries</li> </ul> <p>Solution:</p> <pre><code># Implement lifecycle policy\nPUT _ilm/policy/mcp-mesh-logs-policy\n{\n  \"policy\": {\n    \"phases\": {\n      \"hot\": {\n        \"actions\": {\n          \"rollover\": {\n            \"max_age\": \"1d\",\n            \"max_size\": \"50GB\"\n          }\n        }\n      },\n      \"warm\": {\n        \"min_age\": \"2d\",\n        \"actions\": {\n          \"shrink\": {\n            \"number_of_shards\": 1\n          },\n          \"forcemerge\": {\n            \"max_num_segments\": 1\n          }\n        }\n      },\n      \"delete\": {\n        \"min_age\": \"30d\",\n        \"actions\": {\n          \"delete\": {}\n        }\n      }\n    }\n  }\n}\n\n# Force merge old indices\nPOST /mcp-mesh-logs-2024.01.*/_forcemerge?max_num_segments=1\n\n# Delete old data\nDELETE /mcp-mesh-logs-2023.*\n</code></pre>"},{"location":"07-observability/troubleshooting/#alerting-issues","title":"\ud83d\udea8 Alerting Issues","text":""},{"location":"07-observability/troubleshooting/#issue-9-alerts-not-firing","title":"Issue 9: Alerts Not Firing","text":"<p>Symptoms:</p> <ul> <li>Known problems but no alerts</li> <li>Alerts stuck in pending</li> <li>No notifications received</li> </ul> <p>Diagnosis:</p> <pre><code># Check alert rules\nkubectl exec -n monitoring prometheus-0 -- \\\n  promtool check rules /etc/prometheus/rules/*.yaml\n\n# Check pending alerts\ncurl -s http://localhost:9090/api/v1/rules | \\\n  jq '.data.groups[].rules[] | select(.state==\"pending\")'\n\n# Check AlertManager\nkubectl logs -n monitoring alertmanager-0\ncurl -s http://localhost:9093/api/v1/alerts\n</code></pre> <p>Solution:</p> <pre><code># Fix alert expressions\n# Ensure data exists\n- alert: ServiceDown\n  expr: up{job=\"mcp-mesh-registry\"} == 0 or absent(up{job=\"mcp-mesh-registry\"})\n  for: 2m\n\n# Fix AlertManager routing\nroute:\n  receiver: 'default'\n  group_by: ['alertname', 'cluster']\n  group_wait: 10s\n  group_interval: 10s\n  repeat_interval: 1h\n\n# Test configuration\namtool check-config alertmanager.yaml\namtool config routes test --config.file=alertmanager.yaml\n</code></pre>"},{"location":"07-observability/troubleshooting/#issue-10-alert-storm","title":"Issue 10: Alert Storm","text":"<p>Symptoms:</p> <ul> <li>Hundreds of alerts firing</li> <li>Notification channels flooded</li> <li>Real issues lost in noise</li> </ul> <p>Solution:</p> <pre><code># Implement alert grouping\nroute:\n  group_by: [\"alertname\", \"cluster\", \"service\"]\n  group_wait: 30s\n  group_interval: 5m\n\n# Add inhibition rules\ninhibit_rules:\n  - source_match:\n      severity: \"critical\"\n      alertname: \"ClusterDown\"\n    target_match_re:\n      severity: \"warning|info\"\n    equal: [\"cluster\"]\n\n  # Implement alert deduplication\n  - alert: HighErrorRate\n    expr: |\n      (\n        increase(errors_total[5m]) &gt; 100\n        AND\n        rate(errors_total[5m]) &gt; 0.05\n      )\n    # Don't alert on both conditions\n</code></pre>"},{"location":"07-observability/troubleshooting/#performance-optimization","title":"Performance Optimization","text":""},{"location":"07-observability/troubleshooting/#optimize-metric-collection","title":"Optimize Metric Collection","text":"<pre><code># Reduce scrape frequency for non-critical targets\nscrape_configs:\n  - job_name: \"mcp-mesh-agents\"\n    scrape_interval: 60s # Instead of default 30s\n\n# Drop unused metrics at collection time\nmetric_relabel_configs:\n  - source_labels: [__name__]\n    regex: \"go_gc_.*\"\n    action: drop\n</code></pre>"},{"location":"07-observability/troubleshooting/#optimize-query-performance","title":"Optimize Query Performance","text":"<pre><code># Use recording rules for expensive queries\ngroups:\n  - name: expensive_queries\n    interval: 30s\n    rules:\n    - record: instance:cpu_utilization:rate5m\n      expr: |\n        100 - (avg by (instance) (\n          irate(node_cpu_seconds_total{mode=\"idle\"}[5m])\n        ) * 100)\n</code></pre>"},{"location":"07-observability/troubleshooting/#optimize-storage","title":"Optimize Storage","text":"<pre><code># Prometheus storage optimization\n# Use compression\n--storage.tsdb.retention.size=100GB\n--storage.tsdb.wal-compression\n\n# Elasticsearch optimization\nPUT /_cluster/settings\n{\n  \"transient\": {\n    \"indices.memory.index_buffer_size\": \"20%\",\n    \"indices.queries.cache.size\": \"15%\"\n  }\n}\n</code></pre>"},{"location":"07-observability/troubleshooting/#emergency-procedures","title":"Emergency Procedures","text":""},{"location":"07-observability/troubleshooting/#prometheus-recovery","title":"Prometheus Recovery","text":"<pre><code>#!/bin/bash\n# prometheus-recovery.sh\n\n# 1. Stop Prometheus\nkubectl scale statefulset prometheus-prometheus -n monitoring --replicas=0\n\n# 2. Backup corrupted data\nkubectl exec -n monitoring prometheus-0 -- tar czf /tmp/backup.tgz /prometheus\nkubectl cp monitoring/prometheus-0:/tmp/backup.tgz ./prometheus-backup.tgz\n\n# 3. Clean WAL\nkubectl exec -n monitoring prometheus-0 -- rm -rf /prometheus/wal/*\n\n# 4. Restart\nkubectl scale statefulset prometheus-prometheus -n monitoring --replicas=1\n\n# 5. Verify\nkubectl logs -n monitoring prometheus-0 -f\n</code></pre>"},{"location":"07-observability/troubleshooting/#elasticsearch-recovery","title":"Elasticsearch Recovery","text":"<pre><code># Fix unassigned shards\nPOST /_cluster/reroute\n{\n  \"commands\": [{\n    \"allocate_empty_primary\": {\n      \"index\": \"mcp-mesh-logs-2024.01.15\",\n      \"shard\": 0,\n      \"node\": \"node-1\",\n      \"accept_data_loss\": true\n    }\n  }]\n}\n\n# Reset index\nPOST /mcp-mesh-logs-2024.01.15/_close\nPUT /mcp-mesh-logs-2024.01.15/_settings\n{\n  \"index.blocks.read_only_allow_delete\": null\n}\nPOST /mcp-mesh-logs-2024.01.15/_open\n</code></pre>"},{"location":"07-observability/troubleshooting/#monitoring-the-monitors","title":"Monitoring the Monitors","text":""},{"location":"07-observability/troubleshooting/#health-check-dashboard","title":"Health Check Dashboard","text":"<pre><code>{\n  \"dashboard\": {\n    \"title\": \"Observability Health\",\n    \"panels\": [\n      {\n        \"title\": \"Component Status\",\n        \"targets\": [\n          { \"expr\": \"up{job=~'prometheus|grafana|jaeger-.*|elasticsearch'}\" }\n        ]\n      },\n      {\n        \"title\": \"Data Ingestion Rates\",\n        \"targets\": [\n          { \"expr\": \"rate(prometheus_tsdb_samples_appended_total[5m])\" },\n          { \"expr\": \"rate(jaeger_collector_spans_received_total[5m])\" },\n          { \"expr\": \"rate(elasticsearch_indices_indexing_index_total[5m])\" }\n        ]\n      },\n      {\n        \"title\": \"Error Rates\",\n        \"targets\": [\n          { \"expr\": \"rate(prometheus_rule_evaluation_failures_total[5m])\" },\n          { \"expr\": \"rate(grafana_api_response_status_total{code!~'2..'}[5m])\" }\n        ]\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"07-observability/troubleshooting/#synthetic-monitoring","title":"Synthetic Monitoring","text":"<pre><code># synthetic_monitor.py\nimport requests\nimport time\nfrom prometheus_client import Counter, Histogram, push_to_gateway\n\n# Metrics\ncheck_duration = Histogram('observability_check_duration_seconds',\n                         'Duration of observability checks',\n                         ['component'])\ncheck_failures = Counter('observability_check_failures_total',\n                        'Total observability check failures',\n                        ['component'])\n\ndef check_prometheus():\n    start = time.time()\n    try:\n        r = requests.get('http://prometheus:9090/api/v1/query',\n                        params={'query': 'up'})\n        r.raise_for_status()\n        assert len(r.json()['data']['result']) &gt; 0\n    except Exception as e:\n        check_failures.labels(component='prometheus').inc()\n        raise\n    finally:\n        check_duration.labels(component='prometheus').observe(time.time() - start)\n\ndef check_grafana():\n    start = time.time()\n    try:\n        r = requests.get('http://grafana:3000/api/health')\n        r.raise_for_status()\n        assert r.json()['database'] == 'ok'\n    except Exception as e:\n        check_failures.labels(component='grafana').inc()\n        raise\n    finally:\n        check_duration.labels(component='grafana').observe(time.time() - start)\n\n# Run checks\nif __name__ == '__main__':\n    while True:\n        check_prometheus()\n        check_grafana()\n\n        # Push metrics\n        push_to_gateway('pushgateway:9091', job='synthetic_monitor')\n\n        time.sleep(60)\n</code></pre>"},{"location":"07-observability/troubleshooting/#prevention-best-practices","title":"Prevention Best Practices","text":"<ol> <li>Capacity Planning</li> </ol> <pre><code># Monitor growth rate\nprometheus_tsdb_symbol_table_size_bytes /\nprometheus_tsdb_storage_blocks_bytes\n</code></pre> <ol> <li>Regular Maintenance</li> </ol> <pre><code># Weekly: Check cardinality\n# Monthly: Review retention policies\n# Quarterly: Capacity review\n</code></pre> <ol> <li>Testing Changes</li> </ol> <pre><code># Test recording rules\npromtool test rules tests.yml\n\n# Test alerts\npromtool check rules alerts.yml\n</code></pre> <ol> <li>Documentation</li> <li>Keep runbooks updated</li> <li>Document custom metrics</li> <li>Maintain architecture diagrams</li> </ol>"},{"location":"07-observability/troubleshooting/#getting-help","title":"Getting Help","text":"<p>If you're still experiencing issues:</p> <ol> <li>Check Logs</li> </ol> <pre><code># Collect all observability logs\nfor component in prometheus grafana jaeger elasticsearch fluentd; do\n  echo \"=== $component logs ===\"\n  kubectl logs -n monitoring -l app.kubernetes.io/name=$component --tail=100\ndone &gt; observability-logs.txt\n</code></pre> <ol> <li> <p>Community Resources</p> </li> <li> <p>Prometheus: https://prometheus.io/community/</p> </li> <li>Grafana: https://community.grafana.com/</li> <li>Jaeger: https://www.jaegertracing.io/get-in-touch/</li> <li> <p>Elastic: https://discuss.elastic.co/</p> </li> <li> <p>File an Issue</p> </li> <li>Include diagnostic output</li> <li>Provide configuration files</li> <li>Describe expected vs actual behavior</li> </ol>"},{"location":"07-observability/troubleshooting/#summary","title":"Summary","text":"<p>This guide covered troubleshooting for all observability components:</p> <p>Key takeaways:</p> <ul> <li>\ud83d\udd0d Systematic diagnosis approach</li> <li>\ud83d\udd27 Component-specific solutions</li> <li>\ud83d\udcca Performance optimization techniques</li> <li>\ud83d\udea8 Emergency recovery procedures</li> </ul> <p>\ud83d\udca1 Remember: Good observability includes monitoring the monitoring stack itself</p> <p>\ud83d\udcda Reference: Component-specific troubleshooting guides in official documentation</p> <p>\ud83c\udd98 Emergency: If all monitoring is down, check node resources and kubelet logs first</p>"},{"location":"cli/","title":"meshctl CLI Reference","text":"<p>Command-line tool for MCP Mesh development and deployment</p>"},{"location":"cli/#installation","title":"Installation","text":"<p>Supported platforms: macOS, Linux (Windows users: use WSL or Git Bash)</p> npm (Recommended)Homebrewcurl <pre><code>npm install -g @mcpmesh/cli\n</code></pre> <pre><code>brew install dhyansraj/tap/meshctl\n</code></pre> <pre><code>curl -sSL https://raw.githubusercontent.com/dhyansraj/mcp-mesh/main/install.sh | bash\n</code></pre> <p>Verify installation:</p> <pre><code>meshctl --version\n</code></pre>"},{"location":"cli/#commands","title":"Commands","text":"Command Description <code>start</code> Start agents with mesh runtime <code>stop</code> Stop detached agents and registry <code>list</code> List running agents <code>status</code> Show detailed agent status <code>call</code> Call an MCP tool on an agent <code>trace</code> Display distributed call trace <code>logs</code> View agent logs (detached mode) <code>scaffold</code> Generate new agent from template <code>man</code> Show built-in documentation <code>config</code> Manage meshctl configuration <code>completion</code> Generate shell autocompletion"},{"location":"cli/#quick-reference","title":"Quick Reference","text":""},{"location":"cli/#start-agents","title":"Start Agents","text":"<pre><code>meshctl start my_agent.py              # Start Python agent\nmeshctl start src/index.ts             # Start TypeScript agent\nmeshctl start -w my_agent.py           # Hot reload on changes\nmeshctl start -d my_agent.py           # Detached (background)\nmeshctl start --debug my_agent.py      # Debug logging\nmeshctl start --registry-only          # Start registry only\nmeshctl start agent1.py agent2.ts      # Multiple agents\n</code></pre>"},{"location":"cli/#call-tools","title":"Call Tools","text":"<pre><code>meshctl call get_weather                    # Auto-discover agent\nmeshctl call add '{\"a\": 1, \"b\": 2}'         # With JSON args\nmeshctl call --trace get_weather            # With tracing\nmeshctl call weather-agent-7f3a:get_weather # Specific agent\n</code></pre>"},{"location":"cli/#inspect-mesh","title":"Inspect Mesh","text":"<pre><code>meshctl list                   # List healthy agents\nmeshctl list --all             # Include unhealthy\nmeshctl list --tools           # List all tools\nmeshctl list --tools=add       # Show tool schema\nmeshctl status                 # Show wiring details\nmeshctl status my-agent        # Specific agent\n</code></pre>"},{"location":"cli/#scaffold-agents","title":"Scaffold Agents","text":"<pre><code>meshctl scaffold                              # Interactive wizard\nmeshctl scaffold --name my-agent              # Python agent\nmeshctl scaffold --name my-agent -l ts        # TypeScript agent\nmeshctl scaffold --compose                    # Generate docker-compose\nmeshctl scaffold --compose --observability    # With tracing stack\n</code></pre>"},{"location":"cli/#view-documentation","title":"View Documentation","text":"<pre><code>meshctl man --list              # List all topics\nmeshctl man decorators          # Python decorators\nmeshctl man decorators -t       # TypeScript version\nmeshctl man deployment          # Deployment guide\n</code></pre>"},{"location":"cli/#manage-background-agents","title":"Manage Background Agents","text":"<pre><code>meshctl logs my-agent           # View logs\nmeshctl logs my-agent -f        # Follow logs\nmeshctl stop my-agent           # Stop specific agent\nmeshctl stop                    # Stop all + registry\n</code></pre>"},{"location":"cli/#detailed-help","title":"Detailed Help","text":"<p>Each command has comprehensive built-in help with examples:</p> <pre><code>meshctl --help              # All commands\nmeshctl start --help        # Start options\nmeshctl call --help         # Call options\nmeshctl scaffold --help     # Scaffold options\nmeshctl man --help          # Man page options\n</code></pre>"},{"location":"cli/#environment-variables","title":"Environment Variables","text":"Variable Description Default <code>MCP_MESH_REGISTRY_URL</code> Registry URL <code>http://localhost:8000</code> <code>MCP_MESH_LOG_LEVEL</code> Log level (TRACE/DEBUG/INFO/WARN/ERROR) <code>INFO</code> <code>MCP_MESH_HTTP_PORT</code> Agent HTTP port Auto-assigned <p>See Environment Variables for the full list.</p>"},{"location":"concepts/architecture/","title":"Architecture &amp; Design","text":"<p>Core architecture, agent coordination, and design philosophy</p>"},{"location":"concepts/architecture/#overview","title":"Overview","text":"<p>MCP Mesh is a distributed service mesh for MCP (Model Context Protocol) agents. It provides:</p> <ul> <li>Zero-boilerplate dependency injection between agents</li> <li>Automatic service discovery via a central registry</li> <li>Smart routing with tag-based selection</li> <li>Health monitoring with heartbeat and topology updates</li> </ul> <pre><code>graph TB\n    subgraph \"MCP Mesh\"\n        R[Registry]\n        A1[Agent 1]\n        A2[Agent 2]\n        A3[Agent 3]\n    end\n\n    A1 --&gt;|register| R\n    A2 --&gt;|register| R\n    A3 --&gt;|register| R\n    R --&gt;|discover| A1\n    A1 --&gt;|call| A2\n    A2 --&gt;|call| A3</code></pre>"},{"location":"concepts/architecture/#core-components","title":"Core Components","text":""},{"location":"concepts/architecture/#registry","title":"Registry","text":"<p>The registry is the central coordination point:</p> <ul> <li>Agent registration - Agents register on startup</li> <li>Capability tracking - Tracks what each agent provides</li> <li>Dependency resolution - Resolves capability dependencies</li> <li>Health monitoring - Tracks agent health via heartbeats</li> </ul>"},{"location":"concepts/architecture/#agents","title":"Agents","text":"<p>Agents are the workhorses of the mesh:</p> <ul> <li>Capabilities - Named services they provide</li> <li>Dependencies - Capabilities they consume</li> <li>Tags - Metadata for smart selection</li> <li>Health checks - Regular heartbeat to registry</li> </ul>"},{"location":"concepts/architecture/#proxies","title":"Proxies","text":"<p>Proxies handle inter-agent communication:</p> <ul> <li>SelfDependencyProxy - Same agent (direct call, no network overhead)</li> <li>EnhancedUnifiedMCPProxy - Cross-agent calls (auto-configured from decorator kwargs)</li> </ul>"},{"location":"concepts/architecture/#communication-flow","title":"Communication Flow","text":"<pre><code>sequenceDiagram\n    participant C as Consumer Agent\n    participant R as Registry\n    participant P as Provider Agent\n\n    C-&gt;&gt;R: 1. Register (capabilities, dependencies)\n    P-&gt;&gt;R: 2. Register (capabilities)\n    R-&gt;&gt;R: 3. Resolve dependencies\n    R-&gt;&gt;C: 4. Inject proxy for dependency\n    C-&gt;&gt;P: 5. Call via proxy\n    P-&gt;&gt;C: 6. Return result</code></pre>"},{"location":"concepts/architecture/#dependency-injection","title":"Dependency Injection","text":"<p>MCP Mesh uses automatic dependency injection based on capability names:</p> <ol> <li>Declaration: Agent declares dependencies</li> <li>Discovery: Registry finds matching providers</li> <li>Injection: Proxy injected at function call time</li> <li>Routing: Calls route through the mesh</li> </ol> <pre><code># Declaration\n@mesh.tool(dependencies=[\"database\"])\nasync def my_function(database=None):\n    # database is automatically injected!\n    result = await database(query=\"SELECT *\")\n</code></pre>"},{"location":"concepts/architecture/#service-discovery","title":"Service Discovery","text":""},{"location":"concepts/architecture/#capability-based","title":"Capability-Based","text":"<p>Agents find each other by capability name:</p> <pre><code># Provider\n@mesh.tool(capability=\"user_service\")\ndef get_user(): pass\n\n# Consumer\n@mesh.tool(dependencies=[\"user_service\"])\ndef my_function(user_service=None): pass\n</code></pre>"},{"location":"concepts/architecture/#tag-based-selection","title":"Tag-Based Selection","text":"<p>When multiple providers exist, tags determine selection:</p> <pre><code># Multiple providers\n@mesh.tool(capability=\"llm\", tags=[\"claude\", \"opus\"])\n@mesh.tool(capability=\"llm\", tags=[\"claude\", \"haiku\"])\n\n# Consumer selects\n@mesh.tool(dependencies=[{\"capability\": \"llm\", \"tags\": [\"+opus\"]}])\n</code></pre>"},{"location":"concepts/architecture/#health-topology","title":"Health &amp; Topology","text":""},{"location":"concepts/architecture/#heartbeat-system","title":"Heartbeat System","text":"<p>Agents send regular heartbeats to the registry:</p> <pre><code>Agent \u2192 Registry: heartbeat (every 30s default)\nRegistry: Update agent status, TTL\n</code></pre>"},{"location":"concepts/architecture/#topology-updates","title":"Topology Updates","text":"<p>When agents join/leave, the registry updates topology:</p> <ol> <li>New agent registers \u2192 Notify dependent agents</li> <li>Agent disconnects \u2192 Mark unhealthy, reroute</li> <li>Agent recovers \u2192 Restore routing</li> </ol>"},{"location":"concepts/architecture/#deployment-patterns","title":"Deployment Patterns","text":""},{"location":"concepts/architecture/#local-development","title":"Local Development","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           Developer Machine     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n\u2502  \u2502 Agent 1 \u2502  \u2502 Agent 2 \u2502      \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518      \u2502\n\u2502       \u2502            \u2502            \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502              \u2502                  \u2502\n\u2502       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502       \u2502  Registry  \u2502            \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"concepts/architecture/#docker-compose","title":"Docker Compose","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Docker Network          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n\u2502  \u2502 agent-1 \u2502  \u2502 agent-2 \u2502      \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518      \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502       \u2502  registry  \u2502            \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"concepts/architecture/#kubernetes","title":"Kubernetes","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Kubernetes Cluster         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  Agent Pod   \u2502  \u2502  Agent Pod   \u2502    \u2502\n\u2502  \u2502  (replicas)  \u2502  \u2502  (replicas)  \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502\n\u2502           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502           \u2502   Registry  \u2502               \u2502\n\u2502           \u2502   Service   \u2502               \u2502\n\u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"concepts/architecture/#design-principles","title":"Design Principles","text":""},{"location":"concepts/architecture/#1-zero-boilerplate","title":"1. Zero Boilerplate","text":"<p>No manual wiring, no service locators:</p> <pre><code># Just declare, mesh handles the rest\n@mesh.tool(dependencies=[\"service\"])\ndef my_function(service=None):\n    return service()\n</code></pre>"},{"location":"concepts/architecture/#2-graceful-degradation","title":"2. Graceful Degradation","text":"<p>Always handle missing dependencies:</p> <pre><code>if service is None:\n    return \"Fallback response\"\n</code></pre>"},{"location":"concepts/architecture/#3-protocol-agnostic","title":"3. Protocol Agnostic","text":"<p>Built on MCP, works with any MCP-compatible client.</p>"},{"location":"concepts/architecture/#4-cloud-native","title":"4. Cloud Native","text":"<p>Designed for containers and Kubernetes.</p>"},{"location":"concepts/architecture/#see-also","title":"See Also","text":"<ul> <li>Registry - Registry details</li> <li>Health &amp; Discovery - Health system</li> <li>Tag Matching - Selection algorithm</li> </ul>"},{"location":"concepts/health-discovery/","title":"Health &amp; Discovery","text":"<p>Heartbeat system, health checks, and topology updates</p>"},{"location":"concepts/health-discovery/#overview","title":"Overview","text":"<p>MCP Mesh maintains agent health through:</p> <ul> <li>Heartbeats - Regular pings to registry</li> <li>Health checks - Custom health functions</li> <li>Topology updates - Automatic rerouting on failures</li> </ul>"},{"location":"concepts/health-discovery/#heartbeat-system","title":"Heartbeat System","text":""},{"location":"concepts/health-discovery/#how-it-works","title":"How It Works","text":"<pre><code>sequenceDiagram\n    participant A as Agent\n    participant R as Registry\n\n    loop Every 30s (default)\n        A-&gt;&gt;R: POST /heartbeat\n        R-&gt;&gt;R: Update TTL\n        R-&gt;&gt;A: 200 OK\n    end\n\n    Note over R: If no heartbeat for 90s...\n    R-&gt;&gt;R: Mark agent unhealthy</code></pre>"},{"location":"concepts/health-discovery/#configuration","title":"Configuration","text":"<pre><code>@mesh.agent(\n    name=\"my-agent\",\n    health_interval=30,      # Heartbeat every 30s\n    auto_run_interval=10,    # Keep-alive every 10s\n)\n</code></pre> <pre><code>const agent = mesh(server, {\n  name: \"my-agent\",\n  heartbeatInterval: 30, // Heartbeat every 30s\n});\n</code></pre>"},{"location":"concepts/health-discovery/#health-checks","title":"Health Checks","text":""},{"location":"concepts/health-discovery/#custom-health-function-python","title":"Custom Health Function (Python)","text":"<pre><code>async def my_health_check():\n    \"\"\"Custom health check.\"\"\"\n    # Check database connection\n    if not db.is_connected():\n        return {\"status\": \"unhealthy\", \"reason\": \"db disconnected\"}\n\n    # Check memory\n    if memory_usage() &gt; 90:\n        return {\"status\": \"degraded\", \"reason\": \"high memory\"}\n\n    return {\"status\": \"healthy\"}\n\n@mesh.agent(\n    name=\"my-agent\",\n    health_check=my_health_check,\n    health_check_ttl=30,  # Cache health for 30s\n)\nclass MyAgent:\n    pass\n</code></pre>"},{"location":"concepts/health-discovery/#health-states","title":"Health States","text":"State Description <code>healthy</code> Agent is fully operational <code>degraded</code> Agent works but with issues <code>unhealthy</code> Agent cannot serve requests"},{"location":"concepts/health-discovery/#discovery","title":"Discovery","text":""},{"location":"concepts/health-discovery/#capability-discovery","title":"Capability Discovery","text":"<p>Agents discover each other by capability:</p> <pre><code># Provider registers capability\n@mesh.tool(capability=\"user_service\")\ndef get_user(): pass\n\n# Consumer discovers by capability\n@mesh.tool(dependencies=[\"user_service\"])\ndef my_function(user_service=None): pass\n</code></pre>"},{"location":"concepts/health-discovery/#tag-based-discovery","title":"Tag-Based Discovery","text":"<p>Filter by tags when multiple providers exist:</p> <pre><code>@mesh.tool(dependencies=[{\n    \"capability\": \"llm\",\n    \"tags\": [\"claude\", \"+opus\"]\n}])\n</code></pre>"},{"location":"concepts/health-discovery/#version-based-discovery","title":"Version-Based Discovery","text":"<p>Require specific versions:</p> <pre><code>@mesh.tool(dependencies=[{\n    \"capability\": \"api\",\n    \"version\": \"&gt;=2.0.0\"\n}])\n</code></pre>"},{"location":"concepts/health-discovery/#topology-updates","title":"Topology Updates","text":""},{"location":"concepts/health-discovery/#agent-joins","title":"Agent Joins","text":"<p>When a new agent registers:</p> <ol> <li>Registry stores agent info</li> <li>Dependent agents notified</li> <li>Proxies updated with new routes</li> </ol>"},{"location":"concepts/health-discovery/#agent-leaves","title":"Agent Leaves","text":"<p>When an agent disconnects:</p> <ol> <li>Heartbeat timeout detected</li> <li>Agent marked unhealthy</li> <li>Traffic rerouted to healthy instances</li> <li>Dependent agents notified</li> </ol>"},{"location":"concepts/health-discovery/#automatic-failover","title":"Automatic Failover","text":"<pre><code>graph LR\n    subgraph \"Before Failure\"\n        A1[Consumer] --&gt; B1[Provider A - healthy]\n        A1 -.-&gt; B2[Provider B - healthy]\n    end\n\n    subgraph \"After Failure\"\n        A2[Consumer] --&gt; B3[Provider B - healthy]\n        X[Provider A - unhealthy]\n    end</code></pre>"},{"location":"concepts/health-discovery/#monitoring","title":"Monitoring","text":""},{"location":"concepts/health-discovery/#registry-endpoints","title":"Registry Endpoints","text":"<pre><code># All agents\ncurl http://localhost:8000/agents\n\n# Specific agent\ncurl http://localhost:8000/agents/my-agent\n\n# Registry health\ncurl http://localhost:8000/health\n</code></pre>"},{"location":"concepts/health-discovery/#cli-commands","title":"CLI Commands","text":"<pre><code># List agents with status\nmeshctl list\n\n# Detailed status\nmeshctl status\n\n# Watch for changes\nmeshctl status --watch\n</code></pre>"},{"location":"concepts/health-discovery/#configuration_1","title":"Configuration","text":""},{"location":"concepts/health-discovery/#environment-variables","title":"Environment Variables","text":"<pre><code># Heartbeat interval (seconds)\nexport MCP_MESH_HEALTH_INTERVAL=30\n\n# Health check TTL (seconds)\nexport MCP_MESH_HEALTH_CHECK_TTL=30\n\n# Agent timeout (mark unhealthy after)\nexport MCP_MESH_AGENT_TIMEOUT=90\n</code></pre>"},{"location":"concepts/health-discovery/#best-practices","title":"Best Practices","text":""},{"location":"concepts/health-discovery/#1-implement-health-checks","title":"1. Implement Health Checks","text":"<pre><code>async def health():\n    # Check all critical dependencies\n    checks = {\n        \"database\": await check_db(),\n        \"cache\": await check_cache(),\n        \"memory\": check_memory(),\n    }\n\n    if all(c[\"ok\"] for c in checks.values()):\n        return {\"status\": \"healthy\", \"checks\": checks}\n    return {\"status\": \"degraded\", \"checks\": checks}\n</code></pre>"},{"location":"concepts/health-discovery/#2-handle-failures-gracefully","title":"2. Handle Failures Gracefully","text":"<pre><code>@mesh.tool(dependencies=[\"optional_service\"])\nasync def my_function(optional_service=None):\n    if optional_service is None:\n        # Fallback logic\n        return \"Fallback response\"\n    return await optional_service()\n</code></pre>"},{"location":"concepts/health-discovery/#3-use-appropriate-intervals","title":"3. Use Appropriate Intervals","text":"Use Case Heartbeat TTL Development 30s 90s Production 15s 45s High Availability 10s 30s"},{"location":"concepts/health-discovery/#troubleshooting","title":"Troubleshooting","text":""},{"location":"concepts/health-discovery/#agent-shows-unhealthy","title":"Agent Shows Unhealthy","text":"<pre><code># Check agent logs\nmeshctl start my_agent.py --log-level debug\n\n# Check heartbeat\ncurl http://localhost:8000/agents/my-agent\n</code></pre>"},{"location":"concepts/health-discovery/#discovery-not-working","title":"Discovery Not Working","text":"<pre><code># Verify registration\ncurl http://localhost:8000/agents | jq '.agents[] | {name, capabilities}'\n\n# Check namespace\ncurl http://localhost:8000/agents | jq '.agents[] | {name, namespace}'\n</code></pre>"},{"location":"concepts/health-discovery/#see-also","title":"See Also","text":"<ul> <li>Architecture - System overview</li> <li>Registry - Registry details</li> <li>Tag Matching - Selection algorithm</li> </ul>"},{"location":"concepts/registry/","title":"Registry","text":"<p>Central coordination point for agent discovery</p>"},{"location":"concepts/registry/#overview","title":"Overview","text":"<p>The registry is the brain of MCP Mesh:</p> <ul> <li>Tracks all registered agents</li> <li>Resolves capability dependencies</li> <li>Manages health status</li> <li>Provides discovery endpoints</li> </ul>"},{"location":"concepts/registry/#automatic-startup","title":"Automatic Startup","text":"<p>The registry starts automatically when you run your first agent:</p> <pre><code>meshctl start my_agent.py\n# Registry starts automatically on port 8000\n</code></pre>"},{"location":"concepts/registry/#manual-startup","title":"Manual Startup","text":"<p>For custom configurations:</p> <pre><code>meshctl registry start --port 8000 --host 0.0.0.0\n</code></pre>"},{"location":"concepts/registry/#registry-api","title":"Registry API","text":""},{"location":"concepts/registry/#list-agents","title":"List Agents","text":"<pre><code>curl http://localhost:8000/agents\n</code></pre> <p>Response:</p> <pre><code>{\n  \"agents\": [\n    {\n      \"name\": \"my-agent\",\n      \"host\": \"localhost\",\n      \"port\": 9090,\n      \"capabilities\": {\n        \"greeting\": {\n          \"version\": \"1.0.0\",\n          \"tags\": [\"social\"]\n        }\n      },\n      \"status\": \"healthy\"\n    }\n  ]\n}\n</code></pre>"},{"location":"concepts/registry/#get-agent-status","title":"Get Agent Status","text":"<pre><code>curl http://localhost:8000/agents/my-agent\n</code></pre>"},{"location":"concepts/registry/#health-check","title":"Health Check","text":"<pre><code>curl http://localhost:8000/health\n</code></pre>"},{"location":"concepts/registry/#agent-registration","title":"Agent Registration","text":"<p>Agents auto-register on startup:</p> <pre><code>sequenceDiagram\n    participant A as Agent\n    participant R as Registry\n\n    A-&gt;&gt;R: POST /register\n    Note right of R: Store agent info\n    R-&gt;&gt;A: 200 OK (agent ID)\n    loop Heartbeat\n        A-&gt;&gt;R: POST /heartbeat\n        R-&gt;&gt;A: 200 OK\n    end</code></pre>"},{"location":"concepts/registry/#registration-payload","title":"Registration Payload","text":"<pre><code>{\n  \"name\": \"my-agent\",\n  \"host\": \"localhost\",\n  \"port\": 9090,\n  \"namespace\": \"default\",\n  \"capabilities\": {\n    \"greeting\": {\n      \"version\": \"1.0.0\",\n      \"tags\": [\"social\", \"basic\"],\n      \"dependencies\": []\n    }\n  }\n}\n</code></pre>"},{"location":"concepts/registry/#dependency-resolution","title":"Dependency Resolution","text":"<p>When an agent registers with dependencies:</p> <ol> <li>Registry receives registration with <code>dependencies</code></li> <li>Finds agents providing those capabilities</li> <li>Returns proxy configurations to consumer</li> <li>Consumer uses proxies to call providers</li> </ol> <pre><code>graph LR\n    A[Consumer] --&gt;|depends on: database| R[Registry]\n    R --&gt;|finds| B[Provider: database]\n    R --&gt;|returns proxy config| A\n    A --&gt;|calls via proxy| B</code></pre>"},{"location":"concepts/registry/#configuration","title":"Configuration","text":""},{"location":"concepts/registry/#environment-variables","title":"Environment Variables","text":"<pre><code># Registry host/port\nexport MCP_MESH_REGISTRY_URL=http://localhost:8000\n\n# Custom registry host\nexport MCP_MESH_REGISTRY_HOST=0.0.0.0\nexport MCP_MESH_REGISTRY_PORT=8000\n\n# Health check settings\nexport MCP_MESH_HEALTH_INTERVAL=30\nexport MCP_MESH_HEALTH_TTL=90\n</code></pre>"},{"location":"concepts/registry/#docker-compose","title":"Docker Compose","text":"<pre><code>services:\n  registry:\n    image: mcpmesh/registry:latest\n    ports:\n      - \"8000:8000\"\n    environment:\n      - MCP_MESH_REGISTRY_HOST=0.0.0.0\n      - MCP_MESH_HEALTH_INTERVAL=30\n\n  my-agent:\n    build: ./my-agent\n    environment:\n      - MCP_MESH_REGISTRY_URL=http://registry:8000\n    depends_on:\n      - registry\n</code></pre>"},{"location":"concepts/registry/#namespaces","title":"Namespaces","text":"<p>Namespaces isolate agents:</p> <pre><code># Production namespace\n@mesh.agent(name=\"api\", namespace=\"production\")\n\n# Development namespace\n@mesh.agent(name=\"api\", namespace=\"development\")\n</code></pre> <p>Agents only discover others in the same namespace.</p>"},{"location":"concepts/registry/#high-availability","title":"High Availability","text":"<p>For production, run multiple registry instances:</p> <pre><code># docker-compose.yml\nservices:\n  registry-1:\n    image: mcpmesh/registry:latest\n    ports:\n      - \"8000:8000\"\n\n  registry-2:\n    image: mcpmesh/registry:latest\n    ports:\n      - \"8001:8000\"\n\n  # Load balancer in front\n</code></pre>"},{"location":"concepts/registry/#troubleshooting","title":"Troubleshooting","text":""},{"location":"concepts/registry/#agent-not-registering","title":"Agent Not Registering","text":"<pre><code># Check registry is running\ncurl http://localhost:8000/health\n\n# Check agent logs\nmeshctl start my_agent.py --log-level debug\n</code></pre>"},{"location":"concepts/registry/#dependency-not-found","title":"Dependency Not Found","text":"<pre><code># List all agents\ncurl http://localhost:8000/agents | jq '.agents[] | {name, capabilities: (.capabilities | keys)}'\n\n# Check capability exists\ncurl http://localhost:8000/agents | jq '.agents[] | select(.capabilities.my_capability)'\n</code></pre>"},{"location":"concepts/registry/#wrong-namespace","title":"Wrong Namespace","text":"<pre><code># Check agent namespace\ncurl http://localhost:8000/agents | jq '.agents[] | {name, namespace}'\n</code></pre>"},{"location":"concepts/registry/#see-also","title":"See Also","text":"<ul> <li>Architecture - System overview</li> <li>Health &amp; Discovery - Health system</li> <li>Environment Variables - All config options</li> </ul>"},{"location":"concepts/tag-matching/","title":"Tag Matching","text":"<p>Smart service selection with \u00b1 operators</p>"},{"location":"concepts/tag-matching/#overview","title":"Overview","text":"<p>When multiple providers offer the same capability, tags determine which one gets selected. MCP Mesh uses a scoring system with preference operators.</p>"},{"location":"concepts/tag-matching/#tag-operators","title":"Tag Operators","text":"Operator Prefix Meaning Effect Required none Must be present Provider rejected if missing Preferred <code>+</code> Bonus if present Higher score if present Excluded <code>-</code> Must NOT be present Provider rejected if present"},{"location":"concepts/tag-matching/#examples","title":"Examples","text":"<pre><code># Required: must have \"claude\"\n# Preferred: bonus for \"opus\"\n# Excluded: never use \"experimental\"\ntags = [\"claude\", \"+opus\", \"-experimental\"]\n</code></pre>"},{"location":"concepts/tag-matching/#scoring-algorithm","title":"Scoring Algorithm","text":""},{"location":"concepts/tag-matching/#point-values","title":"Point Values","text":"Tag Type Points Required (present) 5 points Preferred (present) 10 bonus points Preferred (missing) 0 points Excluded (present) Provider eliminated"},{"location":"concepts/tag-matching/#scoring-example","title":"Scoring Example","text":"<p>Available providers:</p> <pre><code># Provider A: claude-haiku\ntags = [\"claude\", \"haiku\", \"fast\"]\n\n# Provider B: claude-sonnet\ntags = [\"claude\", \"sonnet\", \"balanced\"]\n\n# Provider C: claude-opus\ntags = [\"claude\", \"opus\", \"premium\"]\n\n# Provider D: claude-experimental\ntags = [\"claude\", \"experimental\"]\n</code></pre> <p>Consumer request:</p> <pre><code>tags = [\"claude\", \"+opus\", \"-experimental\"]\n</code></pre> <p>Scoring:</p> Provider Calculation Score Result claude-haiku claude(5) 5 Candidate claude-sonnet claude(5) 5 Candidate claude-opus claude(5) + opus(10) 15 SELECTED claude-experimental ELIMINATED - Has \"experimental\""},{"location":"concepts/tag-matching/#use-cases","title":"Use Cases","text":""},{"location":"concepts/tag-matching/#cost-optimization","title":"Cost Optimization","text":"<pre><code># Prefer cheaper models, exclude premium\n@mesh.tool(dependencies=[{\n    \"capability\": \"llm\",\n    \"tags\": [\"claude\", \"+haiku\", \"-premium\"]\n}])\n</code></pre>"},{"location":"concepts/tag-matching/#quality-prioritization","title":"Quality Prioritization","text":"<pre><code># Prefer highest quality\n@mesh.tool(dependencies=[{\n    \"capability\": \"llm\",\n    \"tags\": [\"claude\", \"+opus\", \"+premium\"]\n}])\n</code></pre>"},{"location":"concepts/tag-matching/#production-safety","title":"Production Safety","text":"<pre><code># Never use experimental or beta\n@mesh.tool(dependencies=[{\n    \"capability\": \"database\",\n    \"tags\": [\"postgres\", \"-experimental\", \"-beta\", \"-staging\"]\n}])\n</code></pre>"},{"location":"concepts/tag-matching/#multi-preference","title":"Multi-Preference","text":"<pre><code># Multiple preferences (additive scoring)\n@mesh.tool(dependencies=[{\n    \"capability\": \"storage\",\n    \"tags\": [\n        \"s3\",          # Required\n        \"+fast\",       # Prefer fast\n        \"+ssd\",        # Prefer SSD\n        \"+replicated\", # Prefer replicated\n        \"-beta\"        # Exclude beta\n    ]\n}])\n</code></pre>"},{"location":"concepts/tag-matching/#tie-breaking","title":"Tie Breaking","text":"<p>When multiple providers have the same score:</p> <ol> <li>Version - Higher version wins</li> <li>Registration time - Earlier wins</li> <li>Random - If still tied</li> </ol>"},{"location":"concepts/tag-matching/#combining-with-versions","title":"Combining with Versions","text":"<p>Tags work with version constraints:</p> <pre><code>@mesh.tool(dependencies=[{\n    \"capability\": \"api\",\n    \"tags\": [\"rest\", \"+v2\", \"-deprecated\"],\n    \"version\": \"&gt;=2.0.0,&lt;3.0.0\"\n}])\n</code></pre> <p>Both tags AND version must match.</p>"},{"location":"concepts/tag-matching/#namespace-interaction","title":"Namespace Interaction","text":"<p>Tags operate within namespaces:</p> <pre><code>@mesh.tool(dependencies=[{\n    \"capability\": \"database\",\n    \"tags\": [\"+primary\"],\n    \"namespace\": \"production\"  # Only search production\n}])\n</code></pre>"},{"location":"concepts/tag-matching/#best-practices","title":"Best Practices","text":""},{"location":"concepts/tag-matching/#1-use-descriptive-tags","title":"1. Use Descriptive Tags","text":"<pre><code># \u2705 Good - clear categories\ntags = [\"llm\", \"claude\", \"sonnet\", \"balanced\", \"production\"]\n\n# \u274c Bad - vague\ntags = [\"service\", \"v1\"]\n</code></pre>"},{"location":"concepts/tag-matching/#2-required-preferred","title":"2. Required + Preferred","text":"<pre><code># \u2705 Good - required base, preferred optimization\ntags = [\"claude\", \"+opus\", \"+fast\"]\n\n# \u274c Bad - all required (too strict)\ntags = [\"claude\", \"opus\", \"fast\"]  # May find nothing\n</code></pre>"},{"location":"concepts/tag-matching/#3-safety-exclusions","title":"3. Safety Exclusions","text":"<pre><code># \u2705 Always exclude unsafe options in production\ntags = [\"database\", \"-experimental\", \"-beta\", \"-test\"]\n</code></pre>"},{"location":"concepts/tag-matching/#4-document-tag-conventions","title":"4. Document Tag Conventions","text":"<pre><code># Project tag conventions:\n# - llm providers: claude, openai, local\n# - quality tiers: haiku, sonnet, opus\n# - environments: production, staging, development\n# - stability: stable, beta, experimental\n</code></pre>"},{"location":"concepts/tag-matching/#debugging","title":"Debugging","text":""},{"location":"concepts/tag-matching/#check-available-tags","title":"Check Available Tags","text":"<pre><code>curl http://localhost:8000/agents | jq '.agents[].capabilities | to_entries[] | {capability: .key, tags: .value.tags}'\n</code></pre>"},{"location":"concepts/tag-matching/#test-matching","title":"Test Matching","text":"<pre><code># Use meshctl to test capability resolution\nmeshctl call my_tool  # See which provider was selected\n</code></pre>"},{"location":"concepts/tag-matching/#see-also","title":"See Also","text":"<ul> <li>Architecture - System overview</li> <li>Dependency Injection - DI patterns</li> <li>Capabilities &amp; Tags - Full reference</li> </ul>"},{"location":"python/","title":"Python SDK","text":"\ud83d\udcd8 Looking for TypeScript? See the TypeScript SDK <p>Build distributed MCP agents with Python decorators and zero boilerplate</p>"},{"location":"python/#overview","title":"Overview","text":"<p>The MCP Mesh Python SDK provides a decorator-based API for building distributed agent systems. Combined with FastMCP, you get:</p> <ul> <li><code>@mesh.tool</code> - Register capabilities with dependency injection</li> <li><code>@mesh.agent</code> - Configure agent servers with auto-run</li> <li><code>@mesh.llm</code> - LLM-powered tools with automatic tool discovery</li> <li><code>@mesh.llm_provider</code> - Zero-code LLM providers via LiteLLM</li> <li><code>@mesh.route</code> - FastAPI routes with mesh DI</li> </ul>"},{"location":"python/#installation","title":"Installation","text":"<pre><code># Install the SDK\npip install mcp-mesh\n\n# Install the CLI (required for development)\nnpm install -g @mcpmesh/cli\n</code></pre>"},{"location":"python/#quick-start","title":"Quick Start","text":"<pre><code># View the quick start guide\nmeshctl man quickstart\n\n# Or scaffold a new agent\nmeshctl scaffold --name my-agent\n</code></pre>"},{"location":"python/#documentation","title":"Documentation","text":"<p>For comprehensive documentation, use the built-in man pages:</p> <pre><code>meshctl man --list              # List all topics\nmeshctl man &lt;topic&gt;             # View a topic\nmeshctl man &lt;topic&gt; --raw       # Get markdown output (LLM-friendly)\n</code></pre>"},{"location":"python/#key-topics","title":"Key Topics","text":"Topic Command Description Quick Start <code>meshctl man quickstart</code> Get started in minutes Decorators <code>meshctl man decorators</code> @mesh.tool, @mesh.agent, @mesh.llm Dependency Injection <code>meshctl man di</code> How DI works LLM Integration <code>meshctl man llm</code> Build AI-powered agents Deployment <code>meshctl man deployment</code> Local, Docker, Kubernetes"},{"location":"python/#next-steps","title":"Next Steps","text":"Quick Start <p>Get your first agent running in 5 minutes</p> Start Tutorial \u2192 Decorators Reference <p>Complete API reference for all decorators</p> View Reference \u2192 LLM Integration <p>Build AI-powered agents</p> Learn More \u2192"},{"location":"python/capabilities-tags/","title":"Capabilities & Tags","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Capabilities"},{"location":"python/capabilities-tags/#capabilities-system","title":"Capabilities System","text":"<p>Named services that agents provide for discovery and dependency injection</p>"},{"location":"python/capabilities-tags/#overview","title":"Overview","text":"<p>Capabilities are named services that agents register with the mesh. When an agent declares a capability, other agents can discover and use it through dependency injection. Multiple agents can provide the same capability with different implementations.</p>"},{"location":"python/capabilities-tags/#capability-selector-syntax","title":"Capability Selector Syntax","text":"<p>MCP Mesh uses a unified syntax for selecting capabilities throughout the framework. This same pattern appears in <code>dependencies</code>, <code>@mesh.llm</code> provider/filter, <code>@mesh.route</code>, and <code>meshctl scaffold --filter</code>.</p>"},{"location":"python/capabilities-tags/#selector-fields","title":"Selector Fields","text":"Field Required Description <code>capability</code> Yes* Capability name to match <code>tags</code> No Tag filters with \u00b1 operators <code>version</code> No Semantic version constraint (e.g., <code>&gt;=2.0.0</code>) <p>*When filtering by tags only (e.g., LLM tool filter), <code>capability</code> can be omitted.</p>"},{"location":"python/capabilities-tags/#syntax-forms","title":"Syntax Forms","text":"<p>Shorthand (capability name only):</p> <pre><code>dependencies=[\"date_service\", \"weather_data\"]\n</code></pre> <p>Full form (with filters):</p> <pre><code>dependencies=[\n    {\"capability\": \"date_service\"},\n    {\"capability\": \"weather_data\", \"tags\": [\"+fast\", \"-deprecated\"]},\n    {\"capability\": \"api_client\", \"version\": \"&gt;=2.0.0\"},\n]\n</code></pre>"},{"location":"python/capabilities-tags/#where-this-syntax-is-used","title":"Where This Syntax Is Used","text":"Context Example <code>@mesh.tool</code> dependencies <code>dependencies=[\"svc\"]</code> or <code>[{\"capability\": \"svc\"}]</code> <code>@mesh.llm</code> provider <code>provider={\"capability\": \"llm\", \"tags\": [\"+claude\"]}</code> <code>@mesh.llm</code> filter <code>filter=[{\"capability\": \"calc\"}, {\"tags\": [\"tools\"]}]</code> <code>@mesh.route</code> dependencies <code>dependencies=[{\"capability\": \"api\", \"tags\": [\"+v2\"]}]</code> <code>meshctl scaffold --filter</code> <code>--filter '[{\"capability\": \"x\"}]'</code>"},{"location":"python/capabilities-tags/#tag-operators","title":"Tag Operators","text":"Prefix Meaning Example (none) Required <code>\"api\"</code> <code>+</code> Preferred <code>\"+fast\"</code> <code>-</code> Excluded <code>\"-deprecated\"</code>"},{"location":"python/capabilities-tags/#selector-logic-andor","title":"Selector Logic (AND/OR)","text":"Syntax Semantics <code>tags: [\"a\", \"b\", \"c\"]</code> a AND b AND c (all required) <code>tags: [\"+a\", \"+b\"]</code> Prefer a, prefer b (neither required) <code>tags: [\"a\", \"-x\"]</code> Must have a, must NOT have x <code>[{tags:[\"a\"]}, {tags:[\"b\"]}]</code> a OR b (multiple selectors) <p>See <code>meshctl man tags</code> for detailed tag matching behavior.</p>"},{"location":"python/capabilities-tags/#declaring-capabilities","title":"Declaring Capabilities","text":"<pre><code>@app.tool()\n@mesh.tool(\n    capability=\"weather_data\",           # Capability name\n    description=\"Provides weather info\", # Human-readable description\n    version=\"1.0.0\",                     # Semantic version\n    tags=[\"weather\", \"current\", \"api\"],  # Tags for filtering\n)\ndef get_weather(city: str) -&gt; dict:\n    return {\"city\": city, \"temp\": 72, \"conditions\": \"sunny\"}\n</code></pre>"},{"location":"python/capabilities-tags/#capability-resolution","title":"Capability Resolution","text":"<p>When an agent requests a dependency, the registry resolves it by:</p> <ol> <li>Name matching: Find agents providing the requested capability</li> <li>Tag filtering: Apply tag constraints (if specified)</li> <li>Version constraints: Check semantic version compatibility</li> <li>Load balancing: Select from multiple matching providers</li> </ol>"},{"location":"python/capabilities-tags/#multiple-implementations","title":"Multiple Implementations","text":"<p>Multiple agents can provide the same capability:</p> <pre><code># Agent 1: OpenWeather implementation\n@mesh.tool(\n    capability=\"weather_data\",\n    tags=[\"weather\", \"openweather\", \"free\"],\n)\ndef openweather_data(city: str): ...\n\n# Agent 2: Premium weather implementation\n@mesh.tool(\n    capability=\"weather_data\",\n    tags=[\"weather\", \"premium\", \"accurate\"],\n)\ndef premium_weather_data(city: str): ...\n</code></pre> <p>Consumers can select implementations using tag filters:</p> <pre><code>@mesh.tool(\n    dependencies=[{\"capability\": \"weather_data\", \"tags\": [\"+premium\"]}],\n)\ndef get_forecast(weather: mesh.McpMeshTool = None): ...\n</code></pre>"},{"location":"python/capabilities-tags/#dependency-declaration","title":"Dependency Declaration","text":""},{"location":"python/capabilities-tags/#simple-by-name","title":"Simple (by name)","text":"<pre><code>@mesh.tool(\n    dependencies=[\"date_service\", \"weather_data\"],\n)\ndef my_tool(date: mesh.McpMeshTool = None, weather: mesh.McpMeshTool = None):\n    pass\n</code></pre>"},{"location":"python/capabilities-tags/#advanced-with-filters","title":"Advanced (with filters)","text":"<pre><code>@mesh.tool(\n    dependencies=[\n        {\"capability\": \"date_service\"},\n        {\"capability\": \"weather_data\", \"tags\": [\"+accurate\", \"-deprecated\"]},\n    ],\n)\ndef my_tool(date: mesh.McpMeshTool = None, weather: mesh.McpMeshTool = None):\n    pass\n</code></pre>"},{"location":"python/capabilities-tags/#capability-naming-conventions","title":"Capability Naming Conventions","text":"Pattern Example Use Case <code>noun_noun</code> <code>weather_data</code> Data providers <code>verb_noun</code> <code>get_time</code> Action services <code>domain_action</code> <code>auth_validate</code> Domain-specific <code>service</code> <code>llm</code> Generic services"},{"location":"python/capabilities-tags/#versioning","title":"Versioning","text":"<p>Capabilities support semantic versioning:</p> <pre><code>@mesh.tool(\n    capability=\"api_client\",\n    version=\"2.1.0\",\n)\ndef api_v2(): ...\n</code></pre> <p>Consumers can specify version constraints (coming soon):</p> <pre><code>dependencies=[{\"capability\": \"api_client\", \"version\": \"&gt;=2.0.0\"}]\n</code></pre>"},{"location":"python/capabilities-tags/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man tags</code> - Tag matching system</li> <li><code>meshctl man dependency-injection</code> - How DI works</li> <li><code>meshctl man decorators</code> - All decorator options</li> </ul>"},{"location":"python/decorators/","title":"Decorators","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Decorators"},{"location":"python/decorators/#mcp-mesh-decorators","title":"MCP Mesh Decorators","text":"<p>Core decorators for building distributed agent systems</p> <p>Note: This page shows Python examples. TypeScript uses equivalent function-based APIs (<code>mesh()</code>, <code>mesh.llm()</code>, <code>mesh.route()</code>). See <code>meshctl man decorators --typescript</code> for TypeScript examples.</p>"},{"location":"python/decorators/#overview","title":"Overview","text":"<p>MCP Mesh provides core decorators (Python) and function wrappers (TypeScript) that transform regular functions into mesh-aware distributed services. These APIs handle registration, dependency injection, and communication automatically.</p> Decorator Purpose <code>@mesh.agent</code> Configure agent server settings <code>@mesh.tool</code> Register capability with DI <code>@mesh.llm</code> Enable LLM-powered tools <code>@mesh.llm_provider</code> Create LLM provider (zero-code) <code>@mesh.route</code> FastAPI route with mesh DI"},{"location":"python/decorators/#decorator-order-critical","title":"Decorator Order (Critical!)","text":"<p>When using multiple decorators, order matters:</p> <pre><code>@app.tool()           # 1. FastMCP protocol handler (outermost)\n@mesh.llm(...)        # 2. LLM integration (if using)\n@mesh.tool(...)       # 3. Mesh capability registration (innermost)\ndef my_function():\n    pass\n</code></pre>"},{"location":"python/decorators/#meshagent","title":"@mesh.agent","text":"<p>Configures the agent server settings. Applied to a class.</p> <pre><code>@mesh.agent(\n    name=\"my-service\",           # Required: unique agent identifier\n    version=\"1.0.0\",             # Semantic version\n    description=\"Service desc\",  # Human-readable description\n    http_port=8080,              # HTTP server port (0 = auto-assign)\n    http_host=\"localhost\",       # Host announced to registry\n    namespace=\"default\",         # Namespace for isolation\n    auto_run=True,               # Start automatically (no main() needed)\n    auto_run_interval=30,        # Heartbeat interval in seconds\n    health_check=health_fn,      # Optional health check function\n    health_check_ttl=30,         # Health check cache TTL\n)\nclass MyAgent:\n    pass\n</code></pre>"},{"location":"python/decorators/#meshtool","title":"@mesh.tool","text":"<p>Registers a function as a mesh capability with dependency injection.</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"greeting\",              # Capability name for discovery\n    description=\"Greets users\",         # Human-readable description\n    version=\"1.0.0\",                    # Capability version\n    tags=[\"greeting\", \"utility\"],       # Tags for filtering\n    dependencies=[\"date_service\"],      # Required capabilities\n)\nasync def greet(name: str, date_svc: mesh.McpMeshTool = None) -&gt; str:\n    if date_svc:\n        today = await date_svc()  # Must use await for proxy calls!\n        return f\"Hello {name}! Today is {today}\"\n    return f\"Hello {name}!\"  # Graceful degradation\n</code></pre> <p>Note: Functions with dependencies must be <code>async def</code> and proxy calls require <code>await</code>.</p>"},{"location":"python/decorators/#dependency-injection-types","title":"Dependency Injection Types","text":"Type Use Case <code>mesh.McpMeshTool</code> Tool calls via proxy <code>mesh.MeshLlmAgent</code> LLM agent injection (with <code>@mesh.llm</code>)"},{"location":"python/decorators/#meshllm","title":"@mesh.llm","text":"<p>Enables LLM-powered tools with automatic tool discovery.</p> <pre><code>@app.tool()\n@mesh.llm(\n    provider={\"capability\": \"llm\", \"tags\": [\"+claude\"]},  # LLM provider selector\n    max_iterations=5,                    # Max agentic loop iterations\n    system_prompt=\"file://prompts/agent.jinja2\",  # Jinja2 template\n    context_param=\"ctx\",                 # Parameter name for context\n    filter=[{\"tags\": [\"tools\"]}],        # Tool filter for discovery\n    filter_mode=\"all\",                   # \"all\", \"best_match\", or \"*\"\n)\n@mesh.tool(\n    capability=\"smart_assistant\",\n    description=\"LLM-powered assistant\",\n)\nasync def assist(ctx: AssistContext, llm: mesh.MeshLlmAgent = None) -&gt; AssistResponse:\n    return await llm(\"Help the user with their request\")\n</code></pre> <p>Note: Response format is determined by return type: <code>-&gt; str</code> for text, <code>-&gt; PydanticModel</code> for JSON.</p>"},{"location":"python/decorators/#filter-modes","title":"Filter Modes","text":"Mode Description <code>all</code> Include all tools matching any filter <code>best_match</code> One tool per capability (best tag match) <code>*</code> All available tools (wildcard)"},{"location":"python/decorators/#meshllm_provider","title":"@mesh.llm_provider","text":"<p>Creates a zero-code LLM provider wrapping LiteLLM.</p> <pre><code>@mesh.llm_provider(\n    model=\"anthropic/claude-sonnet-4-5\",  # LiteLLM model string\n    capability=\"llm\",                      # Capability name\n    tags=[\"llm\", \"claude\", \"provider\"],    # Discovery tags\n    version=\"1.0.0\",                       # Provider version\n)\ndef claude_provider():\n    pass  # No implementation needed\n</code></pre>"},{"location":"python/decorators/#meshroute","title":"@mesh.route","text":"<p>Enables mesh dependency injection in FastAPI route handlers. Use this when building REST APIs that consume mesh capabilities.</p> <pre><code>from fastapi import APIRouter, Request\nimport mesh\nfrom mesh.types import McpMeshTool\n\nrouter = APIRouter()\n\n@router.post(\"/chat\")\n@mesh.route(dependencies=[\"avatar_chat\"])\nasync def chat_endpoint(\n    request: Request,\n    message: str,\n    avatar_agent: McpMeshTool = None,  # Injected by mesh\n):\n    result = await avatar_agent(message=message, user_email=\"user@example.com\")\n    return {\"response\": result.get(\"message\")}\n</code></pre> <p>Note: <code>@mesh.route</code> is for FastAPI backends that consume mesh capabilities. Use <code>@mesh.tool</code> for MCP agents that provide capabilities.</p> <p>See <code>meshctl man fastapi</code> for complete FastAPI integration guide.</p>"},{"location":"python/decorators/#environment-variable-overrides","title":"Environment Variable Overrides","text":"<p>All decorator parameters can be overridden via environment variables:</p> <pre><code>export MCP_MESH_AGENT_NAME=custom-name\nexport MCP_MESH_HTTP_PORT=9090\nexport MCP_MESH_NAMESPACE=production\nexport MCP_MESH_AUTO_RUN=false\n</code></pre>"},{"location":"python/decorators/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man dependency-injection</code> - DI details</li> <li><code>meshctl man llm</code> - LLM integration guide</li> <li><code>meshctl man tags</code> - Tag matching system</li> <li><code>meshctl man capabilities</code> - Capabilities system</li> <li><code>meshctl man fastapi</code> - FastAPI integration with @mesh.route</li> </ul>"},{"location":"python/dependency-injection/","title":"Dependency Injection","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Dependency Injection"},{"location":"python/dependency-injection/#dependency-injection","title":"Dependency Injection","text":"<p>Automatic wiring of capabilities between agents</p>"},{"location":"python/dependency-injection/#overview","title":"Overview","text":"<p>MCP Mesh provides automatic dependency injection (DI) that connects agents based on their declared capabilities and dependencies. When a function declares a dependency, the mesh automatically creates a callable proxy that routes to the providing agent.</p>"},{"location":"python/dependency-injection/#how-it-works","title":"How It Works","text":"<ol> <li>Declaration: Function declares dependencies via <code>@mesh.tool</code> decorator</li> <li>Registration: Agent registers with registry, advertising capabilities</li> <li>Resolution: Registry matches dependencies to providers</li> <li>Injection: Mesh creates proxy objects for each dependency</li> <li>Invocation: Calling the proxy routes to the remote agent</li> </ol>"},{"location":"python/dependency-injection/#declaring-dependencies","title":"Declaring Dependencies","text":""},{"location":"python/dependency-injection/#simple-dependencies","title":"Simple Dependencies","text":"<pre><code>@app.tool()\n@mesh.tool(\n    capability=\"greeting\",\n    dependencies=[\"date_service\"],  # Request by capability name\n)\nasync def greet(name: str, date_service: mesh.McpMeshTool = None) -&gt; str:\n    if date_service:\n        today = await date_service()  # Must use await!\n        return f\"Hello {name}! Today is {today}\"\n    return f\"Hello {name}!\"\n</code></pre> <p>Important: Functions with dependencies must be <code>async def</code> and calls must use <code>await</code>.</p>"},{"location":"python/dependency-injection/#dependencies-with-filters","title":"Dependencies with Filters","text":"<p>Use the capability selector syntax (see <code>meshctl man capabilities</code>) to filter by tags or version:</p> <pre><code>@app.tool()\n@mesh.tool(\n    capability=\"report\",\n    dependencies=[\n        {\"capability\": \"data_service\", \"tags\": [\"+fast\"]},\n        {\"capability\": \"formatter\", \"tags\": [\"-deprecated\"]},\n    ],\n)\nasync def generate_report(\n    data_svc: mesh.McpMeshTool = None,\n    formatter: mesh.McpMeshTool = None,\n) -&gt; str:\n    data = await data_svc(query=\"sales\")\n    return await formatter(data=data)\n</code></pre>"},{"location":"python/dependency-injection/#injection-types","title":"Injection Types","text":""},{"location":"python/dependency-injection/#meshmcpmeshtool","title":"mesh.McpMeshTool","text":"<p>Callable proxy for tool invocations:</p> <pre><code>async def my_tool(helper: mesh.McpMeshTool = None):\n    result = await helper(arg1=\"value\")  # Direct call\n    result = await helper.call_tool(\"tool_name\", {\"arg\": \"value\"})  # Named tool\n</code></pre>"},{"location":"python/dependency-injection/#meshmeshllmagent","title":"mesh.MeshLlmAgent","text":"<p>For LLM agent injection in <code>@mesh.llm</code> decorated functions:</p> <pre><code>@mesh.llm(...)\ndef smart_tool(ctx: Context, llm: mesh.MeshLlmAgent = None):\n    response = llm(\"Process this request\")\n</code></pre>"},{"location":"python/dependency-injection/#graceful-degradation","title":"Graceful Degradation","text":"<p>Dependencies may be unavailable. Always handle <code>None</code>:</p> <pre><code>async def my_tool(helper: mesh.McpMeshTool = None):\n    if helper is None:\n        return \"Service temporarily unavailable\"\n    return await helper()\n</code></pre> <p>Or use default values:</p> <pre><code>async def get_time(date_service: mesh.McpMeshTool = None):\n    if date_service:\n        return await date_service()\n    return datetime.now().isoformat()  # Fallback\n</code></pre>"},{"location":"python/dependency-injection/#proxy-configuration","title":"Proxy Configuration","text":"<p>Configure proxy behavior via <code>dependency_kwargs</code>:</p> <pre><code>@mesh.tool(\n    dependencies=[\"slow_service\"],\n    dependency_kwargs={\n        \"slow_service\": {\n            \"timeout\": 60,           # Request timeout (seconds)\n            \"retry_count\": 3,        # Retry attempts\n            \"streaming\": True,       # Enable streaming\n            \"session_required\": True, # Require session affinity\n        }\n    },\n)\nasync def my_tool(slow_service: mesh.McpMeshTool = None):\n    result = await slow_service(data=\"large_payload\")\n    ...\n</code></pre>"},{"location":"python/dependency-injection/#proxy-types-auto-selected","title":"Proxy Types (Auto-Selected)","text":"<p>The mesh uses a unified proxy system:</p> Proxy Type Use Case <code>SelfDependencyProxy</code> Same agent (direct call, no network overhead) <code>EnhancedUnifiedMCPProxy</code> Cross-agent calls (auto-configured from kwargs)"},{"location":"python/dependency-injection/#function-vs-capability-names","title":"Function vs Capability Names","text":"<ul> <li>Capability name: Used for dependency resolution (<code>date_service</code>)</li> <li>Function name: Used in MCP tool calls (<code>get_current_time</code>)</li> </ul> <p>The mesh maps capabilities to their implementing functions automatically.</p>"},{"location":"python/dependency-injection/#auto-rewiring","title":"Auto-Rewiring","text":"<p>When topology changes (agents join/leave), the mesh:</p> <ol> <li>Detects change via heartbeat response</li> <li>Refreshes dependency proxies</li> <li>Routes to new providers automatically</li> </ol> <p>No code changes needed - happens transparently.</p>"},{"location":"python/dependency-injection/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man capabilities</code> - Declaring capabilities</li> <li><code>meshctl man tags</code> - Tag-based selection</li> <li><code>meshctl man health</code> - Health monitoring</li> <li><code>meshctl man proxies</code> - Proxy details</li> </ul>"},{"location":"python/examples/","title":"Examples & Testing","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Testing"},{"location":"python/examples/#testing-mcp-agents","title":"Testing MCP Agents","text":"<p>How to test MCP Mesh agents using meshctl and curl</p>"},{"location":"python/examples/#quick-way-meshctl-call","title":"Quick Way: meshctl call","text":"<pre><code>meshctl call hello_mesh_simple                    # Call tool by name (recommended)\nmeshctl call add '{\"a\": 1, \"b\": 2}'               # With arguments\nmeshctl list --tools                              # List all available tools\n</code></pre> <p>See <code>meshctl man cli</code> for more CLI commands.</p>"},{"location":"python/examples/#protocol-details-curl","title":"Protocol Details: curl","text":"<p>MCP agents expose a JSON-RPC 2.0 API over HTTP with Server-Sent Events (SSE) responses. This section shows the correct curl syntax - useful for understanding the underlying protocol.</p>"},{"location":"python/examples/#key-points","title":"Key Points","text":"<ul> <li>Endpoint: Always POST to <code>/mcp</code> (not REST-style paths like <code>/tools/list</code>)</li> <li>Method: Always <code>POST</code></li> <li>Headers: Must include both <code>Content-Type</code> AND <code>Accept</code> headers</li> <li>Body: JSON-RPC 2.0 format with <code>jsonrpc</code>, <code>id</code>, <code>method</code>, <code>params</code></li> <li>Response: Server-Sent Events format, requires parsing</li> </ul>"},{"location":"python/examples/#list-available-tools","title":"List Available Tools","text":"<pre><code>curl -s -X POST http://localhost:PORT/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": 1,\n    \"method\": \"tools/list\",\n    \"params\": {}\n  }'\n</code></pre>"},{"location":"python/examples/#call-a-tool-no-arguments","title":"Call a Tool (No Arguments)","text":"<pre><code>curl -s -X POST http://localhost:PORT/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": 1,\n    \"method\": \"tools/call\",\n    \"params\": {\n      \"name\": \"get_current_time\",\n      \"arguments\": {}\n    }\n  }'\n</code></pre>"},{"location":"python/examples/#call-a-tool-with-arguments","title":"Call a Tool (With Arguments)","text":"<pre><code>curl -s -X POST http://localhost:PORT/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": 1,\n    \"method\": \"tools/call\",\n    \"params\": {\n      \"name\": \"generate_report\",\n      \"arguments\": {\"title\": \"Test Report\", \"format\": \"markdown\"}\n    }\n  }'\n</code></pre>"},{"location":"python/examples/#available-mcp-methods","title":"Available MCP Methods","text":"Method Description <code>tools/list</code> List all available tools <code>tools/call</code> Invoke a tool with arguments <code>prompts/list</code> List available prompts <code>resources/list</code> List available resources <code>resources/read</code> Read a resource"},{"location":"python/examples/#response-format","title":"Response Format","text":"<p>MCP responses use Server-Sent Events (SSE) format:</p> <pre><code>data: {\"jsonrpc\":\"2.0\",\"id\":1,\"result\":{\"tools\":[...]}}\n</code></pre> <p>To parse the response, you can pipe through:</p> <pre><code>| grep \"^data:\" | sed 's/^data: //' | jq .\n</code></pre>"},{"location":"python/examples/#common-errors","title":"Common Errors","text":""},{"location":"python/examples/#missing-accept-header","title":"Missing Accept Header","text":"<pre><code>Error: Response not in expected format\nFix: Add -H \"Accept: application/json, text/event-stream\"\n</code></pre>"},{"location":"python/examples/#wrong-endpoint","title":"Wrong Endpoint","text":"<pre><code>Error: 404 Not Found\nFix: Use /mcp endpoint, not /tools/list or similar\n</code></pre>"},{"location":"python/examples/#invalid-json-rpc-format","title":"Invalid JSON-RPC Format","text":"<pre><code>Error: Invalid request\nFix: Ensure body has jsonrpc, id, method, and params fields\n</code></pre>"},{"location":"python/examples/#testing-in-docker-compose","title":"Testing in Docker Compose","text":"<p>Calls route through the registry proxy by default:</p> <pre><code>meshctl call greet\nmeshctl call add '{\"a\": 1, \"b\": 2}'\n\n# Bypass proxy (requires mapped ports)\nmeshctl call greet --use-proxy=false --agent-url http://localhost:9001\n</code></pre>"},{"location":"python/examples/#testing-in-kubernetes","title":"Testing in Kubernetes","text":"<p>For Kubernetes with ingress configured, use ingress mode:</p> <pre><code># With DNS configured for the ingress domain\nmeshctl call greet --ingress-domain mcp-mesh.local\n\n# Without DNS (direct IP or port-forwarded)\nmeshctl call greet --ingress-domain mcp-mesh.local --ingress-url http://localhost:9080\n</code></pre>"},{"location":"python/examples/#testing-with-meshctl","title":"Testing with meshctl","text":"<pre><code># Find agent ports\nmeshctl list\n\n# Check agent status\nmeshctl status --verbose\n</code></pre>"},{"location":"python/examples/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man cli</code> - CLI commands for development</li> <li><code>meshctl man decorators</code> - How to create tools</li> <li><code>meshctl man capabilities</code> - Understanding capabilities</li> </ul>"},{"location":"python/fastapi-integration/","title":"FastAPI Integration","text":"<p>Use mesh dependency injection in FastAPI backends with @mesh.route</p> <p>Note: This page covers Python/FastAPI integration. For TypeScript/Express, use <code>mesh.route()</code> middleware. See <code>meshctl man express</code> for Express examples.</p>"},{"location":"python/fastapi-integration/#overview","title":"Overview","text":"<p>MCP Mesh provides the <code>@mesh.route</code> decorator for FastAPI applications that need to consume mesh capabilities without being MCP agents themselves. This enables traditional REST APIs to leverage the mesh service layer.</p> <p>Important: This is for integrating MCP Mesh into your EXISTING FastAPI app. There is no <code>meshctl scaffold</code> command for FastAPI. To create a new MCP agent, use <code>meshctl scaffold</code> instead.</p> <p>TypeScript/Express: A similar <code>mesh.route()</code> middleware exists for Express applications. See <code>meshctl man express</code> for details.</p>"},{"location":"python/fastapi-integration/#installation","title":"Installation","text":"<pre><code>pip install mcp-mesh\n</code></pre>"},{"location":"python/fastapi-integration/#two-architectures","title":"Two Architectures","text":"Pattern Decorator Use Case MCP Agent <code>@mesh.tool</code> + <code>@mesh.agent</code> Service that provides capabilities FastAPI Backend <code>@mesh.route</code> REST API that consumes capabilities <pre><code>[Frontend] \u2192 [FastAPI Backend] \u2192 [MCP Mesh] \u2192 [Agents]\n                   \u2191\n            @mesh.route\n</code></pre>"},{"location":"python/fastapi-integration/#meshroute-decorator","title":"@mesh.route Decorator","text":"<pre><code>from fastapi import APIRouter, Request\nimport mesh\nfrom mesh.types import McpMeshTool\n\nrouter = APIRouter()\n\n@router.post(\"/chat\")\n@mesh.route(dependencies=[\"avatar_chat\"])\nasync def chat(\n    request: Request,\n    message: str,\n    avatar_agent: McpMeshTool = None,  # Injected by mesh\n):\n    result = await avatar_agent(\n        message=message,\n        user_email=\"user@example.com\",\n    )\n    return {\"response\": result.get(\"message\")}\n</code></pre>"},{"location":"python/fastapi-integration/#dependency-declaration","title":"Dependency Declaration","text":""},{"location":"python/fastapi-integration/#simple-by-capability-name","title":"Simple (by capability name)","text":"<pre><code>@mesh.route(dependencies=[\"user_service\", \"notification_service\"])\nasync def handler(\n    user_svc: McpMeshTool = None,\n    notif_svc: McpMeshTool = None,\n):\n    ...\n</code></pre>"},{"location":"python/fastapi-integration/#with-tag-filtering","title":"With Tag Filtering","text":"<pre><code>@mesh.route(dependencies=[\n    {\"capability\": \"llm\", \"tags\": [\"+claude\"]},\n    {\"capability\": \"storage\", \"tags\": [\"-deprecated\"]},\n])\nasync def handler(\n    llm_agent: McpMeshTool = None,\n    storage_agent: McpMeshTool = None,\n):\n    ...\n</code></pre>"},{"location":"python/fastapi-integration/#complete-example","title":"Complete Example","text":"<pre><code>from fastapi import FastAPI, APIRouter, Request, HTTPException\nimport mesh\nfrom mesh.types import McpMeshTool\nfrom pydantic import BaseModel\n\napp = FastAPI(title=\"My Backend\")\nrouter = APIRouter(prefix=\"/api\", tags=[\"api\"])\n\nclass ChatRequest(BaseModel):\n    message: str\n    avatar_id: str = \"default\"\n\nclass ChatResponse(BaseModel):\n    response: str\n    avatar_id: str\n\n@router.post(\"/chat\", response_model=ChatResponse)\n@mesh.route(dependencies=[\"avatar_chat\"])\nasync def chat_endpoint(\n    request: Request,\n    chat_req: ChatRequest,\n    avatar_agent: McpMeshTool = None,\n):\n    \"\"\"Chat endpoint that delegates to mesh avatar agent.\"\"\"\n    if avatar_agent is None:\n        raise HTTPException(503, \"Avatar service unavailable\")\n\n    result = await avatar_agent(\n        message=chat_req.message,\n        avatar_id=chat_req.avatar_id,\n        user_email=\"user@example.com\",\n    )\n\n    return ChatResponse(\n        response=result.get(\"message\", \"\"),\n        avatar_id=chat_req.avatar_id,\n    )\n\n@router.get(\"/history\")\n@mesh.route(dependencies=[\"conversation_history_get\"])\nasync def get_history(\n    request: Request,\n    avatar_id: str = \"default\",\n    limit: int = 50,\n    history_agent: McpMeshTool = None,\n):\n    \"\"\"Get conversation history from mesh agent.\"\"\"\n    result = await history_agent(\n        avatar_id=avatar_id,\n        limit=limit,\n    )\n    return {\"messages\": result.get(\"messages\", [])}\n\napp.include_router(router)\n</code></pre>"},{"location":"python/fastapi-integration/#running-your-fastapi-app","title":"Running Your FastAPI App","text":"<p>Run your existing FastAPI application as you normally would:</p> <pre><code>export MCP_MESH_REGISTRY_URL=http://localhost:8000\nuvicorn main:app --host 0.0.0.0 --port 8080\n</code></pre> <p>Note: Unlike MCP agents, FastAPI backends are NOT started with <code>meshctl start</code>.</p> <p>The backend will:</p> <ol> <li>Connect to the mesh registry on startup</li> <li>Resolve dependencies declared in <code>@mesh.route</code></li> <li>Inject <code>McpMeshTool</code> proxies into route handlers</li> <li>Re-resolve on topology changes (auto-rewiring)</li> </ol>"},{"location":"python/fastapi-integration/#key-differences-from-meshtool","title":"Key Differences from @mesh.tool","text":"Aspect @mesh.tool @mesh.route Registers with mesh Yes No Provides capabilities Yes No Consumes capabilities Yes Yes Has heartbeat Yes Yes (for dependency resolution) Protocol MCP JSON-RPC REST/HTTP Use case Microservice API Gateway/Backend"},{"location":"python/fastapi-integration/#when-to-use-meshroute","title":"When to Use @mesh.route","text":"<ul> <li>Building a REST API that fronts mesh services</li> <li>API gateway pattern</li> <li>Backend-for-Frontend (BFF) services</li> <li>Adding REST endpoints to existing FastAPI apps</li> <li>When you need traditional HTTP semantics (REST, OpenAPI docs)</li> </ul>"},{"location":"python/fastapi-integration/#when-to-use-meshtool-instead","title":"When to Use @mesh.tool Instead","text":"<ul> <li>Building reusable mesh capabilities</li> <li>Service-to-service communication</li> <li>LLM tool providers</li> <li>When other agents need to discover and call your service</li> </ul>"},{"location":"python/fastapi-integration/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man express</code> - TypeScript/Express equivalent</li> <li><code>meshctl man decorators</code> - All mesh decorators</li> <li><code>meshctl man dependency-injection</code> - How DI works</li> <li><code>meshctl man proxies</code> - Proxy configuration</li> </ul>"},{"location":"python/getting-started/","title":"Quick Start","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Quick Start"},{"location":"python/getting-started/#quick-start","title":"Quick Start","text":"<p>Get started with MCP Mesh in minutes (Python)</p>"},{"location":"python/getting-started/#prerequisites","title":"Prerequisites","text":"<pre><code># Python 3.11+\npython3 --version\n\n# Create virtual environment\npython3.11 -m venv .venv\nsource .venv/bin/activate\n\n# Install MCP Mesh SDK\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n</code></pre>"},{"location":"python/getting-started/#1-start-the-registry","title":"1. Start the Registry","text":"<pre><code># Terminal 1: Start registry\nmeshctl start --registry-only --debug\n</code></pre>"},{"location":"python/getting-started/#2-create-your-first-agent","title":"2. Create Your First Agent","text":"<pre><code># Terminal 2: Scaffold a basic agent\nmeshctl scaffold --name greeter --agent-type tool\n</code></pre> <p>This creates <code>greeter/main.py</code>:</p> <pre><code>import mesh\n\napp = mesh.get_app()\n\n@app.tool()\n@mesh.tool(\n    capability=\"greeting\",\n    description=\"Greet a user by name\",\n)\ndef greet(name: str) -&gt; str:\n    return f\"Hello, {name}!\"\n\n@mesh.agent(\n    name=\"greeter\",\n    version=\"1.0.0\",\n    http_port=9000,\n)\nclass GreeterAgent:\n    pass\n</code></pre>"},{"location":"python/getting-started/#3-run-the-agent","title":"3. Run the Agent","text":"<pre><code># Terminal 2: Start the agent\nmeshctl start greeter/main.py --debug\n</code></pre>"},{"location":"python/getting-started/#4-test-the-agent","title":"4. Test the Agent","text":"<pre><code># Terminal 3: Call the agent\nmeshctl call greeter greeting --params '{\"name\": \"World\"}'\n# Output: Hello, World!\n\n# Or list running agents\nmeshctl list\n</code></pre>"},{"location":"python/getting-started/#5-add-a-dependency","title":"5. Add a Dependency","text":"<p>Create a second agent that depends on the greeter:</p> <pre><code>meshctl scaffold --name assistant --agent-type tool\n</code></pre> <p>Edit <code>assistant/main.py</code>:</p> <pre><code>import mesh\n\napp = mesh.get_app()\n\n@app.tool()\n@mesh.tool(\n    capability=\"smart_greeting\",\n    description=\"Enhanced greeting with time\",\n    dependencies=[\"greeting\"],  # Depend on greeter\n)\nasync def smart_greet(\n    name: str,\n    greeting_svc: mesh.McpMeshTool = None,  # Injected!\n) -&gt; str:\n    if greeting_svc:\n        base_greeting = await greeting_svc(name=name)\n        return f\"{base_greeting} Welcome to MCP Mesh!\"\n    return f\"Hello, {name}! (greeter unavailable)\"\n\n@mesh.agent(\n    name=\"assistant\",\n    version=\"1.0.0\",\n    http_port=9001,\n)\nclass AssistantAgent:\n    pass\n</code></pre> <pre><code># Start the assistant\nmeshctl start assistant/main.py --debug\n\n# Call the smart greeting\nmeshctl call assistant smart_greeting --params '{\"name\": \"Developer\"}'\n# Output: Hello, Developer! Welcome to MCP Mesh!\n</code></pre>"},{"location":"python/getting-started/#next-steps","title":"Next Steps","text":"<ul> <li><code>meshctl man decorators</code> - Learn all mesh decorators</li> <li><code>meshctl man llm</code> - Add LLM capabilities</li> <li><code>meshctl man deployment</code> - Deploy to Docker/Kubernetes</li> <li><code>meshctl man tags</code> - Tag-based service selection</li> </ul>"},{"location":"python/getting-started/#see-also","title":"See Also","text":"<ul> <li><code>meshctl scaffold --help</code> - All scaffold options</li> <li><code>meshctl man prerequisites</code> - Full setup guide</li> </ul>"},{"location":"python/getting-started/prerequisites/","title":"Prerequisites","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Prerequisites"},{"location":"python/getting-started/prerequisites/#prerequisites","title":"Prerequisites","text":"<p>What you need before building MCP Mesh agents</p> <p>MCP Mesh supports both Python and TypeScript. Choose the language that fits your needs\u2014or use both in the same mesh.</p>"},{"location":"python/getting-started/prerequisites/#windows-users","title":"Windows Users","text":"<p><code>meshctl</code> and <code>mcp-mesh-registry</code> require a Unix-like environment on Windows:</p> <ul> <li>WSL2 (recommended) - Full Linux environment</li> <li>Git Bash - Lightweight option</li> </ul> <p>Alternatively, use Docker Desktop for containerized development.</p>"},{"location":"python/getting-started/prerequisites/#local-development","title":"Local Development","text":"<p>For developing and testing agents locally. Choose your preferred language:</p>"},{"location":"python/getting-started/prerequisites/#python-311","title":"Python 3.11+","text":"<pre><code># Check version\npython3 --version  # Need 3.11+\n\n# Install if needed\nbrew install python@3.11          # macOS\nsudo apt install python3.11       # Ubuntu/Debian\n</code></pre>"},{"location":"python/getting-started/prerequisites/#virtual-environment-recommended","title":"Virtual Environment (Recommended)","text":"<p>Create a virtual environment at your project root (where you run <code>meshctl</code>). All agents share this single venv - do not create separate venvs inside agent folders.</p> <p>Note: <code>meshctl</code> is a Go binary that auto-detects <code>.venv</code> in the current directory. You only need to activate the venv for <code>pip</code> commands - meshctl commands work without activation.</p> <pre><code># At project root - create venv (one-time setup)\npython3.11 -m venv .venv\n\n# Activate only when using pip\nsource .venv/bin/activate         # macOS/Linux\n.venv\\Scripts\\activate            # Windows\npip install --upgrade pip\n</code></pre>"},{"location":"python/getting-started/prerequisites/#mcp-mesh-sdk","title":"MCP Mesh SDK","text":"<pre><code>pip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n\n# Verify\npython -c \"import mesh; print('Ready!')\"\n</code></pre>"},{"location":"python/getting-started/prerequisites/#quick-start-python","title":"Quick Start (Python)","text":"<pre><code># 1. Create venv and install SDK (one-time setup)\npython3.11 -m venv .venv\nsource .venv/bin/activate    # Only needed for pip\npip install --upgrade pip\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\ndeactivate                   # Can deactivate after pip install\n\n# 2. Scaffold agents - meshctl auto-detects .venv (no activation needed)\nmeshctl scaffold --name hello --agent-type basic\nmeshctl scaffold --name assistant --agent-type llm-agent\n\n# 3. Run agent - meshctl uses .venv/bin/python automatically\nmeshctl start hello/main.py --debug\n</code></pre>"},{"location":"python/getting-started/prerequisites/#nodejs-18-for-typescript","title":"Node.js 18+ (for TypeScript)","text":"<pre><code># Check version\nnode --version   # Need 18+\nnpm --version\n\n# Install if needed\nbrew install node          # macOS\nsudo apt install nodejs    # Ubuntu/Debian\n</code></pre>"},{"location":"python/getting-started/prerequisites/#typescript-sdk","title":"TypeScript SDK","text":"<pre><code># In your agent directory\nnpm init -y\nnpm install @mcpmesh/sdk\n\n# Verify\nnpx tsx -e \"import { mesh } from '@mcpmesh/sdk'; console.log('Ready!')\"\n</code></pre>"},{"location":"python/getting-started/prerequisites/#quick-start-typescript","title":"Quick Start (TypeScript)","text":"<pre><code># 1. Scaffold TypeScript agent\nmeshctl scaffold --name hello --agent-type basic --lang typescript\n\n# 2. Install dependencies\ncd hello\nnpm install\n\n# 3. Run agent - meshctl uses npx tsx automatically\nmeshctl start src/index.ts --debug\n</code></pre>"},{"location":"python/getting-started/prerequisites/#docker-deployment","title":"Docker Deployment","text":"<p>For containerized deployments.</p>"},{"location":"python/getting-started/prerequisites/#docker-docker-compose","title":"Docker &amp; Docker Compose","text":"<pre><code># Check installation\ndocker --version\ndocker compose version\n</code></pre>"},{"location":"python/getting-started/prerequisites/#mcp-mesh-images","title":"MCP Mesh Images","text":"Image Description <code>mcpmesh/registry:0.8</code> Registry service <code>mcpmesh/python-runtime:0.8</code> Python runtime with SDK <code>mcpmesh/typescript-runtime:0.8</code> TypeScript runtime with SDK <pre><code># Pull images\ndocker pull mcpmesh/registry:0.8\ndocker pull mcpmesh/python-runtime:0.8\ndocker pull mcpmesh/typescript-runtime:0.8\n</code></pre>"},{"location":"python/getting-started/prerequisites/#generate-docker-compose","title":"Generate Docker Compose","text":"<pre><code>meshctl scaffold --compose              # Basic stack\nmeshctl scaffold --compose --observability  # With Grafana/Tempo\n</code></pre>"},{"location":"python/getting-started/prerequisites/#kubernetes-deployment","title":"Kubernetes Deployment","text":"<p>For production Kubernetes clusters.</p>"},{"location":"python/getting-started/prerequisites/#kubectl","title":"kubectl","text":"<pre><code>kubectl version --client\n</code></pre>"},{"location":"python/getting-started/prerequisites/#helm-3","title":"Helm 3+","text":"<pre><code>helm version\n</code></pre>"},{"location":"python/getting-started/prerequisites/#mcp-mesh-helm-charts","title":"MCP Mesh Helm Charts","text":"<p>Available from OCI registry (no <code>helm repo add</code> needed):</p> Chart Description <code>oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-core</code> Registry + DB + Observability <code>oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-agent</code> Deploy agents <pre><code># Install core infrastructure\nhelm install mcp-core oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-core \\\n  --version 0.8.0-beta.6 \\\n  -n mcp-mesh --create-namespace\n\n# Deploy an agent\nhelm install my-agent oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-agent \\\n  --version 0.8.0-beta.6 \\\n  -n mcp-mesh \\\n  -f helm-values.yaml\n</code></pre>"},{"location":"python/getting-started/prerequisites/#cluster-options","title":"Cluster Options","text":"<ul> <li>Minikube - Local testing</li> <li>Kind - Lightweight local clusters</li> <li>Cloud - GKE, EKS, AKS for production</li> </ul>"},{"location":"python/getting-started/prerequisites/#version-compatibility","title":"Version Compatibility","text":"Component Minimum Recommended Python 3.11 3.12 Node.js 18 20+ Docker 20.10 Latest Kubernetes 1.25 1.28+ Helm 3.10 3.14+"},{"location":"python/getting-started/prerequisites/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man deployment</code> - Deployment patterns</li> <li><code>meshctl man environment</code> - Configuration options</li> <li><code>meshctl scaffold --help</code> - Generate agents</li> </ul>"},{"location":"python/llm/","title":"LLM Integration","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript LLM Integration"},{"location":"python/llm/#llm-integration","title":"LLM Integration","text":"<p>Building LLM-powered agents with @mesh.llm decorator</p> <p>Note: This page shows Python examples. TypeScript uses equivalent <code>mesh.llm()</code> function wrapper. See <code>meshctl man llm --typescript</code> for TypeScript examples.</p>"},{"location":"python/llm/#overview","title":"Overview","text":"<p>MCP Mesh provides first-class support for LLM-powered agents through the <code>@mesh.llm</code> decorator (Python) or <code>mesh.llm()</code> wrapper (TypeScript). This enables agentic loops where LLMs can discover and use mesh tools automatically.</p>"},{"location":"python/llm/#whats-included","title":"What's Included","text":"<p>The <code>mcp-mesh</code> package includes LLM support out of the box via LiteLLM:</p> <ul> <li>Claude (Anthropic)</li> <li>GPT (OpenAI)</li> <li>And 100+ other providers via LiteLLM</li> </ul> <p>No additional packages needed. Just set your API keys:</p> <pre><code>export ANTHROPIC_API_KEY=sk-ant-...\nexport OPENAI_API_KEY=sk-...\n</code></pre>"},{"location":"python/llm/#meshllm-decorator","title":"@mesh.llm Decorator","text":"<pre><code>@app.tool()\n@mesh.llm(\n    provider={\"capability\": \"llm\", \"tags\": [\"+claude\"]},\n    max_iterations=5,\n    system_prompt=\"file://prompts/assistant.jinja2\",\n    context_param=\"ctx\",\n    filter=[{\"tags\": [\"tools\"]}],\n    filter_mode=\"all\",\n)\n@mesh.tool(\n    capability=\"smart_assistant\",\n    description=\"LLM-powered assistant\",\n)\ndef assist(ctx: AssistContext, llm: mesh.MeshLlmAgent = None) -&gt; AssistResponse:\n    return llm(\"Help the user with their request\")\n</code></pre>"},{"location":"python/llm/#parameters","title":"Parameters","text":"Parameter Type Description <code>provider</code> dict LLM provider selector (capability + tags) <code>max_iterations</code> int Max agentic loop iterations (default: 1) <code>system_prompt</code> str Inline prompt or <code>file://path</code> to Jinja2 template <code>context_param</code> str Parameter name receiving context object <code>filter</code> list Tool filter criteria <code>filter_mode</code> str <code>\"all\"</code>, <code>\"best_match\"</code>, or <code>\"*\"</code> <code>&lt;llm_params&gt;</code> any LiteLLM params (max_tokens, temperature, etc.) <p>Note: <code>provider</code> and <code>filter</code> use the capability selector syntax (<code>capability</code>, <code>tags</code>, <code>version</code>). See <code>meshctl man capabilities</code> for details.</p> <p>Note: Response format is determined by the function's return type annotation, not a parameter. See Response Formats.</p>"},{"location":"python/llm/#llm-model-parameters","title":"LLM Model Parameters","text":"<p>Pass any LiteLLM parameter in the decorator as defaults:</p> <pre><code>@mesh.llm(\n    provider={\"capability\": \"llm\"},\n    max_tokens=16000,\n    temperature=0.7,\n    top_p=0.9,\n)\ndef assist(ctx, llm = None):\n    # Uses decorator defaults\n    return llm(\"Help the user\")\n\n    # Override at call time\n    return llm(\"Help\", max_tokens=8000)\n</code></pre> <p>Call-time parameters take precedence over decorator defaults.</p>"},{"location":"python/llm/#response-metadata","title":"Response Metadata","text":"<p>LLM results include <code>_mesh_meta</code> for cost tracking and debugging:</p> <pre><code>result = await llm(\"Analyze this\")\nprint(result._mesh_meta.model)          # \"openai/gpt-4o\"\nprint(result._mesh_meta.input_tokens)   # 100\nprint(result._mesh_meta.output_tokens)  # 50\nprint(result._mesh_meta.latency_ms)     # 125.5\n</code></pre>"},{"location":"python/llm/#llm-provider-selection","title":"LLM Provider Selection","text":"<p>Select LLM provider using capability and tags:</p> <pre><code># Prefer Claude\nprovider={\"capability\": \"llm\", \"tags\": [\"+claude\"]}\n\n# Require OpenAI\nprovider={\"capability\": \"llm\", \"tags\": [\"openai\"]}\n\n# Any LLM provider\nprovider={\"capability\": \"llm\"}\n</code></pre>"},{"location":"python/llm/#model-override","title":"Model Override","text":"<p>Override provider's default model at the consumer:</p> <pre><code>@mesh.llm(\n    provider={\"capability\": \"llm\", \"tags\": [\"+claude\"]},\n    model=\"anthropic/claude-haiku\",  # Override provider default\n)\ndef fast_assist(ctx, llm = None):\n    return llm(\"Quick response needed\")\n</code></pre> <p>Vendor mismatch (e.g., requesting OpenAI model from Claude provider) logs a warning and falls back to provider default.</p>"},{"location":"python/llm/#creating-llm-providers","title":"Creating LLM Providers","text":"<p>Use <code>@mesh.llm_provider</code> for zero-code LLM providers:</p> <pre><code>@mesh.llm_provider(\n    model=\"anthropic/claude-sonnet-4-5\",\n    capability=\"llm\",\n    tags=[\"llm\", \"claude\", \"provider\"],\n    version=\"1.0.0\",\n)\ndef claude_provider():\n    pass  # No implementation needed\n\n@mesh.agent(name=\"claude-provider\", http_port=9110)\nclass ClaudeProviderAgent:\n    pass\n</code></pre>"},{"location":"python/llm/#supported-models-litellm","title":"Supported Models (LiteLLM)","text":"<pre><code>anthropic/claude-sonnet-4-5\nanthropic/claude-sonnet-4-20250514\nopenai/gpt-4o\nopenai/gpt-4-turbo\nopenai/gpt-3.5-turbo\n</code></pre>"},{"location":"python/llm/#tool-filtering","title":"Tool Filtering","text":"<p>Control which mesh tools the LLM can access using <code>filter</code> and <code>filter_mode</code>:</p> <pre><code>filter=[{\"tags\": [\"tools\"]}],      # By tags\nfilter=[{\"capability\": \"calc\"}],   # By capability\nfilter_mode=\"*\",                   # All tools (wildcard)\n# Omit filter for no tools (LLM only)\n</code></pre> <p>For tag operators (\u00b1), matching algorithm, and advanced patterns, see <code>meshctl man tags</code>.</p>"},{"location":"python/llm/#system-prompts","title":"System Prompts","text":""},{"location":"python/llm/#inline-prompt","title":"Inline Prompt","text":"<pre><code>system_prompt=\"You are a helpful assistant. Analyze the input and respond.\"\n</code></pre>"},{"location":"python/llm/#jinja2-template-file","title":"Jinja2 Template File","text":"<pre><code>system_prompt=\"file://prompts/assistant.jinja2\"\n</code></pre> <p>Template example:</p> <pre><code>You are {{ agent_name }}, an AI assistant.\n\n## Context\n{{ input_text }}\n\n## Instructions\nAnalyze the input and provide a helpful response.\nAvailable tools: {{ tools | join(\", \") }}\n</code></pre> <p>Note: Context fields are accessed directly (<code>{{ input_text }}</code>), not via prefix.</p>"},{"location":"python/llm/#context-objects","title":"Context Objects","text":"<p>Define typed context with Pydantic:</p> <pre><code>from pydantic import BaseModel, Field\n\nclass AssistContext(BaseModel):\n    input_text: str = Field(..., description=\"User's request\")\n    user_id: str = Field(default=\"anonymous\")\n    preferences: dict = Field(default_factory=dict)\n\n@mesh.llm(context_param=\"ctx\", ...)\ndef assist(ctx: AssistContext, llm: mesh.MeshLlmAgent = None):\n    return llm(f\"Help with: {ctx.input_text}\")\n</code></pre>"},{"location":"python/llm/#response-formats","title":"Response Formats","text":"<p>Response format is determined by the return type annotation - not a decorator parameter.</p> Return Type Output Description <code>-&gt; str</code> Plain text LLM returns unstructured text <code>-&gt; PydanticModel</code> Structured JSON LLM returns validated object"},{"location":"python/llm/#text-response","title":"Text Response","text":"<pre><code>@mesh.llm(provider={\"capability\": \"llm\"}, ...)\n@mesh.tool(capability=\"summarize\")\ndef summarize(ctx: SummaryContext, llm: mesh.MeshLlmAgent = None) -&gt; str:\n    return llm(\"Summarize the input\")  # Returns plain text\n</code></pre>"},{"location":"python/llm/#structured-json-response","title":"Structured JSON Response","text":"<pre><code>class AssistResponse(BaseModel):\n    answer: str\n    confidence: float\n    sources: list[str]\n\n@mesh.llm(provider={\"capability\": \"llm\"}, ...)\n@mesh.tool(capability=\"smart_assistant\")\ndef assist(ctx: AssistContext, llm: mesh.MeshLlmAgent = None) -&gt; AssistResponse:\n    return llm(\"Analyze and respond\")  # Returns validated Pydantic object\n</code></pre>"},{"location":"python/llm/#agentic-loops","title":"Agentic Loops","text":"<p>Set <code>max_iterations</code> for multi-step reasoning:</p> <pre><code>@mesh.llm(\n    max_iterations=10,  # Allow up to 10 tool calls\n    filter=[{\"tags\": [\"tools\"]}],\n)\ndef complex_task(ctx: TaskContext, llm: mesh.MeshLlmAgent = None):\n    return llm(\"Complete this multi-step task\")\n</code></pre> <p>The LLM will:</p> <ol> <li>Analyze the request</li> <li>Call discovered tools as needed</li> <li>Use tool results for further reasoning</li> <li>Return final response</li> </ol>"},{"location":"python/llm/#runtime-context-injection","title":"Runtime Context Injection","text":"<p>Pass additional context at call time to merge with or override auto-populated context:</p> <pre><code>@mesh.llm(\n    system_prompt=\"file://prompts/assistant.jinja2\",\n    context_param=\"ctx\",\n)\ndef assist(ctx: AssistContext, llm: mesh.MeshLlmAgent = None):\n    # Default: uses ctx from context_param\n    return llm(\"Help the user\")\n\n    # Add extra context (runtime wins on conflicts)\n    return llm(\"Help\", context={\"extra_info\": \"value\"})\n\n    # Auto context wins on conflicts\n    return llm(\"Help\", context={\"extra\": \"value\"}, context_mode=\"prepend\")\n\n    # Replace context entirely\n    return llm(\"Help\", context={\"only\": \"this\"}, context_mode=\"replace\")\n</code></pre>"},{"location":"python/llm/#context-modes","title":"Context Modes","text":"Mode Behavior <code>append</code> auto_context | runtime_context (default) <code>prepend</code> runtime_context | auto_context (auto wins) <code>replace</code> runtime_context only (ignores auto)"},{"location":"python/llm/#use-cases","title":"Use Cases","text":"<p>Multi-turn conversations with state:</p> <pre><code>async def chat(ctx: ChatContext, llm: mesh.MeshLlmAgent = None):\n    # First turn\n    response1 = await llm(\"Hello\", context={\"turn\": 1})\n\n    # Second turn with accumulated context\n    response2 = await llm(\"Continue\", context={\"turn\": 2, \"prev\": response1})\n\n    return response2\n</code></pre> <p>Conditional context:</p> <pre><code>async def assist(ctx: AssistContext, llm: mesh.MeshLlmAgent = None):\n    extra = {\"premium\": True} if ctx.user.is_premium else {}\n    return await llm(\"Help\", context=extra)\n</code></pre> <p>Clear context when not needed:</p> <pre><code># Explicitly clear all context\nreturn await llm(\"Standalone query\", context={}, context_mode=\"replace\")\n</code></pre>"},{"location":"python/llm/#scaffolding-llm-agents","title":"Scaffolding LLM Agents","text":"<pre><code># Generate LLM agent\nmeshctl scaffold --name my-agent --agent-type llm-agent --llm-selector claude\n\n# Generate LLM provider\nmeshctl scaffold --name claude-provider --agent-type llm-provider --model anthropic/claude-sonnet-4-5\n</code></pre>"},{"location":"python/llm/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man decorators</code> - All decorator options</li> <li><code>meshctl man tags</code> - Tag matching for providers</li> <li><code>meshctl man testing</code> - Testing LLM agents</li> </ul>"},{"location":"python/local-development/","title":"Local Development (Python)","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Local Development <p>Develop MCP Mesh agents locally with Python</p>"},{"location":"python/local-development/#development-workflow","title":"Development Workflow","text":"<pre><code>graph LR\n    A[Install] --&gt; B[Scaffold]\n    B --&gt; C[Run]\n    C --&gt; D[Call &amp; Debug]\n    D --&gt; C</code></pre>"},{"location":"python/local-development/#guides","title":"Guides","text":"Guide What You'll Learn Getting Started Install meshctl CLI and Python SDK Scaffold Agents Generate agents with <code>meshctl scaffold</code> Run Agents Start agents with hot reload, debug mode Inspect the Mesh View agents, tools, and dependencies Call &amp; Debug Tools Call tools and trace distributed calls Troubleshooting Common issues and solutions"},{"location":"python/local-development/#quick-reference","title":"Quick Reference","text":"<pre><code># Install CLI\nnpm install -g @mcpmesh/cli\n\n# Set up Python (at project root)\npython3 -m venv .venv\nsource .venv/bin/activate\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\ndeactivate  # meshctl auto-detects .venv\n\n# Scaffold (interactive wizard)\nmeshctl scaffold\n\n# Run\nmeshctl start main.py\nmeshctl start -w main.py          # hot reload\nmeshctl start --debug main.py     # debug mode\n\n# Inspect\nmeshctl list                      # agents\nmeshctl list --tools              # all tools\nmeshctl status                    # wiring details\n\n# Call\nmeshctl call get_weather '{\"city\":\"London\"}'\nmeshctl call --trace get_weather  # with tracing\n\n# Debug\nmeshctl trace &lt;trace-id&gt;          # view call tree\nmeshctl logs my-agent -f          # follow logs\nmeshctl man --list                # built-in docs\n</code></pre>"},{"location":"python/local-development/01-getting-started/","title":"Getting Started (Python)","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Getting Started <p>Install meshctl CLI and Python SDK</p>"},{"location":"python/local-development/01-getting-started/#prerequisites","title":"Prerequisites","text":"<ul> <li>Node.js 18+ - for meshctl CLI</li> <li>Python 3.11+ - for agent development</li> </ul>"},{"location":"python/local-development/01-getting-started/#install-meshctl-cli","title":"Install meshctl CLI","text":"<pre><code>npm install -g @mcpmesh/cli\n\n# Verify\nmeshctl --version\n</code></pre>"},{"location":"python/local-development/01-getting-started/#set-up-python-environment","title":"Set Up Python Environment","text":"<p>Create a virtual environment at your project root. All agents share this single venv\u2014don't create separate venvs inside agent folders.</p> <pre><code># Create project directory\nmkdir my-mesh-project\ncd my-mesh-project\n\n# Create venv (one-time setup)\npython3 -m venv .venv\n\n# Activate only for pip commands\nsource .venv/bin/activate         # macOS/Linux\n# .venv\\Scripts\\activate          # Windows\n\n# Install SDK\npip install --upgrade pip\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n\n# Verify\npython -c \"import mesh; print('Ready!')\"\n\n# Can deactivate after pip install\ndeactivate\n</code></pre> <p>meshctl auto-detects .venv</p> <p><code>meshctl</code> is a Go binary that auto-detects <code>.venv</code> in the current directory. You only need to activate the venv for <code>pip</code> commands\u2014meshctl commands work without activation.</p>"},{"location":"python/local-development/01-getting-started/#quick-start","title":"Quick Start","text":"<pre><code># 1. Scaffold an agent (interactive wizard)\nmeshctl scaffold\n\n# 2. Edit hello/main.py to implement your tool logic\n\n# 3. Run agent (meshctl uses .venv/bin/python automatically)\nmeshctl start hello/main.py --debug\n</code></pre> <p>The scaffolded code includes placeholder tools\u2014edit <code>main.py</code> to add your logic.</p>"},{"location":"python/local-development/01-getting-started/#next-steps","title":"Next Steps","text":"<p>Continue to Scaffold Agents \u2192</p>"},{"location":"python/local-development/02-scaffold/","title":"Scaffold Agents (Python)","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Scaffold <p>Generate agents with <code>meshctl scaffold</code></p>"},{"location":"python/local-development/02-scaffold/#interactive-mode-recommended","title":"Interactive Mode (Recommended)","text":"<p>The easiest way to create an agent:</p> <pre><code>meshctl scaffold\n</code></pre> <p>This launches an interactive wizard that guides you through:</p> <ul> <li>Agent name and type</li> <li>Capabilities and tools</li> <li>Output directory</li> </ul> <p>The generated code includes placeholder tools\u2014you'll need to edit <code>main.py</code> to implement your logic.</p>"},{"location":"python/local-development/02-scaffold/#cli-mode","title":"CLI Mode","text":"<p>For scripting or when you know what you want:</p> <pre><code># Basic tool agent\nmeshctl scaffold --name my-agent --agent-type tool\n\n# LLM-powered agent\nmeshctl scaffold --name emotion-analyzer --agent-type llm-agent \\\n  --llm-selector openai --response-format json\n\n# LLM provider (zero-code)\nmeshctl scaffold --name claude-provider --agent-type llm-provider \\\n  --model anthropic/claude-sonnet-4-5\n</code></pre>"},{"location":"python/local-development/02-scaffold/#agent-types","title":"Agent Types","text":"Type Description Use Case <code>tool</code> Basic agent with <code>@mesh.tool</code> Services, utilities, data processing <code>llm-agent</code> LLM-powered with <code>@mesh.llm</code> AI assistants, text analysis <code>llm-provider</code> Zero-code LLM wrapper Expose LLM as mesh capability"},{"location":"python/local-development/02-scaffold/#generated-files","title":"Generated Files","text":"<pre><code>my-agent/\n\u251c\u2500\u2500 main.py           # Agent code - edit this to add your logic\n\u251c\u2500\u2500 requirements.txt  # Add your dependencies here\n\u251c\u2500\u2500 Dockerfile        # Container build (ready to use)\n\u251c\u2500\u2500 helm-values.yaml  # Kubernetes config\n\u2514\u2500\u2500 README.md\n</code></pre> <p>After scaffolding: Edit <code>main.py</code> to implement your tool logic. The placeholder returns <code>\"Not implemented\"</code>.</p>"},{"location":"python/local-development/02-scaffold/#add-tools-to-existing-agent","title":"Add Tools to Existing Agent","text":"<pre><code>meshctl scaffold --name my-agent --add-tool \\\n  --tool-name process_data \\\n  --tool-description \"Process incoming data\"\n</code></pre>"},{"location":"python/local-development/02-scaffold/#generate-docker-compose","title":"Generate Docker Compose","text":"<pre><code># Generate docker-compose.yml for all agents in directory\nmeshctl scaffold --compose\n\n# With observability stack (registry + Redis + Tempo + Grafana)\nmeshctl scaffold --compose --observability\n</code></pre> <p>Local Tracing Setup</p> <p>Use <code>--compose --observability</code> even if you run agents locally. Start the infrastructure with <code>docker compose up -d</code>, then run agents with <code>meshctl start</code>\u2014they auto-connect to the Docker registry. This enables <code>meshctl call --trace</code> and <code>meshctl trace</code>.</p>"},{"location":"python/local-development/02-scaffold/#preview-before-creating","title":"Preview Before Creating","text":"<pre><code># Dry run - see what would be generated\nmeshctl scaffold --name my-agent --agent-type tool --dry-run\n</code></pre>"},{"location":"python/local-development/02-scaffold/#more-options","title":"More Options","text":"<pre><code># See all scaffold options\nmeshctl scaffold --help\n\n# See available agent templates\nmeshctl scaffold --list-modes\n</code></pre>"},{"location":"python/local-development/02-scaffold/#next-steps","title":"Next Steps","text":"<p>Continue to Run Agents \u2192</p>"},{"location":"python/local-development/03-running-agents/","title":"Run Agents (Python)","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Run Agents <p>Start agents with <code>meshctl start</code></p>"},{"location":"python/local-development/03-running-agents/#basic-usage","title":"Basic Usage","text":"<pre><code># Start a single agent\nmeshctl start main.py\n</code></pre> <p>The registry starts automatically on port 8000 if not already running. If a registry is already running (e.g., in Docker), agents connect to it instead.</p>"},{"location":"python/local-development/03-running-agents/#multiple-agents","title":"Multiple Agents","text":"<pre><code># Start multiple agents at once (mixed languages supported)\nmeshctl start agent1.py agent2.py agent3.ts\n</code></pre>"},{"location":"python/local-development/03-running-agents/#hot-reload","title":"Hot Reload","text":"<p>Auto-restart agents when code changes:</p> <pre><code>meshctl start -w main.py\nmeshctl start --watch main.py\n</code></pre>"},{"location":"python/local-development/03-running-agents/#debug-mode","title":"Debug Mode","text":"<p>Enable verbose logging:</p> <pre><code>meshctl start --debug main.py\n\n# Or set specific log level\nmeshctl start --log-level DEBUG main.py\n\n# Available levels: TRACE, DEBUG, INFO, WARN, ERROR\n</code></pre>"},{"location":"python/local-development/03-running-agents/#background-mode","title":"Background Mode","text":"<p>Run agents in the background (detached):</p> <pre><code># Start in background\nmeshctl start -d main.py\n\n# View logs\nmeshctl logs my-agent -f\n\n# Stop background agents\nmeshctl stop --all\n</code></pre>"},{"location":"python/local-development/03-running-agents/#environment-variables","title":"Environment Variables","text":"<p>Share configuration across agents:</p> <pre><code># Load from .env file\nmeshctl start --env-file .env main.py\n\n# Or pass individual variables\nmeshctl start --env OPENAI_API_KEY=sk-... main.py\n</code></pre>"},{"location":"python/local-development/03-running-agents/#registry-options","title":"Registry Options","text":"<pre><code># Start registry only (no agents)\nmeshctl start --registry-only\n\n# Use custom registry port\nmeshctl start --registry-port 9000 main.py\n\n# Connect to external registry\nmeshctl start --registry-url http://remote:8000 main.py\n</code></pre>"},{"location":"python/local-development/03-running-agents/#common-patterns","title":"Common Patterns","text":"<pre><code># Development: hot reload + debug\nmeshctl start -w --debug main.py\n\n# CI/Testing: background + quiet\nmeshctl start -d --quiet main.py\n\n# Production-like: custom registry\nmeshctl start --registry-url http://registry:8000 main.py\n</code></pre>"},{"location":"python/local-development/03-running-agents/#all-options","title":"All Options","text":"<pre><code>meshctl start --help\n</code></pre> <p>Key flags:</p> Flag Description <code>-w, --watch</code> Hot reload on file changes <code>-d, --detach</code> Run in background <code>--debug</code> Enable debug mode <code>--log-level</code> Set log level (TRACE/DEBUG/INFO/WARN/ERROR) <code>--env-file</code> Load environment from file <code>--env</code> Set individual env var <code>--registry-only</code> Start registry without agents <code>--registry-port</code> Registry port (default: 8000)"},{"location":"python/local-development/03-running-agents/#next-steps","title":"Next Steps","text":"<p>Continue to Inspect the Mesh \u2192</p>"},{"location":"python/local-development/04-inspecting-mesh/","title":"Inspect the Mesh (Python)","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Inspect Mesh <p>View agents, tools, and dependencies with <code>meshctl list</code> and <code>meshctl status</code></p>"},{"location":"python/local-development/04-inspecting-mesh/#list-agents","title":"List Agents","text":"<pre><code># Show healthy agents (default)\nmeshctl list\n\n# Show all agents including unhealthy\nmeshctl list --all\n\n# Filter by name pattern\nmeshctl list --filter weather\n\n# Show additional columns (endpoints, tool counts)\nmeshctl list --wide\n</code></pre> <p>Example output:</p> <pre><code>NAME                    STATUS    DEPS     UPTIME\nhello-world-5395c5e4    healthy   2/2      5m\nsystem-agent-a1b2c3d4   healthy   0/0      5m\nweather-agent-x9y8z7    healthy   1/1      2m\n</code></pre>"},{"location":"python/local-development/04-inspecting-mesh/#list-tools","title":"List Tools","text":"<pre><code># List all tools across all agents\nmeshctl list --tools\nmeshctl list -t\n\n# Show details for a specific tool (schema, call spec)\nmeshctl list --tools=get_weather\n\n# Show tool from specific agent\nmeshctl list --tools=weather-agent:get_weather\n</code></pre> <p>Example output:</p> <pre><code>TOOL                 AGENT                   CAPABILITY\nget_weather          weather-agent-x9y8z7    weather_service\nget_current_time     system-agent-a1b2c3d4   system_info\nhello_mesh_simple    hello-world-5395c5e4    greeter\n</code></pre>"},{"location":"python/local-development/04-inspecting-mesh/#agent-status","title":"Agent Status","text":"<pre><code># Show wiring details for all agents\nmeshctl status\n\n# Show details for specific agent\nmeshctl status hello-world-5395c5e4\n</code></pre> <p>Shows:</p> <ul> <li>Agent metadata (name, version, capabilities)</li> <li>Resolved dependencies (which agents provide them)</li> <li>HTTP endpoint</li> <li>Health status</li> </ul>"},{"location":"python/local-development/04-inspecting-mesh/#json-output","title":"JSON Output","text":"<p>For scripting and automation:</p> <pre><code>meshctl list --json\nmeshctl status --json\nmeshctl list --tools --json\n</code></pre>"},{"location":"python/local-development/04-inspecting-mesh/#remote-registry","title":"Remote Registry","text":"<p>Inspect agents on a remote registry:</p> <pre><code>meshctl list --registry-url http://remote:8000\nmeshctl status --registry-url http://remote:8000\n</code></pre>"},{"location":"python/local-development/04-inspecting-mesh/#quick-reference","title":"Quick Reference","text":"Command Description <code>meshctl list</code> List healthy agents <code>meshctl list --all</code> List all agents <code>meshctl list -t</code> List all tools <code>meshctl list -t=&lt;tool&gt;</code> Show tool details <code>meshctl status</code> Show agent wiring <code>meshctl status &lt;agent&gt;</code> Show specific agent"},{"location":"python/local-development/04-inspecting-mesh/#next-steps","title":"Next Steps","text":"<p>Continue to Call &amp; Debug Tools \u2192</p>"},{"location":"python/local-development/05-calling-tools/","title":"Call &amp; Debug Tools (Python)","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Call Tools <p>Call tools and trace distributed calls with <code>meshctl call</code>, <code>meshctl trace</code>, and <code>meshctl logs</code></p>"},{"location":"python/local-development/05-calling-tools/#call-tools","title":"Call Tools","text":"<pre><code># Auto-discover agent by tool name (recommended)\nmeshctl call get_weather\n\n# With JSON arguments\nmeshctl call add '{\"a\": 1, \"b\": 2}'\n\n# Arguments from file\nmeshctl call process --file data.json\n</code></pre>"},{"location":"python/local-development/05-calling-tools/#target-specific-agent","title":"Target Specific Agent","text":"<p>When multiple agents provide the same tool:</p> <pre><code># Use full agent ID from 'meshctl list'\nmeshctl call weather-agent-7f3a2b:get_weather '{\"city\": \"London\"}'\n</code></pre>"},{"location":"python/local-development/05-calling-tools/#distributed-tracing","title":"Distributed Tracing","text":"<p>Tracing requires Redis + Tempo in addition to the registry. The easiest way to set this up for local development:</p> <pre><code># 1. Generate docker-compose with observability stack\nmeshctl scaffold --compose --observability\n\n# 2. Start infrastructure (registry + Redis + Tempo)\ndocker compose up -d\n\n# 3. Run your agents locally (auto-connects to Docker registry)\nmeshctl start my-agent/main.py\n</code></pre> <p>Now you can trace calls:</p> <pre><code># Call with tracing enabled\nmeshctl call --trace get_weather '{\"city\": \"London\"}'\n</code></pre> <p>Output includes a trace ID:</p> <pre><code>Result: {\"temperature\": 20, \"conditions\": \"cloudy\"}\nTrace ID: abc123def456789\n</code></pre>"},{"location":"python/local-development/05-calling-tools/#view-call-tree","title":"View Call Tree","text":"<pre><code># View the full call tree\nmeshctl trace abc123def456789\n</code></pre> <p>Shows the complete call hierarchy:</p> <pre><code>get_weather (weather-agent) 120ms\n\u251c\u2500\u2500 fetch_coordinates (geo-agent) 45ms\n\u2514\u2500\u2500 get_forecast (forecast-agent) 65ms\n    \u2514\u2500\u2500 cache_lookup (cache-agent) 5ms\n</code></pre> <p>Without Docker</p> <p>If you're not running the observability stack, <code>meshctl call</code> still works but <code>--trace</code> won't capture data and <code>meshctl trace</code> won't return results.</p>"},{"location":"python/local-development/05-calling-tools/#view-agent-logs","title":"View Agent Logs","text":"<p>For agents running in background (detached mode):</p> <pre><code># Last 100 lines (default)\nmeshctl logs my-agent\n\n# Follow logs in real-time\nmeshctl logs my-agent -f\n\n# Last 50 lines\nmeshctl logs my-agent --tail 50\n\n# Logs from last 10 minutes\nmeshctl logs my-agent --since 10m\n\n# Previous log (before last restart)\nmeshctl logs my-agent -p\n\n# List available agent logs\nmeshctl logs --list\n</code></pre>"},{"location":"python/local-development/05-calling-tools/#built-in-documentation","title":"Built-in Documentation","text":"<pre><code># List all documentation topics\nmeshctl man --list\n\n# View specific topic\nmeshctl man decorators      # SDK decorators reference\nmeshctl man llm             # LLM integration guide\nmeshctl man di              # Dependency injection\nmeshctl man quickstart      # Getting started guide\n\n# Raw markdown (for LLMs)\nmeshctl man decorators --raw\n</code></pre>"},{"location":"python/local-development/05-calling-tools/#quick-reference","title":"Quick Reference","text":"Command Description <code>meshctl call &lt;tool&gt;</code> Call tool (auto-discover) <code>meshctl call &lt;tool&gt; '{...}'</code> Call with JSON args <code>meshctl call --trace &lt;tool&gt;</code> Call with tracing <code>meshctl trace &lt;id&gt;</code> View call tree <code>meshctl logs &lt;agent&gt; -f</code> Follow agent logs <code>meshctl man --list</code> List doc topics <code>meshctl man &lt;topic&gt;</code> View documentation"},{"location":"python/local-development/05-calling-tools/#troubleshooting-calls","title":"Troubleshooting Calls","text":"<p>If a call fails:</p> <ol> <li>Check the agent is running: <code>meshctl list</code></li> <li>Check tool exists: <code>meshctl list --tools=&lt;tool_name&gt;</code></li> <li>Enable tracing: <code>meshctl call --trace &lt;tool&gt;</code></li> <li>Check logs: <code>meshctl logs &lt;agent&gt; --since 5m</code></li> </ol>"},{"location":"python/local-development/05-calling-tools/#next-steps","title":"Next Steps","text":"<p>See Troubleshooting for common issues \u2192</p>"},{"location":"python/local-development/troubleshooting/","title":"Troubleshooting (Python)","text":"\ud83d\udcd8 Looking for TypeScript? See TypeScript Troubleshooting <p>Common issues and solutions for MCP Mesh Python development</p>"},{"location":"python/local-development/troubleshooting/#quick-diagnostics","title":"Quick Diagnostics","text":"<pre><code># Check CLI is installed\nmeshctl --version\n\n# Check registry is running\ncurl http://localhost:8000/health\n\n# List agents and their status\nmeshctl list --all\n\n# Check agent logs\nmeshctl logs &lt;agent-name&gt; --since 5m\n</code></pre>"},{"location":"python/local-development/troubleshooting/#registry-issues","title":"Registry Issues","text":""},{"location":"python/local-development/troubleshooting/#registry-not-running","title":"Registry Not Running","text":"<p>Symptom: <code>Connection refused</code> when starting agents</p> <pre><code># Start registry manually\nmeshctl start --registry-only\n\n# Or start an agent (registry auto-starts)\nmeshctl start main.py\n</code></pre>"},{"location":"python/local-development/troubleshooting/#port-8000-already-in-use","title":"Port 8000 Already in Use","text":"<pre><code># Find what's using the port\nlsof -i :8000\n\n# Kill it\nkill $(lsof -t -i:8000)\n\n# Or use a different port\nmeshctl start --registry-port 9000 main.py\n</code></pre>"},{"location":"python/local-development/troubleshooting/#agent-issues","title":"Agent Issues","text":""},{"location":"python/local-development/troubleshooting/#agent-not-appearing-in-registry","title":"Agent Not Appearing in Registry","text":"<pre><code># Check agent is running\nmeshctl list --all\n\n# Enable debug logging\nmeshctl start --debug main.py\n\n# Check for registration errors in logs\nmeshctl logs my-agent --since 5m | grep -i error\n</code></pre>"},{"location":"python/local-development/troubleshooting/#dependencies-not-resolved","title":"Dependencies Not Resolved","text":"<p>Symptom: Agent shows <code>1/2</code> in DEPS column</p> <pre><code># See which dependencies are missing\nmeshctl status my-agent\n\n# Check if the providing agent is running\nmeshctl list\n\n# Start the missing agent\nmeshctl start provider-agent.py\n</code></pre>"},{"location":"python/local-development/troubleshooting/#port-conflict-between-agents","title":"Port Conflict Between Agents","text":"<p>Symptom: <code>address already in use</code></p> <p>Agents auto-assign ports by default. If you've hardcoded ports:</p> <pre><code># Don't do this for local dev\n@mesh.agent(name=\"my-agent\", http_port=8080)  # Conflicts!\n\n# Do this instead - let mesh assign ports\n@mesh.agent(name=\"my-agent\", http_port=0)  # Auto-assign\n</code></pre>"},{"location":"python/local-development/troubleshooting/#tool-call-issues","title":"Tool Call Issues","text":""},{"location":"python/local-development/troubleshooting/#tool-not-found","title":"Tool Not Found","text":"<pre><code># List all available tools\nmeshctl list --tools\n\n# Check tool details\nmeshctl list --tools=my_tool_name\n</code></pre>"},{"location":"python/local-development/troubleshooting/#call-timeout","title":"Call Timeout","text":"<pre><code># Increase timeout (default 30s)\nmeshctl call --timeout 60 slow_operation\n\n# Check if agent is healthy\nmeshctl list\n</code></pre>"},{"location":"python/local-development/troubleshooting/#wrong-arguments","title":"Wrong Arguments","text":"<pre><code># Check tool's expected schema\nmeshctl list --tools=my_tool_name\n\n# Shows parameter types and required fields\n</code></pre>"},{"location":"python/local-development/troubleshooting/#import-issues","title":"Import Issues","text":""},{"location":"python/local-development/troubleshooting/#importerror-cannot-import-name-agent-from-mesh","title":"<code>ImportError: cannot import name 'agent' from 'mesh'</code>","text":"<pre><code># Verify SDK is installed\npip show mcp-mesh\n\n# Reinstall if needed\npip install --force-reinstall \"mcp-mesh&gt;=0.8,&lt;0.9\"\n\n# Check Python path\npython -c \"import mesh; print(mesh.__file__)\"\n</code></pre>"},{"location":"python/local-development/troubleshooting/#logging-debugging","title":"Logging &amp; Debugging","text":""},{"location":"python/local-development/troubleshooting/#enable-debug-logging","title":"Enable Debug Logging","text":"<pre><code># Via CLI flag\nmeshctl start --debug main.py\n\n# Or via log level\nmeshctl start --log-level DEBUG main.py\n\n# TRACE level for SQL queries\nmeshctl start --log-level TRACE main.py\n</code></pre>"},{"location":"python/local-development/troubleshooting/#view-distributed-trace","title":"View Distributed Trace","text":"<pre><code># Call with tracing\nmeshctl call --trace my_tool\n\n# View the trace tree\nmeshctl trace &lt;trace-id&gt;\n</code></pre>"},{"location":"python/local-development/troubleshooting/#getting-help","title":"Getting Help","text":"<pre><code># Built-in documentation\nmeshctl man --list\nmeshctl man &lt;topic&gt;\n\n# Command help\nmeshctl &lt;command&gt; --help\n</code></pre>"},{"location":"python/local-development/troubleshooting/#still-stuck","title":"Still Stuck?","text":"<ol> <li>Check GitHub Issues</li> <li>Enable <code>--debug</code> and share the logs</li> <li>Create a minimal reproduction case</li> </ol>"},{"location":"typescript/","title":"TypeScript SDK","text":"\ud83d\udc0d Looking for Python? See the Python SDK <p>Build distributed MCP agents with TypeScript and zero boilerplate</p>"},{"location":"typescript/#overview","title":"Overview","text":"<p>The MCP Mesh TypeScript SDK provides a function-based API for building distributed agent systems:</p> <ul> <li><code>mesh()</code> - Wrap FastMCP with mesh capabilities</li> <li><code>agent.addTool()</code> - Register tools with capabilities and tags</li> <li><code>mesh.llm()</code> - Create LLM-powered tools</li> <li><code>agent.addLlmProvider()</code> - Zero-code LLM providers</li> </ul>"},{"location":"typescript/#installation","title":"Installation","text":"<pre><code># Install the SDK\nnpm install @mcpmesh/sdk\n\n# Install the CLI (if not already installed)\nnpm install -g @mcpmesh/cli\n</code></pre>"},{"location":"typescript/#quick-start","title":"Quick Start","text":"<pre><code># View the quick start guide\nmeshctl man quickstart --typescript\n\n# Or scaffold a new agent\nmeshctl scaffold --name my-agent --lang typescript\n</code></pre>"},{"location":"typescript/#documentation","title":"Documentation","text":"<p>For comprehensive documentation, use the built-in man pages:</p> <pre><code>meshctl man --list                      # List all topics\nmeshctl man &lt;topic&gt; --typescript        # View TypeScript version\nmeshctl man &lt;topic&gt; --typescript --raw  # Get markdown output\n</code></pre>"},{"location":"typescript/#key-topics","title":"Key Topics","text":"Topic Command Description Quick Start <code>meshctl man quickstart --typescript</code> Get started in minutes Mesh Functions <code>meshctl man decorators --typescript</code> mesh(), addTool(), mesh.llm() Dependency Injection <code>meshctl man di --typescript</code> How DI works LLM Integration <code>meshctl man llm --typescript</code> Build AI-powered agents Deployment <code>meshctl man deployment --typescript</code> Local, Docker, Kubernetes"},{"location":"typescript/#next-steps","title":"Next Steps","text":"Quick Start <p>Get your first agent running in 5 minutes</p> Start Tutorial \u2192 Mesh Functions Reference <p>Complete API reference</p> View Reference \u2192 LLM Integration <p>Build AI-powered agents</p> Learn More \u2192"},{"location":"typescript/capabilities-tags/","title":"Capabilities & Tags","text":"\ud83d\udc0d Looking for Python? See Python Capabilities"},{"location":"typescript/capabilities-tags/#capabilities-system-typescript","title":"Capabilities System (TypeScript)","text":"<p>Named services that agents provide for discovery and dependency injection</p>"},{"location":"typescript/capabilities-tags/#overview","title":"Overview","text":"<p>Capabilities are named services that agents register with the mesh. When an agent declares a capability, other agents can discover and use it through dependency injection. Multiple agents can provide the same capability with different implementations.</p>"},{"location":"typescript/capabilities-tags/#capability-selector-syntax","title":"Capability Selector Syntax","text":"<p>MCP Mesh uses a unified syntax for selecting capabilities throughout the framework. This same pattern appears in <code>dependencies</code>, <code>mesh.llm()</code> provider/filter, <code>mesh.route()</code>, and <code>meshctl scaffold --filter</code>.</p>"},{"location":"typescript/capabilities-tags/#selector-fields","title":"Selector Fields","text":"Field Required Description <code>capability</code> Yes* Capability name to match <code>tags</code> No Tag filters with \u00b1 operators <code>version</code> No Semantic version constraint (e.g., <code>&gt;=2.0.0</code>) <p>*When filtering by tags only (e.g., LLM tool filter), <code>capability</code> can be omitted.</p>"},{"location":"typescript/capabilities-tags/#syntax-forms","title":"Syntax Forms","text":"<p>Shorthand (capability name only):</p> <pre><code>dependencies: [\"date_service\", \"weather_data\"];\n</code></pre> <p>Full form (with filters):</p> <pre><code>dependencies: [\n  { capability: \"date_service\" },\n  { capability: \"weather_data\", tags: [\"+fast\", \"-deprecated\"] },\n  { capability: \"api_client\", version: \"&gt;=2.0.0\" },\n];\n</code></pre>"},{"location":"typescript/capabilities-tags/#where-this-syntax-is-used","title":"Where This Syntax Is Used","text":"Context Example <code>addTool()</code> dependencies <code>dependencies: [\"svc\"]</code> or <code>[{ capability: \"svc\" }]</code> <code>mesh.llm()</code> provider <code>provider: { capability: \"llm\", tags: [\"+claude\"] }</code> <code>mesh.llm()</code> filter <code>filter: [{ capability: \"calc\" }, { tags: [\"tools\"] }]</code> <code>mesh.route()</code> dependencies <code>[{ capability: \"api\", tags: [\"+v2\"] }]</code> <code>meshctl scaffold --filter</code> <code>--filter '[{\"capability\": \"x\"}]'</code>"},{"location":"typescript/capabilities-tags/#tag-operators","title":"Tag Operators","text":"Prefix Meaning Example (none) Required <code>\"api\"</code> <code>+</code> Preferred <code>\"+fast\"</code> <code>-</code> Excluded <code>\"-deprecated\"</code>"},{"location":"typescript/capabilities-tags/#selector-logic-andor","title":"Selector Logic (AND/OR)","text":"Syntax Semantics <code>tags: [\"a\", \"b\", \"c\"]</code> a AND b AND c (all required) <code>tags: [\"+a\", \"+b\"]</code> Prefer a, prefer b (neither required) <code>tags: [\"a\", \"-x\"]</code> Must have a, must NOT have x <code>[{tags:[\"a\"]}, {tags:[\"b\"]}]</code> a OR b (multiple selectors) <p>See <code>meshctl man tags</code> for detailed tag matching behavior.</p>"},{"location":"typescript/capabilities-tags/#declaring-capabilities","title":"Declaring Capabilities","text":"<pre><code>import { z } from \"zod\";\n\nagent.addTool({\n  name: \"get_weather\",\n  capability: \"weather_data\", // Capability name\n  description: \"Provides weather info\", // Human-readable description\n  version: \"1.0.0\", // Semantic version\n  tags: [\"weather\", \"current\", \"api\"], // Tags for filtering\n  parameters: z.object({\n    city: z.string(),\n  }),\n  execute: async ({ city }) =&gt; {\n    return JSON.stringify({ city, temp: 72, conditions: \"sunny\" });\n  },\n});\n</code></pre>"},{"location":"typescript/capabilities-tags/#capability-resolution","title":"Capability Resolution","text":"<p>When an agent requests a dependency, the registry resolves it by:</p> <ol> <li>Name matching: Find agents providing the requested capability</li> <li>Tag filtering: Apply tag constraints (if specified)</li> <li>Version constraints: Check semantic version compatibility</li> <li>Load balancing: Select from multiple matching providers</li> </ol>"},{"location":"typescript/capabilities-tags/#multiple-implementations","title":"Multiple Implementations","text":"<p>Multiple agents can provide the same capability:</p> <pre><code>// Agent 1: OpenWeather implementation\nagent1.addTool({\n  name: \"openweather\",\n  capability: \"weather_data\",\n  tags: [\"weather\", \"openweather\", \"free\"],\n  parameters: z.object({ city: z.string() }),\n  execute: async ({ city }) =&gt; {\n    /* ... */\n  },\n});\n\n// Agent 2: Premium weather implementation\nagent2.addTool({\n  name: \"premium_weather\",\n  capability: \"weather_data\",\n  tags: [\"weather\", \"premium\", \"accurate\"],\n  parameters: z.object({ city: z.string() }),\n  execute: async ({ city }) =&gt; {\n    /* ... */\n  },\n});\n</code></pre> <p>Consumers can select implementations using tag filters:</p> <pre><code>agent.addTool({\n  name: \"get_forecast\",\n  capability: \"forecast\",\n  dependencies: [{ capability: \"weather_data\", tags: [\"+premium\"] }],\n  parameters: z.object({}),\n  execute: async ({}, { weather_data }) =&gt; {\n    if (weather_data) {\n      return await weather_data({ city: \"NYC\" });\n    }\n    return \"Weather service unavailable\";\n  },\n});\n</code></pre>"},{"location":"typescript/capabilities-tags/#dependency-declaration","title":"Dependency Declaration","text":""},{"location":"typescript/capabilities-tags/#simple-by-name","title":"Simple (by name)","text":"<pre><code>agent.addTool({\n  name: \"my_tool\",\n  capability: \"my_capability\",\n  dependencies: [\"date_service\", \"weather_data\"],\n  parameters: z.object({ query: z.string() }),\n  execute: async ({ query }, { date_service, weather_data }) =&gt; {\n    // date_service and weather_data are McpMeshTool | null\n  },\n});\n</code></pre>"},{"location":"typescript/capabilities-tags/#advanced-with-filters","title":"Advanced (with filters)","text":"<pre><code>agent.addTool({\n  name: \"my_tool\",\n  capability: \"my_capability\",\n  dependencies: [\n    { capability: \"date_service\" },\n    { capability: \"weather_data\", tags: [\"+accurate\", \"-deprecated\"] },\n  ],\n  parameters: z.object({ query: z.string() }),\n  execute: async ({ query }, { date_service, weather_data }) =&gt; {\n    // Dependencies injected by capability name\n  },\n});\n</code></pre>"},{"location":"typescript/capabilities-tags/#capability-naming-conventions","title":"Capability Naming Conventions","text":"Pattern Example Use Case <code>noun_noun</code> <code>weather_data</code> Data providers <code>verb_noun</code> <code>get_time</code> Action services <code>domain_action</code> <code>auth_validate</code> Domain-specific <code>service</code> <code>llm</code> Generic services"},{"location":"typescript/capabilities-tags/#versioning","title":"Versioning","text":"<p>Capabilities support semantic versioning:</p> <pre><code>agent.addTool({\n  name: \"api_v2\",\n  capability: \"api_client\",\n  version: \"2.1.0\",\n  // ...\n});\n</code></pre> <p>Consumers can specify version constraints:</p> <pre><code>dependencies: [{ capability: \"api_client\", version: \"&gt;=2.0.0\" }];\n</code></pre>"},{"location":"typescript/capabilities-tags/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man tags --typescript</code> - Tag matching system</li> <li><code>meshctl man dependency-injection --typescript</code> - How DI works</li> <li><code>meshctl man decorators --typescript</code> - All TypeScript functions</li> </ul>"},{"location":"typescript/dependency-injection/","title":"Dependency Injection","text":"\ud83d\udc0d Looking for Python? See Python Dependency Injection"},{"location":"typescript/dependency-injection/#dependency-injection-typescript","title":"Dependency Injection (TypeScript)","text":"<p>Automatic wiring of capabilities between agents</p>"},{"location":"typescript/dependency-injection/#overview","title":"Overview","text":"<p>MCP Mesh provides automatic dependency injection (DI) that connects agents based on their declared capabilities and dependencies. When a tool declares a dependency, the mesh automatically creates a callable proxy that routes to the providing agent.</p>"},{"location":"typescript/dependency-injection/#how-it-works","title":"How It Works","text":"<ol> <li>Declaration: Tool declares dependencies via <code>addTool()</code> options</li> <li>Registration: Agent registers with registry, advertising capabilities</li> <li>Resolution: Registry matches dependencies to providers</li> <li>Injection: Mesh creates proxy objects for each dependency</li> <li>Invocation: Calling the proxy routes to the remote agent</li> </ol>"},{"location":"typescript/dependency-injection/#declaring-dependencies","title":"Declaring Dependencies","text":""},{"location":"typescript/dependency-injection/#simple-dependencies","title":"Simple Dependencies","text":"<pre><code>import { z } from \"zod\";\n\nagent.addTool({\n  name: \"greet\",\n  capability: \"greeting\",\n  dependencies: [\"date_service\"], // Request by capability name\n  parameters: z.object({\n    name: z.string(),\n  }),\n  execute: async ({ name }, { date_service }) =&gt; {\n    if (date_service) {\n      const today = await date_service({});\n      return `Hello ${name}! Today is ${today}`;\n    }\n    return `Hello ${name}!`;\n  },\n});\n</code></pre> <p>Important: Dependencies are injected as the second parameter to <code>execute</code>, keyed by capability name. They may be <code>null</code> if unavailable.</p>"},{"location":"typescript/dependency-injection/#dependencies-with-filters","title":"Dependencies with Filters","text":"<p>Use the capability selector syntax (see <code>meshctl man capabilities --typescript</code>) to filter by tags or version:</p> <pre><code>agent.addTool({\n  name: \"generate_report\",\n  capability: \"report\",\n  dependencies: [\n    { capability: \"data_service\", tags: [\"+fast\"] },\n    { capability: \"formatter\", tags: [\"-deprecated\"] },\n  ],\n  parameters: z.object({}),\n  execute: async ({}, { data_service, formatter }) =&gt; {\n    if (!data_service || !formatter) {\n      return \"Required services unavailable\";\n    }\n    const data = await data_service({ query: \"sales\" });\n    return await formatter({ data });\n  },\n});\n</code></pre>"},{"location":"typescript/dependency-injection/#injection-types","title":"Injection Types","text":""},{"location":"typescript/dependency-injection/#mcpmeshtool","title":"McpMeshTool","text":"<p>Callable proxy for tool invocations:</p> <pre><code>execute: async ({}, { helper }) =&gt; {\n  if (helper) {\n    // Direct call (calls default tool)\n    const result = await helper({ arg1: \"value\" });\n\n    // Named tool call\n    const result2 = await helper.callTool(\"tool_name\", { arg: \"value\" });\n  }\n}\n</code></pre>"},{"location":"typescript/dependency-injection/#llm-injection","title":"LLM Injection","text":"<p>For LLM agent injection in <code>mesh.llm()</code> decorated tools:</p> <pre><code>agent.addTool({\n  name: \"smart_tool\",\n  ...mesh.llm({\n    provider: { capability: \"llm\", tags: [\"+claude\"] },\n    systemPrompt: \"You are a helpful assistant.\",\n  }),\n  capability: \"smart\",\n  parameters: z.object({ query: z.string() }),\n  execute: async ({ query }, { llm }) =&gt; {\n    return llm(\"Process this request: \" + query);\n  },\n});\n</code></pre>"},{"location":"typescript/dependency-injection/#graceful-degradation","title":"Graceful Degradation","text":"<p>Dependencies may be unavailable. Always handle <code>null</code>:</p> <pre><code>agent.addTool({\n  name: \"my_tool\",\n  capability: \"my_capability\",\n  dependencies: [\"helper\"],\n  parameters: z.object({}),\n  execute: async ({}, { helper }) =&gt; {\n    if (helper === null) {\n      return \"Service temporarily unavailable\";\n    }\n    return await helper({});\n  },\n});\n</code></pre> <p>Or use default values:</p> <pre><code>agent.addTool({\n  name: \"get_time\",\n  capability: \"time_service\",\n  dependencies: [\"date_service\"],\n  parameters: z.object({}),\n  execute: async ({}, { date_service }) =&gt; {\n    if (date_service) {\n      return await date_service({});\n    }\n    return new Date().toISOString(); // Fallback\n  },\n});\n</code></pre>"},{"location":"typescript/dependency-injection/#proxy-configuration","title":"Proxy Configuration","text":"<p>Configure proxy behavior via <code>dependencyConfig</code>:</p> <pre><code>agent.addTool({\n  name: \"my_tool\",\n  capability: \"my_capability\",\n  dependencies: [\"slow_service\"],\n  dependencyConfig: {\n    slow_service: {\n      timeout: 60000, // Request timeout (milliseconds)\n      retryCount: 3, // Retry attempts\n      streaming: true, // Enable streaming\n      sessionRequired: true, // Require session affinity\n    },\n  },\n  parameters: z.object({ data: z.string() }),\n  execute: async ({ data }, { slow_service }) =&gt; {\n    if (slow_service) {\n      return await slow_service({ data });\n    }\n    return \"Service unavailable\";\n  },\n});\n</code></pre>"},{"location":"typescript/dependency-injection/#proxy-types-auto-selected","title":"Proxy Types (Auto-Selected)","text":"<p>The mesh uses a unified proxy system:</p> Proxy Type Use Case <code>SelfDependencyProxy</code> Same agent (direct call, no network overhead) <code>EnhancedUnifiedMCPProxy</code> Cross-agent calls (auto-configured from kwargs)"},{"location":"typescript/dependency-injection/#function-vs-capability-names","title":"Function vs Capability Names","text":"<ul> <li>Capability name: Used for dependency resolution (<code>date_service</code>)</li> <li>Function name: Used in MCP tool calls (<code>get_current_time</code>)</li> </ul> <p>The mesh maps capabilities to their implementing functions automatically.</p>"},{"location":"typescript/dependency-injection/#auto-rewiring","title":"Auto-Rewiring","text":"<p>When topology changes (agents join/leave), the mesh:</p> <ol> <li>Detects change via heartbeat response</li> <li>Refreshes dependency proxies</li> <li>Routes to new providers automatically</li> </ol> <p>No code changes needed - happens transparently.</p>"},{"location":"typescript/dependency-injection/#typescript-type-safety","title":"TypeScript Type Safety","text":"<p>Dependencies are typed based on the capability name:</p> <pre><code>// Dependencies are McpMeshTool | null\nexecute: async (params, deps: Record&lt;string, McpMeshTool | null&gt;) =&gt; {\n  const { date_service, weather_service } = deps;\n\n  if (date_service) {\n    // TypeScript knows this is McpMeshTool\n    const result = await date_service({});\n  }\n};\n</code></pre>"},{"location":"typescript/dependency-injection/#complete-example","title":"Complete Example","text":"<pre><code>import { FastMCP } from \"fastmcp\";\nimport { mesh } from \"@mcpmesh/sdk\";\nimport { z } from \"zod\";\n\nconst server = new FastMCP({ name: \"Report Service\", version: \"1.0.0\" });\nconst agent = mesh(server, { name: \"report-service\", port: 9000 });\n\n// Tool with multiple dependencies\nagent.addTool({\n  name: \"generate_sales_report\",\n  capability: \"sales_report\",\n  description: \"Generate a sales report with formatting\",\n  dependencies: [\n    { capability: \"data_service\", tags: [\"+fast\"] },\n    { capability: \"formatter\" },\n    \"audit_log\", // Simple string form\n  ],\n  parameters: z.object({\n    quarter: z.enum([\"Q1\", \"Q2\", \"Q3\", \"Q4\"]),\n    year: z.number(),\n  }),\n  execute: async (\n    { quarter, year },\n    { data_service, formatter, audit_log },\n  ) =&gt; {\n    // Graceful degradation for each dependency\n    if (!data_service) {\n      return \"Data service unavailable\";\n    }\n\n    const data = await data_service({ quarter, year });\n\n    // Format if available, otherwise return raw\n    const result = formatter\n      ? await formatter({ data, format: \"markdown\" })\n      : JSON.stringify(data);\n\n    // Log if audit service is available\n    if (audit_log) {\n      await audit_log({ action: \"report_generated\", quarter, year });\n    }\n\n    return result;\n  },\n});\n</code></pre>"},{"location":"typescript/dependency-injection/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man capabilities --typescript</code> - Declaring capabilities</li> <li><code>meshctl man tags --typescript</code> - Tag-based selection</li> <li><code>meshctl man health --typescript</code> - Health monitoring</li> <li><code>meshctl man proxies --typescript</code> - Proxy details</li> </ul>"},{"location":"typescript/examples/","title":"Examples & Testing","text":"\ud83d\udc0d Looking for Python? See Python Testing"},{"location":"typescript/examples/#testing-mcp-agents-typescript","title":"Testing MCP Agents (TypeScript)","text":"<p>How to test TypeScript MCP Mesh agents</p>"},{"location":"typescript/examples/#quick-way-meshctl-call","title":"Quick Way: meshctl call","text":"<pre><code>meshctl call hello_mesh_simple                    # Call tool by name\nmeshctl call add --params '{\"a\": 1, \"b\": 2}'     # With arguments\nmeshctl list --tools                              # List all available tools\n</code></pre> <p>See <code>meshctl man cli</code> for more CLI commands.</p>"},{"location":"typescript/examples/#unit-testing-with-vitest","title":"Unit Testing with Vitest","text":"<p>The TypeScript SDK works well with Vitest for unit testing:</p> <pre><code>// src/index.test.ts\nimport { describe, it, expect, beforeAll, afterAll } from \"vitest\";\nimport { FastMCP } from \"fastmcp\";\nimport { mesh } from \"@mcpmesh/sdk\";\nimport { z } from \"zod\";\n\ndescribe(\"Calculator Agent\", () =&gt; {\n  let agent: ReturnType&lt;typeof mesh&gt;;\n\n  beforeAll(() =&gt; {\n    const server = new FastMCP({ name: \"Test Calculator\", version: \"1.0.0\" });\n    agent = mesh(server, {\n      name: \"test-calculator\",\n      port: 0, // Auto-assign port for testing\n      registryUrl: \"\", // No registry for unit tests\n    });\n\n    agent.addTool({\n      name: \"add\",\n      capability: \"calculator_add\",\n      description: \"Add two numbers\",\n      parameters: z.object({ a: z.number(), b: z.number() }),\n      execute: async ({ a, b }) =&gt; String(a + b),\n    });\n  });\n\n  it(\"should add two numbers\", async () =&gt; {\n    // Test the execute function directly\n    const result = await agent.callTool(\"add\", { a: 2, b: 3 });\n    expect(result).toBe(\"5\");\n  });\n});\n</code></pre>"},{"location":"typescript/examples/#running-tests","title":"Running Tests","text":"<pre><code># Install vitest\nnpm install -D vitest\n\n# Run tests\nnpx vitest\n\n# Watch mode\nnpx vitest --watch\n\n# With coverage\nnpx vitest --coverage\n</code></pre>"},{"location":"typescript/examples/#integration-testing","title":"Integration Testing","text":"<p>For testing agents with the mesh:</p> <pre><code>// integration.test.ts\nimport { describe, it, expect, beforeAll, afterAll } from \"vitest\";\nimport { spawn, ChildProcess } from \"child_process\";\n\ndescribe(\"Agent Integration\", () =&gt; {\n  let registryProcess: ChildProcess;\n  let agentProcess: ChildProcess;\n\n  beforeAll(async () =&gt; {\n    // Start registry\n    registryProcess = spawn(\"meshctl\", [\"start\", \"--registry-only\"], {\n      stdio: \"pipe\",\n    });\n\n    // Wait for registry\n    await new Promise((resolve) =&gt; setTimeout(resolve, 2000));\n\n    // Start agent\n    agentProcess = spawn(\"meshctl\", [\"start\", \"src/index.ts\"], {\n      stdio: \"pipe\",\n      env: { ...process.env, MCP_MESH_REGISTRY_URL: \"http://localhost:8000\" },\n    });\n\n    // Wait for agent registration\n    await new Promise((resolve) =&gt; setTimeout(resolve, 3000));\n  });\n\n  afterAll(() =&gt; {\n    agentProcess?.kill();\n    registryProcess?.kill();\n  });\n\n  it(\"should register with mesh\", async () =&gt; {\n    const response = await fetch(\"http://localhost:8000/agents\");\n    const agents = await response.json();\n    expect(agents.some((a: any) =&gt; a.name.startsWith(\"my-agent\"))).toBe(true);\n  });\n});\n</code></pre>"},{"location":"typescript/examples/#testing-with-docker-compose","title":"Testing with Docker Compose","text":"<pre><code># docker-compose.test.yml\nservices:\n  registry:\n    image: mcpmesh/registry:0.8\n    ports:\n      - \"8000:8000\"\n    healthcheck:\n      test: [\"CMD\", \"wget\", \"-q\", \"--spider\", \"http://localhost:8000/health\"]\n      interval: 5s\n      timeout: 3s\n      retries: 5\n\n  agent-under-test:\n    build: .\n    depends_on:\n      registry:\n        condition: service_healthy\n    environment:\n      MCP_MESH_REGISTRY_URL: http://registry:8000\n</code></pre> <pre><code># Run integration tests\ndocker compose -f docker-compose.test.yml up -d\nnpx vitest run integration/\ndocker compose -f docker-compose.test.yml down\n</code></pre>"},{"location":"typescript/examples/#protocol-details-curl","title":"Protocol Details: curl","text":"<p>MCP agents expose a JSON-RPC 2.0 API over HTTP with SSE responses:</p>"},{"location":"typescript/examples/#list-available-tools","title":"List Available Tools","text":"<pre><code>curl -s -X POST http://localhost:9000/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": 1,\n    \"method\": \"tools/list\",\n    \"params\": {}\n  }'\n</code></pre>"},{"location":"typescript/examples/#call-a-tool","title":"Call a Tool","text":"<pre><code>curl -s -X POST http://localhost:9000/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: application/json, text/event-stream\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": 1,\n    \"method\": \"tools/call\",\n    \"params\": {\n      \"name\": \"add\",\n      \"arguments\": {\"a\": 1, \"b\": 2}\n    }\n  }'\n</code></pre>"},{"location":"typescript/examples/#parse-sse-response","title":"Parse SSE Response","text":"<pre><code># Parse SSE format\n| grep \"^data:\" | sed 's/^data: //' | jq .\n</code></pre>"},{"location":"typescript/examples/#testing-dependencies","title":"Testing Dependencies","text":"<p>Test graceful degradation when dependencies are unavailable:</p> <pre><code>import { describe, it, expect } from \"vitest\";\n\ndescribe(\"Dependency Handling\", () =&gt; {\n  it(\"should handle missing dependency gracefully\", async () =&gt; {\n    // With no registry, dependencies will be null\n    const result = await agent.callTool(\"smart_greet\", { name: \"Test\" });\n\n    // Should use fallback behavior\n    expect(result).toContain(\"(service unavailable)\");\n  });\n});\n</code></pre>"},{"location":"typescript/examples/#mocking-dependencies","title":"Mocking Dependencies","text":"<pre><code>import { vi } from \"vitest\";\n\n// Mock a dependency proxy\nconst mockCalculator = vi.fn().mockResolvedValue(\"42\");\n\n// Inject mock into agent\nagent.setMockDependency(\"calculator\", mockCalculator);\n\n// Test\nconst result = await agent.callTool(\"calculate\", { expression: \"6*7\" });\nexpect(mockCalculator).toHaveBeenCalledWith({ expression: \"6*7\" });\nexpect(result).toBe(\"42\");\n</code></pre>"},{"location":"typescript/examples/#available-mcp-methods","title":"Available MCP Methods","text":"Method Description <code>tools/list</code> List all available tools <code>tools/call</code> Invoke a tool with arguments <code>prompts/list</code> List available prompts <code>resources/list</code> List available resources"},{"location":"typescript/examples/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man cli</code> - CLI commands reference</li> <li><code>meshctl man decorators --typescript</code> - TypeScript functions</li> <li><code>meshctl man deployment --typescript</code> - Deployment patterns</li> </ul>"},{"location":"typescript/express-integration/","title":"Express Integration","text":"<p>Use mesh dependency injection in Express backends with mesh.route()</p> <p>Note: This page covers TypeScript/Express integration. For Python/FastAPI, see <code>meshctl man fastapi</code>.</p>"},{"location":"typescript/express-integration/#overview","title":"Overview","text":"<p>MCP Mesh provides <code>mesh.route()</code> middleware for Express applications that need to consume mesh capabilities without being MCP agents themselves. This enables traditional REST APIs to leverage the mesh service layer.</p> <p>Important: This is for integrating MCP Mesh into your EXISTING Express app. There is no <code>meshctl scaffold</code> command for Express backends. To create a new MCP agent, use <code>meshctl scaffold --lang typescript</code> instead.</p>"},{"location":"typescript/express-integration/#installation","title":"Installation","text":"<pre><code>npm install @mcpmesh/sdk express\nnpm install -D @types/express tsx\n</code></pre>"},{"location":"typescript/express-integration/#two-architectures","title":"Two Architectures","text":"Pattern Function Use Case MCP Agent <code>mesh()</code> + auto-run Service that provides capabilities Express Backend <code>mesh.route()</code> REST API that consumes capabilities <pre><code>[Frontend] \u2192 [Express Backend] \u2192 [MCP Mesh] \u2192 [Agents]\n                   \u2191\n            mesh.route()\n</code></pre>"},{"location":"typescript/express-integration/#meshroute-function","title":"mesh.route() Function","text":"<pre><code>import express from \"express\";\nimport { mesh } from \"@mcpmesh/sdk\";\nimport type { McpMeshTool } from \"@mcpmesh/sdk\";\n\nconst app = express();\napp.use(express.json());\n\napp.post(\n  \"/chat\",\n  mesh.route(\n    [{ capability: \"avatar_chat\" }],\n    async (req, res, { avatar_chat }) =&gt; {\n      if (!avatar_chat) {\n        return res.status(503).json({ error: \"Service unavailable\" });\n      }\n      const result = await avatar_chat({\n        message: req.body.message,\n        user_email: \"user@example.com\",\n      });\n      res.json({ response: result.message });\n    },\n  ),\n);\n\napp.listen(3000);\n</code></pre>"},{"location":"typescript/express-integration/#dependency-declaration","title":"Dependency Declaration","text":""},{"location":"typescript/express-integration/#simple-by-capability-name","title":"Simple (by capability name)","text":"<pre><code>app.post(\n  \"/users\",\n  mesh.route(\n    [\"user_service\", \"notification_service\"],\n    async (req, res, { user_service, notification_service }) =&gt; {\n      // Dependencies are keyed by capability name\n    },\n  ),\n);\n</code></pre>"},{"location":"typescript/express-integration/#with-tag-filtering","title":"With Tag Filtering","text":"<pre><code>app.post(\n  \"/analyze\",\n  mesh.route(\n    [\n      { capability: \"llm\", tags: [\"+claude\"] },\n      { capability: \"storage\", tags: [\"-deprecated\"] },\n    ],\n    async (req, res, { llm, storage }) =&gt; {\n      // Use filtered dependencies\n    },\n  ),\n);\n</code></pre>"},{"location":"typescript/express-integration/#complete-example","title":"Complete Example","text":"<pre><code>import express, { Request, Response } from \"express\";\nimport { mesh } from \"@mcpmesh/sdk\";\nimport type { McpMeshTool } from \"@mcpmesh/sdk\";\n\nconst app = express();\napp.use(express.json());\n\ninterface ChatRequest {\n  message: string;\n  avatarId?: string;\n}\n\ninterface ChatResponse {\n  response: string;\n  avatarId: string;\n}\n\n// Chat endpoint that delegates to mesh avatar agent\napp.post(\n  \"/api/chat\",\n  mesh.route(\n    [{ capability: \"avatar_chat\" }],\n    async (\n      req: Request&lt;{}, ChatResponse, ChatRequest&gt;,\n      res: Response&lt;ChatResponse&gt;,\n      { avatar_chat },\n    ) =&gt; {\n      if (!avatar_chat) {\n        return res.status(503).json({\n          response: \"Avatar service unavailable\",\n          avatarId: \"\",\n        });\n      }\n\n      const result = await avatar_chat({\n        message: req.body.message,\n        avatar_id: req.body.avatarId || \"default\",\n        user_email: \"user@example.com\",\n      });\n\n      res.json({\n        response: result.message || \"\",\n        avatarId: req.body.avatarId || \"default\",\n      });\n    },\n  ),\n);\n\n// History endpoint using mesh agent\napp.get(\n  \"/api/history\",\n  mesh.route(\n    [{ capability: \"conversation_history_get\" }],\n    async (req, res, { conversation_history_get }) =&gt; {\n      const result = await conversation_history_get({\n        avatar_id: req.query.avatarId || \"default\",\n        limit: parseInt(req.query.limit as string) || 50,\n      });\n      res.json({ messages: result.messages || [] });\n    },\n  ),\n);\n\napp.listen(3000, () =&gt; {\n  console.log(\"Express server listening on port 3000\");\n});\n</code></pre>"},{"location":"typescript/express-integration/#running-your-express-app","title":"Running Your Express App","text":"<p>Run your existing Express application as you normally would:</p> <pre><code>export MCP_MESH_REGISTRY_URL=http://localhost:8000\nnpx tsx src/server.ts\n</code></pre> <p>Note: Unlike MCP agents, Express backends are NOT started with <code>meshctl start</code>.</p> <p>The backend will:</p> <ol> <li>Auto-initialize mesh connection on first <code>mesh.route()</code> call</li> <li>Connect to the mesh registry</li> <li>Resolve dependencies declared in <code>mesh.route()</code></li> <li>Inject proxies into route handlers as the <code>deps</code> object</li> <li>Re-resolve on topology changes (auto-rewiring)</li> </ol>"},{"location":"typescript/express-integration/#advanced-explicit-control","title":"Advanced: Explicit Control","text":"<p>For cases where you need more control over initialization:</p> <pre><code>import express from \"express\";\nimport { meshExpress, mesh } from \"@mcpmesh/sdk\";\n\nconst app = express();\napp.use(express.json());\n\n// Explicit mesh configuration\nconst meshApp = meshExpress(app, {\n  name: \"my-api\",\n  port: 3000,\n  registryUrl: \"http://localhost:8000\",\n});\n\n// Define routes with mesh.route()\napp.post(\n  \"/compute\",\n  mesh.route(\n    [{ capability: \"calculator\" }],\n    async (req, res, { calculator }) =&gt; {\n      res.json({ result: await calculator(req.body) });\n    },\n  ),\n);\n\n// Explicitly start the mesh connection\nmeshApp.start();\n</code></pre>"},{"location":"typescript/express-integration/#key-differences-from-mesh","title":"Key Differences from mesh()","text":"Aspect mesh() (MCP Agent) mesh.route() (Express) Registers with mesh Yes No Provides capabilities Yes No Consumes capabilities Yes Yes Has heartbeat Yes Yes (for dependency resolution) Protocol MCP JSON-RPC REST/HTTP Use case Microservice API Gateway/Backend"},{"location":"typescript/express-integration/#when-to-use-meshroute","title":"When to Use mesh.route()","text":"<ul> <li>Building a REST API that fronts mesh services</li> <li>API gateway pattern</li> <li>Backend-for-Frontend (BFF) services</li> <li>Adding REST endpoints to existing Express apps</li> <li>When you need traditional HTTP semantics (REST, OpenAPI docs)</li> </ul>"},{"location":"typescript/express-integration/#when-to-use-mesh-instead","title":"When to Use mesh() Instead","text":"<ul> <li>Building reusable mesh capabilities</li> <li>Service-to-service communication</li> <li>LLM tool providers</li> <li>When other agents need to discover and call your service</li> </ul>"},{"location":"typescript/express-integration/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man decorators</code> - All mesh decorators and functions</li> <li><code>meshctl man dependency-injection</code> - How DI works</li> <li><code>meshctl man proxies</code> - Proxy configuration</li> <li><code>meshctl man fastapi</code> - Python/FastAPI equivalent</li> </ul>"},{"location":"typescript/mesh-functions/","title":"Mesh Functions","text":"\ud83d\udc0d Looking for Python? See Python Decorators"},{"location":"typescript/mesh-functions/#mcp-mesh-functions-typescript","title":"MCP Mesh Functions (TypeScript)","text":"<p>Core functions for building distributed agent systems</p>"},{"location":"typescript/mesh-functions/#overview","title":"Overview","text":"<p>MCP Mesh provides core functions that transform regular TypeScript functions into mesh-aware distributed services. These functions handle registration, dependency injection, and communication automatically.</p> Function Purpose <code>mesh()</code> Create mesh agent wrapping FastMCP <code>agent.addTool()</code> Register capability with DI <code>mesh.llm()</code> Enable LLM-powered tools <code>mesh.llmProvider()</code> Create LLM provider (zero-code) <code>mesh.route()</code> Express route with mesh DI"},{"location":"typescript/mesh-functions/#mesh-function","title":"mesh() Function","text":"<p>Creates a MeshAgent that wraps a FastMCP server with mesh capabilities.</p> <pre><code>import { FastMCP } from \"fastmcp\";\nimport { mesh } from \"@mcpmesh/sdk\";\n\nconst server = new FastMCP({\n  name: \"My Service\",\n  version: \"1.0.0\",\n});\n\nconst agent = mesh(server, {\n  name: \"my-service\", // Required: unique agent identifier\n  version: \"1.0.0\", // Semantic version\n  description: \"Service desc\", // Human-readable description\n  port: 8080, // HTTP server port (0 = auto-assign)\n  host: \"localhost\", // Host announced to registry\n  namespace: \"default\", // Namespace for isolation\n  heartbeatInterval: 30, // Heartbeat interval in seconds\n});\n</code></pre>"},{"location":"typescript/mesh-functions/#agentaddtool","title":"agent.addTool()","text":"<p>Registers a function as a mesh capability with dependency injection.</p> <pre><code>import { z } from \"zod\";\n\nagent.addTool({\n  name: \"greet\",\n  capability: \"greeting\", // Capability name for discovery\n  description: \"Greets users\", // Human-readable description\n  version: \"1.0.0\", // Capability version\n  tags: [\"greeting\", \"utility\"], // Tags for filtering\n  dependencies: [\"date_service\"], // Required capabilities\n  parameters: z.object({\n    name: z.string(),\n  }),\n  execute: async (\n    { name }, // Input parameters\n    { date_service }, // Injected dependencies (nullable)\n  ) =&gt; {\n    if (date_service) {\n      const today = await date_service({});\n      return `Hello ${name}! Today is ${today}`;\n    }\n    return `Hello ${name}!`; // Graceful degradation\n  },\n});\n</code></pre> <p>Note: Dependencies are injected as the second parameter object, keyed by capability name. They may be <code>null</code> if unavailable.</p>"},{"location":"typescript/mesh-functions/#dependency-injection-types","title":"Dependency Injection Types","text":"Type Use Case <code>McpMeshTool</code> Tool calls via proxy <code>null</code> Dependency unavailable"},{"location":"typescript/mesh-functions/#meshllm","title":"mesh.llm()","text":"<p>Creates an LLM-powered tool with automatic tool discovery.</p> <pre><code>import { z } from \"zod\";\n\nagent.addTool({\n  name: \"assist\",\n  ...mesh.llm({\n    provider: { capability: \"llm\", tags: [\"+claude\"] }, // LLM provider selector\n    maxIterations: 5, // Max agentic loop iterations\n    systemPrompt: \"file://prompts/agent.hbs\", // Handlebars template\n    contextParam: \"ctx\", // Parameter name for context\n    filter: [{ tags: [\"tools\"] }], // Tool filter for discovery\n    filterMode: \"all\", // \"all\", \"best_match\", or \"*\"\n  }),\n  capability: \"smart_assistant\",\n  description: \"LLM-powered assistant\",\n  parameters: z.object({\n    ctx: z.object({\n      query: z.string(),\n    }),\n  }),\n  execute: async ({ ctx }, { llm }) =&gt; {\n    return llm(\"Help the user with their request\");\n  },\n});\n</code></pre>"},{"location":"typescript/mesh-functions/#filter-modes","title":"Filter Modes","text":"Mode Description <code>all</code> Include all tools matching any filter <code>best_match</code> One tool per capability (best tag match) <code>*</code> All available tools (wildcard)"},{"location":"typescript/mesh-functions/#meshllmprovider","title":"mesh.llmProvider()","text":"<p>Creates a zero-code LLM provider wrapping LiteLLM-compatible APIs.</p> <pre><code>agent.addTool({\n  name: \"claude_chat\",\n  ...mesh.llmProvider({\n    model: \"anthropic/claude-sonnet-4-5\", // LiteLLM model string\n    capability: \"llm\", // Capability name\n    tags: [\"llm\", \"claude\", \"provider\"], // Discovery tags\n    version: \"1.0.0\", // Provider version\n  }),\n});\n</code></pre>"},{"location":"typescript/mesh-functions/#meshroute","title":"mesh.route()","text":"<p>Enables mesh dependency injection in Express route handlers. Use this when building REST APIs that consume mesh capabilities.</p> <pre><code>import express from \"express\";\nimport { mesh } from \"@mcpmesh/sdk\";\n\nconst app = express();\napp.use(express.json());\n\napp.post(\n  \"/chat\",\n  mesh.route(\n    [{ capability: \"avatar_chat\" }], // Dependencies\n    async (req, res, { avatar_chat }) =&gt; {\n      if (!avatar_chat) {\n        return res.status(503).json({ error: \"Service unavailable\" });\n      }\n      const result = await avatar_chat({\n        message: req.body.message,\n        user_email: \"user@example.com\",\n      });\n      res.json({ response: result.message });\n    },\n  ),\n);\n\napp.listen(3000);\n</code></pre> <p>Note: <code>mesh.route()</code> is for Express backends that consume mesh capabilities. Use <code>agent.addTool()</code> for MCP agents that provide capabilities.</p> <p>See <code>meshctl man express</code> for complete Express integration guide.</p>"},{"location":"typescript/mesh-functions/#environment-variable-overrides","title":"Environment Variable Overrides","text":"<p>All configuration can be overridden via environment variables:</p> <pre><code>export MCP_MESH_AGENT_NAME=custom-name\nexport MCP_MESH_HTTP_PORT=9090\nexport MCP_MESH_NAMESPACE=production\nexport MCP_MESH_REGISTRY_URL=http://registry:8000\n</code></pre>"},{"location":"typescript/mesh-functions/#complete-example","title":"Complete Example","text":"<pre><code>import { FastMCP } from \"fastmcp\";\nimport { mesh } from \"@mcpmesh/sdk\";\nimport { z } from \"zod\";\n\nconst server = new FastMCP({\n  name: \"Calculator Service\",\n  version: \"1.0.0\",\n});\n\nconst agent = mesh(server, {\n  name: \"calculator\",\n  port: 9000,\n});\n\n// Basic tool\nagent.addTool({\n  name: \"add\",\n  capability: \"calculator_add\",\n  description: \"Add two numbers\",\n  tags: [\"math\", \"calculator\"],\n  parameters: z.object({\n    a: z.number(),\n    b: z.number(),\n  }),\n  execute: async ({ a, b }) =&gt; String(a + b),\n});\n\n// Tool with dependency\nagent.addTool({\n  name: \"calculate_with_logging\",\n  capability: \"calculator_logged\",\n  description: \"Calculate with audit logging\",\n  dependencies: [\"audit_log\"],\n  parameters: z.object({\n    operation: z.string(),\n    a: z.number(),\n    b: z.number(),\n  }),\n  execute: async ({ operation, a, b }, { audit_log }) =&gt; {\n    const result = operation === \"add\" ? a + b : a - b;\n    if (audit_log) {\n      await audit_log({ operation, a, b, result });\n    }\n    return String(result);\n  },\n});\n\n// Agent auto-starts - no explicit run() call needed!\n</code></pre>"},{"location":"typescript/mesh-functions/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man dependency-injection</code> - DI details</li> <li><code>meshctl man llm --typescript</code> - LLM integration guide</li> <li><code>meshctl man tags</code> - Tag matching system</li> <li><code>meshctl man capabilities</code> - Capabilities system</li> <li><code>meshctl man express</code> - Express integration with mesh.route()</li> </ul>"},{"location":"typescript/getting-started/","title":"Quick Start","text":"\ud83d\udc0d Looking for Python? See Python Quick Start"},{"location":"typescript/getting-started/#quick-start","title":"Quick Start","text":"<p>Get started with MCP Mesh in minutes (TypeScript)</p>"},{"location":"typescript/getting-started/#prerequisites","title":"Prerequisites","text":"<pre><code># Node.js 18+\nnode --version\n\n# Create project directory\nmkdir my-mesh-project &amp;&amp; cd my-mesh-project\n</code></pre>"},{"location":"typescript/getting-started/#1-start-the-registry","title":"1. Start the Registry","text":"<pre><code># Terminal 1: Start registry\nmeshctl start --registry-only --debug\n</code></pre>"},{"location":"typescript/getting-started/#2-create-your-first-agent","title":"2. Create Your First Agent","text":"<pre><code># Terminal 2: Scaffold a TypeScript agent\nmeshctl scaffold --name greeter --agent-type tool --lang typescript\n</code></pre> <p>This creates <code>greeter/src/index.ts</code>:</p> <pre><code>import { mesh, MeshAgent } from \"@mcpmesh/sdk\";\n\nconst app = new MeshAgent({\n  name: \"greeter\",\n  version: \"1.0.0\",\n  port: 9000,\n});\n\napp.tool(\n  mesh({\n    capability: \"greeting\",\n    description: \"Greet a user by name\",\n  }),\n  async ({ name }: { name: string }) =&gt; {\n    return `Hello, ${name}!`;\n  },\n);\n\napp.run();\n</code></pre>"},{"location":"typescript/getting-started/#3-install-dependencies-and-run","title":"3. Install Dependencies and Run","text":"<pre><code># Terminal 2: Install and start\ncd greeter\nnpm install\nmeshctl start src/index.ts --debug\n</code></pre>"},{"location":"typescript/getting-started/#4-test-the-agent","title":"4. Test the Agent","text":"<pre><code># Terminal 3: Call the agent\nmeshctl call greeter greeting --params '{\"name\": \"World\"}'\n# Output: Hello, World!\n\n# Or list running agents\nmeshctl list\n</code></pre>"},{"location":"typescript/getting-started/#5-add-a-dependency","title":"5. Add a Dependency","text":"<p>Create a second agent that depends on the greeter:</p> <pre><code>meshctl scaffold --name assistant --agent-type tool --lang typescript --port 9001\n</code></pre> <p>Edit <code>assistant/src/index.ts</code>:</p> <pre><code>import { mesh, MeshAgent, McpMeshTool } from \"@mcpmesh/sdk\";\n\nconst app = new MeshAgent({\n  name: \"assistant\",\n  version: \"1.0.0\",\n  port: 9001,\n});\n\napp.tool(\n  mesh({\n    capability: \"smart_greeting\",\n    description: \"Enhanced greeting with time\",\n    dependencies: [\"greeting\"], // Depend on greeter\n  }),\n  async (\n    { name }: { name: string },\n    { greeting }: { greeting: McpMeshTool | null }, // Injected!\n  ) =&gt; {\n    if (greeting) {\n      const baseGreeting = await greeting({ name });\n      return `${baseGreeting} Welcome to MCP Mesh!`;\n    }\n    return `Hello, ${name}! (greeter unavailable)`;\n  },\n);\n\napp.run();\n</code></pre> <pre><code># Install and start the assistant\ncd assistant\nnpm install\nmeshctl start src/index.ts --debug\n\n# Call the smart greeting\nmeshctl call assistant smart_greeting --params '{\"name\": \"Developer\"}'\n# Output: Hello, Developer! Welcome to MCP Mesh!\n</code></pre>"},{"location":"typescript/getting-started/#next-steps","title":"Next Steps","text":"<ul> <li><code>meshctl man decorators --typescript</code> - Learn all mesh functions</li> <li><code>meshctl man llm --typescript</code> - Add LLM capabilities</li> <li><code>meshctl man deployment --typescript</code> - Deploy to Docker/Kubernetes</li> <li><code>meshctl man express</code> - Express REST API integration</li> </ul>"},{"location":"typescript/getting-started/#see-also","title":"See Also","text":"<ul> <li><code>meshctl scaffold --help</code> - All scaffold options</li> <li><code>meshctl man prerequisites</code> - Full setup guide</li> </ul>"},{"location":"typescript/getting-started/prerequisites/","title":"Prerequisites","text":"\ud83d\udc0d Looking for Python? See Python Prerequisites"},{"location":"typescript/getting-started/prerequisites/#prerequisites","title":"Prerequisites","text":"<p>What you need before building MCP Mesh agents</p> <p>MCP Mesh supports both Python and TypeScript. Choose the language that fits your needs\u2014or use both in the same mesh.</p>"},{"location":"typescript/getting-started/prerequisites/#windows-users","title":"Windows Users","text":"<p><code>meshctl</code> and <code>mcp-mesh-registry</code> require a Unix-like environment on Windows:</p> <ul> <li>WSL2 (recommended) - Full Linux environment</li> <li>Git Bash - Lightweight option</li> </ul> <p>Alternatively, use Docker Desktop for containerized development.</p>"},{"location":"typescript/getting-started/prerequisites/#local-development","title":"Local Development","text":"<p>For developing and testing agents locally. Choose your preferred language:</p>"},{"location":"typescript/getting-started/prerequisites/#python-311","title":"Python 3.11+","text":"<pre><code># Check version\npython3 --version  # Need 3.11+\n\n# Install if needed\nbrew install python@3.11          # macOS\nsudo apt install python3.11       # Ubuntu/Debian\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#virtual-environment-recommended","title":"Virtual Environment (Recommended)","text":"<p>Create a virtual environment at your project root (where you run <code>meshctl</code>). All agents share this single venv - do not create separate venvs inside agent folders.</p> <p>Note: <code>meshctl</code> is a Go binary that auto-detects <code>.venv</code> in the current directory. You only need to activate the venv for <code>pip</code> commands - meshctl commands work without activation.</p> <pre><code># At project root - create venv (one-time setup)\npython3.11 -m venv .venv\n\n# Activate only when using pip\nsource .venv/bin/activate         # macOS/Linux\n.venv\\Scripts\\activate            # Windows\npip install --upgrade pip\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#mcp-mesh-sdk","title":"MCP Mesh SDK","text":"<pre><code>pip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\n\n# Verify\npython -c \"import mesh; print('Ready!')\"\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#quick-start-python","title":"Quick Start (Python)","text":"<pre><code># 1. Create venv and install SDK (one-time setup)\npython3.11 -m venv .venv\nsource .venv/bin/activate    # Only needed for pip\npip install --upgrade pip\npip install \"mcp-mesh&gt;=0.8,&lt;0.9\"\ndeactivate                   # Can deactivate after pip install\n\n# 2. Scaffold agents - meshctl auto-detects .venv (no activation needed)\nmeshctl scaffold --name hello --agent-type basic\nmeshctl scaffold --name assistant --agent-type llm-agent\n\n# 3. Run agent - meshctl uses .venv/bin/python automatically\nmeshctl start hello/main.py --debug\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#nodejs-18-for-typescript","title":"Node.js 18+ (for TypeScript)","text":"<pre><code># Check version\nnode --version   # Need 18+\nnpm --version\n\n# Install if needed\nbrew install node          # macOS\nsudo apt install nodejs    # Ubuntu/Debian\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#typescript-sdk","title":"TypeScript SDK","text":"<pre><code># In your agent directory\nnpm init -y\nnpm install @mcpmesh/sdk\n\n# Verify\nnpx tsx -e \"import { mesh } from '@mcpmesh/sdk'; console.log('Ready!')\"\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#quick-start-typescript","title":"Quick Start (TypeScript)","text":"<pre><code># 1. Scaffold TypeScript agent\nmeshctl scaffold --name hello --agent-type basic --lang typescript\n\n# 2. Install dependencies\ncd hello\nnpm install\n\n# 3. Run agent - meshctl uses npx tsx automatically\nmeshctl start src/index.ts --debug\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#docker-deployment","title":"Docker Deployment","text":"<p>For containerized deployments.</p>"},{"location":"typescript/getting-started/prerequisites/#docker-docker-compose","title":"Docker &amp; Docker Compose","text":"<pre><code># Check installation\ndocker --version\ndocker compose version\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#mcp-mesh-images","title":"MCP Mesh Images","text":"Image Description <code>mcpmesh/registry:0.8</code> Registry service <code>mcpmesh/python-runtime:0.8</code> Python runtime with SDK <code>mcpmesh/typescript-runtime:0.8</code> TypeScript runtime with SDK <pre><code># Pull images\ndocker pull mcpmesh/registry:0.8\ndocker pull mcpmesh/python-runtime:0.8\ndocker pull mcpmesh/typescript-runtime:0.8\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#generate-docker-compose","title":"Generate Docker Compose","text":"<pre><code>meshctl scaffold --compose              # Basic stack\nmeshctl scaffold --compose --observability  # With Grafana/Tempo\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#kubernetes-deployment","title":"Kubernetes Deployment","text":"<p>For production Kubernetes clusters.</p>"},{"location":"typescript/getting-started/prerequisites/#kubectl","title":"kubectl","text":"<pre><code>kubectl version --client\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#helm-3","title":"Helm 3+","text":"<pre><code>helm version\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#mcp-mesh-helm-charts","title":"MCP Mesh Helm Charts","text":"<p>Available from OCI registry (no <code>helm repo add</code> needed):</p> Chart Description <code>oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-core</code> Registry + DB + Observability <code>oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-agent</code> Deploy agents <pre><code># Install core infrastructure\nhelm install mcp-core oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-core \\\n  --version 0.8.0-beta.6 \\\n  -n mcp-mesh --create-namespace\n\n# Deploy an agent\nhelm install my-agent oci://ghcr.io/dhyansraj/mcp-mesh/mcp-mesh-agent \\\n  --version 0.8.0-beta.6 \\\n  -n mcp-mesh \\\n  -f helm-values.yaml\n</code></pre>"},{"location":"typescript/getting-started/prerequisites/#cluster-options","title":"Cluster Options","text":"<ul> <li>Minikube - Local testing</li> <li>Kind - Lightweight local clusters</li> <li>Cloud - GKE, EKS, AKS for production</li> </ul>"},{"location":"typescript/getting-started/prerequisites/#version-compatibility","title":"Version Compatibility","text":"Component Minimum Recommended Python 3.11 3.12 Node.js 18 20+ Docker 20.10 Latest Kubernetes 1.25 1.28+ Helm 3.10 3.14+"},{"location":"typescript/getting-started/prerequisites/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man deployment</code> - Deployment patterns</li> <li><code>meshctl man environment</code> - Configuration options</li> <li><code>meshctl scaffold --help</code> - Generate agents</li> </ul>"},{"location":"typescript/llm/","title":"LLM Integration","text":"\ud83d\udc0d Looking for Python? See Python LLM Integration"},{"location":"typescript/llm/#llm-integration-typescript","title":"LLM Integration (TypeScript)","text":"<p>Building LLM-powered agents with mesh.llm()</p>"},{"location":"typescript/llm/#overview","title":"Overview","text":"<p>MCP Mesh provides first-class support for LLM-powered agents through <code>mesh.llm()</code>. This enables agentic loops where LLMs can discover and use mesh tools automatically.</p>"},{"location":"typescript/llm/#whats-included","title":"What's Included","text":"<p>The <code>@mcpmesh/sdk</code> package includes LLM support out of the box via the Vercel AI SDK:</p> <ul> <li>Claude (Anthropic) - <code>@ai-sdk/anthropic</code></li> <li>GPT (OpenAI) - <code>@ai-sdk/openai</code></li> </ul> <p>No additional packages needed. Just set your API keys:</p> <pre><code>export ANTHROPIC_API_KEY=sk-ant-...\nexport OPENAI_API_KEY=sk-...\n</code></pre>"},{"location":"typescript/llm/#meshllm-function","title":"mesh.llm() Function","text":"<pre><code>import { FastMCP } from \"fastmcp\";\nimport { mesh } from \"@mcpmesh/sdk\";\nimport { z } from \"zod\";\n\nconst server = new FastMCP({ name: \"Smart Assistant\", version: \"1.0.0\" });\nconst agent = mesh(server, { name: \"smart-assistant\", port: 9003 });\n\nagent.addTool({\n  name: \"assist\",\n  ...mesh.llm({\n    provider: { capability: \"llm\", tags: [\"+claude\"] },\n    maxIterations: 5,\n    systemPrompt: \"file://prompts/assistant.hbs\",\n    contextParam: \"ctx\",\n    filter: [{ tags: [\"tools\"] }],\n    filterMode: \"all\",\n  }),\n  capability: \"smart_assistant\",\n  description: \"LLM-powered assistant\",\n  parameters: z.object({\n    ctx: z.object({\n      query: z.string(),\n    }),\n  }),\n  execute: async ({ ctx }, { llm }) =&gt; {\n    return llm(\"Help the user with their request\");\n  },\n});\n</code></pre>"},{"location":"typescript/llm/#parameters","title":"Parameters","text":"Parameter Type Description <code>provider</code> <code>LlmProviderSpec</code> LLM provider selector (capability + tags) <code>maxIterations</code> <code>number</code> Max agentic loop iterations (default: 10) <code>systemPrompt</code> <code>string</code> System prompt or file path (Handlebars template) <code>contextParam</code> <code>string</code> Parameter name passed to template context <code>filter</code> <code>LlmFilterSpec[]</code> Tool filter for discovery <code>filterMode</code> <code>string</code> How to select tools: \"all\", \"best_match\", \"*\" <code>returns</code> <code>ZodType</code> Optional: Schema for structured output"},{"location":"typescript/llm/#provider-selector","title":"Provider Selector","text":"<p>Select LLM providers using capability and tag matching:</p> <pre><code>// Simple: just capability name\nprovider: \"llm\"\n\n// With tags for specific provider\nprovider: { capability: \"llm\", tags: [\"+claude\"] }\n\n// Exclude certain providers\nprovider: { capability: \"llm\", tags: [\"-openai\"] }\n</code></pre>"},{"location":"typescript/llm/#system-prompts-with-handlebars","title":"System Prompts with Handlebars","text":"<p>System prompts support Handlebars templating:</p> <pre><code>// Inline prompt\nsystemPrompt: \"You are a helpful assistant. User context: {{ctx.user}}\";\n\n// File-based prompt\nsystemPrompt: \"file://prompts/assistant.hbs\";\n</code></pre> <p>Template file (<code>prompts/assistant.hbs</code>):</p> <pre><code>You are a helpful assistant. User:\n{{ctx.user.name}}\nQuery:\n{{ctx.query}}\n\nAvailable tools will be provided. Use them to help the user.\n</code></pre>"},{"location":"typescript/llm/#structured-output","title":"Structured Output","text":"<p>Use Zod schemas for type-safe structured responses:</p> <pre><code>import { z } from \"zod\";\n\nconst AssistResponse = z.object({\n  answer: z.string(),\n  confidence: z.number().min(0).max(1),\n  sources: z.array(z.string()).optional(),\n});\n\nagent.addTool({\n  name: \"analyze\",\n  ...mesh.llm({\n    provider: { capability: \"llm\", tags: [\"+claude\"] },\n    systemPrompt: \"Analyze the query and provide a structured response.\",\n    returns: AssistResponse, // Enables structured output\n  }),\n  capability: \"analyzer\",\n  description: \"Analyzes queries with structured output\",\n  parameters: z.object({\n    query: z.string(),\n  }),\n  execute: async ({ query }, { llm }) =&gt; {\n    // Returns AssistResponse type\n    const result = await llm(query);\n    return JSON.stringify(result);\n  },\n});\n</code></pre>"},{"location":"typescript/llm/#tool-filtering","title":"Tool Filtering","text":"<p>Control which mesh tools the LLM can access:</p> <pre><code>// All tools with specific tags\nfilter: [{ tags: [\"tools\", \"safe\"] }];\n\n// Specific capabilities\nfilter: [{ capability: \"calculator\" }, { capability: \"weather\" }];\n\n// Mixed filtering\nfilter: [{ capability: \"data\", tags: [\"+fast\"] }, { tags: [\"utility\"] }];\n</code></pre>"},{"location":"typescript/llm/#filter-modes","title":"Filter Modes","text":"Mode Description <code>all</code> Include all tools matching any filter <code>best_match</code> One tool per capability (best tag match) <code>*</code> All available tools in the mesh (wildcard)"},{"location":"typescript/llm/#creating-llm-providers","title":"Creating LLM Providers","text":"<p>Create zero-code LLM providers with <code>agent.addLlmProvider()</code>:</p> <pre><code>import { FastMCP, mesh } from \"@mcpmesh/sdk\";\n\nconst server = new FastMCP({ name: \"Claude Provider\", version: \"1.0.0\" });\nconst agent = mesh(server, { name: \"claude-provider\", port: 9001 });\n\n// Single provider (default name: \"process_chat\")\nagent.addLlmProvider({\n  model: \"anthropic/claude-sonnet-4-5\",\n  capability: \"llm\",\n  tags: [\"llm\", \"claude\", \"provider\"],\n});\n\n// Multiple providers in one agent (use custom names)\nagent.addLlmProvider({\n  name: \"sonnet_chat\", // Custom tool name\n  model: \"anthropic/claude-sonnet-4-5\",\n  capability: \"llm\",\n  tags: [\"llm\", \"claude\", \"sonnet\"],\n});\n\nagent.addLlmProvider({\n  name: \"opus_chat\", // Different tool name\n  model: \"anthropic/claude-opus-4\",\n  capability: \"llm\",\n  tags: [\"llm\", \"claude\", \"opus\"],\n});\n</code></pre>"},{"location":"typescript/llm/#llm-provider-parameters","title":"LLM Provider Parameters","text":"Parameter Type Default Description <code>model</code> <code>string</code> (required) LiteLLM model format (e.g., \"anthropic/claude-sonnet-4-5\") <code>name</code> <code>string</code> <code>\"process_chat\"</code> Tool name for MCP registration <code>capability</code> <code>string</code> <code>\"llm\"</code> Capability name for mesh discovery <code>tags</code> <code>string[]</code> <code>[]</code> Tags for provider selection <code>version</code> <code>string</code> <code>\"1.0.0\"</code> Version for mesh registration <code>maxTokens</code> <code>number</code> (model default) Maximum tokens to generate <code>temperature</code> <code>number</code> (model default) Sampling temperature <code>topP</code> <code>number</code> (model default) Top-p sampling <code>description</code> <code>string</code> (auto-generated) Tool description"},{"location":"typescript/llm/#supported-models","title":"Supported Models","text":"<p>Uses LiteLLM model format:</p> Provider Model Format Anthropic <code>anthropic/claude-sonnet-4-5</code> OpenAI <code>openai/gpt-4o</code> Google <code>gemini/gemini-pro</code> Mistral <code>mistral/mistral-large-latest</code> Ollama <code>ollama/llama3</code>"},{"location":"typescript/llm/#complete-example","title":"Complete Example","text":"<pre><code>import { FastMCP, mesh } from \"@mcpmesh/sdk\";\nimport { z } from \"zod\";\n\n// 1. Create LLM Provider\nconst providerServer = new FastMCP({ name: \"Claude\", version: \"1.0.0\" });\nconst provider = mesh(providerServer, { name: \"claude-provider\", port: 9001 });\n\nprovider.addLlmProvider({\n  name: \"chat\",\n  model: \"anthropic/claude-sonnet-4-5\",\n  capability: \"llm\",\n  tags: [\"llm\", \"claude\"],\n});\n\n// 2. Create Tool Agent\nconst toolServer = new FastMCP({ name: \"Calculator\", version: \"1.0.0\" });\nconst calculator = mesh(toolServer, { name: \"calculator\", port: 9002 });\n\ncalculator.addTool({\n  name: \"add\",\n  capability: \"calculator_add\",\n  tags: [\"tools\", \"math\"],\n  description: \"Add two numbers\",\n  parameters: z.object({ a: z.number(), b: z.number() }),\n  execute: async ({ a, b }) =&gt; String(a + b),\n});\n\n// 3. Create LLM Agent\nconst agentServer = new FastMCP({ name: \"Smart Assistant\", version: \"1.0.0\" });\nconst assistant = mesh(agentServer, { name: \"smart-assistant\", port: 9003 });\n\nassistant.addTool({\n  name: \"assist\",\n  ...mesh.llm({\n    provider: { capability: \"llm\", tags: [\"+claude\"] },\n    systemPrompt: \"You are a helpful assistant with access to a calculator.\",\n    filter: [{ tags: [\"tools\"] }],\n    maxIterations: 5,\n  }),\n  capability: \"assistant\",\n  description: \"LLM-powered assistant\",\n  parameters: z.object({ message: z.string() }),\n  execute: async ({ message }, { llm }) =&gt; llm(message),\n});\n</code></pre>"},{"location":"typescript/llm/#see-also","title":"See Also","text":"<ul> <li><code>meshctl man decorators --typescript</code> - All mesh functions</li> <li><code>meshctl man tags</code> - Tag matching for provider selection</li> <li><code>meshctl man capabilities</code> - Capability discovery</li> </ul>"},{"location":"typescript/local-development/","title":"Local Development (TypeScript)","text":"\ud83d\udc0d Looking for Python? See Python Local Development <p>Develop MCP Mesh agents locally with TypeScript</p>"},{"location":"typescript/local-development/#development-workflow","title":"Development Workflow","text":"<pre><code>graph LR\n    A[Install] --&gt; B[Scaffold]\n    B --&gt; C[Run]\n    C --&gt; D[Call &amp; Debug]\n    D --&gt; C</code></pre>"},{"location":"typescript/local-development/#guides","title":"Guides","text":"Guide What You'll Learn Getting Started Install meshctl CLI and TypeScript SDK Scaffold Agents Generate agents with <code>meshctl scaffold</code> Run Agents Start agents with hot reload, debug mode Inspect the Mesh View agents, tools, and dependencies Call &amp; Debug Tools Call tools and trace distributed calls Troubleshooting Common issues and solutions"},{"location":"typescript/local-development/#quick-reference","title":"Quick Reference","text":"<pre><code># Install CLI\nnpm install -g @mcpmesh/cli\n\n# Set up TypeScript project\nmkdir my-mesh-project &amp;&amp; cd my-mesh-project\nnpm init -y\nnpm install @mcpmesh/sdk zod\nnpm install -D typescript tsx @types/node\n\n# Scaffold (interactive wizard)\nmeshctl scaffold\n\n# Run\nmeshctl start src/index.ts\nmeshctl start -w src/index.ts      # hot reload\nmeshctl start --debug src/index.ts # debug mode\n\n# Inspect\nmeshctl list                       # agents\nmeshctl list --tools               # all tools\nmeshctl status                     # wiring details\n\n# Call\nmeshctl call get_weather '{\"city\":\"London\"}'\nmeshctl call --trace get_weather   # with tracing\n\n# Debug\nmeshctl trace &lt;trace-id&gt;           # view call tree\nmeshctl logs my-agent -f           # follow logs\nmeshctl man --list                 # built-in docs\n</code></pre>"},{"location":"typescript/local-development/01-getting-started/","title":"Getting Started (TypeScript)","text":"\ud83d\udc0d Looking for Python? See Python Getting Started <p>Install meshctl CLI to start building MCP Mesh agents with TypeScript</p>"},{"location":"typescript/local-development/01-getting-started/#prerequisites","title":"Prerequisites","text":"<ul> <li>Node.js 18+ - for meshctl CLI and TypeScript runtime</li> </ul>"},{"location":"typescript/local-development/01-getting-started/#install-meshctl-cli","title":"Install meshctl CLI","text":"<pre><code>npm install -g @mcpmesh/cli\n\n# Verify\nmeshctl --version\n</code></pre> <p>Per-Agent Dependencies</p> <p>Unlike Python (shared <code>.venv</code>), each TypeScript agent is its own npm project. The SDK is installed per-agent via <code>npm install</code> after scaffolding.</p>"},{"location":"typescript/local-development/01-getting-started/#next-steps","title":"Next Steps","text":"<p>Continue to Scaffold Agents \u2014 creates a complete agent project with <code>package.json</code> and all dependencies listed.</p>"},{"location":"typescript/local-development/02-scaffold/","title":"Scaffold Agents (TypeScript)","text":"\ud83d\udc0d Looking for Python? See Python Scaffold <p>Generate agents with <code>meshctl scaffold</code></p>"},{"location":"typescript/local-development/02-scaffold/#interactive-mode-recommended","title":"Interactive Mode (Recommended)","text":"<p>The easiest way to create an agent:</p> <pre><code>meshctl scaffold --lang typescript\n</code></pre> <p>This launches an interactive wizard that guides you through:</p> <ul> <li>Agent name and type</li> <li>Capabilities and tools</li> <li>Output directory</li> </ul> <p>The generated code includes placeholder tools\u2014you'll need to edit <code>src/index.ts</code> to implement your logic.</p>"},{"location":"typescript/local-development/02-scaffold/#cli-mode","title":"CLI Mode","text":"<p>For scripting or when you know what you want:</p> <pre><code># Basic tool agent\nmeshctl scaffold --name my-agent --agent-type tool --lang typescript\n\n# LLM-powered agent\nmeshctl scaffold --name emotion-analyzer --agent-type llm-agent \\\n  --llm-selector openai --lang typescript\n\n# LLM provider (zero-code)\nmeshctl scaffold --name claude-provider --agent-type llm-provider \\\n  --model anthropic/claude-sonnet-4-5 --lang typescript\n</code></pre>"},{"location":"typescript/local-development/02-scaffold/#agent-types","title":"Agent Types","text":"Type Description Use Case <code>tool</code> Basic agent with <code>addTool()</code> Services, utilities, data processing <code>llm-agent</code> LLM-powered agent AI assistants, text analysis <code>llm-provider</code> Zero-code LLM wrapper Expose LLM as mesh capability"},{"location":"typescript/local-development/02-scaffold/#generated-files","title":"Generated Files","text":"<pre><code>my-agent/\n\u251c\u2500\u2500 src/\n\u2502   \u2514\u2500\u2500 index.ts      # Agent code - edit this to add your logic\n\u251c\u2500\u2500 package.json      # Add your dependencies here\n\u251c\u2500\u2500 tsconfig.json     # TypeScript config (ready to use)\n\u251c\u2500\u2500 Dockerfile        # Container build (ready to use)\n\u251c\u2500\u2500 helm-values.yaml  # Kubernetes config\n\u2514\u2500\u2500 README.md\n</code></pre> <p>After scaffolding:</p> <ol> <li><code>cd my-agent &amp;&amp; npm install</code></li> <li>Edit <code>src/index.ts</code> to implement your tool logic (placeholder returns <code>\"Not implemented\"</code>)</li> </ol>"},{"location":"typescript/local-development/02-scaffold/#add-tools-to-existing-agent","title":"Add Tools to Existing Agent","text":"<pre><code>meshctl scaffold --name my-agent --lang typescript --add-tool \\\n  --tool-name process_data \\\n  --tool-description \"Process incoming data\"\n</code></pre>"},{"location":"typescript/local-development/02-scaffold/#generate-docker-compose","title":"Generate Docker Compose","text":"<pre><code># Generate docker-compose.yml for all agents in directory\nmeshctl scaffold --compose\n\n# With observability stack (registry + Redis + Tempo + Grafana)\nmeshctl scaffold --compose --observability\n</code></pre> <p>Local Tracing Setup</p> <p>Use <code>--compose --observability</code> even if you run agents locally. Start the infrastructure with <code>docker compose up -d</code>, then run agents with <code>meshctl start</code>\u2014they auto-connect to the Docker registry. This enables <code>meshctl call --trace</code> and <code>meshctl trace</code>.</p>"},{"location":"typescript/local-development/02-scaffold/#preview-before-creating","title":"Preview Before Creating","text":"<pre><code># Dry run - see what would be generated\nmeshctl scaffold --name my-agent --agent-type tool --lang typescript --dry-run\n</code></pre>"},{"location":"typescript/local-development/02-scaffold/#more-options","title":"More Options","text":"<pre><code># See all scaffold options\nmeshctl scaffold --help\n\n# See available agent templates\nmeshctl scaffold --list-modes\n</code></pre>"},{"location":"typescript/local-development/02-scaffold/#next-steps","title":"Next Steps","text":"<p>Continue to Run Agents \u2192</p>"},{"location":"typescript/local-development/03-running-agents/","title":"Run Agents (TypeScript)","text":"\ud83d\udc0d Looking for Python? See Python Run Agents <p>Start agents with <code>meshctl start</code></p>"},{"location":"typescript/local-development/03-running-agents/#basic-usage","title":"Basic Usage","text":"<pre><code># Start a single agent\nmeshctl start src/index.ts\n</code></pre> <p>The registry starts automatically on port 8000 if not already running. If a registry is already running (e.g., in Docker), agents connect to it instead.</p>"},{"location":"typescript/local-development/03-running-agents/#multiple-agents","title":"Multiple Agents","text":"<pre><code># Start multiple agents at once (mixed languages supported)\nmeshctl start agent1/src/index.ts agent2/src/index.ts agent3.py\n</code></pre>"},{"location":"typescript/local-development/03-running-agents/#hot-reload","title":"Hot Reload","text":"<p>Auto-restart agents when code changes:</p> <pre><code>meshctl start -w src/index.ts\nmeshctl start --watch src/index.ts\n</code></pre>"},{"location":"typescript/local-development/03-running-agents/#debug-mode","title":"Debug Mode","text":"<p>Enable verbose logging:</p> <pre><code>meshctl start --debug src/index.ts\n\n# Or set specific log level\nmeshctl start --log-level DEBUG src/index.ts\n\n# Available levels: TRACE, DEBUG, INFO, WARN, ERROR\n</code></pre>"},{"location":"typescript/local-development/03-running-agents/#background-mode","title":"Background Mode","text":"<p>Run agents in the background (detached):</p> <pre><code># Start in background\nmeshctl start -d src/index.ts\n\n# View logs\nmeshctl logs my-agent -f\n\n# Stop background agents\nmeshctl stop --all\n</code></pre>"},{"location":"typescript/local-development/03-running-agents/#environment-variables","title":"Environment Variables","text":"<p>Share configuration across agents:</p> <pre><code># Load from .env file\nmeshctl start --env-file .env src/index.ts\n\n# Or pass individual variables\nmeshctl start --env OPENAI_API_KEY=sk-... src/index.ts\n</code></pre>"},{"location":"typescript/local-development/03-running-agents/#registry-options","title":"Registry Options","text":"<pre><code># Start registry only (no agents)\nmeshctl start --registry-only\n\n# Use custom registry port\nmeshctl start --registry-port 9000 src/index.ts\n\n# Connect to external registry\nmeshctl start --registry-url http://remote:8000 src/index.ts\n</code></pre>"},{"location":"typescript/local-development/03-running-agents/#common-patterns","title":"Common Patterns","text":"<pre><code># Development: hot reload + debug\nmeshctl start -w --debug src/index.ts\n\n# CI/Testing: background + quiet\nmeshctl start -d --quiet src/index.ts\n\n# Production-like: custom registry\nmeshctl start --registry-url http://registry:8000 src/index.ts\n</code></pre>"},{"location":"typescript/local-development/03-running-agents/#all-options","title":"All Options","text":"<pre><code>meshctl start --help\n</code></pre> <p>Key flags:</p> Flag Description <code>-w, --watch</code> Hot reload on file changes <code>-d, --detach</code> Run in background <code>--debug</code> Enable debug mode <code>--log-level</code> Set log level (TRACE/DEBUG/INFO/WARN/ERROR) <code>--env-file</code> Load environment from file <code>--env</code> Set individual env var <code>--registry-only</code> Start registry without agents <code>--registry-port</code> Registry port (default: 8000)"},{"location":"typescript/local-development/03-running-agents/#next-steps","title":"Next Steps","text":"<p>Continue to Inspect the Mesh \u2192</p>"},{"location":"typescript/local-development/04-inspecting-mesh/","title":"Inspect the Mesh (TypeScript)","text":"\ud83d\udc0d Looking for Python? See Python Inspect Mesh <p>View agents, tools, and dependencies with <code>meshctl list</code> and <code>meshctl status</code></p>"},{"location":"typescript/local-development/04-inspecting-mesh/#list-agents","title":"List Agents","text":"<pre><code># Show healthy agents (default)\nmeshctl list\n\n# Show all agents including unhealthy\nmeshctl list --all\n\n# Filter by name pattern\nmeshctl list --filter weather\n\n# Show additional columns (endpoints, tool counts)\nmeshctl list --wide\n</code></pre> <p>Example output:</p> <pre><code>NAME                    STATUS    DEPS     UPTIME\nhello-world-5395c5e4    healthy   2/2      5m\nsystem-agent-a1b2c3d4   healthy   0/0      5m\nweather-agent-x9y8z7    healthy   1/1      2m\n</code></pre>"},{"location":"typescript/local-development/04-inspecting-mesh/#list-tools","title":"List Tools","text":"<pre><code># List all tools across all agents\nmeshctl list --tools\nmeshctl list -t\n\n# Show details for a specific tool (schema, call spec)\nmeshctl list --tools=get_weather\n\n# Show tool from specific agent\nmeshctl list --tools=weather-agent:get_weather\n</code></pre> <p>Example output:</p> <pre><code>TOOL                 AGENT                   CAPABILITY\nget_weather          weather-agent-x9y8z7    weather_service\nget_current_time     system-agent-a1b2c3d4   system_info\nhello_mesh_simple    hello-world-5395c5e4    greeter\n</code></pre>"},{"location":"typescript/local-development/04-inspecting-mesh/#agent-status","title":"Agent Status","text":"<pre><code># Show wiring details for all agents\nmeshctl status\n\n# Show details for specific agent\nmeshctl status hello-world-5395c5e4\n</code></pre> <p>Shows:</p> <ul> <li>Agent metadata (name, version, capabilities)</li> <li>Resolved dependencies (which agents provide them)</li> <li>HTTP endpoint</li> <li>Health status</li> </ul>"},{"location":"typescript/local-development/04-inspecting-mesh/#json-output","title":"JSON Output","text":"<p>For scripting and automation:</p> <pre><code>meshctl list --json\nmeshctl status --json\nmeshctl list --tools --json\n</code></pre>"},{"location":"typescript/local-development/04-inspecting-mesh/#remote-registry","title":"Remote Registry","text":"<p>Inspect agents on a remote registry:</p> <pre><code>meshctl list --registry-url http://remote:8000\nmeshctl status --registry-url http://remote:8000\n</code></pre>"},{"location":"typescript/local-development/04-inspecting-mesh/#quick-reference","title":"Quick Reference","text":"Command Description <code>meshctl list</code> List healthy agents <code>meshctl list --all</code> List all agents <code>meshctl list -t</code> List all tools <code>meshctl list -t=&lt;tool&gt;</code> Show tool details <code>meshctl status</code> Show agent wiring <code>meshctl status &lt;agent&gt;</code> Show specific agent"},{"location":"typescript/local-development/04-inspecting-mesh/#next-steps","title":"Next Steps","text":"<p>Continue to Call &amp; Debug Tools \u2192</p>"},{"location":"typescript/local-development/05-calling-tools/","title":"Call &amp; Debug Tools (TypeScript)","text":"\ud83d\udc0d Looking for Python? See Python Call Tools <p>Call tools and trace distributed calls with <code>meshctl call</code>, <code>meshctl trace</code>, and <code>meshctl logs</code></p>"},{"location":"typescript/local-development/05-calling-tools/#call-tools","title":"Call Tools","text":"<pre><code># Auto-discover agent by tool name (recommended)\nmeshctl call get_weather\n\n# With JSON arguments\nmeshctl call add '{\"a\": 1, \"b\": 2}'\n\n# Arguments from file\nmeshctl call process --file data.json\n</code></pre>"},{"location":"typescript/local-development/05-calling-tools/#target-specific-agent","title":"Target Specific Agent","text":"<p>When multiple agents provide the same tool:</p> <pre><code># Use full agent ID from 'meshctl list'\nmeshctl call weather-agent-7f3a2b:get_weather '{\"city\": \"London\"}'\n</code></pre>"},{"location":"typescript/local-development/05-calling-tools/#distributed-tracing","title":"Distributed Tracing","text":"<p>Tracing requires Redis + Tempo in addition to the registry. The easiest way to set this up for local development:</p> <pre><code># 1. Generate docker-compose with observability stack\nmeshctl scaffold --compose --observability\n\n# 2. Start infrastructure (registry + Redis + Tempo)\ndocker compose up -d\n\n# 3. Run your agents locally (auto-connects to Docker registry)\nmeshctl start my-agent/src/index.ts\n</code></pre> <p>Now you can trace calls:</p> <pre><code># Call with tracing enabled\nmeshctl call --trace get_weather '{\"city\": \"London\"}'\n</code></pre> <p>Output includes a trace ID:</p> <pre><code>Result: {\"temperature\": 20, \"conditions\": \"cloudy\"}\nTrace ID: abc123def456789\n</code></pre>"},{"location":"typescript/local-development/05-calling-tools/#view-call-tree","title":"View Call Tree","text":"<pre><code># View the full call tree\nmeshctl trace abc123def456789\n</code></pre> <p>Shows the complete call hierarchy:</p> <pre><code>get_weather (weather-agent) 120ms\n\u251c\u2500\u2500 fetch_coordinates (geo-agent) 45ms\n\u2514\u2500\u2500 get_forecast (forecast-agent) 65ms\n    \u2514\u2500\u2500 cache_lookup (cache-agent) 5ms\n</code></pre> <p>Without Docker</p> <p>If you're not running the observability stack, <code>meshctl call</code> still works but <code>--trace</code> won't capture data and <code>meshctl trace</code> won't return results.</p>"},{"location":"typescript/local-development/05-calling-tools/#view-agent-logs","title":"View Agent Logs","text":"<p>For agents running in background (detached mode):</p> <pre><code># Last 100 lines (default)\nmeshctl logs my-agent\n\n# Follow logs in real-time\nmeshctl logs my-agent -f\n\n# Last 50 lines\nmeshctl logs my-agent --tail 50\n\n# Logs from last 10 minutes\nmeshctl logs my-agent --since 10m\n\n# Previous log (before last restart)\nmeshctl logs my-agent -p\n\n# List available agent logs\nmeshctl logs --list\n</code></pre>"},{"location":"typescript/local-development/05-calling-tools/#built-in-documentation","title":"Built-in Documentation","text":"<pre><code># List all documentation topics\nmeshctl man --list\n\n# View specific topic\nmeshctl man decorators      # SDK reference\nmeshctl man llm             # LLM integration guide\nmeshctl man di              # Dependency injection\nmeshctl man quickstart      # Getting started guide\n\n# Raw markdown (for LLMs)\nmeshctl man decorators --raw\n</code></pre>"},{"location":"typescript/local-development/05-calling-tools/#quick-reference","title":"Quick Reference","text":"Command Description <code>meshctl call &lt;tool&gt;</code> Call tool (auto-discover) <code>meshctl call &lt;tool&gt; '{...}'</code> Call with JSON args <code>meshctl call --trace &lt;tool&gt;</code> Call with tracing <code>meshctl trace &lt;id&gt;</code> View call tree <code>meshctl logs &lt;agent&gt; -f</code> Follow agent logs <code>meshctl man --list</code> List doc topics <code>meshctl man &lt;topic&gt;</code> View documentation"},{"location":"typescript/local-development/05-calling-tools/#troubleshooting-calls","title":"Troubleshooting Calls","text":"<p>If a call fails:</p> <ol> <li>Check the agent is running: <code>meshctl list</code></li> <li>Check tool exists: <code>meshctl list --tools=&lt;tool_name&gt;</code></li> <li>Enable tracing: <code>meshctl call --trace &lt;tool&gt;</code></li> <li>Check logs: <code>meshctl logs &lt;agent&gt; --since 5m</code></li> </ol>"},{"location":"typescript/local-development/05-calling-tools/#next-steps","title":"Next Steps","text":"<p>See Troubleshooting for common issues \u2192</p>"},{"location":"typescript/local-development/troubleshooting/","title":"Troubleshooting (TypeScript)","text":"\ud83d\udc0d Looking for Python? See Python Troubleshooting <p>Common issues and solutions for MCP Mesh TypeScript development</p>"},{"location":"typescript/local-development/troubleshooting/#quick-diagnostics","title":"Quick Diagnostics","text":"<pre><code># Check CLI is installed\nmeshctl --version\n\n# Check registry is running\ncurl http://localhost:8000/health\n\n# List agents and their status\nmeshctl list --all\n\n# Check agent logs\nmeshctl logs &lt;agent-name&gt; --since 5m\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#registry-issues","title":"Registry Issues","text":""},{"location":"typescript/local-development/troubleshooting/#registry-not-running","title":"Registry Not Running","text":"<p>Symptom: <code>Connection refused</code> when starting agents</p> <pre><code># Start registry manually\nmeshctl start --registry-only\n\n# Or start an agent (registry auto-starts)\nmeshctl start src/index.ts\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#port-8000-already-in-use","title":"Port 8000 Already in Use","text":"<pre><code># Find what's using the port\nlsof -i :8000\n\n# Kill it\nkill $(lsof -t -i:8000)\n\n# Or use a different port\nmeshctl start --registry-port 9000 src/index.ts\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#agent-issues","title":"Agent Issues","text":""},{"location":"typescript/local-development/troubleshooting/#agent-not-appearing-in-registry","title":"Agent Not Appearing in Registry","text":"<pre><code># Check agent is running\nmeshctl list --all\n\n# Enable debug logging\nmeshctl start --debug src/index.ts\n\n# Check for registration errors in logs\nmeshctl logs my-agent --since 5m | grep -i error\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#dependencies-not-resolved","title":"Dependencies Not Resolved","text":"<p>Symptom: Agent shows <code>1/2</code> in DEPS column</p> <pre><code># See which dependencies are missing\nmeshctl status my-agent\n\n# Check if the providing agent is running\nmeshctl list\n\n# Start the missing agent\nmeshctl start provider-agent/src/index.ts\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#port-conflict-between-agents","title":"Port Conflict Between Agents","text":"<p>Symptom: <code>EADDRINUSE: address already in use</code></p> <p>Agents auto-assign ports by default. If you've hardcoded ports:</p> <pre><code>// Don't do this for local dev\nconst agent = mesh(server, { name: \"my-agent\", port: 8080 }); // Conflicts!\n\n// Do this instead - let mesh assign ports\nconst agent = mesh(server, { name: \"my-agent\", port: 0 }); // Auto-assign\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#tool-call-issues","title":"Tool Call Issues","text":""},{"location":"typescript/local-development/troubleshooting/#tool-not-found","title":"Tool Not Found","text":"<pre><code># List all available tools\nmeshctl list --tools\n\n# Check tool details\nmeshctl list --tools=my_tool_name\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#call-timeout","title":"Call Timeout","text":"<pre><code># Increase timeout (default 30s)\nmeshctl call --timeout 60 slow_operation\n\n# Check if agent is healthy\nmeshctl list\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#wrong-arguments","title":"Wrong Arguments","text":"<pre><code># Check tool's expected schema\nmeshctl list --tools=my_tool_name\n\n# Shows parameter types and required fields\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#typescript-issues","title":"TypeScript Issues","text":""},{"location":"typescript/local-development/troubleshooting/#module-import-errors","title":"Module Import Errors","text":"<pre><code># Verify SDK is installed\nnpm list @mcpmesh/sdk\n\n# Reinstall if needed\nnpm install @mcpmesh/sdk zod\n\n# Check package.json has \"type\": \"module\"\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#tsx-not-found","title":"tsx Not Found","text":"<pre><code># Install tsx\nnpm install -D tsx\n\n# Verify it works\nnpx tsx --version\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#logging-debugging","title":"Logging &amp; Debugging","text":""},{"location":"typescript/local-development/troubleshooting/#enable-debug-logging","title":"Enable Debug Logging","text":"<pre><code># Via CLI flag\nmeshctl start --debug src/index.ts\n\n# Or via log level\nmeshctl start --log-level DEBUG src/index.ts\n\n# TRACE level for SQL queries\nmeshctl start --log-level TRACE src/index.ts\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#view-distributed-trace","title":"View Distributed Trace","text":"<pre><code># Call with tracing\nmeshctl call --trace my_tool\n\n# View the trace tree\nmeshctl trace &lt;trace-id&gt;\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#getting-help","title":"Getting Help","text":"<pre><code># Built-in documentation\nmeshctl man --list\nmeshctl man &lt;topic&gt;\n\n# Command help\nmeshctl &lt;command&gt; --help\n</code></pre>"},{"location":"typescript/local-development/troubleshooting/#still-stuck","title":"Still Stuck?","text":"<ol> <li>Check GitHub Issues</li> <li>Enable <code>--debug</code> and share the logs</li> <li>Create a minimal reproduction case</li> </ol>"}]}